<span class="com">(* The Great Computer Language Shootout
   http://shootout.alioth.debian.org

   contributed by Isaac Gouy (Oberon-2 novice)
*)</span>


<span class="kwa">MODULE</span> Fasta<span class="sym">;
</span><span class="kwa">IMPORT</span> LangShootout<span class="sym">,</span> Random<span class="sym">,</span> Out<span class="sym">;

</span><span class="kwa">CONST</span> length <span class="sym">=</span> <span class="num">60</span><span class="sym">;

</span><span class="kwa">TYPE
</span>   Frequency <span class="sym">=</span> <span class="kwa">RECORD
</span>      c<span class="sym">:</span> <span class="kwb">CHAR</span><span class="sym">;
</span>      p<span class="sym">:</span> <span class="kwb">LONGREAL</span><span class="sym">;
</span>   <span class="kwa">END</span><span class="sym">;

</span>   Freqency4 <span class="sym">=</span> <span class="kwa">ARRAY</span> <span class="num">4</span> <span class="kwa">OF</span> Frequency<span class="sym">;
</span>   Freqency17 <span class="sym">=</span> <span class="kwa">ARRAY</span> <span class="num">17</span> <span class="kwa">OF</span> Frequency<span class="sym">;

</span><span class="kwa">VAR
</span>   dna1<span class="sym">:</span> Freqency4<span class="sym">;
</span>   dna2<span class="sym">:</span> Freqency17<span class="sym">;
</span>   n<span class="sym">:</span> <span class="kwb">LONGINT</span><span class="sym">;


</span><span class="kwa">PROCEDURE</span> MakeCumulative<span class="sym">(</span><span class="kwa">VAR</span> a<span class="sym">:</span> <span class="kwa">ARRAY OF</span> Frequency<span class="sym">);
</span><span class="kwa">VAR
</span>   i<span class="sym">:</span> <span class="kwb">LONGINT</span><span class="sym">;
</span>   cp<span class="sym">:</span> <span class="kwb">LONGREAL</span><span class="sym">;
</span><span class="kwa">BEGIN
</span>   cp <span class="sym">:=</span> <span class="num">0.0</span><span class="sym">;
</span>   FOR i <span class="sym">:=</span> <span class="num">0</span> <span class="kwa">TO LEN</span><span class="sym">(</span>a<span class="sym">) -</span> <span class="num">1</span> <span class="kwa">DO
</span>      cp <span class="sym">:=</span> cp <span class="sym">+</span> a<span class="sym">[</span>i<span class="sym">].</span>p<span class="sym">;
</span>      a<span class="sym">[</span>i<span class="sym">].</span>p <span class="sym">:=</span> cp<span class="sym">;
</span>   <span class="kwa">END</span><span class="sym">;
</span><span class="kwa">END</span> MakeCumulative<span class="sym">;


</span><span class="kwa">PROCEDURE</span> MakeDna1<span class="sym">(</span><span class="kwa">VAR</span> a<span class="sym">:</span> Freqency4<span class="sym">);
</span><span class="kwa">BEGIN
</span>   a<span class="sym">[</span><span class="num">0</span><span class="sym">].</span>c <span class="sym">:=</span> <span class="str">&quot;a&quot;</span><span class="sym">;</span>   a<span class="sym">[</span><span class="num">0</span><span class="sym">].</span>p <span class="sym">:=</span> <span class="num">0.3029549426680</span><span class="sym">;
</span>   a<span class="sym">[</span><span class="num">1</span><span class="sym">].</span>c <span class="sym">:=</span> <span class="str">&quot;c&quot;</span><span class="sym">;</span>   a<span class="sym">[</span><span class="num">1</span><span class="sym">].</span>p <span class="sym">:=</span> <span class="num">0.1979883004921</span><span class="sym">;
</span>   a<span class="sym">[</span><span class="num">2</span><span class="sym">].</span>c <span class="sym">:=</span> <span class="str">&quot;g&quot;</span><span class="sym">;</span>   a<span class="sym">[</span><span class="num">2</span><span class="sym">].</span>p <span class="sym">:=</span> <span class="num">0.1975473066391</span><span class="sym">;
</span>   a<span class="sym">[</span><span class="num">3</span><span class="sym">].</span>c <span class="sym">:=</span> <span class="str">&quot;t&quot;</span><span class="sym">;</span>   a<span class="sym">[</span><span class="num">3</span><span class="sym">].</span>p <span class="sym">:=</span> <span class="num">0.3015094502008</span><span class="sym">;

</span>   MakeCumulative<span class="sym">(</span>a<span class="sym">);
</span><span class="kwa">END</span> MakeDna1<span class="sym">;


</span><span class="kwa">PROCEDURE</span> MakeDna2<span class="sym">(</span><span class="kwa">VAR</span> a<span class="sym">:</span> Freqency17<span class="sym">);
</span><span class="kwa">BEGIN
</span>   a<span class="sym">[</span><span class="num">0</span><span class="sym">].</span>c <span class="sym">:=</span> <span class="str">&quot;a&quot;</span><span class="sym">;</span>   a<span class="sym">[</span><span class="num">0</span><span class="sym">].</span>p <span class="sym">:=</span> <span class="num">0.250</span><span class="sym">;
</span>   a<span class="sym">[</span><span class="num">1</span><span class="sym">].</span>c <span class="sym">:=</span> <span class="str">&quot;c&quot;</span><span class="sym">;</span>   a<span class="sym">[</span><span class="num">1</span><span class="sym">].</span>p <span class="sym">:=</span> <span class="num">0.125</span><span class="sym">;
</span>   a<span class="sym">[</span><span class="num">2</span><span class="sym">].</span>c <span class="sym">:=</span> <span class="str">&quot;g&quot;</span><span class="sym">;</span>   a<span class="sym">[</span><span class="num">2</span><span class="sym">].</span>p <span class="sym">:=</span> <span class="num">0.125</span><span class="sym">;
</span>   a<span class="sym">[</span><span class="num">3</span><span class="sym">].</span>c <span class="sym">:=</span> <span class="str">&quot;t&quot;</span><span class="sym">;</span>   a<span class="sym">[</span><span class="num">3</span><span class="sym">].</span>p <span class="sym">:=</span> <span class="num">0.250</span><span class="sym">;

</span>   a<span class="sym">[</span><span class="num">4</span><span class="sym">].</span>c <span class="sym">:=</span> <span class="str">&quot;U&quot;</span><span class="sym">;</span>   a<span class="sym">[</span><span class="num">4</span><span class="sym">].</span>p <span class="sym">:=</span> <span class="num">0.019230769231</span><span class="sym">;
</span>   a<span class="sym">[</span><span class="num">5</span><span class="sym">].</span>c <span class="sym">:=</span> <span class="str">&quot;R&quot;</span><span class="sym">;</span>   a<span class="sym">[</span><span class="num">5</span><span class="sym">].</span>p <span class="sym">:=</span> <span class="num">0.019230769231</span><span class="sym">;
</span>   a<span class="sym">[</span><span class="num">6</span><span class="sym">].</span>c <span class="sym">:=</span> <span class="str">&quot;Y&quot;</span><span class="sym">;</span>   a<span class="sym">[</span><span class="num">6</span><span class="sym">].</span>p <span class="sym">:=</span> <span class="num">0.019230769231</span><span class="sym">;
</span>   a<span class="sym">[</span><span class="num">7</span><span class="sym">].</span>c <span class="sym">:=</span> <span class="str">&quot;K&quot;</span><span class="sym">;</span>   a<span class="sym">[</span><span class="num">7</span><span class="sym">].</span>p <span class="sym">:=</span> <span class="num">0.019230769231</span><span class="sym">;
</span>   a<span class="sym">[</span><span class="num">8</span><span class="sym">].</span>c <span class="sym">:=</span> <span class="str">&quot;M&quot;</span><span class="sym">;</span>   a<span class="sym">[</span><span class="num">8</span><span class="sym">].</span>p <span class="sym">:=</span> <span class="num">0.019230769231</span><span class="sym">;
</span>   a<span class="sym">[</span><span class="num">9</span><span class="sym">].</span>c <span class="sym">:=</span> <span class="str">&quot;S&quot;</span><span class="sym">;</span>   a<span class="sym">[</span><span class="num">9</span><span class="sym">].</span>p <span class="sym">:=</span> <span class="num">0.019230769231</span><span class="sym">;
</span>   a<span class="sym">[</span><span class="num">10</span><span class="sym">].</span>c <span class="sym">:=</span> <span class="str">&quot;W&quot;</span><span class="sym">;</span>  a<span class="sym">[</span><span class="num">10</span><span class="sym">].</span>p <span class="sym">:=</span> <span class="num">0.019230769231</span><span class="sym">;
</span>   a<span class="sym">[</span><span class="num">11</span><span class="sym">].</span>c <span class="sym">:=</span> <span class="str">&quot;B&quot;</span><span class="sym">;</span>  a<span class="sym">[</span><span class="num">11</span><span class="sym">].</span>p <span class="sym">:=</span> <span class="num">0.019230769231</span><span class="sym">;
</span>   a<span class="sym">[</span><span class="num">12</span><span class="sym">].</span>c <span class="sym">:=</span> <span class="str">&quot;D&quot;</span><span class="sym">;</span>  a<span class="sym">[</span><span class="num">12</span><span class="sym">].</span>p <span class="sym">:=</span> <span class="num">0.019230769231</span><span class="sym">;
</span>   a<span class="sym">[</span><span class="num">13</span><span class="sym">].</span>c <span class="sym">:=</span> <span class="str">&quot;H&quot;</span><span class="sym">;</span>  a<span class="sym">[</span><span class="num">13</span><span class="sym">].</span>p <span class="sym">:=</span> <span class="num">0.019230769231</span><span class="sym">;
</span>   a<span class="sym">[</span><span class="num">14</span><span class="sym">].</span>c <span class="sym">:=</span> <span class="str">&quot;V&quot;</span><span class="sym">;</span>  a<span class="sym">[</span><span class="num">14</span><span class="sym">].</span>p <span class="sym">:=</span> <span class="num">0.019230769231</span><span class="sym">;
</span>   a<span class="sym">[</span><span class="num">15</span><span class="sym">].</span>c <span class="sym">:=</span> <span class="str">&quot;N&quot;</span><span class="sym">;</span>  a<span class="sym">[</span><span class="num">15</span><span class="sym">].</span>p <span class="sym">:=</span> <span class="num">0.019230769231</span><span class="sym">;
</span>   a<span class="sym">[</span><span class="num">16</span><span class="sym">].</span>c <span class="sym">:=</span> <span class="str">&quot;-&quot;</span><span class="sym">;</span>  a<span class="sym">[</span><span class="num">16</span><span class="sym">].</span>p <span class="sym">:=</span> <span class="num">0.019230769231</span><span class="sym">;

</span>   MakeCumulative<span class="sym">(</span>a<span class="sym">);
</span><span class="kwa">END</span> MakeDna2<span class="sym">;


</span><span class="kwa">PROCEDURE</span> SelectRandom<span class="sym">(</span><span class="kwa">VAR</span> a<span class="sym">:</span> <span class="kwa">ARRAY OF</span> Frequency<span class="sym">):</span> <span class="kwb">CHAR</span><span class="sym">;
</span><span class="kwa">VAR
</span>   i<span class="sym">:</span> <span class="kwb">LONGINT</span><span class="sym">;
</span>   r<span class="sym">:</span> <span class="kwb">LONGREAL</span><span class="sym">;
</span><span class="kwa">BEGIN
</span>   r <span class="sym">:=</span> Random<span class="sym">.</span>Next<span class="sym">(</span><span class="num">1.0</span><span class="sym">);
</span>   FOR i <span class="sym">:=</span> <span class="num">0</span> <span class="kwa">TO LEN</span><span class="sym">(</span>a<span class="sym">) -</span> <span class="num">1</span> <span class="kwa">DO
      IF</span> r <span class="sym">&lt;</span> a<span class="sym">[</span>i<span class="sym">].</span>p <span class="kwa">THEN RETURN</span> a<span class="sym">[</span>i<span class="sym">].</span>c<span class="sym">;</span> <span class="kwa">END</span><span class="sym">;
</span>   <span class="kwa">END</span><span class="sym">;
</span><span class="kwa">END</span> SelectRandom<span class="sym">;


</span><span class="kwa">PROCEDURE</span> MakeFastaFragment<span class="sym">(</span>id<span class="sym">,</span>desc<span class="sym">:</span> <span class="kwa">ARRAY OF</span> <span class="kwb">CHAR</span><span class="sym">;
</span>                            <span class="kwa">VAR</span> a<span class="sym">:</span> <span class="kwa">ARRAY OF</span> Frequency<span class="sym">;
</span>                            n<span class="sym">:</span> <span class="kwb">LONGINT</span><span class="sym">);
</span><span class="kwa">VAR
</span>   i<span class="sym">,</span> m<span class="sym">:</span> <span class="kwb">LONGINT</span><span class="sym">;
</span><span class="kwa">BEGIN
</span>   Out<span class="sym">.</span>String<span class="sym">(</span><span class="str">&quot;&gt;&quot;</span><span class="sym">);</span> Out<span class="sym">.</span>String<span class="sym">(</span>id<span class="sym">);</span> Out<span class="sym">.</span>Char<span class="sym">(</span><span class="num">20X</span><span class="sym">);</span> Out<span class="sym">.</span>String<span class="sym">(</span>desc<span class="sym">);</span> Out<span class="sym">.</span>Ln<span class="sym">;
</span>   <span class="kwa">WHILE</span> n <span class="sym">&gt;</span> <span class="num">0</span> <span class="kwa">DO
      IF</span> n <span class="sym">&lt;</span> length <span class="kwa">THEN</span> m <span class="sym">:=</span> n<span class="sym">;</span> <span class="kwa">ELSE</span> m <span class="sym">:=</span> length<span class="sym">;</span> <span class="kwa">END</span><span class="sym">;
</span>      FOR i <span class="sym">:=</span> <span class="num">0</span> <span class="kwa">TO</span> m<span class="num">-1</span> <span class="kwa">DO</span> Out<span class="sym">.</span>Char<span class="sym">(</span> SelectRandom<span class="sym">(</span>a<span class="sym">) );</span> <span class="kwa">END</span><span class="sym">;</span> Out<span class="sym">.</span>Ln<span class="sym">;
</span>      <span class="kwa">DEC</span><span class="sym">(</span>n<span class="sym">,</span>length<span class="sym">);
</span>   <span class="kwa">END</span><span class="sym">;
</span><span class="kwa">END</span> MakeFastaFragment<span class="sym">;


</span><span class="kwa">BEGIN
</span>   n <span class="sym">:=</span> LangShootout<span class="sym">.</span>Argi<span class="sym">();
</span>   <span class="kwa">IF</span> n <span class="sym">=</span> <span class="num">1</span> <span class="kwa">THEN</span> n <span class="sym">:=</span> <span class="num">1000</span><span class="sym">;</span> <span class="kwa">END</span><span class="sym">;

</span>   MakeDna1<span class="sym">(</span>dna1<span class="sym">);
</span>   MakeDna2<span class="sym">(</span>dna2<span class="sym">);

</span>   MakeFastaFragment<span class="sym">(</span>'TestOne'<span class="sym">,</span>'test fragment'<span class="sym">,</span>dna2<span class="sym">,</span>n<span class="sym">*</span><span class="num">1</span><span class="sym">);
</span>   MakeFastaFragment<span class="sym">(</span>'TestTwo'<span class="sym">,</span>'test fragment'<span class="sym">,</span>dna1<span class="sym">,</span>n<span class="sym">*</span><span class="num">2</span><span class="sym">);
</span>   MakeFastaFragment<span class="sym">(</span>'TestThree'<span class="sym">,</span>'test fragment'<span class="sym">,</span>dna2<span class="sym">,</span>n<span class="sym">*</span><span class="num">3</span><span class="sym">);
</span>   MakeFastaFragment<span class="sym">(</span>'TestFour'<span class="sym">,</span>'test fragment'<span class="sym">,</span>dna1<span class="sym">,</span>n<span class="sym">*</span><span class="num">4</span><span class="sym">);
</span>   MakeFastaFragment<span class="sym">(</span>'TestFive'<span class="sym">,</span>'test fragment'<span class="sym">,</span>dna2<span class="sym">,</span>n<span class="sym">*</span><span class="num">5</span><span class="sym">);
</span><span class="kwa">END</span> Fasta<span class="sym">.

</span><span class="com">(*
 * vim: ts=4 ft=oberon2
 *)</span>
