<table width="100%" border="0" cellpadding="5" cellspacing="0"><tr><td bgcolor="#FFFFFF"><pre>
%% $Id: sumcol-mercury.code,v 1.2 2004-11-08 08:15:53 bfulgham Exp $
%% http:<I><FONT COLOR="#B22222">//www.bagley.org/~doug/shootout/
</FONT></I>
:- module mytest.

:- <B><FONT COLOR="#A020F0">interface</FONT></B>.

:- import_module io.

:- pred main(io__state :: di, io__state :: uo) <B><FONT COLOR="#A020F0">is</FONT></B> det.

:- <B><FONT COLOR="#A020F0">implementation</FONT></B>.

:- import_module <B><FONT COLOR="#A020F0">string</FONT></B>, int.

main --&gt;
    io__read_line_as_string(IOResult),
    sumcol(IOResult, 0).

:- pred sumcol(io__result(<B><FONT COLOR="#A020F0">string</FONT></B>)::<B><FONT COLOR="#A020F0">in</FONT></B>, int::<B><FONT COLOR="#A020F0">in</FONT></B>, io__state::di, io__state::uo) <B><FONT COLOR="#A020F0">is</FONT></B> det.

sumcol(IOResult, Sum) --&gt;
    ( <I><FONT COLOR="#B22222">{ IOResult = ok(LineIn) }</FONT></I>,
        <I><FONT COLOR="#B22222">{ chomp(LineIn, Line) }</FONT></I>,
	io__read_line_as_string(NewIOResult),
	( <B><FONT COLOR="#A020F0">if</FONT></B> <I><FONT COLOR="#B22222">{ string__to_int(Line, N) }</FONT></I> <B><FONT COLOR="#A020F0">then</FONT></B>
	    sumcol(NewIOResult, Sum + N)
	  <B><FONT COLOR="#A020F0">else</FONT></B>
	    sumcol(NewIOResult, Sum)
	)
    ; <I><FONT COLOR="#B22222">{ IOResult = eof }</FONT></I>,
        io__write_int(Sum),
	io__write_string(&quot;\n&quot;)
    ; <I><FONT COLOR="#B22222">{ IOResult = error(_Error) }</FONT></I>,
	io__write_string(&quot;Error reading <B><FONT COLOR="#A020F0">file</FONT></B>!&quot;)
    ).

:- pred chomp(<B><FONT COLOR="#A020F0">string</FONT></B>::<B><FONT COLOR="#A020F0">in</FONT></B>, <B><FONT COLOR="#A020F0">string</FONT></B>::out) <B><FONT COLOR="#A020F0">is</FONT></B> det.

chomp(InStr, OutStr) :-
    ( <B><FONT COLOR="#A020F0">if</FONT></B> string__remove_suffix(InStr, &quot;\n&quot;, NewStr) <B><FONT COLOR="#A020F0">then</FONT></B>
	OutStr = NewStr
      <B><FONT COLOR="#A020F0">else</FONT></B>
	OutStr = InStr
    ).</pre></td></tr></table>
