<table width="100%" border="0" cellpadding="5" cellspacing="0"><tr><td bgcolor="#FFFFFF"><pre>
<B><FONT COLOR="#BC8F8F">&quot;  The Great Computer Language Shootout
   contributed by Paolo Bonzini

   To run: gst -QI /usr/local/share/smalltalk/gst.im matrix.st -a 300
&quot;</FONT></B>

!Array class methodsFor: <B><FONT COLOR="#BC8F8F">'instance creation'</FONT></B>!

newMatrix: rows columns: cols
    | count mx row |
    count := 1.
    mx := self <B><FONT COLOR="#A020F0">new</FONT></B>: rows.
    1 to: rows <B><FONT COLOR="#A020F0">do</FONT></B>: [ :i |
        row := mx at: i put: (Array <B><FONT COLOR="#A020F0">new</FONT></B>: cols).
        1 to: cols <B><FONT COLOR="#A020F0">do</FONT></B>: [ :j |
	    row at: j put: count.
	    count := count + 1
	].
    ].
    ^mx! !

!Array methodsFor: <B><FONT COLOR="#BC8F8F">'testing'</FONT></B>!

atXY: coord
    ^(self at: coord <B><FONT COLOR="#A020F0">x</FONT></B>) at: coord <B><FONT COLOR="#A020F0">y</FONT></B>!
    
mmult: m2
    | rows cols terms val mx row myRow |
    rows := self size.
    terms := m2 size.
    cols := m2 first size.
    mx := Array <B><FONT COLOR="#A020F0">new</FONT></B>: rows.
    1 to: rows <B><FONT COLOR="#A020F0">do</FONT></B>: [ :i |
        row := mx at: i put: (Array <B><FONT COLOR="#A020F0">new</FONT></B>: cols).
	myRow := self at: i.
        1 to: cols <B><FONT COLOR="#A020F0">do</FONT></B>: [ :j |
	    val := 0.
	    1 to: terms <B><FONT COLOR="#A020F0">do</FONT></B>: [ :k |
	        val := val + ((myRow at: k) * ((m2 at: k) at: j) bitAnd: 16r3FFF_FFFF) ].
	    row at: j put: val.
	].
    ].
    ^mx! !


| m1 m2 mm size n |
n := Smalltalk arguments isEmpty
   ifTrue: [ 1 ]
   ifFalse: [ 1 max: Smalltalk arguments first asInteger ].

size := 30.
m1 := Array newMatrix: size columns: size.
m2 := Array newMatrix: size columns: size.
n timesRepeat: [ mm := m1 mmult: m2 ].
(<B><FONT COLOR="#BC8F8F">'%1 %2 %3 %4'</FONT></B> bindWith: (mm atXY: 1@1)
    with: (mm atXY: 3@4) with: (mm atXY: 4@3)
    with: (mm atXY: 5@5)) displayNl!</pre></td></tr></table>
