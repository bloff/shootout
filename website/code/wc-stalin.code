<table width="100%" border="0" cellpadding="5" cellspacing="0"><tr><td bgcolor="#FFFFFF"><pre>
<I><FONT COLOR="#B22222">;;; $Id: wc-stalin.code,v 1.1 2004-11-02 08:53:32 bfulgham Exp $
</FONT></I><I><FONT COLOR="#B22222">;;; http://www.bagley.org/~doug/shootout/
</FONT></I><I><FONT COLOR="#B22222">;;; based on code from Bengt Kleberg
</FONT></I>
(include <B><FONT COLOR="#BC8F8F">&quot;QobiScheme&quot;</FONT></B>)

<I><FONT COLOR="#B22222">; x is a character
</FONT></I><I><FONT COLOR="#B22222">; nl is number of newlines
</FONT></I><I><FONT COLOR="#B22222">; nw is number of words
</FONT></I><I><FONT COLOR="#B22222">; nc in number of chsracters
</FONT></I>
(<B><FONT COLOR="#A020F0">define</FONT></B> <B><FONT COLOR="#0000FF">wcport</FONT></B>
  (<B><FONT COLOR="#A020F0">lambda</FONT></B> (port)
    (<B><FONT COLOR="#A020F0">letrec</FONT></B> ((wc (<B><FONT COLOR="#A020F0">lambda</FONT></B> (x nl nw nc inword)
		   (<B><FONT COLOR="#A020F0">if</FONT></B> (eof-object? x)
		       (<B><FONT COLOR="#A020F0">begin</FONT></B> (display nl) (display <B><FONT COLOR="#BC8F8F">&quot; &quot;</FONT></B>) (display nw)
			      (display <B><FONT COLOR="#BC8F8F">&quot; &quot;</FONT></B>) (display nc) (newline))
		       (<B><FONT COLOR="#A020F0">let</FONT></B> ((new-nl (<B><FONT COLOR="#A020F0">if</FONT></B> (char=? x #\newline) (+ nl 1) nl)))
			 (<B><FONT COLOR="#A020F0">if</FONT></B> (char-whitespace? x)
			     (wc (read-char port) new-nl (<B><FONT COLOR="#A020F0">if</FONT></B> inword (+ nw 1) nw) (+ nc 1) #f)
			     (wc (read-char port) new-nl nw (+ nc 1) #t)))))))
      (wc (read-char port) 0 0 0 #f))))

(wcport (current-input-port))</pre></td></tr></table>
