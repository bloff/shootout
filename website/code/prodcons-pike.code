<table width="100%" border="0" cellpadding="5" cellspacing="0"><tr><td bgcolor="#FFFFFF"><pre>
#!/<B><FONT COLOR="#5F9EA0">usr/bin/pike</FONT></B>
<I><FONT COLOR="#B22222">// -*- mode: pike -*-
</FONT></I><I><FONT COLOR="#B22222">// $Id: prodcons-pike.code,v 1.2 2004-11-08 08:15:18 bfulgham Exp $
</FONT></I><I><FONT COLOR="#B22222">// http://www.bagley.org/~doug/shootout/
</FONT></I>
inherit Thread.Condition: access;
inherit Thread.Mutex: mutex;
<B><FONT COLOR="#228B22">int</FONT></B> data, consumed, produced, count;

<B><FONT COLOR="#228B22">void</FONT></B> <B><FONT COLOR="#0000FF">producer</FONT></B>(<B><FONT COLOR="#228B22">int</FONT></B> n) {
    <B><FONT COLOR="#A020F0">for</FONT></B> (<B><FONT COLOR="#228B22">int</FONT></B> i=1; i&lt;=n; i++) {
	object mtx = mutex::lock();
	<B><FONT COLOR="#A020F0">while</FONT></B> (count != 0) access::wait(mtx);
	data = i;
	count += 1;
	destruct(mtx);
	<B><FONT COLOR="#5F9EA0">access</FONT></B>::signal();
	produced += 1;
    }
}

<B><FONT COLOR="#228B22">void</FONT></B> <B><FONT COLOR="#0000FF">consumer</FONT></B>(<B><FONT COLOR="#228B22">int</FONT></B> n) {
    <B><FONT COLOR="#A020F0">while</FONT></B> (1) {
	object mtx = mutex::lock();
	<B><FONT COLOR="#A020F0">while</FONT></B> (count == 0) access::wait(mtx);
	<B><FONT COLOR="#228B22">int</FONT></B> i = data;
	count -= 1;
	<B><FONT COLOR="#5F9EA0">access</FONT></B>::signal();
	destruct(mtx);
	consumed += 1;
	<B><FONT COLOR="#A020F0">if</FONT></B> (i == n) <B><FONT COLOR="#A020F0">break</FONT></B>;
    }
}

<B><FONT COLOR="#228B22">void</FONT></B> <B><FONT COLOR="#0000FF">main</FONT></B>(<B><FONT COLOR="#228B22">int</FONT></B> argc, array(string) argv) {
    <B><FONT COLOR="#228B22">int</FONT></B> n = (<B><FONT COLOR="#228B22">int</FONT></B>)argv[-1];
    <B><FONT COLOR="#A020F0">if</FONT></B> (n &lt; 1) n = 1;
    data = consumed = produced = count = 0;
    thread_create(producer, n);
    consumer(n);
    write(<B><FONT COLOR="#BC8F8F">&quot;%d %d\n&quot;</FONT></B>, produced, consumed);
}</pre></td></tr></table>
