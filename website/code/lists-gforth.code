<table width="100%" border="0" cellpadding="5" cellspacing="0"><tr><td bgcolor="#FFFFFF"><pre>
<I><FONT COLOR="#B22222">\ -*- mode: forth -*-
</FONT></I><I><FONT COLOR="#B22222">\ $Id: lists-gforth.code,v 1.1 2004-11-02 08:52:33 bfulgham Exp $
</FONT></I><I><FONT COLOR="#B22222">\ http://www.bagley.org/~doug/shootout/
</FONT></I><I><FONT COLOR="#B22222">\ from Anton Ertl
</FONT></I>
0. argc @ 1<B><FONT COLOR="#5F9EA0">-</FONT></B> arg <B><FONT COLOR="#5F9EA0">&gt;</FONT></B>number <B><FONT COLOR="#5F9EA0">2drop</FONT></B> <B><FONT COLOR="#5F9EA0">drop</FONT></B> <B><FONT COLOR="#A020F0">constant</FONT></B> NUM

10000 <B><FONT COLOR="#A020F0">constant</FONT></B> SIZE

struct
    <B><FONT COLOR="#228B22">cell</FONT></B>% field list<B><FONT COLOR="#5F9EA0">-</FONT></B><B><FONT COLOR="#A020F0">next</FONT></B>
    <B><FONT COLOR="#228B22">cell</FONT></B>% field list<B><FONT COLOR="#5F9EA0">-</FONT></B>val
<B><FONT COLOR="#A020F0">end</FONT></B><B><FONT COLOR="#5F9EA0">-</FONT></B>struct list%

<B><FONT COLOR="#A020F0">: </FONT></B><B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">make-list</FONT></I></B></FONT></B> ( <B><FONT COLOR="#5F9EA0">-</FONT></B><B><FONT COLOR="#5F9EA0">-</FONT></B> list )
    0 0 SIZE <B><FONT COLOR="#5F9EA0">-</FONT></B><B><FONT COLOR="#A020F0">do</FONT></B> ( tail )
	list% %alloc
	i <B><FONT COLOR="#5F9EA0">over</FONT></B> list<B><FONT COLOR="#5F9EA0">-</FONT></B>val <B><FONT COLOR="#5F9EA0">!</FONT></B>
	<B><FONT COLOR="#5F9EA0">tuck</FONT></B> list<B><FONT COLOR="#5F9EA0">-</FONT></B><B><FONT COLOR="#A020F0">next</FONT></B> <B><FONT COLOR="#5F9EA0">!</FONT></B>
	1 <B><FONT COLOR="#5F9EA0">-</FONT></B><B><FONT COLOR="#A020F0">loop</FONT></B>
;

<B><FONT COLOR="#A020F0">: </FONT></B><B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">copy-list</FONT></I></B></FONT></B> ( list1 <B><FONT COLOR="#5F9EA0">-</FONT></B><B><FONT COLOR="#5F9EA0">-</FONT></B> list2 )
    0 { w<B><FONT COLOR="#5F9EA0">^</FONT></B> list2 }
    list2 <B><FONT COLOR="#A020F0">begin</FONT></B> ( list1' list2p' )
	<B><FONT COLOR="#5F9EA0">over</FONT></B>
    <B><FONT COLOR="#A020F0">while</FONT></B>
	list% %alloc <B><FONT COLOR="#5F9EA0">dup</FONT></B> <B><FONT COLOR="#5F9EA0">&gt;</FONT></B>r <B><FONT COLOR="#5F9EA0">swap</FONT></B> <B><FONT COLOR="#5F9EA0">!</FONT></B> ( list1' R: list2' )
	<B><FONT COLOR="#5F9EA0">dup</FONT></B> list<B><FONT COLOR="#5F9EA0">-</FONT></B>val @ r@ list<B><FONT COLOR="#5F9EA0">-</FONT></B>val <B><FONT COLOR="#5F9EA0">!</FONT></B>
	list<B><FONT COLOR="#5F9EA0">-</FONT></B><B><FONT COLOR="#A020F0">next</FONT></B> @ r<B><FONT COLOR="#5F9EA0">&gt;</FONT></B> list<B><FONT COLOR="#5F9EA0">-</FONT></B><B><FONT COLOR="#A020F0">next</FONT></B> ( list1'' list2p'' )
    <B><FONT COLOR="#A020F0">repeat</FONT></B>
    off <B><FONT COLOR="#5F9EA0">drop</FONT></B> list2 @ ;

<B><FONT COLOR="#A020F0">: </FONT></B><B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">move-head-to-tail</FONT></I></B></FONT></B> ( list1 <B><FONT COLOR="#5F9EA0">-</FONT></B><B><FONT COLOR="#5F9EA0">-</FONT></B> list2 )
    <I><FONT COLOR="#B22222">\ somehow this is an expensive noop
</FONT></I>    0 { w<B><FONT COLOR="#5F9EA0">^</FONT></B> list2 }
    list2 <B><FONT COLOR="#A020F0">begin</FONT></B> ( list1' list2p' )
	<B><FONT COLOR="#5F9EA0">over</FONT></B>
    <B><FONT COLOR="#A020F0">while</FONT></B>
	<I><FONT COLOR="#B22222">\ move one element
</FONT></I>	<B><FONT COLOR="#5F9EA0">over</FONT></B> list<B><FONT COLOR="#5F9EA0">-</FONT></B><B><FONT COLOR="#A020F0">next</FONT></B> <B><FONT COLOR="#5F9EA0">dup</FONT></B> @ 2<B><FONT COLOR="#5F9EA0">&gt;</FONT></B>r ( list1' list2p' R: list2p'' list1'' )
	<B><FONT COLOR="#5F9EA0">over</FONT></B> list<B><FONT COLOR="#5F9EA0">-</FONT></B><B><FONT COLOR="#A020F0">next</FONT></B> off
	<B><FONT COLOR="#5F9EA0">!</FONT></B> r<B><FONT COLOR="#5F9EA0">&gt;</FONT></B> r<B><FONT COLOR="#5F9EA0">&gt;</FONT></B>
    <B><FONT COLOR="#A020F0">repeat</FONT></B>
    off <B><FONT COLOR="#5F9EA0">drop</FONT></B> list2 @ ;

<B><FONT COLOR="#A020F0">: </FONT></B><B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">nreverse</FONT></I></B></FONT></B> ( list1 <B><FONT COLOR="#5F9EA0">-</FONT></B><B><FONT COLOR="#5F9EA0">-</FONT></B> list2 )
    <I><FONT COLOR="#B22222">\ destructive reverse
</FONT></I>    0 <B><FONT COLOR="#5F9EA0">swap</FONT></B> <B><FONT COLOR="#A020F0">begin</FONT></B> ( list2' list1' )
	<B><FONT COLOR="#5F9EA0">dup</FONT></B>
    <B><FONT COLOR="#A020F0">while</FONT></B>
	<B><FONT COLOR="#5F9EA0">dup</FONT></B> list<B><FONT COLOR="#5F9EA0">-</FONT></B><B><FONT COLOR="#A020F0">next</FONT></B> @ <B><FONT COLOR="#5F9EA0">&gt;</FONT></B>r ( list2' list1' R: list1'' )
	<B><FONT COLOR="#5F9EA0">tuck</FONT></B> list<B><FONT COLOR="#5F9EA0">-</FONT></B><B><FONT COLOR="#A020F0">next</FONT></B> <B><FONT COLOR="#5F9EA0">!</FONT></B> r<B><FONT COLOR="#5F9EA0">&gt;</FONT></B> ( list1' list1'' )
    <B><FONT COLOR="#A020F0">repeat</FONT></B>
    <B><FONT COLOR="#5F9EA0">drop</FONT></B> ;

<B><FONT COLOR="#A020F0">: </FONT></B><B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">move-tail-to-tail</FONT></I></B></FONT></B> ( list1 <B><FONT COLOR="#5F9EA0">-</FONT></B><B><FONT COLOR="#5F9EA0">-</FONT></B> list2 )
    <I><FONT COLOR="#B22222">\ use head-to-tail instead of head-to-head nreverse
</FONT></I>    nreverse move<B><FONT COLOR="#5F9EA0">-</FONT></B>head<B><FONT COLOR="#5F9EA0">-</FONT></B>to<B><FONT COLOR="#5F9EA0">-</FONT></B>tail ;

<B><FONT COLOR="#A020F0">: </FONT></B><B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">list-equals</FONT></I></B></FONT></B> ( list1 list2 <B><FONT COLOR="#5F9EA0">-</FONT></B><B><FONT COLOR="#5F9EA0">-</FONT></B> f )
    <B><FONT COLOR="#A020F0">begin</FONT></B> ( l1' l2' )
	<B><FONT COLOR="#5F9EA0">dup</FONT></B>
    <B><FONT COLOR="#A020F0">while</FONT></B>
	<B><FONT COLOR="#5F9EA0">over</FONT></B>
    <B><FONT COLOR="#A020F0">while</FONT></B>
	<B><FONT COLOR="#5F9EA0">over</FONT></B> list<B><FONT COLOR="#5F9EA0">-</FONT></B>val @ <B><FONT COLOR="#5F9EA0">over</FONT></B> list<B><FONT COLOR="#5F9EA0">-</FONT></B>val @ <B><FONT COLOR="#5F9EA0">&lt;&gt;</FONT></B> <B><FONT COLOR="#A020F0">if</FONT></B>
	    <B><FONT COLOR="#5F9EA0">2drop</FONT></B> false <B><FONT COLOR="#A020F0">exit</FONT></B>
	<B><FONT COLOR="#A020F0">endif</FONT></B>
	list<B><FONT COLOR="#5F9EA0">-</FONT></B><B><FONT COLOR="#A020F0">next</FONT></B> @ <B><FONT COLOR="#5F9EA0">swap</FONT></B> list<B><FONT COLOR="#5F9EA0">-</FONT></B><B><FONT COLOR="#A020F0">next</FONT></B> @ ( symmetric )
    <B><FONT COLOR="#A020F0">repeat</FONT></B> <B><FONT COLOR="#A020F0">then</FONT></B>
    = ;

<B><FONT COLOR="#A020F0">: </FONT></B><B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">list-length</FONT></I></B></FONT></B> ( list <B><FONT COLOR="#5F9EA0">-</FONT></B><B><FONT COLOR="#5F9EA0">-</FONT></B> n )
    0 <B><FONT COLOR="#A020F0">begin</FONT></B> ( l' n' )
	<B><FONT COLOR="#5F9EA0">over</FONT></B>
    <B><FONT COLOR="#A020F0">while</FONT></B>
	1<B><FONT COLOR="#5F9EA0">+</FONT></B> <B><FONT COLOR="#5F9EA0">swap</FONT></B> list<B><FONT COLOR="#5F9EA0">-</FONT></B><B><FONT COLOR="#A020F0">next</FONT></B> @ <B><FONT COLOR="#5F9EA0">swap</FONT></B>
    <B><FONT COLOR="#A020F0">repeat</FONT></B>
    <B><FONT COLOR="#5F9EA0">nip</FONT></B> ;

s<B><FONT COLOR="#BC8F8F">&quot; wrong result&quot;</FONT></B> exception <B><FONT COLOR="#A020F0">constant</FONT></B> wrong<B><FONT COLOR="#5F9EA0">-</FONT></B>result

<B><FONT COLOR="#A020F0">: </FONT></B><B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">main</FONT></I></B></FONT></B> ( <B><FONT COLOR="#5F9EA0">-</FONT></B><B><FONT COLOR="#5F9EA0">-</FONT></B> n )
    0 NUM 0 ?<B><FONT COLOR="#A020F0">do</FONT></B>
	<B><FONT COLOR="#5F9EA0">drop</FONT></B>
	make<B><FONT COLOR="#5F9EA0">-</FONT></B>list <B><FONT COLOR="#5F9EA0">dup</FONT></B> copy<B><FONT COLOR="#5F9EA0">-</FONT></B>list ( list1 list2 )
	move<B><FONT COLOR="#5F9EA0">-</FONT></B>head<B><FONT COLOR="#5F9EA0">-</FONT></B>to<B><FONT COLOR="#5F9EA0">-</FONT></B>tail move<B><FONT COLOR="#5F9EA0">-</FONT></B>tail<B><FONT COLOR="#5F9EA0">-</FONT></B>to<B><FONT COLOR="#5F9EA0">-</FONT></B>tail <B><FONT COLOR="#5F9EA0">swap</FONT></B> nreverse ( list2 list1 )
	<B><FONT COLOR="#5F9EA0">dup</FONT></B> list<B><FONT COLOR="#5F9EA0">-</FONT></B>val @ SIZE <B><FONT COLOR="#5F9EA0">&lt;&gt;</FONT></B> wrong<B><FONT COLOR="#5F9EA0">-</FONT></B>result <B><FONT COLOR="#A020F0">and</FONT></B> <B><FONT COLOR="#5F9EA0">throw</FONT></B>
	<B><FONT COLOR="#5F9EA0">tuck</FONT></B> list<B><FONT COLOR="#5F9EA0">-</FONT></B>equals 0= wrong<B><FONT COLOR="#5F9EA0">-</FONT></B>result <B><FONT COLOR="#A020F0">and</FONT></B> <B><FONT COLOR="#5F9EA0">throw</FONT></B>
	list<B><FONT COLOR="#5F9EA0">-</FONT></B>length
    <B><FONT COLOR="#A020F0">loop</FONT></B> ;

main 0 .r cr <B><FONT COLOR="#5F9EA0">bye</FONT></B>
</pre></td></tr></table>
