<table width="100%" border="0" cellpadding="5" cellspacing="0"><tr><td bgcolor="#FFFFFF"><pre>
<I><FONT COLOR="#B22222">%%% -*- mode: erlang -*-
</FONT></I><I><FONT COLOR="#B22222">%%% $Id: hash-erlang.code,v 1.1 2004-11-02 08:52:31 bfulgham Exp $
</FONT></I><I><FONT COLOR="#B22222">%%% http://shootout.alioth.debian.org/
</FONT></I>
<I><FONT COLOR="#B22222">%% Use ETS tables (Erlang's associative store).
</FONT></I><I><FONT COLOR="#B22222">%%
</FONT></I><I><FONT COLOR="#B22222">%% Optimizations provided by Einar Karttunen.
</FONT></I><I><FONT COLOR="#B22222">%% An off-by-one error corrected by Brent Fulgham
</FONT></I>
<B><FONT COLOR="#5F9EA0">-module</FONT></B>(hash).
<B><FONT COLOR="#5F9EA0">-export</FONT></B>([main/0, main/1]).

<B><FONT COLOR="#0000FF">main</FONT></B>() -&gt; main([<B><FONT COLOR="#BC8F8F">'1'</FONT></B>]).
<B><FONT COLOR="#0000FF">main</FONT></B>([<FONT COLOR="#B8860B">Arg</FONT>]) -&gt;
    <FONT COLOR="#B8860B">N</FONT> = <B><FONT COLOR="#A020F0">list_to_integer</FONT></B>(<B><FONT COLOR="#A020F0">atom_to_list</FONT></B>(<FONT COLOR="#B8860B">Arg</FONT>)),
    <FONT COLOR="#B8860B">H</FONT> = ets:new(i_am_a_carrot, [set]),
    doinserts(0, <FONT COLOR="#B8860B">N</FONT> + 1, <FONT COLOR="#B8860B">H</FONT>),
    <FONT COLOR="#B8860B">Count</FONT> = dolookups(<FONT COLOR="#B8860B">N</FONT> + 1, 0, <FONT COLOR="#B8860B">H</FONT>),
    io:format(<B><FONT COLOR="#BC8F8F">&quot;~w~n&quot;</FONT></B>, [<FONT COLOR="#B8860B">Count</FONT>]),
    <B><FONT COLOR="#A020F0">halt</FONT></B>().

<B><FONT COLOR="#0000FF">doinserts</FONT></B>(<FONT COLOR="#B8860B">N</FONT>, <FONT COLOR="#B8860B">N</FONT>, <FONT COLOR="#B8860B">H</FONT>) -&gt; ok;
<B><FONT COLOR="#0000FF">doinserts</FONT></B>(<FONT COLOR="#B8860B">I</FONT>, <FONT COLOR="#B8860B">N</FONT>, <FONT COLOR="#B8860B">H</FONT>) -&gt;
    ets:insert(<FONT COLOR="#B8860B">H</FONT>, { erlang:<B><FONT COLOR="#A020F0">integer_to_list</FONT></B>(<FONT COLOR="#B8860B">I</FONT>, 16), <FONT COLOR="#B8860B">I</FONT> }),
    doinserts(<FONT COLOR="#B8860B">I</FONT>+1, <FONT COLOR="#B8860B">N</FONT>, <FONT COLOR="#B8860B">H</FONT>).

<B><FONT COLOR="#0000FF">dolookups</FONT></B>(0, <FONT COLOR="#B8860B">C</FONT>, <FONT COLOR="#B8860B">H</FONT>) -&gt; <FONT COLOR="#B8860B">C</FONT>;
<B><FONT COLOR="#0000FF">dolookups</FONT></B>(<FONT COLOR="#B8860B">I</FONT>, <FONT COLOR="#B8860B">C</FONT>, <FONT COLOR="#B8860B">H</FONT>) -&gt;
    <FONT COLOR="#B8860B">Nx</FONT> = <B><FONT COLOR="#A020F0">integer_to_list</FONT></B>(<FONT COLOR="#B8860B">I</FONT>),
    <B><FONT COLOR="#A020F0">case</FONT></B> ets:lookup(<FONT COLOR="#B8860B">H</FONT>, <FONT COLOR="#B8860B">Nx</FONT>) <B><FONT COLOR="#A020F0">of</FONT></B>
	[] -&gt;    dolookups(<FONT COLOR="#B8860B">I</FONT>-1, <FONT COLOR="#B8860B">C</FONT>, <FONT COLOR="#B8860B">H</FONT>);
	<FONT COLOR="#B8860B">Found</FONT> -&gt; dolookups(<FONT COLOR="#B8860B">I</FONT>-1, <FONT COLOR="#B8860B">C</FONT>+1, <FONT COLOR="#B8860B">H</FONT>)
    <B><FONT COLOR="#A020F0">end</FONT></B>.</pre></td></tr></table>
