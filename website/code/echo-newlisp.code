<table width="100%" border="0" cellpadding="5" cellspacing="0"><tr><td bgcolor="#FFFFFF"><pre>
#!/usr/bin/newlisp

# client-server.lsp - benchmark
# requires newLISP v 8.1.7 <B><FONT COLOR="#A020F0">or</FONT></B> later
#
# Contributed by Lutz Mueller
(set 'DATA <B><FONT COLOR="#BC8F8F">&quot;Hello there sailor\n&quot;</FONT></B>)<I><FONT COLOR="#B22222">;
</FONT></I>(set 'bufferSize (length DATA))


(<B><FONT COLOR="#A020F0">define</FONT></B> (<B><FONT COLOR="#0000FF">server</FONT></B> port)
	(set 'listen (net-listen port))
	(set 'connection (net-accept listen))
	(set 'N 0)
	(while (net-receive connection 'buff bufferSize)
		(inc 'N (length buff))
		(net-send connection buff))
	(net-close connection)
	(net-close listen)
	(println <B><FONT COLOR="#BC8F8F">&quot;server processed &quot;</FONT></B> N <B><FONT COLOR="#BC8F8F">&quot; bytes&quot;</FONT></B>))


(<B><FONT COLOR="#A020F0">define</FONT></B> (<B><FONT COLOR="#0000FF">client</FONT></B> port n)
	(set 'connection (net-connect <B><FONT COLOR="#BC8F8F">&quot;127.0.0.1&quot;</FONT></B> port))
	(dotimes (x n)
		(net-send connection DATA)
		(net-receive connection 'buff bufferSize)
		(<B><FONT COLOR="#A020F0">if</FONT></B> (!= buff DATA) (println <B><FONT COLOR="#BC8F8F">&quot;Received different message: &quot;</FONT></B> buff)))
	(net-close connection))

(set 'n (integer (nth 2 (main-args))))

(fork (server 100001))
(sleep 100)
(client 100001 n)
(exit)
<I><FONT COLOR="#B22222">;; eof
</FONT></I></pre></td></tr></table>
