<table width="100%" border="0" cellpadding="5" cellspacing="0"><tr><td bgcolor="#FFFFFF"><pre>
<I><FONT COLOR="#B22222">\ -*- mode: forth -*-
</FONT></I><I><FONT COLOR="#B22222">\ $Id: strcat-gforth.code,v 1.2 2004-11-08 08:15:53 bfulgham Exp $
</FONT></I><I><FONT COLOR="#B22222">\ http://www.bagley.org/~doug/shootout/
</FONT></I>
<I><FONT COLOR="#B22222">\ read NUM from last command line argument
</FONT></I>0. argc @ 1<B><FONT COLOR="#5F9EA0">-</FONT></B> arg <B><FONT COLOR="#5F9EA0">&gt;</FONT></B>number <B><FONT COLOR="#5F9EA0">2drop</FONT></B> <B><FONT COLOR="#5F9EA0">drop</FONT></B> <B><FONT COLOR="#A020F0">constant</FONT></B> NUM

<B><FONT COLOR="#A020F0">variable</FONT></B> hsiz    32                       hsiz <B><FONT COLOR="#5F9EA0">!</FONT></B>  <I><FONT COLOR="#B22222">\ buffer can hold this much
</FONT></I><B><FONT COLOR="#A020F0">variable</FONT></B> hbuf    hsiz @ allocate <B><FONT COLOR="#5F9EA0">throw</FONT></B>    hbuf <B><FONT COLOR="#5F9EA0">!</FONT></B>  <I><FONT COLOR="#B22222">\ start of buffer
</FONT></I><B><FONT COLOR="#A020F0">variable</FONT></B> hoff    0                        hoff <B><FONT COLOR="#5F9EA0">!</FONT></B>  <I><FONT COLOR="#B22222">\ current offset in buffer
</FONT></I>
<B><FONT COLOR="#A020F0">: </FONT></B><B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">STUFF</FONT></I></B></FONT></B> s<B><FONT COLOR="#BC8F8F">&quot; hello.&quot;</FONT></B> ;

<B><FONT COLOR="#A020F0">: </FONT></B><B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">strcat</FONT></I></B></FONT></B> ( straddr strlen <B><FONT COLOR="#5F9EA0">-</FONT></B><B><FONT COLOR="#5F9EA0">-</FONT></B> )
    <B><FONT COLOR="#5F9EA0">dup</FONT></B>                              <I><FONT COLOR="#B22222">\ dup strlen on stack
</FONT></I>    hsiz @ hoff @ <B><FONT COLOR="#5F9EA0">-</FONT></B> <B><FONT COLOR="#5F9EA0">&gt;</FONT></B>                <I><FONT COLOR="#B22222">\ if strlen &gt; remaining space
</FONT></I>    <B><FONT COLOR="#A020F0">if</FONT></B>                               <I><FONT COLOR="#B22222">\ reallocate buffer
</FONT></I>	hsiz @ 2<B><FONT COLOR="#5F9EA0">*</FONT></B> hsiz <B><FONT COLOR="#5F9EA0">!</FONT></B>             <I><FONT COLOR="#B22222">\ double size
</FONT></I>	hbuf @ hsiz @ resize <B><FONT COLOR="#5F9EA0">throw</FONT></B>   <I><FONT COLOR="#B22222">\ reallocate buffer
</FONT></I>	hbuf <B><FONT COLOR="#5F9EA0">!</FONT></B>                       <I><FONT COLOR="#B22222">\ store (possibly new) buffer start
</FONT></I>    <B><FONT COLOR="#A020F0">then</FONT></B>
    <B><FONT COLOR="#5F9EA0">swap</FONT></B> <B><FONT COLOR="#5F9EA0">over</FONT></B>                        <I><FONT COLOR="#B22222">\ stack: strlen straddr strlen
</FONT></I>    hbuf @ hoff @ <B><FONT COLOR="#5F9EA0">+</FONT></B>
    <B><FONT COLOR="#5F9EA0">swap</FONT></B> cmove<B><FONT COLOR="#5F9EA0">&gt;</FONT></B>                      <I><FONT COLOR="#B22222">\ append from straddr to hbuf+hoff
</FONT></I>    hoff @ <B><FONT COLOR="#5F9EA0">+</FONT></B> hoff <B><FONT COLOR="#5F9EA0">!</FONT></B>                  <I><FONT COLOR="#B22222">\ update hoff
</FONT></I>    ;

<B><FONT COLOR="#A020F0">: </FONT></B><B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">main</FONT></I></B></FONT></B> ( <B><FONT COLOR="#5F9EA0">-</FONT></B><B><FONT COLOR="#5F9EA0">-</FONT></B> )
    NUM 0
    <B><FONT COLOR="#A020F0">do</FONT></B>
	STUFF strcat
    <B><FONT COLOR="#A020F0">loop</FONT></B>
    <I><FONT COLOR="#B22222">\ as a final result push the resultant string on the stack as if we
</FONT></I>    <I><FONT COLOR="#B22222">\ were going to use it for something.
</FONT></I>    hbuf @ hoff @
    <I><FONT COLOR="#B22222">\ and print out the length
</FONT></I>    1 u.r cr <B><FONT COLOR="#5F9EA0">drop</FONT></B> ;

main

<B><FONT COLOR="#5F9EA0">bye</FONT></B> <I><FONT COLOR="#B22222">\ th-th-that's all folks!
</FONT></I></pre></td></tr></table>
