<table width="100%" border="0" cellpadding="5" cellspacing="0"><tr><td bgcolor="#FFFFFF"><pre>
<I><FONT COLOR="#B22222">-- The Great Computer Language Shootout
</FONT></I><I><FONT COLOR="#B22222">-- http://shootout.alioth.debian.org
</FONT></I><I><FONT COLOR="#B22222">-- contributed by Isaac Gouy (Lua novice)
</FONT></I>
n <B><FONT COLOR="#5F9EA0">=</FONT></B> <B><FONT COLOR="#228B22">tonumber</FONT></B>(arg[1]) <B><FONT COLOR="#A020F0">or</FONT></B> 1

produced <B><FONT COLOR="#5F9EA0">=</FONT></B> 0
consumed <B><FONT COLOR="#5F9EA0">=</FONT></B> 0
buffer <B><FONT COLOR="#5F9EA0">=</FONT></B> 0

<B><FONT COLOR="#A020F0">function</FONT></B> producer()
   <B><FONT COLOR="#A020F0">return</FONT></B> coroutine.create( 

      <B><FONT COLOR="#A020F0">function</FONT></B>()
         <B><FONT COLOR="#A020F0">while</FONT></B> produced <B><FONT COLOR="#5F9EA0">&lt;</FONT></B> n <B><FONT COLOR="#A020F0">do</FONT></B>
            produced <B><FONT COLOR="#5F9EA0">=</FONT></B> produced <B><FONT COLOR="#5F9EA0">+</FONT></B> 1
            buffer <B><FONT COLOR="#5F9EA0">=</FONT></B> produced
               <I><FONT COLOR="#B22222">-- io.write(buffer)
</FONT></I>            coroutine.yield()
         <B><FONT COLOR="#A020F0">end</FONT></B>
      <B><FONT COLOR="#A020F0">end</FONT></B>

   )
<B><FONT COLOR="#A020F0">end</FONT></B>
   

<B><FONT COLOR="#A020F0">function</FONT></B> consumer(p)
   <B><FONT COLOR="#A020F0">return</FONT></B> coroutine.create( 

      <B><FONT COLOR="#A020F0">function</FONT></B>()
         <B><FONT COLOR="#A020F0">local</FONT></B> value <B><FONT COLOR="#5F9EA0">=</FONT></B> 0
         <B><FONT COLOR="#A020F0">while</FONT></B> consumed <B><FONT COLOR="#5F9EA0">&lt;</FONT></B> n <B><FONT COLOR="#A020F0">do</FONT></B>
            coroutine.resume(p)
            value <B><FONT COLOR="#5F9EA0">=</FONT></B> buffer
               <I><FONT COLOR="#B22222">-- io.write(&quot; -&gt; &quot;, value, &quot;\n&quot;)
</FONT></I>            consumed <B><FONT COLOR="#5F9EA0">=</FONT></B> consumed <B><FONT COLOR="#5F9EA0">+</FONT></B> 1
         <B><FONT COLOR="#A020F0">end</FONT></B>
      <B><FONT COLOR="#A020F0">end</FONT></B>

   )
<B><FONT COLOR="#A020F0">end</FONT></B>


coroutine.resume( consumer( producer() ))
io.write(produced, <B><FONT COLOR="#BC8F8F">&quot; &quot;</FONT></B>, consumed, <B><FONT COLOR="#BC8F8F">&quot;\n&quot;</FONT></B>)</pre></td></tr></table>
