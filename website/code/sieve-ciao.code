<table width="100%" border="0" cellpadding="5" cellspacing="0"><tr><td bgcolor="#FFFFFF"><pre>
%%% -*- mode: prolog -*-
%%% $Id: sieve-ciao.code,v 1.2 2004-11-08 08:15:52 bfulgham Exp $
%%% http:<I><FONT COLOR="#B22222">//shootout.alioth.debian.org/
</FONT></I>%%%
%%% Based on a <B><FONT COLOR="#A020F0">program</FONT></B> by Jim Montgomery
%%%
:- module(sieve, [main/1]).
:- use_module(<B><FONT COLOR="#A020F0">library</FONT></B>(<B><FONT COLOR="#A020F0">write</FONT></B>)).

%%% integers
%%%    Generates a list <B><FONT COLOR="#A020F0">of</FONT></B> integers from Low <B><FONT COLOR="#A020F0">to</FONT></B> High
integers(_,_,[]).
integers(Low,Limit,[Low|Rest]) :-
    Low =&lt; Limit,
    !, CurrInt <B><FONT COLOR="#A020F0">is</FONT></B> Low+1,
    integers(CurrInt,Limit,Rest).

%%% sieve
%%%    Selects smallest remaining number <B><FONT COLOR="#A020F0">in</FONT></B> list (it <B><FONT COLOR="#A020F0">is</FONT></B> prime) <B><FONT COLOR="#A020F0">and</FONT></B> <B><FONT COLOR="#A020F0">then</FONT></B>
%%%    removes all multiples <B><FONT COLOR="#A020F0">of</FONT></B> this prime from the list
sieve([],[]).
sieve([Head|Tail],[Head|Primes]) :-
    remove(Head,Tail,New),
    sieve(New,Primes).

%%% remove
%%    Remove all multiples <B><FONT COLOR="#A020F0">of</FONT></B> the current prime number from list
remove(Prime,[],[]).
remove(Prime,[H|Tail],[Head|Val]) :-
    \+(0 <B><FONT COLOR="#A020F0">is</FONT></B> Head <B><FONT COLOR="#A020F0">mod</FONT></B> Prime),
    !, remove(Prime,Tail,Val).
remove(Prime,[Head|Tail],Val) :-
    0 <B><FONT COLOR="#A020F0">is</FONT></B> Head <B><FONT COLOR="#A020F0">mod</FONT></B> Prime,
    !, remove(Prime,Tail,Val).

%%% loop
%%%%    loop construct <B><FONT COLOR="#A020F0">to</FONT></B> <B><FONT COLOR="#A020F0">do</FONT></B> this task Count times
loop(_,0,_).
loop(Limit,Count,List) :-
    Current <B><FONT COLOR="#A020F0">is</FONT></B> Count - 1,
    integers(2,Limit,Integers),
    sieve(Integers,List),
    loop(Limit,Current,List).

%%% run_list
%%%    <B><FONT COLOR="#A020F0">program</FONT></B> driver
run_list([Arg|Args]) :-
	<B><FONT COLOR="#A020F0">name</FONT></B>(Arg,ArgStr), <B><FONT COLOR="#A020F0">name</FONT></B>(ArgN,ArgStr),
	loop(8192,ArgN,List),
	length(List,Val),
	<B><FONT COLOR="#A020F0">write</FONT></B>(<B><FONT COLOR="#BC8F8F">'Count: '</FONT></B>),
	<B><FONT COLOR="#A020F0">write</FONT></B>(Val), nl, halt.

%%% main
%%%    <B><FONT COLOR="#A020F0">program</FONT></B> driver
main(Argv) :-
	run_list(Argv).
	</pre></td></tr></table>
