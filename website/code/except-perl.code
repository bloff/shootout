<table width="100%" border="0" cellpadding="5" cellspacing="0"><tr><td bgcolor="#FFFFFF"><pre>
<I><FONT COLOR="#B22222">#!/usr/bin/perl
</FONT></I><I><FONT COLOR="#B22222"># $Id: except-perl.code,v 1.2 2004-11-08 08:15:13 bfulgham Exp $
</FONT></I><I><FONT COLOR="#B22222"># http://www.bagley.org/~doug/shootout/
</FONT></I>
<B><FONT COLOR="#A020F0">use</FONT></B> integer;

<B><FONT COLOR="#A020F0">my</FONT></B> $HI = 0;
<B><FONT COLOR="#A020F0">my</FONT></B> $LO = 0;
<B><FONT COLOR="#A020F0">my</FONT></B> $NUM = $ARGV[0];
$NUM = 1 <B><FONT COLOR="#A020F0">if</FONT></B> ($NUM &lt; 1);

<B><FONT COLOR="#A020F0">package</FONT></B> Lo_Exception;

<B><FONT COLOR="#A020F0">sub</FONT></B> <B><FONT COLOR="#A020F0">new</FONT></B> {
    <B><FONT COLOR="#A020F0">bless</FONT></B>({Val =&gt; <B><FONT COLOR="#A020F0">shift</FONT></B>}, __PACKAGE__);
}

<B><FONT COLOR="#A020F0">package</FONT></B> Hi_Exception;

<B><FONT COLOR="#A020F0">sub</FONT></B> <B><FONT COLOR="#A020F0">new</FONT></B> {
    <B><FONT COLOR="#A020F0">bless</FONT></B>({Val =&gt; <B><FONT COLOR="#A020F0">shift</FONT></B>}, __PACKAGE__);
}

<B><FONT COLOR="#A020F0">package</FONT></B> main;

<B><FONT COLOR="#A020F0">sub</FONT></B> some_function {
    <B><FONT COLOR="#A020F0">my</FONT></B> $num = <B><FONT COLOR="#A020F0">shift</FONT></B>;
    <B><FONT COLOR="#A020F0">eval</FONT></B> {
	&amp;hi_function($num);
    };
    <B><FONT COLOR="#A020F0">if</FONT></B> ($@) {
	<B><FONT COLOR="#A020F0">die</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;We shouldn't get here ($@)&quot;</FONT></B>;
    }
}

<B><FONT COLOR="#A020F0">sub</FONT></B> hi_function {
    <B><FONT COLOR="#A020F0">my</FONT></B> $num = <B><FONT COLOR="#A020F0">shift</FONT></B>;
    <B><FONT COLOR="#A020F0">eval</FONT></B> {
	&amp;lo_function($num);
    };
    <B><FONT COLOR="#A020F0">if</FONT></B> (<B><FONT COLOR="#A020F0">ref</FONT></B>($@) <B><FONT COLOR="#A020F0">eq</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;Hi_Exception&quot;</FONT></B>) {
	$HI++;		<I><FONT COLOR="#B22222"># handle
</FONT></I>    } <B><FONT COLOR="#A020F0">elsif</FONT></B> ($@) {
	<B><FONT COLOR="#A020F0">die</FONT></B> $@;		<I><FONT COLOR="#B22222"># rethrow
</FONT></I>    }
}

<B><FONT COLOR="#A020F0">sub</FONT></B> lo_function {
    <B><FONT COLOR="#A020F0">my</FONT></B> $num = <B><FONT COLOR="#A020F0">shift</FONT></B>;
    <B><FONT COLOR="#A020F0">eval</FONT></B> {
	&amp;blowup($num);
    };
    <B><FONT COLOR="#A020F0">if</FONT></B> (<B><FONT COLOR="#A020F0">ref</FONT></B>($@) <B><FONT COLOR="#A020F0">eq</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;Lo_Exception&quot;</FONT></B>) {
	$LO++;		<I><FONT COLOR="#B22222"># handle
</FONT></I>    } <B><FONT COLOR="#A020F0">elsif</FONT></B> ($@) {
	<B><FONT COLOR="#A020F0">die</FONT></B> $@;		<I><FONT COLOR="#B22222"># rethrow
</FONT></I>    }
}

<B><FONT COLOR="#A020F0">sub</FONT></B> blowup {
    <B><FONT COLOR="#A020F0">my</FONT></B> $num = <B><FONT COLOR="#A020F0">shift</FONT></B>;
    <B><FONT COLOR="#A020F0">if</FONT></B> ($num % 2) {
	<B><FONT COLOR="#A020F0">die</FONT></B> Lo_Exception-&gt;new(Num =&gt; $num);
    } <B><FONT COLOR="#A020F0">else</FONT></B> {
	<B><FONT COLOR="#A020F0">die</FONT></B> Hi_Exception-&gt;new(Num =&gt; $num);
    }
}

$NUM = $ARGV[0];
<B><FONT COLOR="#A020F0">while</FONT></B> ($NUM--) {
    &amp;some_function($NUM);
}
<B><FONT COLOR="#A020F0">print</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;Exceptions: HI=$HI / LO=$LO\n&quot;</FONT></B>;</pre></td></tr></table>
