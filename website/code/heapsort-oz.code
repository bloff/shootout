<table width="100%" border="0" cellpadding="5" cellspacing="0"><tr><td bgcolor="#FFFFFF"><pre>
<I><FONT COLOR="#B22222">%%% $Id: heapsort-oz.code,v 1.1 2004-11-02 08:52:32 bfulgham Exp $
</FONT></I><I><FONT COLOR="#B22222">%%% http://dada.perl.it/shootout/
</FONT></I><I><FONT COLOR="#B22222">%%%
</FONT></I><I><FONT COLOR="#B22222">%%% contributed by Isaac Gouy
</FONT></I>

<I><FONT COLOR="#B22222">%%  Transliterated from the Mercury solution
</FONT></I><I><FONT COLOR="#B22222">%%
</FONT></I><I><FONT COLOR="#B22222">%%  Usage: start from command line with
</FONT></I><I><FONT COLOR="#B22222">%%     ozc -x heapsort.oz -o heapsort.oz.exe
</FONT></I><I><FONT COLOR="#B22222">%%     heapsort.oz.exe 1000
</FONT></I>
<B><FONT COLOR="#228B22">functor</FONT></B>
<B><FONT COLOR="#5F9EA0">import</FONT></B> System Application

<B><FONT COLOR="#A020F0">define</FONT></B>
   IM <B><FONT COLOR="#5F9EA0">=</FONT></B> 139968
   IA <B><FONT COLOR="#5F9EA0">=</FONT></B> 3877
   IC <B><FONT COLOR="#5F9EA0">=</FONT></B> 29573
   Seed <B><FONT COLOR="#5F9EA0">=</FONT></B> 42
   
   <B><FONT COLOR="#A020F0">fun</FONT></B> {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Random_heap</FONT></I></B></FONT></B> H I S0}
      <B><FONT COLOR="#5F9EA0">local</FONT></B> R S <B><FONT COLOR="#A020F0">in</FONT></B>
     <B><FONT COLOR="#A020F0">if</FONT></B> I <B><FONT COLOR="#5F9EA0">=</FONT></B>&lt; {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Array</FONT></I></B></FONT></B>.high H} <B><FONT COLOR="#A020F0">then</FONT></B>
        {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Gen_random</FONT></I></B></FONT></B> R S0 S}
        {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Random_heap</FONT></I></B></FONT></B> {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Up_heap</FONT></I></B></FONT></B> H I R} I+1 S}
     <B><FONT COLOR="#A020F0">else</FONT></B>
        H
     <B><FONT COLOR="#A020F0">end</FONT></B>
      <B><FONT COLOR="#A020F0">end</FONT></B>
   <B><FONT COLOR="#A020F0">end</FONT></B>

   <B><FONT COLOR="#A020F0">fun</FONT></B> {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Up_heap</FONT></I></B></FONT></B> H N Y}
      <B><FONT COLOR="#5F9EA0">local</FONT></B> HalfN X <B><FONT COLOR="#A020F0">in</FONT></B>
     HalfN <B><FONT COLOR="#5F9EA0">=</FONT></B> N div 2
     X <B><FONT COLOR="#5F9EA0">=</FONT></B> {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Get</FONT></I></B></FONT></B> H HalfN}
     <B><FONT COLOR="#A020F0">if</FONT></B> 0 &lt; N andthen X &lt; Y <B><FONT COLOR="#A020F0">then</FONT></B>
        {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Put</FONT></I></B></FONT></B> H N X}
        {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Up_heap</FONT></I></B></FONT></B> H HalfN Y}
     <B><FONT COLOR="#A020F0">else</FONT></B>
        {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Put</FONT></I></B></FONT></B> H N Y}
        H
     <B><FONT COLOR="#A020F0">end</FONT></B>
      <B><FONT COLOR="#A020F0">end</FONT></B>
   <B><FONT COLOR="#A020F0">end</FONT></B>

   <B><FONT COLOR="#A020F0">fun</FONT></B> {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Heapsort</FONT></I></B></FONT></B> H N}
      <B><FONT COLOR="#A020F0">if</FONT></B> N <B><FONT COLOR="#5F9EA0">==</FONT></B> 0 <B><FONT COLOR="#A020F0">then</FONT></B> H
      <B><FONT COLOR="#A020F0">else</FONT></B> {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Heapsort</FONT></I></B></FONT></B> {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Remove_greatest</FONT></I></B></FONT></B> H N} N-1} <B><FONT COLOR="#A020F0">end</FONT></B>
   <B><FONT COLOR="#A020F0">end</FONT></B>

   <B><FONT COLOR="#A020F0">fun</FONT></B> {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Remove_greatest</FONT></I></B></FONT></B> H N}
      <B><FONT COLOR="#5F9EA0">local</FONT></B> X Y <B><FONT COLOR="#A020F0">in</FONT></B>
     X <B><FONT COLOR="#5F9EA0">=</FONT></B> {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Get</FONT></I></B></FONT></B> H 0}
     Y <B><FONT COLOR="#5F9EA0">=</FONT></B> {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Get</FONT></I></B></FONT></B> H N}
     {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Put</FONT></I></B></FONT></B> H N X}
     {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Down_heap</FONT></I></B></FONT></B> H 0 N-1 Y}
      <B><FONT COLOR="#A020F0">end</FONT></B>
   <B><FONT COLOR="#A020F0">end</FONT></B>

   <B><FONT COLOR="#A020F0">fun</FONT></B> {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Down_heap</FONT></I></B></FONT></B> H I N X}
      <B><FONT COLOR="#5F9EA0">local</FONT></B> L R J Y <B><FONT COLOR="#A020F0">in</FONT></B>
     L <B><FONT COLOR="#5F9EA0">=</FONT></B> I + I + 1
     R <B><FONT COLOR="#5F9EA0">=</FONT></B> L + 1
     <B><FONT COLOR="#A020F0">if</FONT></B> N &lt; L <B><FONT COLOR="#A020F0">then</FONT></B>
        {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Put</FONT></I></B></FONT></B> H I X}
        H
     <B><FONT COLOR="#A020F0">else</FONT></B>
        J <B><FONT COLOR="#5F9EA0">=</FONT></B> <B><FONT COLOR="#A020F0">if</FONT></B> R &lt; N andthen {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Get</FONT></I></B></FONT></B> H R} &gt; {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Get</FONT></I></B></FONT></B> H L}
        <B><FONT COLOR="#A020F0">then</FONT></B>  R <B><FONT COLOR="#A020F0">else</FONT></B> L <B><FONT COLOR="#A020F0">end</FONT></B>
        Y <B><FONT COLOR="#5F9EA0">=</FONT></B> {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Get</FONT></I></B></FONT></B> H J}
        <B><FONT COLOR="#A020F0">if</FONT></B> X &gt; Y <B><FONT COLOR="#A020F0">then</FONT></B>
           {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Put</FONT></I></B></FONT></B> H I X}
           H
        <B><FONT COLOR="#A020F0">else</FONT></B>
           {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Put</FONT></I></B></FONT></B> H I Y}
           {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Down_heap</FONT></I></B></FONT></B> H J N X}
        <B><FONT COLOR="#A020F0">end</FONT></B>
     <B><FONT COLOR="#A020F0">end</FONT></B>
      <B><FONT COLOR="#A020F0">end</FONT></B>
   <B><FONT COLOR="#A020F0">end</FONT></B>

   <B><FONT COLOR="#A020F0">proc</FONT></B> {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Gen_random</FONT></I></B></FONT></B> R S0 S}
      S <B><FONT COLOR="#5F9EA0">=</FONT></B> (S0 * IA + IC) mod IM
      R <B><FONT COLOR="#5F9EA0">=</FONT></B> {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">IntToFloat</FONT></I></B></FONT></B> S} / {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">IntToFloat</FONT></I></B></FONT></B> IM}
   <B><FONT COLOR="#A020F0">end</FONT></B>

<B><FONT COLOR="#A020F0">in</FONT></B>
   <B><FONT COLOR="#5F9EA0">local</FONT></B> Args N RandomHeap SortedHeap <B><FONT COLOR="#A020F0">in</FONT></B>
      [Args] <B><FONT COLOR="#5F9EA0">=</FONT></B> {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Application</FONT></I></B></FONT></B>.getArgs plain}
      N <B><FONT COLOR="#5F9EA0">=</FONT></B> {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">String</FONT></I></B></FONT></B>.toInt Args}
      RandomHeap <B><FONT COLOR="#5F9EA0">=</FONT></B> {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Random_heap</FONT></I></B></FONT></B> {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">NewArray</FONT></I></B></FONT></B> 0 N-1 0.0} 0 Seed}
      SortedHeap <B><FONT COLOR="#5F9EA0">=</FONT></B> {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Heapsort</FONT></I></B></FONT></B> RandomHeap N-1}
      {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">System</FONT></I></B></FONT></B>.showInfo {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Get</FONT></I></B></FONT></B> SortedHeap N-1}}
   <B><FONT COLOR="#A020F0">end</FONT></B>
   {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Application</FONT></I></B></FONT></B>.exit 0}
<B><FONT COLOR="#A020F0">end</FONT></B></pre></td></tr></table>
