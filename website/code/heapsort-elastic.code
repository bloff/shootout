<table width="100%" border="0" cellpadding="5" cellspacing="0"><tr><td bgcolor="#FFFFFF"><pre>
<I><FONT COLOR="#B22222">// $Id: heapsort-elastic.code,v 1.2 2004-11-08 08:15:14 bfulgham Exp $
</FONT></I><I><FONT COLOR="#B22222">// http://shootout.alioth.debian.org/
</FONT></I>package heapsort;

import basic;
import sys;
import array;

local IM = 139968;
local IA = 3877;
local IC = 29573;

private function <B><FONT COLOR="#0000FF">gen_random</FONT></B>( n )
{
    <B><FONT COLOR="#228B22">static</FONT></B> LAST = 42.0;
    LAST = (LAST * IA + IC) % IM;
    <B><FONT COLOR="#A020F0">return</FONT></B>(n * LAST / IM);
}

private function <B><FONT COLOR="#0000FF">heapsort</FONT></B>( n, ra )
{
    local rra;
    local i;
    local j;
    
    local l = (n / 2) + 1;
    local ir = n;
    
    <B><FONT COLOR="#A020F0">while</FONT></B> (1) {
        <B><FONT COLOR="#A020F0">if</FONT></B> (l &gt; 1) {
            rra = ra[--l];
        } <B><FONT COLOR="#A020F0">else</FONT></B> {
            rra = ra[ir];
            ra[ir] = ra[1];
            <B><FONT COLOR="#A020F0">if</FONT></B> (--ir == 1) {
                ra[1] = rra;
                <B><FONT COLOR="#A020F0">return</FONT></B>;
            }
        }
        i = l;
        j = l * 2;
        <B><FONT COLOR="#A020F0">while</FONT></B> (j &lt;= ir) {
            <B><FONT COLOR="#A020F0">if</FONT></B> ( (j &lt; ir) &amp;&amp; (ra[j] &lt; ra[j+1]) ) {
                j++;
            }
            <B><FONT COLOR="#A020F0">if</FONT></B> (rra &lt; ra[j]) {
                ra[i] = ra[j];
                i = j;
                j = j + i;
            } <B><FONT COLOR="#A020F0">else</FONT></B> {
                j = ir + 1;
            }
        }
        ra[i] = rra;
    }
}

private n = 1;
private i;
private result = 0;
private ary = #[];
<B><FONT COLOR="#0000FF">if</FONT></B>(array.length(sys.args) &gt; 0) {
    n = basic.<B><FONT COLOR="#228B22">int</FONT></B>(sys.args[0]);
} <B><FONT COLOR="#A020F0">else</FONT></B> {
    n = 1;
}
<B><FONT COLOR="#0000FF">for</FONT></B>(i=1; i&lt;=n; i++) {
    ary[i] = gen_random(1.0);
}
<B><FONT COLOR="#0000FF">heapsort</FONT></B>(n, ary);

basic.print(ary[-1], <B><FONT COLOR="#BC8F8F">&quot;\n&quot;</FONT></B>);</pre></td></tr></table>
