<table width="100%" border="0" cellpadding="5" cellspacing="0"><tr><td bgcolor="#FFFFFF"><pre>
<I><FONT COLOR="#B22222">(*
 * $Id: objinst-ocamlb.code,v 1.2 2004-11-08 08:15:18 bfulgham Exp $
 * http://www.bagley.org/~doug/shootout/
 * from: Benedikt Rosenau
 * with contributions from Markus Mottl
 *)</FONT></I>

class toggle start_state <B><FONT COLOR="#5F9EA0">=</FONT></B> object (self)
  <B><FONT COLOR="#A020F0">val</FONT></B> mutable state <B><FONT COLOR="#5F9EA0">=</FONT></B> start_state

  method value <B><FONT COLOR="#5F9EA0">=</FONT></B> state
  method activate <B><FONT COLOR="#5F9EA0">=</FONT></B> state &lt;<B><FONT COLOR="#5F9EA0">-</FONT></B> not state; self
<B><FONT COLOR="#A020F0">end</FONT></B>

class nth_toggle start_state max_counter <B><FONT COLOR="#5F9EA0">=</FONT></B> object (self)
  inherit toggle start_state

  <B><FONT COLOR="#A020F0">val</FONT></B> count_max <B><FONT COLOR="#5F9EA0">=</FONT></B> max_counter
  <B><FONT COLOR="#A020F0">val</FONT></B> mutable counter <B><FONT COLOR="#5F9EA0">=</FONT></B> 0

  method activate <B><FONT COLOR="#5F9EA0">=</FONT></B>
    counter &lt;<B><FONT COLOR="#5F9EA0">-</FONT></B> counter <B><FONT COLOR="#5F9EA0">+</FONT></B> 1;
    <B><FONT COLOR="#A020F0">if</FONT></B> counter <B><FONT COLOR="#5F9EA0">&gt;=</FONT></B> count_max <B><FONT COLOR="#A020F0">then</FONT></B> begin
      state &lt;<B><FONT COLOR="#5F9EA0">-</FONT></B> not state;
      counter &lt;<B><FONT COLOR="#5F9EA0">-</FONT></B> 0
    <B><FONT COLOR="#A020F0">end</FONT></B>;
    self
<B><FONT COLOR="#A020F0">end</FONT></B>

<B><FONT COLOR="#A020F0">let</FONT></B> n <B><FONT COLOR="#5F9EA0">=</FONT></B> <B><FONT COLOR="#A020F0">if</FONT></B> Array.length Sys.argv <B><FONT COLOR="#5F9EA0">&gt;</FONT></B> 1 <B><FONT COLOR="#A020F0">then</FONT></B> int_of_string Sys.argv.(1) <B><FONT COLOR="#A020F0">else</FONT></B> 1
<B><FONT COLOR="#A020F0">let</FONT></B> tog <B><FONT COLOR="#5F9EA0">=</FONT></B> new toggle true;;
for i <B><FONT COLOR="#5F9EA0">=</FONT></B> 1 to 5 <B><FONT COLOR="#A020F0">do</FONT></B> Printf.printf <B><FONT COLOR="#BC8F8F">&quot;%b\n&quot;</FONT></B> tog#activate#value done;
for i <B><FONT COLOR="#5F9EA0">=</FONT></B> 1 to n <B><FONT COLOR="#A020F0">do</FONT></B> ignore (new toggle true) done;
print_newline ();
<B><FONT COLOR="#A020F0">let</FONT></B> ntog <B><FONT COLOR="#5F9EA0">=</FONT></B> new nth_toggle true 3 <B><FONT COLOR="#A020F0">in</FONT></B>
for i <B><FONT COLOR="#5F9EA0">=</FONT></B> 1 to 8 <B><FONT COLOR="#A020F0">do</FONT></B> Printf.printf <B><FONT COLOR="#BC8F8F">&quot;%b\n&quot;</FONT></B> ntog#activate#value done;
for i <B><FONT COLOR="#5F9EA0">=</FONT></B> 1 to n <B><FONT COLOR="#A020F0">do</FONT></B> ignore (new nth_toggle true 3) done</pre></td></tr></table>
