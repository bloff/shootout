<table width="100%" border="0" cellpadding="5" cellspacing="0"><tr><td bgcolor="#FFFFFF"><pre>
<I><FONT COLOR="#B22222"># $Id: heapsort-gawk.code,v 1.2 2004-11-08 08:15:14 bfulgham Exp $
</FONT></I><I><FONT COLOR="#B22222"># http://www.bagley.org/~doug/shootout/
</FONT></I>
<B><FONT COLOR="#A020F0">function</FONT></B> gen_random(n) { <B><FONT COLOR="#A020F0">return</FONT></B>( (n * (LAST = (LAST * IA + IC) % IM)) / IM ); }

<B><FONT COLOR="#A020F0">function</FONT></B> heapsort (n, ra) {
    l = <B><FONT COLOR="#A020F0">int</FONT></B>(0.5+n/2) + 1
    ir = n;
    <B><FONT COLOR="#A020F0">for</FONT></B> (;;) {
        <B><FONT COLOR="#A020F0">if</FONT></B> (l &gt; 1) {
            rra = ra[--l];
        } <B><FONT COLOR="#A020F0">else</FONT></B> {
            rra = ra[ir];
            ra[ir] = ra[1];
            <B><FONT COLOR="#A020F0">if</FONT></B> (--ir == 1) {
                ra[1] = rra;
                <B><FONT COLOR="#A020F0">return</FONT></B>;
            }
        }
        i = l;
        j = l * 2;
        <B><FONT COLOR="#A020F0">while</FONT></B> (j &lt;= ir) {
            <B><FONT COLOR="#A020F0">if</FONT></B> (j &lt; ir &amp;&amp; ra[j] &lt; ra[j+1]) { ++j; }
            <B><FONT COLOR="#A020F0">if</FONT></B> (rra &lt; ra[j]) {
                ra[i] = ra[j];
                j += (i = j);
            } <B><FONT COLOR="#A020F0">else</FONT></B> {
                j = ir + 1;
            }
        }
        ra[i] = rra;
    }
}

<B><FONT COLOR="#A020F0">BEGIN</FONT></B> {
    IM = 139968;
    IA = 3877;
    IC = 29573;
    LAST = 42;

    n = (<B><FONT COLOR="#A020F0">ARGV</FONT></B>[1] &lt; 1) ? 1 : <B><FONT COLOR="#A020F0">ARGV</FONT></B>[1];
    ary[0] = 0;
    <B><FONT COLOR="#A020F0">for</FONT></B> (i=1; i&lt;=n; i++) {
	ary[i] = gen_random(1.0);
    }

    heapsort(n, ary);

    <B><FONT COLOR="#A020F0">printf</FONT></B>(<B><FONT COLOR="#BC8F8F">&quot;%.10f\n&quot;</FONT></B>, ary[n]);

    <B><FONT COLOR="#A020F0">exit</FONT></B>;
}</pre></td></tr></table>
