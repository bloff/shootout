<span class="com">(* The Great Computer Language Shootout
   http://shootout.alioth.debian.org

   contributed by Isaac Gouy (Oberon-2 novice)
*)</span>

<span class="kwa">MODULE</span> Reversefile<span class="sym">;
</span><span class="kwa">IMPORT</span> StdChannels<span class="sym">,</span> Channel<span class="sym">,</span> Out<span class="sym">,</span> SYSTEM<span class="sym">;

  </span><span class="kwa">TYPE
  </span>   Line <span class="sym">=</span> <span class="kwb">POINTER</span> <span class="kwa">TO ARRAY</span> <span class="num">120</span> <span class="kwa">OF</span> <span class="kwb">CHAR</span><span class="sym">;
 
</span><span class="kwa">VAR
</span>   in<span class="sym">:</span> Channel<span class="sym">.</span>Reader<span class="sym">;
</span>   buffer<span class="sym">:</span> <span class="kwb">POINTER</span> <span class="kwa">TO ARRAY OF</span> <span class="kwb">CHAR</span><span class="sym">;
</span>   i<span class="sym">,</span> j<span class="sym">:</span> <span class="kwb">LONGINT</span><span class="sym">;
</span>   line<span class="sym">:</span> Line<span class="sym">;

</span><span class="kwa">BEGIN
</span>   in <span class="sym">:=</span> StdChannels<span class="sym">.</span>stdin<span class="sym">.</span>NewReader<span class="sym">();
</span>   i <span class="sym">:=</span> in<span class="sym">.</span>Available<span class="sym">();
 </span>   <span class="kwa">IF</span> i <span class="sym">&gt;</span> <span class="num">0</span> <span class="kwa">THEN
            NEW</span><span class="sym">(</span>buffer<span class="sym">,</span> i<span class="sym">+</span><span class="num">1</span><span class="sym">);
</span>      in<span class="sym">.</span>ReadBytes<span class="sym">(</span>buffer^<span class="sym">,</span><span class="num">0</span><span class="sym">,</span>i<span class="sym">);</span> buffer<span class="sym">[</span>i<span class="sym">] :=</span> <span class="num">0X</span><span class="sym">;</span> <span class="kwa">DEC</span><span class="sym">(</span>i<span class="sym">);
  
              </span>      <span class="kwa">IF</span> buffer<span class="sym">[</span>i<span class="sym">] =</span> <span class="num">0A</span>X <span class="kwa">THEN DEC</span><span class="sym">(</span>i<span class="sym">);</span> <span class="kwa">END</span><span class="sym">;
</span>      j <span class="sym">:=</span> i<span class="sym">;
</span>      <span class="kwa">WHILE</span> j <span class="sym">&gt;</span> <span class="num">0</span> <span class="kwa">DO
         IF</span> buffer^<span class="sym">[</span>i<span class="sym">] =</span> <span class="num">0A</span>X <span class="kwa">THEN
</span>            line <span class="sym">:=</span> SYSTEM<span class="sym">.</span><span class="kwa">VAL</span><span class="sym">(</span>Line<span class="sym">,</span> SYSTEM<span class="sym">.</span><span class="kwa">ADR</span><span class="sym">(</span>buffer<span class="sym">[</span>j<span class="sym">]));
</span>            Out<span class="sym">.</span>String<span class="sym">(</span>line^<span class="sym">);
</span>            buffer<span class="sym">[</span>j<span class="sym">] :=</span> <span class="num">0X</span><span class="sym">;
      </span>         <span class="kwa">END</span><span class="sym">;
</span>         j <span class="sym">:=</span> i<span class="sym">;</span> <span class="kwa">DEC</span><span class="sym">(</span>i<span class="sym">);
</span>      <span class="kwa">END</span><span class="sym">;
</span>      line <span class="sym">:=</span> SYSTEM<span class="sym">.</span><span class="kwa">VAL</span><span class="sym">(</span>Line<span class="sym">,</span> SYSTEM<span class="sym">.</span><span class="kwa">ADR</span><span class="sym">(</span>buffer<span class="sym">[</span>j<span class="sym">]));
</span>      Out<span class="sym">.</span>String<span class="sym">(</span>line^<span class="sym">);
</span>   <span class="kwa">END</span><span class="sym">;
   </span><span class="kwa">END</span> Reversefile<span class="sym">.</span>
