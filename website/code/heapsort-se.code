<table width="100%" border="0" cellpadding="5" cellspacing="0"><tr><td bgcolor="#FFFFFF"><pre>
<I><FONT COLOR="#B22222">-- -*- mode: eiffel -*-
</FONT></I><I><FONT COLOR="#B22222">-- $Id: heapsort-se.code,v 1.1 2004-11-02 08:52:32 bfulgham Exp $
</FONT></I><I><FONT COLOR="#B22222">-- http://www.bagley.org/~doug/shootout/
</FONT></I>
<B><FONT COLOR="#A020F0">class</FONT></B> HEAPSORT

<B><FONT COLOR="#A020F0">creation</FONT></B> make

<B><FONT COLOR="#A020F0">feature</FONT></B>

<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">   make</FONT></I></B></FONT></B> <B><FONT COLOR="#A020F0">is</FONT></B>
      <B><FONT COLOR="#A020F0">local</FONT></B>
<B><FONT COLOR="#5F9EA0">	 array: </FONT></B><B><FONT COLOR="#228B22">ARRAY</FONT></B>[<B><FONT COLOR="#228B22">DOUBLE</FONT></B>]
<B><FONT COLOR="#5F9EA0">	 n: </FONT></B><B><FONT COLOR="#228B22">INTEGER</FONT></B>
      <B><FONT COLOR="#A020F0">do</FONT></B>
	 n <B><FONT COLOR="#5F9EA0">:=</FONT></B> argument(1).to_integer
	 <B><FONT COLOR="#5F9EA0">!!</FONT></B>array.make(1, n)
	 fill_array(array)
	 sort_array(n, array)
	 io.put_string(array.item(n).to_string_format(10))
	 io.put_new_line
      <B><FONT COLOR="#A020F0">end</FONT></B>
   
   sort_array(<B><FONT COLOR="#5F9EA0">n: </FONT></B><B><FONT COLOR="#228B22">INTEGER</FONT></B>;<B><FONT COLOR="#5F9EA0"> ra: </FONT></B><B><FONT COLOR="#228B22">ARRAY</FONT></B>[<B><FONT COLOR="#228B22">DOUBLE</FONT></B>]) <B><FONT COLOR="#A020F0">is</FONT></B>
      <B><FONT COLOR="#A020F0">local</FONT></B>
<B><FONT COLOR="#5F9EA0">	 i, j, ir, l: </FONT></B><B><FONT COLOR="#228B22">INTEGER</FONT></B>
<B><FONT COLOR="#5F9EA0">	 rra: </FONT></B><B><FONT COLOR="#228B22">DOUBLE</FONT></B>
<B><FONT COLOR="#5F9EA0">	 done: </FONT></B><B><FONT COLOR="#228B22">BOOLEAN</FONT></B>
      <B><FONT COLOR="#A020F0">do</FONT></B>
	 j <B><FONT COLOR="#5F9EA0">:=</FONT></B> 0
	 i <B><FONT COLOR="#5F9EA0">:=</FONT></B> 0
	 rra <B><FONT COLOR="#5F9EA0">:=</FONT></B> 0.0
	 ir <B><FONT COLOR="#5F9EA0">:=</FONT></B> n
	 l <B><FONT COLOR="#5F9EA0">:=</FONT></B> n // 2
	 done <B><FONT COLOR="#5F9EA0">:=</FONT></B> false
	 
	 <B><FONT COLOR="#A020F0">from</FONT></B> <B><FONT COLOR="#A020F0">until</FONT></B> done <B><FONT COLOR="#A020F0">loop</FONT></B>
	    <B><FONT COLOR="#A020F0">if</FONT></B> l &gt; 1 <B><FONT COLOR="#A020F0">then</FONT></B>
	       l <B><FONT COLOR="#5F9EA0">:=</FONT></B> l - 1
	       rra <B><FONT COLOR="#5F9EA0">:=</FONT></B> ra.item(l)
	    <B><FONT COLOR="#A020F0">else</FONT></B>
	       rra <B><FONT COLOR="#5F9EA0">:=</FONT></B> ra.item(ir)
	       ra.put(ra.item(1), ir)
	       ir <B><FONT COLOR="#5F9EA0">:=</FONT></B> ir - 1
	       <B><FONT COLOR="#A020F0">if</FONT></B> ir <B><FONT COLOR="#5F9EA0">=</FONT></B> 1 <B><FONT COLOR="#A020F0">then</FONT></B>
		  ra.put(rra, 1)
		  <I><FONT COLOR="#B22222">-- should throw exception out of here instead of 
</FONT></I>		  <I><FONT COLOR="#B22222">-- using boolean
</FONT></I>		  done <B><FONT COLOR="#5F9EA0">:=</FONT></B> true
	       <B><FONT COLOR="#A020F0">end</FONT></B>
	    <B><FONT COLOR="#A020F0">end</FONT></B>
	    
	    <B><FONT COLOR="#A020F0">if</FONT></B> <B><FONT COLOR="#A020F0">not</FONT></B> done <B><FONT COLOR="#A020F0">then</FONT></B>
	       i <B><FONT COLOR="#5F9EA0">:=</FONT></B> l
	       j <B><FONT COLOR="#5F9EA0">:=</FONT></B> l * 2
	       
	       <B><FONT COLOR="#A020F0">from</FONT></B> <B><FONT COLOR="#A020F0">until</FONT></B> j &gt; ir <B><FONT COLOR="#A020F0">loop</FONT></B>
		  <B><FONT COLOR="#A020F0">if</FONT></B> (j &lt; ir) <B><FONT COLOR="#A020F0">and</FONT></B> (ra.item(j) &lt; ra.item(j+1)) <B><FONT COLOR="#A020F0">then</FONT></B>
		     j <B><FONT COLOR="#5F9EA0">:=</FONT></B> j + 1
		  <B><FONT COLOR="#A020F0">end</FONT></B>
		  <B><FONT COLOR="#A020F0">if</FONT></B> rra &lt; ra.item(j) <B><FONT COLOR="#A020F0">then</FONT></B>
		     ra.put(ra.item(j), i)
		     i <B><FONT COLOR="#5F9EA0">:=</FONT></B> j
		     j <B><FONT COLOR="#5F9EA0">:=</FONT></B> j + i
		  <B><FONT COLOR="#A020F0">else</FONT></B>
		     j <B><FONT COLOR="#5F9EA0">:=</FONT></B> ir + 1
		  <B><FONT COLOR="#A020F0">end</FONT></B>
	       <B><FONT COLOR="#A020F0">end</FONT></B>
	       ra.put(rra, i)
	    <B><FONT COLOR="#A020F0">end</FONT></B>
	 <B><FONT COLOR="#A020F0">end</FONT></B>
      <B><FONT COLOR="#A020F0">end</FONT></B>


<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">   fill_array</FONT></I></B></FONT></B>(an_array<B><FONT COLOR="#228B22">: ARRAY[DOUBLE]</FONT></B>)<B><FONT COLOR="#228B22"></FONT></B><B><FONT COLOR="#A020F0"> is</FONT></B>
      <B><FONT COLOR="#A020F0">local</FONT></B>
<B><FONT COLOR="#5F9EA0">	 rand: </FONT></B>RANDOMNUMBER
<B><FONT COLOR="#5F9EA0">	 index: </FONT></B><B><FONT COLOR="#228B22">INTEGER</FONT></B>
      <B><FONT COLOR="#A020F0">do</FONT></B>
	 <B><FONT COLOR="#A020F0">from</FONT></B>
	    <B><FONT COLOR="#5F9EA0">!!</FONT></B>rand.make
	    index <B><FONT COLOR="#5F9EA0">:=</FONT></B> an_array.lower
	 <B><FONT COLOR="#A020F0">until</FONT></B>
	    index &gt; an_array.upper
	 <B><FONT COLOR="#A020F0">loop</FONT></B>
	    an_array.put(rand.next(1), index)
	    index <B><FONT COLOR="#5F9EA0">:=</FONT></B> index + 1
	 <B><FONT COLOR="#A020F0">end</FONT></B>
      <B><FONT COLOR="#A020F0">end</FONT></B>

<B><FONT COLOR="#A020F0">end</FONT></B>
</pre></td></tr></table>
