<table width="100%" border="0" cellpadding="5" cellspacing="0"><tr><td bgcolor="#FFFFFF"><pre>
#!/bin/bash
# -*- mode: lisp -*-
PROG=${0%.jl}
[ \! -f $PROG.jlc -o $0 -nt $PROG.jlc ] &amp;&amp;
    rep --batch --no-rc -l compiler -f compile-batch $0
exec rep <B><FONT COLOR="#BC8F8F">&quot;$PROG.jlc&quot;</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;$@&quot;</FONT></B>
!#

<I><FONT COLOR="#B22222">;;; $Id: wc-rep.code,v 1.2 2004-11-08 08:15:54 bfulgham Exp $
</FONT></I><I><FONT COLOR="#B22222">;;; http://www.bagley.org/~doug/shootout/
</FONT></I>
(define-structure main ()
  (open rep rep.system rep.regexp)

  (defun my-string-split (regexp string)
    <B><FONT COLOR="#BC8F8F">&quot;Return a list of substrings of STRING, each delimited by REGEXP.
null-strings are removed.&quot;</FONT></B>
    (<B><FONT COLOR="#A020F0">let</FONT></B> loop ((point 0)
	       (parts '()))
	 (<B><FONT COLOR="#A020F0">if</FONT></B> (string-match regexp string point)
	     (loop (match-end)
	       (<B><FONT COLOR="#A020F0">if</FONT></B> (&lt; point (match-start))
		   (cons (substring string point (match-start)) parts)
		 parts))
	   (<B><FONT COLOR="#A020F0">let</FONT></B> ((part (substring string point)))
	     (<B><FONT COLOR="#A020F0">if</FONT></B> (&gt; (length part) 0)
		 (cons part parts)
	       parts)))))

  <I><FONT COLOR="#B22222">;; eat the unused command line arg
</FONT></I>  (get-command-line-option <B><FONT COLOR="#BC8F8F">&quot;--num&quot;</FONT></B> t)
  (<B><FONT COLOR="#A020F0">let</FONT></B> ((nl 0)
	(nw 0)
	(nc 0)
	(line))
    (while (setq line (read-line))
      (setq nl (+ nl 1))
      (setq nw (+ nw (length (my-string-split <B><FONT COLOR="#BC8F8F">&quot;[ \t\n]+&quot;</FONT></B> line))))
      (setq nc (+ nc (length line))))
    (format standard-output <B><FONT COLOR="#BC8F8F">&quot;%d %d %d\n&quot;</FONT></B> nl nw nc)))

</pre></td></tr></table>
