<table width="100%" border="0" cellpadding="5" cellspacing="0"><tr><td bgcolor="#FFFFFF"><pre>
<I><FONT COLOR="#B22222">#!/usr/bin/perl
</FONT></I><I><FONT COLOR="#B22222"># $Id: prodcons-perl.code,v 1.2 2004-11-08 08:15:18 bfulgham Exp $
</FONT></I><I><FONT COLOR="#B22222"># http://www.bagley.org/~doug/shootout/
</FONT></I>
<B><FONT COLOR="#A020F0">use</FONT></B> strict;
<B><FONT COLOR="#A020F0">use</FONT></B> Thread <B><FONT COLOR="#A020F0">qw</FONT></B>(cond_wait cond_signal);

<B><FONT COLOR="#A020F0">my</FONT></B> $count = 0;
<B><FONT COLOR="#A020F0">my</FONT></B> $data = 0;
<B><FONT COLOR="#A020F0">my</FONT></B> $produced = 0;
<B><FONT COLOR="#A020F0">my</FONT></B> $consumed = 0;

<B><FONT COLOR="#A020F0">sub</FONT></B> consumer {
    <B><FONT COLOR="#A020F0">my</FONT></B> $n = <B><FONT COLOR="#A020F0">shift</FONT></B>;
    <B><FONT COLOR="#A020F0">while</FONT></B> (1) {
	lock($count);
	cond_wait($count) <B><FONT COLOR="#A020F0">while</FONT></B> ($count == 0);
	<B><FONT COLOR="#A020F0">my</FONT></B> $i = $data;
	$count = 0;
	$consumed++;
	<B><FONT COLOR="#A020F0">last</FONT></B> <B><FONT COLOR="#A020F0">if</FONT></B> ($i == $n);
	cond_signal($count);
    }
}

<B><FONT COLOR="#A020F0">sub</FONT></B> producer {
    <B><FONT COLOR="#A020F0">my</FONT></B> $n = <B><FONT COLOR="#A020F0">shift</FONT></B>;
    <B><FONT COLOR="#A020F0">for</FONT></B> (<B><FONT COLOR="#A020F0">my</FONT></B> $i=1; $i&lt;=$n; $i++) {
	lock($count);
	cond_wait($count) <B><FONT COLOR="#A020F0">while</FONT></B> ($count == 1);
	$data = $i;
	$count = 1;
	$produced++;
	cond_signal($count);
    }
}

<B><FONT COLOR="#A020F0">sub</FONT></B> main {
    <B><FONT COLOR="#A020F0">my</FONT></B> $n = ($ARGV[0] &lt; 1) ? 1 : $ARGV[0];
    <B><FONT COLOR="#A020F0">my</FONT></B> $p = Thread-&gt;new(\&amp;producer, $n);
    <B><FONT COLOR="#A020F0">my</FONT></B> $c = Thread-&gt;new(\&amp;consumer, $n);
    $p-&gt;join;
    $c-&gt;join;
    <B><FONT COLOR="#A020F0">print</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;$produced $consumed\n&quot;</FONT></B>;
}

&amp;main();</pre></td></tr></table>
