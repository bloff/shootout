<table width="100%" border="0" cellpadding="5" cellspacing="0"><tr><td bgcolor="#FFFFFF"><pre>
<I><FONT COLOR="#B22222">%%% -*- mode: erlang -*-
</FONT></I><I><FONT COLOR="#B22222">%%% $Id: objinst-erlang.code,v 1.1 2004-11-02 08:52:38 bfulgham Exp $
</FONT></I><I><FONT COLOR="#B22222">%%% http://shootout.alioth.debian.org/
</FONT></I><I><FONT COLOR="#B22222">%%%
</FONT></I><I><FONT COLOR="#B22222">%%% Provided by Bengt Kleberg (Erlang Guru!)
</FONT></I><I><FONT COLOR="#B22222">%%% Slightly modified by Brent Fulgham to match expected output.
</FONT></I><I><FONT COLOR="#B22222">%%%
</FONT></I><B><FONT COLOR="#5F9EA0">-module</FONT></B>(objinst).  
<B><FONT COLOR="#5F9EA0">-export</FONT></B>([main/0, main/1]).

<B><FONT COLOR="#5F9EA0">-record</FONT></B>( <B><FONT COLOR="#228B22">toggle_base</FONT></B>, {state, value = <B><FONT COLOR="#A020F0">fun</FONT></B> value/1, activate = <B><FONT COLOR="#A020F0">fun</FONT></B> activate/1} ).
<B><FONT COLOR="#5F9EA0">-record</FONT></B>( <B><FONT COLOR="#228B22">toggle</FONT></B>, {toggle_base} ).
<B><FONT COLOR="#5F9EA0">-record</FONT></B>( <B><FONT COLOR="#228B22">nth_toggle</FONT></B>, { toggle_base, counter = 0, max_count } ).

<B><FONT COLOR="#0000FF">main</FONT></B>() -&gt; main([<B><FONT COLOR="#BC8F8F">'1'</FONT></B>]).
<B><FONT COLOR="#0000FF">main</FONT></B>([<FONT COLOR="#B8860B">Arg</FONT>]) -&gt;
	<FONT COLOR="#B8860B">Number_of_Times</FONT> = atom_to_integer( <FONT COLOR="#B8860B">Arg</FONT> ),
	activate_toggle( 5, toggle_new( true ) ),
	create_toggle( <FONT COLOR="#B8860B">Number_of_Times</FONT> ),
	io:fwrite(<B><FONT COLOR="#BC8F8F">&quot;\n&quot;</FONT></B>),
	activate_toggle( 8, nth_toggle_new( true, 3 ) ),
	create_nth_toggle( <FONT COLOR="#B8860B">Number_of_Times</FONT> ),
	erlang:<B><FONT COLOR="#A020F0">halt</FONT></B>().


<B><FONT COLOR="#0000FF">atom_to_integer</FONT></B>( <FONT COLOR="#B8860B">Atom</FONT> ) -&gt;
	erlang:<B><FONT COLOR="#A020F0">list_to_integer</FONT></B>(erlang:<B><FONT COLOR="#A020F0">atom_to_list</FONT></B>(<FONT COLOR="#B8860B">Atom</FONT>)).


<B><FONT COLOR="#0000FF">activate_toggle</FONT></B>( 0, <FONT COLOR="#B8860B">_Toggle</FONT> ) -&gt; ok;
<B><FONT COLOR="#0000FF">activate_toggle</FONT></B>( <FONT COLOR="#B8860B">N</FONT>, <FONT COLOR="#B8860B">Toggle</FONT> ) -&gt;
	<FONT COLOR="#B8860B">Activated_Toggle</FONT> = ((<FONT COLOR="#B8860B">Toggle</FONT>#<B><FONT COLOR="#228B22">toggle</FONT></B>.toggle_base)#<B><FONT COLOR="#228B22">toggle_base</FONT></B>.activate)(<FONT COLOR="#B8860B">Toggle</FONT>),
	<FONT COLOR="#B8860B">Value</FONT> = ((<FONT COLOR="#B8860B">Activated_Toggle</FONT>#<B><FONT COLOR="#228B22">toggle</FONT></B>.toggle_base)#<B><FONT COLOR="#228B22">toggle_base</FONT></B>.value)(<FONT COLOR="#B8860B">Activated_Toggle</FONT>),
	io:fwrite(<B><FONT COLOR="#BC8F8F">&quot;~w\n&quot;</FONT></B>, [<FONT COLOR="#B8860B">Value</FONT>]),
	activate_toggle( <FONT COLOR="#B8860B">N</FONT> - 1, <FONT COLOR="#B8860B">Activated_Toggle</FONT>).


<B><FONT COLOR="#0000FF">create_toggle</FONT></B>( 0 ) -&gt; ok;
<B><FONT COLOR="#0000FF">create_toggle</FONT></B>( <FONT COLOR="#B8860B">N</FONT> ) -&gt;
	<FONT COLOR="#B8860B">_Toggle</FONT> = toggle_new( true ),
	create_toggle( <FONT COLOR="#B8860B">N</FONT>-1 ).


<B><FONT COLOR="#0000FF">create_nth_toggle</FONT></B>( 0 ) -&gt; ok;
<B><FONT COLOR="#0000FF">create_nth_toggle</FONT></B>( <FONT COLOR="#B8860B">N</FONT> ) -&gt;
	<FONT COLOR="#B8860B">_Toggle</FONT> = nth_toggle_new( true, 3 ),
	create_nth_toggle( <FONT COLOR="#B8860B">N</FONT>-1 ).


<B><FONT COLOR="#0000FF">toggle_base_new</FONT></B>( <FONT COLOR="#B8860B">State</FONT> ) -&gt;
	#<B><FONT COLOR="#228B22">toggle_base</FONT></B>{state = <FONT COLOR="#B8860B">State</FONT>}.

<B><FONT COLOR="#0000FF">toggle_new</FONT></B>( <FONT COLOR="#B8860B">State</FONT> ) -&gt;
	<FONT COLOR="#B8860B">Toggle</FONT> = toggle_base_new( <FONT COLOR="#B8860B">State</FONT> ),
	#<B><FONT COLOR="#228B22">toggle</FONT></B>{toggle_base = <FONT COLOR="#B8860B">Toggle</FONT>}.

<B><FONT COLOR="#0000FF">nth_toggle_new</FONT></B>( <FONT COLOR="#B8860B">State</FONT>, <FONT COLOR="#B8860B">Max_Count</FONT> ) -&gt;
	<FONT COLOR="#B8860B">Toggle</FONT> = toggle_base_new( <FONT COLOR="#B8860B">State</FONT> ),
	#<B><FONT COLOR="#228B22">nth_toggle</FONT></B>{toggle_base = <FONT COLOR="#B8860B">Toggle</FONT>, max_count = <FONT COLOR="#B8860B">Max_Count</FONT> - 1}.


<B><FONT COLOR="#0000FF">activate</FONT></B>( #<B><FONT COLOR="#228B22">toggle_base</FONT></B>{state = true} = <FONT COLOR="#B8860B">Toggle_Base</FONT> ) -&gt;
	<FONT COLOR="#B8860B">Toggle_Base</FONT>#<B><FONT COLOR="#228B22">toggle_base</FONT></B>{state = false};
<B><FONT COLOR="#0000FF">activate</FONT></B>( #<B><FONT COLOR="#228B22">toggle_base</FONT></B>{state = false} = <FONT COLOR="#B8860B">Toggle_Base</FONT> ) -&gt;
	<FONT COLOR="#B8860B">Toggle_Base</FONT>#<B><FONT COLOR="#228B22">toggle_base</FONT></B>{state = true};
<B><FONT COLOR="#0000FF">activate</FONT></B>( #<B><FONT COLOR="#228B22">toggle</FONT></B>{toggle_base = <FONT COLOR="#B8860B">Toggle_Base</FONT>} = <FONT COLOR="#B8860B">Toggle</FONT> ) -&gt;
	<FONT COLOR="#B8860B">Toggle</FONT>#<B><FONT COLOR="#228B22">toggle</FONT></B>{toggle_base = activate( <FONT COLOR="#B8860B">Toggle_Base</FONT> )};
<B><FONT COLOR="#0000FF">activate</FONT></B>( #<B><FONT COLOR="#228B22">nth_toggle</FONT></B>{counter = <FONT COLOR="#B8860B">Max_Count</FONT>, max_count = <FONT COLOR="#B8860B">Max_Count</FONT>, toggle_base = <FONT COLOR="#B8860B">Toggle_Base</FONT>} = <FONT COLOR="#B8860B">Nth_Toggle</FONT> ) -&gt;
	<FONT COLOR="#B8860B">Nth_Toggle</FONT>#<B><FONT COLOR="#228B22">nth_toggle</FONT></B>{toggle_base = activate( <FONT COLOR="#B8860B">Toggle_Base</FONT> ), counter = 0};
<B><FONT COLOR="#0000FF">activate</FONT></B>( #<B><FONT COLOR="#228B22">nth_toggle</FONT></B>{counter = <FONT COLOR="#B8860B">Count</FONT>} = <FONT COLOR="#B8860B">Nth_Toggle</FONT> ) -&gt;
	<FONT COLOR="#B8860B">Nth_Toggle</FONT>#<B><FONT COLOR="#228B22">nth_toggle</FONT></B>{counter = <FONT COLOR="#B8860B">Count</FONT> + 1}.

<B><FONT COLOR="#0000FF">value</FONT></B>( #<B><FONT COLOR="#228B22">toggle_base</FONT></B>{state = <FONT COLOR="#B8860B">State</FONT>} ) -&gt;
	<FONT COLOR="#B8860B">State</FONT>;
<B><FONT COLOR="#0000FF">value</FONT></B>( #<B><FONT COLOR="#228B22">toggle</FONT></B>{toggle_base = <FONT COLOR="#B8860B">Toggle_Base</FONT>} ) -&gt;
	value( <FONT COLOR="#B8860B">Toggle_Base</FONT> );
<B><FONT COLOR="#0000FF">value</FONT></B>( #<B><FONT COLOR="#228B22">nth_toggle</FONT></B>{toggle_base = <FONT COLOR="#B8860B">Toggle_Base</FONT>} ) -&gt;
	value( <FONT COLOR="#B8860B">Toggle_Base</FONT> ).</pre></td></tr></table>
