<table width="100%" border="0" cellpadding="5" cellspacing="0"><tr><td bgcolor="#FFFFFF"><pre>
module:         wc
synopsis:       implementation of <B><FONT COLOR="#BC8F8F">&quot;Count Lines/Words/Chars&quot;</FONT></B> benchmark
author:         Peter Hinely
copyright:      public <B><FONT COLOR="#5F9EA0">domain</FONT></B>
use-libraries:  common-dylan, io
use-modules:    common-dylan, standard-io, streams, format-out

<B><FONT COLOR="#A020F0">define</FONT></B> <B><FONT COLOR="#5F9EA0">function</FONT></B> <B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">count </FONT></I></B></FONT></B>() <B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">=&gt;</FONT></I></B></FONT></B> ()
  <B><FONT COLOR="#A020F0">let</FONT></B> number-of-lines = 0;
  <B><FONT COLOR="#A020F0">let</FONT></B> number-of-words = 0;
  <B><FONT COLOR="#A020F0">let</FONT></B> number-of-characters = 0;
  <B><FONT COLOR="#A020F0">let</FONT></B> in-word = #f;
  
  <B><FONT COLOR="#A020F0">let</FONT></B> chunk-size = 4096;
  <B><FONT COLOR="#A020F0">let</FONT></B> buffer = <B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">make</FONT></I></B></FONT></B>(<B><FONT COLOR="#228B22">&lt;byte-string&gt;</FONT></B>, <B><FONT COLOR="#5F9EA0">size:</FONT></B> chunk-size);
  <B><FONT COLOR="#A020F0">let</FONT></B> bytes-read <B><FONT COLOR="#5F9EA0">::</FONT></B> <B><FONT COLOR="#228B22">&lt;integer&gt;</FONT></B> = 0;

  <B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">while </FONT></I></B></FONT></B>((bytes-read <B><FONT COLOR="#5F9EA0">:</FONT></B>= <B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">read-into!</FONT></I></B></FONT></B>(*standard-input*, chunk-size, buffer, <B><FONT COLOR="#5F9EA0">on-end-of-stream:</FONT></B> 0)) &gt; 0)
    number-of-characters <B><FONT COLOR="#5F9EA0">:</FONT></B>= number-of-characters + bytes-read;
    <B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">for </FONT></I></B></FONT></B>(c keyed-by i <B><FONT COLOR="#A020F0">in</FONT></B> buffer, <B><FONT COLOR="#5F9EA0">while:</FONT></B> i &lt; bytes-read)
      <B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">if </FONT></I></B></FONT></B>(c == <B><FONT COLOR="#BC8F8F">'\n'</FONT></B>)
        number-of-lines <B><FONT COLOR="#5F9EA0">:</FONT></B>= number-of-lines + 1;
      <B><FONT COLOR="#A020F0">end</FONT></B>;
      <B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">select </FONT></I></B></FONT></B>(c)
        <B><FONT COLOR="#BC8F8F">' ', '\n', '\t'</FONT></B> <B><FONT COLOR="#A020F0">=&gt;</FONT></B> in-word <B><FONT COLOR="#5F9EA0">:</FONT></B>= #f;
        <B><FONT COLOR="#A020F0">otherwise</FONT></B>       <B><FONT COLOR="#A020F0">=&gt;</FONT></B> <B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">if </FONT></I></B></FONT></B>(~in-word)
                             number-of-words <B><FONT COLOR="#5F9EA0">:</FONT></B>= number-of-words + 1;
                             in-word <B><FONT COLOR="#5F9EA0">:</FONT></B>= #t;
                           <B><FONT COLOR="#A020F0">end</FONT></B> <B><FONT COLOR="#A020F0">if</FONT></B>;
      <B><FONT COLOR="#A020F0">end</FONT></B> <B><FONT COLOR="#A020F0">select</FONT></B>;
    <B><FONT COLOR="#A020F0">end</FONT></B> <B><FONT COLOR="#A020F0">for</FONT></B>;
  <B><FONT COLOR="#A020F0">end</FONT></B> <B><FONT COLOR="#A020F0">while</FONT></B>;
  
  <B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">format-out</FONT></I></B></FONT></B>(<B><FONT COLOR="#BC8F8F">&quot;%d %d %d\n&quot;</FONT></B>, number-of-lines, number-of-words, number-of-characters);
<B><FONT COLOR="#A020F0">end</FONT></B> <B><FONT COLOR="#5F9EA0">function</FONT></B>;

<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">count</FONT></I></B></FONT></B>();</pre></td></tr></table>
