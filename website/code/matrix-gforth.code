<table width="100%" border="0" cellpadding="5" cellspacing="0"><tr><td bgcolor="#FFFFFF"><pre>
<I><FONT COLOR="#B22222">\ -*- mode: forth -*-
</FONT></I><I><FONT COLOR="#B22222">\ $Id: matrix-gforth.code,v 1.1 2004-11-02 08:52:36 bfulgham Exp $
</FONT></I><I><FONT COLOR="#B22222">\ http://www.bagley.org/~doug/shootout/
</FONT></I><I><FONT COLOR="#B22222">\ from Jorge Acereda Maciá
</FONT></I>
0. argc @ 1<B><FONT COLOR="#5F9EA0">-</FONT></B> arg <B><FONT COLOR="#5F9EA0">&gt;</FONT></B>number <B><FONT COLOR="#5F9EA0">2drop</FONT></B> <B><FONT COLOR="#5F9EA0">drop</FONT></B> <B><FONT COLOR="#A020F0">constant</FONT></B> iterations

30 <B><FONT COLOR="#A020F0">constant</FONT></B> size
size <B><FONT COLOR="#5F9EA0">dup</FONT></B> <B><FONT COLOR="#5F9EA0">*</FONT></B> floats <B><FONT COLOR="#A020F0">constant</FONT></B> mat<B><FONT COLOR="#5F9EA0">-</FONT></B>byte<B><FONT COLOR="#5F9EA0">-</FONT></B>size
<B><FONT COLOR="#A020F0">: </FONT></B><B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">row-size</FONT></I></B></FONT></B>     size postpone literal ; immediate
<B><FONT COLOR="#A020F0">: </FONT></B><B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">row-stride</FONT></I></B></FONT></B>   <B><FONT COLOR="#228B22">float</FONT></B> postpone literal ; immediate
<B><FONT COLOR="#A020F0">: </FONT></B><B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">col-stride</FONT></I></B></FONT></B>   size floats postpone literal ; immediate

<B><FONT COLOR="#A020F0">: </FONT></B><B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">mkmatrix</FONT></I></B></FONT></B> ( addr <B><FONT COLOR="#5F9EA0">-</FONT></B><B><FONT COLOR="#5F9EA0">-</FONT></B>)
    1.e mat<B><FONT COLOR="#5F9EA0">-</FONT></B>byte<B><FONT COLOR="#5F9EA0">-</FONT></B>size bounds <B><FONT COLOR="#A020F0">do</FONT></B> <B><FONT COLOR="#5F9EA0">fdup</FONT></B> i f<B><FONT COLOR="#5F9EA0">!</FONT></B> 1e f<B><FONT COLOR="#5F9EA0">+</FONT></B> <B><FONT COLOR="#228B22">float</FONT></B> <B><FONT COLOR="#5F9EA0">+</FONT></B><B><FONT COLOR="#A020F0">loop</FONT></B> <B><FONT COLOR="#5F9EA0">fdrop</FONT></B> ;

<B><FONT COLOR="#A020F0">: </FONT></B><B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">}}?</FONT></I></B></FONT></B> ( n1 n2 matrix <B><FONT COLOR="#5F9EA0">-</FONT></B><B><FONT COLOR="#5F9EA0">-</FONT></B> addr, print matrix element)
    <B><FONT COLOR="#5F9EA0">rot</FONT></B> row<B><FONT COLOR="#5F9EA0">-</FONT></B>size <B><FONT COLOR="#5F9EA0">*</FONT></B> <B><FONT COLOR="#5F9EA0">rot</FONT></B> <B><FONT COLOR="#5F9EA0">+</FONT></B> floats <B><FONT COLOR="#5F9EA0">+</FONT></B> f@ f<B><FONT COLOR="#5F9EA0">&gt;</FONT></B>d d<B><FONT COLOR="#5F9EA0">&gt;</FONT></B>s 1 u.r ;

<B><FONT COLOR="#A020F0">: </FONT></B><B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">mat*</FONT></I></B></FONT></B> ( r m1 m2 <B><FONT COLOR="#5F9EA0">-</FONT></B><B><FONT COLOR="#5F9EA0">-</FONT></B>, multiply matrices m1 <B><FONT COLOR="#A020F0">and</FONT></B> m2 storing result at r)
    <B><FONT COLOR="#5F9EA0">-</FONT></B><B><FONT COLOR="#5F9EA0">rot</FONT></B> mat<B><FONT COLOR="#5F9EA0">-</FONT></B>byte<B><FONT COLOR="#5F9EA0">-</FONT></B>size bounds <B><FONT COLOR="#A020F0">do</FONT></B>
        <B><FONT COLOR="#5F9EA0">over</FONT></B> col<B><FONT COLOR="#5F9EA0">-</FONT></B>stride bounds <B><FONT COLOR="#A020F0">do</FONT></B>
            i col<B><FONT COLOR="#5F9EA0">-</FONT></B>stride j row<B><FONT COLOR="#5F9EA0">-</FONT></B>stride row<B><FONT COLOR="#5F9EA0">-</FONT></B>size v<B><FONT COLOR="#5F9EA0">*</FONT></B> <B><FONT COLOR="#5F9EA0">dup</FONT></B> f<B><FONT COLOR="#5F9EA0">!</FONT></B> <B><FONT COLOR="#228B22">float</FONT></B><B><FONT COLOR="#5F9EA0">+</FONT></B>
        <B><FONT COLOR="#228B22">float</FONT></B> <B><FONT COLOR="#5F9EA0">+</FONT></B><B><FONT COLOR="#A020F0">loop</FONT></B>
    col<B><FONT COLOR="#5F9EA0">-</FONT></B>stride <B><FONT COLOR="#5F9EA0">+</FONT></B><B><FONT COLOR="#A020F0">loop</FONT></B> <B><FONT COLOR="#5F9EA0">2drop</FONT></B> ;

create a mat<B><FONT COLOR="#5F9EA0">-</FONT></B>byte<B><FONT COLOR="#5F9EA0">-</FONT></B>size allot   a mkmatrix
create b mat<B><FONT COLOR="#5F9EA0">-</FONT></B>byte<B><FONT COLOR="#5F9EA0">-</FONT></B>size allot   b mkmatrix
create r mat<B><FONT COLOR="#5F9EA0">-</FONT></B>byte<B><FONT COLOR="#5F9EA0">-</FONT></B>size allot

<B><FONT COLOR="#A020F0">: </FONT></B><B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">test</FONT></I></B></FONT></B> iterations 0 <B><FONT COLOR="#A020F0">do</FONT></B>   r a b mat<B><FONT COLOR="#5F9EA0">*</FONT></B>   <B><FONT COLOR="#A020F0">loop</FONT></B> ;

test 0 0 r }}? space  2 3 r }}? space  3 2 r }}? space  4 4 r }}?  cr <B><FONT COLOR="#5F9EA0">bye</FONT></B></pre></td></tr></table>
