<span class="str">&quot;The Computer Language Shootout</span>
<span class="str"> http://shootout.alioth.debian.org/</span>
<span class="str"> contributed by Isaac Gouy&quot;</span>


<span class="sym">!</span> FileStream methodsFor<span class="sym">:</span> <span class="str">'accessing'</span><span class="sym">!</span>

readFasta<span class="sym">:</span> anId
   <span class="sym">|</span> idString newline buffer description line char <span class="sym">|</span>
   idString <span class="sym">:=</span> <span class="str">'&gt;'</span><span class="sym">,</span>anId.
   newline <span class="sym">:=</span> Character nl.

   <span class="str">&quot;find start of particular fasta sequence&quot;</span>
   <span class="sym">[(</span>self atEnd<span class="sym">)</span> <span class="kwa">or</span><span class="sym">: [</span>
         <span class="sym">(</span>self peek <span class="sym">= $&gt;)</span>
            ifTrue<span class="sym">: [(</span>line <span class="sym">:=</span> self nextLine<span class="sym">)</span> startsWith<span class="sym">:</span> idString<span class="sym">]</span>
            ifFalse<span class="sym">: [</span>self skipTo<span class="sym">:</span> newline. false<span class="sym">]]</span>
      <span class="sym">]</span> whileFalse.

   <span class="str">&quot;line-by-line read - it would be a lot faster to block read&quot;</span>
   description <span class="sym">:=</span> line.
   buffer <span class="sym">:=</span> ByteStream on<span class="sym">: (</span>String new<span class="sym">:</span> <span class="num">1028</span><span class="sym">)</span>.
   <span class="sym">[(</span>self atEnd<span class="sym">)</span> <span class="kwa">or</span><span class="sym">: [(</span>char <span class="sym">:=</span> self peek<span class="sym">) = $&gt;]]</span> whileFalse<span class="sym">: [</span>
      <span class="sym">(</span>char <span class="sym">= $;)</span>
         ifTrue<span class="sym">: [</span>self nextLine<span class="sym">]</span>
         ifFalse<span class="sym">: [</span>buffer nextPutAll<span class="sym">:</span> self nextLine<span class="sym">]</span>
      <span class="sym">]</span>.

   ^Association key<span class="sym">:</span> description value<span class="sym">:</span> buffer contents <span class="sym">!</span>


writeReverseComplementFasta<span class="sym">:</span> aString sequence<span class="sym">:</span> aSequence
   <span class="sym">|</span> lineLength n iub <span class="sym">|</span>
   <span class="sym">(</span>aString isNil<span class="sym">)</span> ifTrue<span class="sym">: [</span>^self<span class="sym">]</span>.

   lineLength <span class="sym">:=</span> <span class="num">60</span>. n <span class="sym">:=</span> aSequence size.

   iub <span class="sym">:=</span> String new<span class="sym">:</span> <span class="num">128</span> withAll<span class="sym">: $*</span>.
   iub at<span class="sym">:</span> <span class="kwb">$a</span> value put<span class="sym">:</span> <span class="kwb">$T</span>. iub at<span class="sym">:</span> <span class="kwb">$A</span> value put<span class="sym">:</span> <span class="kwb">$T</span>.
   iub at<span class="sym">:</span> <span class="kwb">$b</span> value put<span class="sym">:</span> <span class="kwb">$V</span>. iub at<span class="sym">:</span> <span class="kwb">$B</span> value put<span class="sym">:</span> <span class="kwb">$V</span>.
   iub at<span class="sym">:</span> <span class="kwb">$c</span> value put<span class="sym">:</span> <span class="kwb">$G</span>. iub at<span class="sym">:</span> <span class="kwb">$C</span> value put<span class="sym">:</span> <span class="kwb">$G</span>.
   iub at<span class="sym">:</span> <span class="kwb">$d</span> value put<span class="sym">:</span> <span class="kwb">$H</span>. iub at<span class="sym">:</span> <span class="kwb">$D</span> value put<span class="sym">:</span> <span class="kwb">$H</span>.
   iub at<span class="sym">:</span> <span class="kwb">$g</span> value put<span class="sym">:</span> <span class="kwb">$C</span>. iub at<span class="sym">:</span> <span class="kwb">$G</span> value put<span class="sym">:</span> <span class="kwb">$C</span>.
   iub at<span class="sym">:</span> <span class="kwb">$h</span> value put<span class="sym">:</span> <span class="kwb">$D</span>. iub at<span class="sym">:</span> <span class="kwb">$H</span> value put<span class="sym">:</span> <span class="kwb">$D</span>.
   iub at<span class="sym">:</span> <span class="kwb">$k</span> value put<span class="sym">:</span> <span class="kwb">$M</span>. iub at<span class="sym">:</span> <span class="kwb">$K</span> value put<span class="sym">:</span> <span class="kwb">$M</span>.
   iub at<span class="sym">:</span> <span class="kwb">$m</span> value put<span class="sym">:</span> <span class="kwb">$K</span>. iub at<span class="sym">:</span> <span class="kwb">$M</span> value put<span class="sym">:</span> <span class="kwb">$K</span>.
   iub at<span class="sym">:</span> <span class="kwb">$n</span> value put<span class="sym">:</span> <span class="kwb">$N</span>. iub at<span class="sym">:</span> <span class="kwb">$N</span> value put<span class="sym">:</span> <span class="kwb">$N</span>.
   iub at<span class="sym">:</span> <span class="kwb">$r</span> value put<span class="sym">:</span> <span class="kwb">$Y</span>. iub at<span class="sym">:</span> <span class="kwb">$R</span> value put<span class="sym">:</span> <span class="kwb">$Y</span>.
   iub at<span class="sym">:</span> <span class="kwb">$s</span> value put<span class="sym">:</span> <span class="kwb">$S</span>. iub at<span class="sym">:</span> <span class="kwb">$S</span> value put<span class="sym">:</span> <span class="kwb">$S</span>.
   iub at<span class="sym">:</span> <span class="kwb">$t</span> value put<span class="sym">:</span> <span class="kwb">$A</span>. iub at<span class="sym">:</span> <span class="kwb">$T</span> value put<span class="sym">:</span> <span class="kwb">$A</span>.
   iub at<span class="sym">:</span> <span class="kwb">$v</span> value put<span class="sym">:</span> <span class="kwb">$B</span>. iub at<span class="sym">:</span> <span class="kwb">$V</span> value put<span class="sym">:</span> <span class="kwb">$B</span>.
   iub at<span class="sym">:</span> <span class="kwb">$w</span> value put<span class="sym">:</span> <span class="kwb">$W</span>. iub at<span class="sym">:</span> <span class="kwb">$W</span> value put<span class="sym">:</span> <span class="kwb">$W</span>.
   iub at<span class="sym">:</span> <span class="kwb">$y</span> value put<span class="sym">:</span> <span class="kwb">$R</span>. iub at<span class="sym">:</span> <span class="kwb">$Y</span> value put<span class="sym">:</span> <span class="kwb">$R</span>.

   self nextPutAll<span class="sym">:</span> aString<span class="sym">;</span> nl.

   <span class="sym">[</span>n <span class="sym">&gt;</span> <span class="num">0</span><span class="sym">]</span> whileTrue<span class="sym">: [</span>
         <span class="num">1</span> to<span class="sym">: ((</span>n <span class="sym">&lt;</span> lineLength<span class="sym">)</span> ifTrue<span class="sym">: [</span>n<span class="sym">]</span> ifFalse<span class="sym">: [</span>lineLength<span class="sym">])</span> <span class="kwa">do</span><span class="sym">:</span>
            <span class="sym">[:</span>i <span class="sym">|</span> self nextPut<span class="sym">: (</span>iub at<span class="sym">: (</span>aSequence at<span class="sym">:</span> n <span class="sym">-</span> i <span class="sym">+</span> <span class="num">1</span><span class="sym">)</span> value<span class="sym">)]</span>.
         self nl.
         n <span class="sym">:=</span> n <span class="sym">-</span> lineLength.
      <span class="sym">] ! !</span>


<span class="sym">|</span> in out fasta <span class="sym">|</span>
in <span class="sym">:=</span> FileStream stdin bufferSize<span class="sym">:</span> <span class="num">4096</span>.
out <span class="sym">:=</span> FileStream stdout bufferSize<span class="sym">:</span> <span class="num">4096</span>.

fasta <span class="sym">:=</span> in readFasta<span class="sym">:</span> <span class="str">'ONE'</span>.
out writeReverseComplementFasta<span class="sym">:</span> fasta key sequence<span class="sym">:</span> fasta value.

fasta <span class="sym">:=</span> in readFasta<span class="sym">:</span> <span class="str">'TWO'</span>.
out writeReverseComplementFasta<span class="sym">:</span> fasta key sequence<span class="sym">:</span> fasta value.

fasta <span class="sym">:=</span> in readFasta<span class="sym">:</span> <span class="str">'THREE'</span>.
out writeReverseComplementFasta<span class="sym">:</span> fasta key sequence<span class="sym">:</span> fasta value.

in close. out close <span class="sym">!</span>
