<table width="100%" border="0" cellpadding="5" cellspacing="0"><tr><td bgcolor="#FFFFFF"><pre>
<I><FONT COLOR="#B22222">-- $Id: objinst-lua.code,v 1.2 2004-11-08 08:15:18 bfulgham Exp $
</FONT></I><I><FONT COLOR="#B22222">-- http://shootout.alioth.debian.org/
</FONT></I><I><FONT COLOR="#B22222">-- contributed by Roberto Ierusalimschy
</FONT></I>
<I><FONT COLOR="#B22222">--------------------------------------------------------------
</FONT></I><I><FONT COLOR="#B22222">-- Toggle class
</FONT></I><I><FONT COLOR="#B22222">--------------------------------------------------------------
</FONT></I>
Toggle <B><FONT COLOR="#5F9EA0">=</FONT></B> {}

<B><FONT COLOR="#A020F0">function </FONT></B><B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Toggle:value</FONT></I></B></FONT></B>  <B><FONT COLOR="#A020F0">()</FONT></B>
  <B><FONT COLOR="#A020F0">return</FONT></B> self.state
<B><FONT COLOR="#A020F0">end</FONT></B>

<B><FONT COLOR="#A020F0">function </FONT></B><B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Toggle:activate</FONT></I></B></FONT></B>  <B><FONT COLOR="#A020F0">()</FONT></B>
  self.state <B><FONT COLOR="#5F9EA0">=</FONT></B> <B><FONT COLOR="#A020F0">not</FONT></B> self.state
  <B><FONT COLOR="#A020F0">return</FONT></B> self
<B><FONT COLOR="#A020F0">end</FONT></B>

<B><FONT COLOR="#A020F0">function </FONT></B><B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Toggle:new</FONT></I></B></FONT></B>  <B><FONT COLOR="#A020F0">(start_state)</FONT></B>
  <B><FONT COLOR="#A020F0">local</FONT></B> o <B><FONT COLOR="#5F9EA0">=</FONT></B> {state <B><FONT COLOR="#5F9EA0">=</FONT></B> start_state}
  self.__index <B><FONT COLOR="#5F9EA0">=</FONT></B> self
  setmetatable(o, self)
  <B><FONT COLOR="#A020F0">return</FONT></B> o
<B><FONT COLOR="#A020F0">end</FONT></B>

<I><FONT COLOR="#B22222">--------------------------------------------------------------
</FONT></I><I><FONT COLOR="#B22222">-- NthToggle class
</FONT></I><I><FONT COLOR="#B22222">--------------------------------------------------------------
</FONT></I>
NthToggle <B><FONT COLOR="#5F9EA0">=</FONT></B><B><FONT COLOR="#5F9EA0"> Toggle:n</FONT></B>ew()

<B><FONT COLOR="#A020F0">function </FONT></B><B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">NthToggle:activate</FONT></I></B></FONT></B>  <B><FONT COLOR="#A020F0">()</FONT></B>
  self.counter <B><FONT COLOR="#5F9EA0">=</FONT></B> self.counter <B><FONT COLOR="#5F9EA0">+</FONT></B> 1
  <B><FONT COLOR="#A020F0">if</FONT></B> self.counter <B><FONT COLOR="#5F9EA0">&gt;=</FONT></B> self.count_max <B><FONT COLOR="#A020F0">then</FONT></B>
    self.state <B><FONT COLOR="#5F9EA0">=</FONT></B> <B><FONT COLOR="#A020F0">not</FONT></B> self.state
    self.counter <B><FONT COLOR="#5F9EA0">=</FONT></B> 0
  <B><FONT COLOR="#A020F0">end</FONT></B>
  <B><FONT COLOR="#A020F0">return</FONT></B> self
<B><FONT COLOR="#A020F0">end</FONT></B>

<B><FONT COLOR="#A020F0">function </FONT></B><B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">NthToggle:new</FONT></I></B></FONT></B>  <B><FONT COLOR="#A020F0">(start_state, max_counter)</FONT></B>
  <B><FONT COLOR="#A020F0">local</FONT></B> o <B><FONT COLOR="#5F9EA0">=</FONT></B> Toggle.new(self, start_state)
  o.count_max <B><FONT COLOR="#5F9EA0">=</FONT></B> max_counter
  o.counter <B><FONT COLOR="#5F9EA0">=</FONT></B> 0
  <B><FONT COLOR="#A020F0">return</FONT></B> o
<B><FONT COLOR="#A020F0">end</FONT></B>

<I><FONT COLOR="#B22222">-----------------------------------------------------------
</FONT></I><I><FONT COLOR="#B22222">-- main
</FONT></I><I><FONT COLOR="#B22222">-----------------------------------------------------------
</FONT></I><B><FONT COLOR="#A020F0">function </FONT></B><B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">main</FONT></I></B></FONT></B>  <B><FONT COLOR="#A020F0">()</FONT></B>
    <B><FONT COLOR="#A020F0">local</FONT></B> N <B><FONT COLOR="#5F9EA0">=</FONT></B> <B><FONT COLOR="#228B22">tonumber</FONT></B>((arg <B><FONT COLOR="#A020F0">and</FONT></B> arg[1])) <B><FONT COLOR="#A020F0">or</FONT></B> 1
    <B><FONT COLOR="#A020F0">local</FONT></B> toggle <B><FONT COLOR="#5F9EA0">=</FONT></B><B><FONT COLOR="#5F9EA0"> Toggle:n</FONT></B>ew(1)
    <B><FONT COLOR="#A020F0">for</FONT></B> i<B><FONT COLOR="#5F9EA0">=</FONT></B>1,5 <B><FONT COLOR="#A020F0">do</FONT></B>
<B><FONT COLOR="#5F9EA0">      toggle:a</FONT></B>ctivate()
      <B><FONT COLOR="#228B22">print</FONT></B>(<B><FONT COLOR="#5F9EA0">toggle:v</FONT></B>alue() <B><FONT COLOR="#A020F0">and</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;true&quot;</FONT></B> <B><FONT COLOR="#A020F0">or</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;false&quot;</FONT></B>)
    <B><FONT COLOR="#A020F0">end</FONT></B>
    <B><FONT COLOR="#A020F0">for</FONT></B> i<B><FONT COLOR="#5F9EA0">=</FONT></B>1,N <B><FONT COLOR="#A020F0">do</FONT></B>
      toggle <B><FONT COLOR="#5F9EA0">=</FONT></B><B><FONT COLOR="#5F9EA0"> Toggle:n</FONT></B>ew(1)
    <B><FONT COLOR="#A020F0">end</FONT></B>

    <B><FONT COLOR="#228B22">print</FONT></B>(<B><FONT COLOR="#BC8F8F">&quot;&quot;</FONT></B>)

    <B><FONT COLOR="#A020F0">local</FONT></B> ntoggle <B><FONT COLOR="#5F9EA0">=</FONT></B><B><FONT COLOR="#5F9EA0"> NthToggle:n</FONT></B>ew(1, 3)
    <B><FONT COLOR="#A020F0">for</FONT></B> i<B><FONT COLOR="#5F9EA0">=</FONT></B>1,8 <B><FONT COLOR="#A020F0">do</FONT></B>
<B><FONT COLOR="#5F9EA0">      ntoggle:a</FONT></B>ctivate()
      <B><FONT COLOR="#228B22">print</FONT></B>(<B><FONT COLOR="#5F9EA0">ntoggle:v</FONT></B>alue() <B><FONT COLOR="#A020F0">and</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;true&quot;</FONT></B> <B><FONT COLOR="#A020F0">or</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;false&quot;</FONT></B>)
    <B><FONT COLOR="#A020F0">end</FONT></B>
    <B><FONT COLOR="#A020F0">for</FONT></B> i<B><FONT COLOR="#5F9EA0">=</FONT></B>1,N <B><FONT COLOR="#A020F0">do</FONT></B>
      ntoggle <B><FONT COLOR="#5F9EA0">=</FONT></B><B><FONT COLOR="#5F9EA0"> NthToggle:n</FONT></B>ew(1, 3)
    <B><FONT COLOR="#A020F0">end</FONT></B>
<B><FONT COLOR="#A020F0">end</FONT></B>

main()

</pre></td></tr></table>
