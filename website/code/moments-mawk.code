<table width="100%" border="0" cellpadding="5" cellspacing="0"><tr><td bgcolor="#FFFFFF"><pre>
<I><FONT COLOR="#B22222"># $Id: moments-mawk.code,v 1.1 2004-11-02 08:52:37 bfulgham Exp $
</FONT></I><I><FONT COLOR="#B22222"># http://www.bagley.org/~doug/shootout/
</FONT></I>
<B><FONT COLOR="#A020F0">BEGIN</FONT></B> {
    <B><FONT COLOR="#A020F0">delete</FONT></B> <B><FONT COLOR="#A020F0">ARGV</FONT></B>;
    sum = 0;
    n = 0;
}

{
    nums[n++] = $1;
    sum += $1;
}

<B><FONT COLOR="#A020F0">END</FONT></B> {
    mean = sum/n;
    <B><FONT COLOR="#A020F0">for</FONT></B> (num <B><FONT COLOR="#A020F0">in</FONT></B> nums) {
	dev = num - mean;
	<B><FONT COLOR="#A020F0">if</FONT></B> (dev &gt; 0) { avg_dev += dev; } <B><FONT COLOR="#A020F0">else</FONT></B> { avg_dev -= dev; }
	vari += dev^2;
	skew += dev^3;
	kurt += dev^4;
    }
    avg_dev /= n;
    vari /= (n - 1);
    std_dev = <B><FONT COLOR="#A020F0">sqrt</FONT></B>(vari);

    <B><FONT COLOR="#A020F0">if</FONT></B> (vari &gt; 0) {
	skew /= (n * vari * std_dev);
	kurt = kurt/(n * vari * vari) - 3.0;
    }

    nums[n] = nums[0];
    heapsort(n, nums);

    mid = <B><FONT COLOR="#A020F0">int</FONT></B>(n/2)+1;
    median = (n % 2) ? nums[mid] : (nums[mid] + nums[mid-1])/2;

    <B><FONT COLOR="#A020F0">printf</FONT></B>(<B><FONT COLOR="#BC8F8F">&quot;n:                  %d\n&quot;</FONT></B>, n);
    <B><FONT COLOR="#A020F0">printf</FONT></B>(<B><FONT COLOR="#BC8F8F">&quot;median:             %f\n&quot;</FONT></B>, median);
    <B><FONT COLOR="#A020F0">printf</FONT></B>(<B><FONT COLOR="#BC8F8F">&quot;mean:               %f\n&quot;</FONT></B>, mean);
    <B><FONT COLOR="#A020F0">printf</FONT></B>(<B><FONT COLOR="#BC8F8F">&quot;average_deviation:  %f\n&quot;</FONT></B>, avg_dev);
    <B><FONT COLOR="#A020F0">printf</FONT></B>(<B><FONT COLOR="#BC8F8F">&quot;standard_deviation: %f\n&quot;</FONT></B>, std_dev);
    <B><FONT COLOR="#A020F0">printf</FONT></B>(<B><FONT COLOR="#BC8F8F">&quot;variance:           %f\n&quot;</FONT></B>, vari);
    <B><FONT COLOR="#A020F0">printf</FONT></B>(<B><FONT COLOR="#BC8F8F">&quot;skew:               %f\n&quot;</FONT></B>, skew);
    <B><FONT COLOR="#A020F0">printf</FONT></B>(<B><FONT COLOR="#BC8F8F">&quot;kurtosis:           %f\n&quot;</FONT></B>, kurt);
}

<B><FONT COLOR="#A020F0">function</FONT></B> heapsort (n, ra) {
    l = <B><FONT COLOR="#A020F0">int</FONT></B>(0.5+n/2) + 1
    ir = n;
    <B><FONT COLOR="#A020F0">for</FONT></B> (;;) {
        <B><FONT COLOR="#A020F0">if</FONT></B> (l &gt; 1) {
            rra = ra[--l];
        } <B><FONT COLOR="#A020F0">else</FONT></B> {
            rra = ra[ir];
            ra[ir] = ra[1];
            <B><FONT COLOR="#A020F0">if</FONT></B> (--ir == 1) {
                ra[1] = rra;
                <B><FONT COLOR="#A020F0">return</FONT></B>;
            }
        }
        i = l;
        j = l * 2;
        <B><FONT COLOR="#A020F0">while</FONT></B> (j &lt;= ir) {
            <B><FONT COLOR="#A020F0">if</FONT></B> (j &lt; ir &amp;&amp; ra[j] &lt; ra[j+1]) { ++j; }
            <B><FONT COLOR="#A020F0">if</FONT></B> (rra &lt; ra[j]) {
                ra[i] = ra[j];
                j += (i = j);
            } <B><FONT COLOR="#A020F0">else</FONT></B> {
                j = ir + 1;
            }
        }
        ra[i] = rra;
    }
}</pre></td></tr></table>
