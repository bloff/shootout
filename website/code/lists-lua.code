<table width="100%" border="0" cellpadding="5" cellspacing="0"><tr><td bgcolor="#FFFFFF"><pre>
<I><FONT COLOR="#B22222">-- $Id: lists-lua.code,v 1.1 2004-11-02 08:52:33 bfulgham Exp $
</FONT></I><I><FONT COLOR="#B22222">-- http://www.bagley.org/~doug/shootout/
</FONT></I><I><FONT COLOR="#B22222">-- implemented by: Roberto Ierusalimschy
</FONT></I>
<I><FONT COLOR="#B22222">--------------------------------------------------------------
</FONT></I><I><FONT COLOR="#B22222">-- List module
</FONT></I><I><FONT COLOR="#B22222">-- defines a prototipe for lists
</FONT></I><I><FONT COLOR="#B22222">--------------------------------------------------------------
</FONT></I>
List <B><FONT COLOR="#5F9EA0">=</FONT></B> {first <B><FONT COLOR="#5F9EA0">=</FONT></B> 0, last <B><FONT COLOR="#5F9EA0">=</FONT></B> <B><FONT COLOR="#5F9EA0">-</FONT></B>1}

<B><FONT COLOR="#A020F0">function </FONT></B><B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">List:new</FONT></I></B></FONT></B>  <B><FONT COLOR="#A020F0">()</FONT></B>
  <B><FONT COLOR="#A020F0">local</FONT></B> n <B><FONT COLOR="#5F9EA0">=</FONT></B> {}
  <B><FONT COLOR="#A020F0">for</FONT></B> k,v <B><FONT COLOR="#A020F0">in</FONT></B> self <B><FONT COLOR="#A020F0">do</FONT></B> n[k] <B><FONT COLOR="#5F9EA0">=</FONT></B> v <B><FONT COLOR="#A020F0">end</FONT></B>
  <B><FONT COLOR="#A020F0">return</FONT></B> n
<B><FONT COLOR="#A020F0">end</FONT></B>

<B><FONT COLOR="#A020F0">function </FONT></B><B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">List:length</FONT></I></B></FONT></B>  <B><FONT COLOR="#A020F0">()</FONT></B>
  <B><FONT COLOR="#A020F0">return</FONT></B> self.last <B><FONT COLOR="#5F9EA0">-</FONT></B> self.first <B><FONT COLOR="#5F9EA0">+</FONT></B> 1
<B><FONT COLOR="#A020F0">end</FONT></B>

<B><FONT COLOR="#A020F0">function </FONT></B><B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">List:pushleft</FONT></I></B></FONT></B>  <B><FONT COLOR="#A020F0">(value)</FONT></B>
  <B><FONT COLOR="#A020F0">local</FONT></B> first <B><FONT COLOR="#5F9EA0">=</FONT></B> self.first <B><FONT COLOR="#5F9EA0">-</FONT></B> 1
  self.first <B><FONT COLOR="#5F9EA0">=</FONT></B> first
  self[first] <B><FONT COLOR="#5F9EA0">=</FONT></B> value
<B><FONT COLOR="#A020F0">end</FONT></B>

<B><FONT COLOR="#A020F0">function </FONT></B><B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">List:pushright</FONT></I></B></FONT></B>  <B><FONT COLOR="#A020F0">(value)</FONT></B>
  <B><FONT COLOR="#A020F0">local</FONT></B> last <B><FONT COLOR="#5F9EA0">=</FONT></B> self.last <B><FONT COLOR="#5F9EA0">+</FONT></B> 1
  self.last <B><FONT COLOR="#5F9EA0">=</FONT></B> last
  self[last] <B><FONT COLOR="#5F9EA0">=</FONT></B> value
<B><FONT COLOR="#A020F0">end</FONT></B>

<B><FONT COLOR="#A020F0">function </FONT></B><B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">List:popleft</FONT></I></B></FONT></B>  <B><FONT COLOR="#A020F0">()</FONT></B>
  <B><FONT COLOR="#A020F0">local</FONT></B> first <B><FONT COLOR="#5F9EA0">=</FONT></B> self.first
  <B><FONT COLOR="#A020F0">if</FONT></B> first <B><FONT COLOR="#5F9EA0">&gt;</FONT></B> self.last <B><FONT COLOR="#A020F0">then</FONT></B> error<B><FONT COLOR="#BC8F8F">&quot;list is empty&quot;</FONT></B> <B><FONT COLOR="#A020F0">end</FONT></B>
  <B><FONT COLOR="#A020F0">local</FONT></B> value <B><FONT COLOR="#5F9EA0">=</FONT></B> self[first]
  self[first] <B><FONT COLOR="#5F9EA0">=</FONT></B> <B><FONT COLOR="#A020F0">nil</FONT></B>  <I><FONT COLOR="#B22222">-- to allow collection
</FONT></I>  self.first <B><FONT COLOR="#5F9EA0">=</FONT></B> first<B><FONT COLOR="#5F9EA0">+</FONT></B>1
  <B><FONT COLOR="#A020F0">return</FONT></B> value
<B><FONT COLOR="#A020F0">end</FONT></B>

<B><FONT COLOR="#A020F0">function </FONT></B><B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">List:popright</FONT></I></B></FONT></B>  <B><FONT COLOR="#A020F0">()</FONT></B>
  <B><FONT COLOR="#A020F0">local</FONT></B> last <B><FONT COLOR="#5F9EA0">=</FONT></B> self.last
  <B><FONT COLOR="#A020F0">if</FONT></B> self.first <B><FONT COLOR="#5F9EA0">&gt;</FONT></B> last <B><FONT COLOR="#A020F0">then</FONT></B> error<B><FONT COLOR="#BC8F8F">&quot;list is empty&quot;</FONT></B> <B><FONT COLOR="#A020F0">end</FONT></B>
  <B><FONT COLOR="#A020F0">local</FONT></B> value <B><FONT COLOR="#5F9EA0">=</FONT></B> self[last]
  self[last] <B><FONT COLOR="#5F9EA0">=</FONT></B> <B><FONT COLOR="#A020F0">nil</FONT></B>  <I><FONT COLOR="#B22222">-- to allow collection
</FONT></I>  self.last <B><FONT COLOR="#5F9EA0">=</FONT></B> last<B><FONT COLOR="#5F9EA0">-</FONT></B>1
  <B><FONT COLOR="#A020F0">return</FONT></B> value
<B><FONT COLOR="#A020F0">end</FONT></B>

<B><FONT COLOR="#A020F0">function </FONT></B><B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">List:reverse</FONT></I></B></FONT></B>  <B><FONT COLOR="#A020F0">()</FONT></B>
  <B><FONT COLOR="#A020F0">local</FONT></B> i, j <B><FONT COLOR="#5F9EA0">=</FONT></B> self.first, self.last
  <B><FONT COLOR="#A020F0">while</FONT></B> i<B><FONT COLOR="#5F9EA0">&lt;</FONT></B>j <B><FONT COLOR="#A020F0">do</FONT></B>
    self[i], self[j] <B><FONT COLOR="#5F9EA0">=</FONT></B> self[j], self[i]
    i <B><FONT COLOR="#5F9EA0">=</FONT></B> i<B><FONT COLOR="#5F9EA0">+</FONT></B>1
    j <B><FONT COLOR="#5F9EA0">=</FONT></B> j<B><FONT COLOR="#5F9EA0">-</FONT></B>1
  <B><FONT COLOR="#A020F0">end</FONT></B>
<B><FONT COLOR="#A020F0">end</FONT></B>

<B><FONT COLOR="#A020F0">function </FONT></B><B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">List:equal</FONT></I></B></FONT></B>  <B><FONT COLOR="#A020F0">(otherlist)</FONT></B>
<B><FONT COLOR="#5F9EA0">  if self:l</FONT></B>ength() <B><FONT COLOR="#5F9EA0">~=</FONT></B><B><FONT COLOR="#5F9EA0"> otherlist:l</FONT></B>ength() <B><FONT COLOR="#A020F0">then</FONT></B> <B><FONT COLOR="#A020F0">return</FONT></B> <B><FONT COLOR="#A020F0">nil</FONT></B> <B><FONT COLOR="#A020F0">end</FONT></B>
  <B><FONT COLOR="#A020F0">local</FONT></B> diff <B><FONT COLOR="#5F9EA0">=</FONT></B> otherlist.first <B><FONT COLOR="#5F9EA0">-</FONT></B> self.first
  <B><FONT COLOR="#A020F0">for</FONT></B> i1<B><FONT COLOR="#5F9EA0">=</FONT></B>self.first,self.last <B><FONT COLOR="#A020F0">do</FONT></B>
    <B><FONT COLOR="#A020F0">if</FONT></B> self[i1] <B><FONT COLOR="#5F9EA0">~=</FONT></B> otherlist[i1<B><FONT COLOR="#5F9EA0">+</FONT></B>diff] <B><FONT COLOR="#A020F0">then</FONT></B> <B><FONT COLOR="#A020F0">return</FONT></B> <B><FONT COLOR="#A020F0">nil</FONT></B> <B><FONT COLOR="#A020F0">end</FONT></B>
  <B><FONT COLOR="#A020F0">end</FONT></B>
  <B><FONT COLOR="#A020F0">return</FONT></B> 1
<B><FONT COLOR="#A020F0">end</FONT></B>

<I><FONT COLOR="#B22222">-----------------------------------------------------------
</FONT></I><I><FONT COLOR="#B22222">-----------------------------------------------------------
</FONT></I>
<I><FONT COLOR="#B22222">-- Some tests
</FONT></I>
<B><FONT COLOR="#A020F0">function </FONT></B><B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">test</FONT></I></B></FONT></B>  <B><FONT COLOR="#A020F0">()</FONT></B>
  <B><FONT COLOR="#A020F0">local</FONT></B> SIZE <B><FONT COLOR="#5F9EA0">=</FONT></B> 10000
  <I><FONT COLOR="#B22222">-- create a list with elements 1..SIZE
</FONT></I>  <B><FONT COLOR="#A020F0">local</FONT></B> l1 <B><FONT COLOR="#5F9EA0">=</FONT></B><B><FONT COLOR="#5F9EA0"> List:n</FONT></B>ew()
  <B><FONT COLOR="#A020F0">for</FONT></B> i<B><FONT COLOR="#5F9EA0">=</FONT></B>1,SIZE <B><FONT COLOR="#A020F0">do</FONT></B>
<B><FONT COLOR="#5F9EA0">    l1:p</FONT></B>ushright(i)
  <B><FONT COLOR="#A020F0">end</FONT></B>
  <I><FONT COLOR="#B22222">-- creates a copy of l1
</FONT></I>  <B><FONT COLOR="#A020F0">local</FONT></B> l2 <B><FONT COLOR="#5F9EA0">=</FONT></B><B><FONT COLOR="#5F9EA0"> l1:n</FONT></B>ew()
  <I><FONT COLOR="#B22222">-- remove each individual item from left side of l2 and
</FONT></I>  <I><FONT COLOR="#B22222">-- append to right side of l3 (preserving order)
</FONT></I>  <B><FONT COLOR="#A020F0">local</FONT></B> l3 <B><FONT COLOR="#5F9EA0">=</FONT></B><B><FONT COLOR="#5F9EA0"> List:n</FONT></B>ew()
<B><FONT COLOR="#5F9EA0">  while l2:l</FONT></B>ength() <B><FONT COLOR="#5F9EA0">&gt;</FONT></B> 0 <B><FONT COLOR="#A020F0">do</FONT></B>
<B><FONT COLOR="#5F9EA0">    l3:p</FONT></B>ushright(<B><FONT COLOR="#5F9EA0">l2:p</FONT></B>opleft())  
  <B><FONT COLOR="#A020F0">end</FONT></B>
  <I><FONT COLOR="#B22222">-- remove each individual item from right side of l3 and
</FONT></I>  <I><FONT COLOR="#B22222">-- append to right side of l2 (reversing list)
</FONT></I><B><FONT COLOR="#5F9EA0">  while l3:l</FONT></B>ength() <B><FONT COLOR="#5F9EA0">&gt;</FONT></B> 0 <B><FONT COLOR="#A020F0">do</FONT></B>
<B><FONT COLOR="#5F9EA0">    l2:p</FONT></B>ushright(<B><FONT COLOR="#5F9EA0">l3:p</FONT></B>opright())
  <B><FONT COLOR="#A020F0">end</FONT></B>
  <I><FONT COLOR="#B22222">-- reverse l1 in place
</FONT></I><B><FONT COLOR="#5F9EA0">  l1:r</FONT></B>everse()
  <I><FONT COLOR="#B22222">-- compare Li1 and Li2 for equality
</FONT></I>  <I><FONT COLOR="#B22222">-- and return length of the list
</FONT></I><B><FONT COLOR="#5F9EA0">  if not l1:e</FONT></B>qual(l2) <B><FONT COLOR="#A020F0">then</FONT></B> <B><FONT COLOR="#A020F0">return</FONT></B> <B><FONT COLOR="#A020F0">nil</FONT></B>
<B><FONT COLOR="#5F9EA0">  else return l1:l</FONT></B>ength()
  <B><FONT COLOR="#A020F0">end</FONT></B>
<B><FONT COLOR="#A020F0">end</FONT></B>

N <B><FONT COLOR="#5F9EA0">=</FONT></B> <B><FONT COLOR="#228B22">tonumber</FONT></B>((arg <B><FONT COLOR="#A020F0">and</FONT></B> arg[1])) <B><FONT COLOR="#A020F0">or</FONT></B> 1
<B><FONT COLOR="#A020F0">for</FONT></B> i<B><FONT COLOR="#5F9EA0">=</FONT></B>1, N <B><FONT COLOR="#A020F0">do</FONT></B>
  result <B><FONT COLOR="#5F9EA0">=</FONT></B> test()
<B><FONT COLOR="#A020F0">end</FONT></B>
<B><FONT COLOR="#228B22">print</FONT></B>(result)</pre></td></tr></table>
