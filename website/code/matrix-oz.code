<table width="100%" border="0" cellpadding="5" cellspacing="0"><tr><td bgcolor="#FFFFFF"><pre>
<I><FONT COLOR="#B22222">%%% $Id: matrix-oz.code,v 1.2 2004-11-08 08:15:17 bfulgham Exp $
</FONT></I><I><FONT COLOR="#B22222">%%% http://dada.perl.it/shootout/
</FONT></I><I><FONT COLOR="#B22222">%%% 
</FONT></I><I><FONT COLOR="#B22222">%%% contributed by Isaac Gouy
</FONT></I>
<I><FONT COLOR="#B22222">%%  Usage: start from command line with
</FONT></I><I><FONT COLOR="#B22222">%%     ozc -x matrix.oz -o matrix.oz.exe
</FONT></I><I><FONT COLOR="#B22222">%%     matrix.oz.exe 300
</FONT></I>
<B><FONT COLOR="#228B22">functor</FONT></B>
<B><FONT COLOR="#5F9EA0">import</FONT></B> System Application

<B><FONT COLOR="#A020F0">define</FONT></B>

   <B><FONT COLOR="#A020F0">proc</FONT></B> {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">MakeMatrix</FONT></I></B></FONT></B> Rows Cols M}
      <B><FONT COLOR="#5F9EA0">local</FONT></B> Count <B><FONT COLOR="#A020F0">in</FONT></B>
     {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">NewArray</FONT></I></B></FONT></B> 0 Rows-1 0 M}
     Count <B><FONT COLOR="#5F9EA0">=</FONT></B>{<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">NewCell</FONT></I></B></FONT></B> 0}
     <B><FONT COLOR="#A020F0">for</FONT></B> I <B><FONT COLOR="#A020F0">in</FONT></B> 0<B><FONT COLOR="#5F9EA0">..</FONT></B>Rows-1 <B><FONT COLOR="#A020F0">do</FONT></B>
        <B><FONT COLOR="#5F9EA0">local</FONT></B> R <B><FONT COLOR="#A020F0">in</FONT></B>
           {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">NewArray</FONT></I></B></FONT></B> 0 Cols-1 0 R}
           {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Put</FONT></I></B></FONT></B> M I R}
           <B><FONT COLOR="#A020F0">for</FONT></B> J <B><FONT COLOR="#A020F0">in</FONT></B> 0<B><FONT COLOR="#5F9EA0">..</FONT></B>Cols-1 <B><FONT COLOR="#A020F0">do</FONT></B>
          {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Assign</FONT></I></B></FONT></B> Count {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Access</FONT></I></B></FONT></B> Count}+1}
          {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Put</FONT></I></B></FONT></B> R J {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Access</FONT></I></B></FONT></B> Count}}
           <B><FONT COLOR="#A020F0">end</FONT></B>
        <B><FONT COLOR="#A020F0">end</FONT></B>
     <B><FONT COLOR="#A020F0">end</FONT></B>
      <B><FONT COLOR="#A020F0">end</FONT></B>
   <B><FONT COLOR="#A020F0">end</FONT></B>


   <B><FONT COLOR="#A020F0">proc</FONT></B> {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">MMult</FONT></I></B></FONT></B> M1 M2 MM}
      <B><FONT COLOR="#5F9EA0">local</FONT></B> S1 N1 Prod S2 N2 <B><FONT COLOR="#A020F0">in</FONT></B>
     S1 <B><FONT COLOR="#5F9EA0">=</FONT></B> {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Array</FONT></I></B></FONT></B>.low M1}
     N1 <B><FONT COLOR="#5F9EA0">=</FONT></B> {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Array</FONT></I></B></FONT></B>.high M1}
     S2 <B><FONT COLOR="#5F9EA0">=</FONT></B> {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Array</FONT></I></B></FONT></B>.low {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Get</FONT></I></B></FONT></B> M1 S1}}
     N2 <B><FONT COLOR="#5F9EA0">=</FONT></B> {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Array</FONT></I></B></FONT></B>.high {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Get</FONT></I></B></FONT></B> M1 S1}}
     Prod <B><FONT COLOR="#5F9EA0">=</FONT></B> {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">NewCell</FONT></I></B></FONT></B> 0}
     {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">NewArray</FONT></I></B></FONT></B> S1 N1 0 MM}
     <B><FONT COLOR="#A020F0">for</FONT></B> I <B><FONT COLOR="#A020F0">in</FONT></B> S1<B><FONT COLOR="#5F9EA0">..</FONT></B>N1 <B><FONT COLOR="#A020F0">do</FONT></B>
        <B><FONT COLOR="#5F9EA0">local</FONT></B> R <B><FONT COLOR="#A020F0">in</FONT></B>
           {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">NewArray</FONT></I></B></FONT></B> S1 N1 0 R}
           {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Put</FONT></I></B></FONT></B> MM I R}
           <B><FONT COLOR="#A020F0">for</FONT></B> J <B><FONT COLOR="#A020F0">in</FONT></B> S1<B><FONT COLOR="#5F9EA0">..</FONT></B>N1 <B><FONT COLOR="#A020F0">do</FONT></B>
          {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Assign</FONT></I></B></FONT></B> Prod 0}
          <B><FONT COLOR="#A020F0">for</FONT></B> K <B><FONT COLOR="#A020F0">in</FONT></B> S2<B><FONT COLOR="#5F9EA0">..</FONT></B>N2 <B><FONT COLOR="#A020F0">do</FONT></B>
             {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Assign</FONT></I></B></FONT></B> Prod {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Get</FONT></I></B></FONT></B> {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Get</FONT></I></B></FONT></B> M1 I} K}*
              {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Get</FONT></I></B></FONT></B> {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Get</FONT></I></B></FONT></B> M2 K} J}+{<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Access</FONT></I></B></FONT></B> Prod}}
          <B><FONT COLOR="#A020F0">end</FONT></B>
          {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Put</FONT></I></B></FONT></B> R J {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Access</FONT></I></B></FONT></B> Prod}}
           <B><FONT COLOR="#A020F0">end</FONT></B>
        <B><FONT COLOR="#A020F0">end</FONT></B>
     <B><FONT COLOR="#A020F0">end</FONT></B>
      <B><FONT COLOR="#A020F0">end</FONT></B>
   <B><FONT COLOR="#A020F0">end</FONT></B>

   <B><FONT COLOR="#A020F0">proc</FONT></B> {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">RepeatMMult</FONT></I></B></FONT></B> N M1 M2 MM}
      <B><FONT COLOR="#5F9EA0">local</FONT></B> T <B><FONT COLOR="#A020F0">in</FONT></B>
     <B><FONT COLOR="#A020F0">if</FONT></B> N &gt; 1 <B><FONT COLOR="#A020F0">then</FONT></B>
        {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">MMult</FONT></I></B></FONT></B> M1 M2 T}
        {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">RepeatMMult</FONT></I></B></FONT></B> N-1 M1 M2 MM}
     <B><FONT COLOR="#A020F0">else</FONT></B> {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">MMult</FONT></I></B></FONT></B> M1 M2 T} MM <B><FONT COLOR="#5F9EA0">=</FONT></B> T <B><FONT COLOR="#A020F0">end</FONT></B>
      <B><FONT COLOR="#A020F0">end</FONT></B>
   <B><FONT COLOR="#A020F0">end</FONT></B>
   
<B><FONT COLOR="#A020F0">in</FONT></B> 
   <B><FONT COLOR="#5F9EA0">local</FONT></B> Args Repeat N M1 M2 MM <B><FONT COLOR="#A020F0">in</FONT></B>
      [Args] <B><FONT COLOR="#5F9EA0">=</FONT></B> {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Application</FONT></I></B></FONT></B>.getArgs plain}
      Repeat <B><FONT COLOR="#5F9EA0">=</FONT></B> {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">String</FONT></I></B></FONT></B>.toInt Args}
      N <B><FONT COLOR="#5F9EA0">=</FONT></B> 30
      {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">MakeMatrix</FONT></I></B></FONT></B> N N M1}
      {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">MakeMatrix</FONT></I></B></FONT></B> N N M2}
      {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">RepeatMMult</FONT></I></B></FONT></B> Repeat M1 M2 MM}
      
      {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">System</FONT></I></B></FONT></B>.printInfo {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Get</FONT></I></B></FONT></B> {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Get</FONT></I></B></FONT></B> MM 0} 0}}{<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">System</FONT></I></B></FONT></B>.printInfo <B><FONT COLOR="#BC8F8F">' '</FONT></B>}
      {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">System</FONT></I></B></FONT></B>.printInfo {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Get</FONT></I></B></FONT></B> {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Get</FONT></I></B></FONT></B> MM 2} 3}}{<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">System</FONT></I></B></FONT></B>.printInfo <B><FONT COLOR="#BC8F8F">' '</FONT></B>} <I><FONT COLOR="#B22222">% get col 3 out of row 2
</FONT></I>      {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">System</FONT></I></B></FONT></B>.printInfo {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Get</FONT></I></B></FONT></B> {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Get</FONT></I></B></FONT></B> MM 3} 2}}{<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">System</FONT></I></B></FONT></B>.printInfo <B><FONT COLOR="#BC8F8F">' '</FONT></B>} <I><FONT COLOR="#B22222">% get col 2 out of row 3
</FONT></I>      {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">System</FONT></I></B></FONT></B>.showInfo {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Get</FONT></I></B></FONT></B> {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Get</FONT></I></B></FONT></B> MM 4} 4} }     
   <B><FONT COLOR="#A020F0">end</FONT></B>
   {<B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Application</FONT></I></B></FONT></B>.exit 0}
<B><FONT COLOR="#A020F0">end</FONT></B></pre></td></tr></table>
