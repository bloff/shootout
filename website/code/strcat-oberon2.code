<table width="100%" border="0" cellpadding="5" cellspacing="0"><tr><td bgcolor="#FFFFFF"><pre>
<I><FONT COLOR="#B22222">(* The Great Computer Language Shootout
   http://shootout.alioth.debian.org

   contributed by Isaac Gouy (Oberon-2 novice)

   Do the same low-level stuff as the C implementations.
*)</FONT></I>

<B><FONT COLOR="#228B22">MODULE</FONT></B> Strcat;
<B><FONT COLOR="#5F9EA0">IMPORT</FONT></B> LangShootout, SYSTEM, Out, Strings;

<B><FONT COLOR="#A020F0">TYPE</FONT></B>
   CharArray <B><FONT COLOR="#5F9EA0">=</FONT></B> <B><FONT COLOR="#228B22">ARRAY</FONT></B> 8 <B><FONT COLOR="#A020F0">OF</FONT></B> <B><FONT COLOR="#228B22">CHAR</FONT></B>;   
   String <B><FONT COLOR="#5F9EA0">=</FONT></B> <B><FONT COLOR="#228B22">POINTER</FONT></B> <B><FONT COLOR="#A020F0">TO</FONT></B> CharArray;

<B><FONT COLOR="#A020F0">VAR</FONT></B>
   buffer, tmp: <B><FONT COLOR="#228B22">POINTER</FONT></B> <B><FONT COLOR="#A020F0">TO</FONT></B> <B><FONT COLOR="#228B22">ARRAY</FONT></B> <B><FONT COLOR="#A020F0">OF</FONT></B> <B><FONT COLOR="#228B22">CHAR</FONT></B>; 
   bufferEnd: String;
   stuff: CharArray;
   n, stufflen, start, end, buflen, newbuflen: <B><FONT COLOR="#228B22">LONGINT</FONT></B>;


<I><FONT COLOR="#B22222">(* Strings.Length only returns INTEGER, we need LONGINT *)</FONT></I>
<B><FONT COLOR="#A020F0">PROCEDURE </FONT></B><B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Length</FONT></I></B></FONT></B>(<B><FONT COLOR="#A020F0">VAR</FONT></B> a: <B><FONT COLOR="#228B22">ARRAY</FONT></B> <B><FONT COLOR="#A020F0">OF</FONT></B> <B><FONT COLOR="#228B22">CHAR</FONT></B>): <B><FONT COLOR="#228B22">LONGINT</FONT></B>;
<B><FONT COLOR="#A020F0">VAR</FONT></B> i: <B><FONT COLOR="#228B22">LONGINT</FONT></B>;
<B><FONT COLOR="#A020F0">BEGIN</FONT></B>
   i <B><FONT COLOR="#5F9EA0">:=</FONT></B> 0;
   <B><FONT COLOR="#A020F0">WHILE</FONT></B> (i &lt; <B><FONT COLOR="#A020F0">LEN</FONT></B>(a)) &amp; (a[i] <B><FONT COLOR="#5F9EA0">#</FONT></B> 0X) <B><FONT COLOR="#A020F0">DO</FONT></B> <B><FONT COLOR="#A020F0">INC</FONT></B>(i); <B><FONT COLOR="#A020F0">END</FONT></B>; 
   <B><FONT COLOR="#A020F0">RETURN</FONT></B> i;   
<B><FONT COLOR="#A020F0">END </FONT></B><B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Length</FONT></I></B></FONT></B>; 


<B><FONT COLOR="#A020F0">BEGIN</FONT></B>
   n <B><FONT COLOR="#5F9EA0">:=</FONT></B> LangShootout.Argi();
   stuff <B><FONT COLOR="#5F9EA0">:=</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;hello&quot;</FONT></B>; stuff[5] <B><FONT COLOR="#5F9EA0">:=</FONT></B> 0AX; stuff[6] <B><FONT COLOR="#5F9EA0">:=</FONT></B> 0X;
   stufflen <B><FONT COLOR="#5F9EA0">:=</FONT></B> Length(stuff);   
   
   buflen <B><FONT COLOR="#5F9EA0">:=</FONT></B> 32; <B><FONT COLOR="#A020F0">NEW</FONT></B>(buffer, buflen); buffer[0] <B><FONT COLOR="#5F9EA0">:=</FONT></B> 0X;
   start <B><FONT COLOR="#5F9EA0">:=</FONT></B> SYSTEM.ADR(buffer[0]);
   end <B><FONT COLOR="#5F9EA0">:=</FONT></B> start;
   <B><FONT COLOR="#A020F0">WHILE</FONT></B> n <B><FONT COLOR="#5F9EA0">&gt;</FONT></B> 0 <B><FONT COLOR="#A020F0">DO</FONT></B> 
      <B><FONT COLOR="#A020F0">IF</FONT></B> (start <B><FONT COLOR="#5F9EA0">+</FONT></B> buflen) <B><FONT COLOR="#5F9EA0">-</FONT></B> end &lt; stufflen <B><FONT COLOR="#5F9EA0">+</FONT></B> 1 <B><FONT COLOR="#A020F0">THEN</FONT></B>
         newbuflen <B><FONT COLOR="#5F9EA0">:=</FONT></B> <B><FONT COLOR="#A020F0">ASH</FONT></B>(buflen,1);
         <B><FONT COLOR="#A020F0">NEW</FONT></B>(tmp, newbuflen);
         COPY(buffer<B><FONT COLOR="#5F9EA0">^</FONT></B>, tmp<B><FONT COLOR="#5F9EA0">^</FONT></B>);
         buffer <B><FONT COLOR="#5F9EA0">:=</FONT></B> tmp; tmp <B><FONT COLOR="#5F9EA0">:=</FONT></B> <B><FONT COLOR="#228B22">NIL</FONT></B>;
         <B><FONT COLOR="#A020F0">DEC</FONT></B>(end, start);
         start <B><FONT COLOR="#5F9EA0">:=</FONT></B> SYSTEM.ADR(buffer[0]);
         <B><FONT COLOR="#A020F0">INC</FONT></B>(end, start);
         buflen <B><FONT COLOR="#5F9EA0">:=</FONT></B> newbuflen;
      <B><FONT COLOR="#A020F0">END</FONT></B>;   
         <I><FONT COLOR="#B22222">(* much faster to strcat to strend than to strbuf! *)</FONT></I>
      bufferEnd <B><FONT COLOR="#5F9EA0">:=</FONT></B> SYSTEM.VAL(String, end);        
      Strings.Append(stuff, bufferEnd<B><FONT COLOR="#5F9EA0">^</FONT></B>);      
      <B><FONT COLOR="#A020F0">INC</FONT></B>(end, stufflen);

      <B><FONT COLOR="#A020F0">DEC</FONT></B>(n);
   <B><FONT COLOR="#A020F0">END</FONT></B>;   
        
   Out.Int( Length(buffer<B><FONT COLOR="#5F9EA0">^</FONT></B>), 0); Out.Ln; 
<B><FONT COLOR="#A020F0">END </FONT></B><B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">Strcat</FONT></I></B></FONT></B>.</pre></td></tr></table>
