<table width="100%" border="0" cellpadding="5" cellspacing="0"><tr><td bgcolor="#FFFFFF"><pre>
<I><FONT COLOR="#B22222">-- $Id: prodcons-ghc.code,v 1.1 2004-11-02 08:52:39 bfulgham Exp $
</FONT></I><I><FONT COLOR="#B22222">-- http://shootout.alioth.debian.org/
</FONT></I><I><FONT COLOR="#B22222">-- by JP Bernardy, optimized by Einar Karttunen
</FONT></I>
<B><FONT COLOR="#A020F0">import</FONT></B> Control.Concurrent
<B><FONT COLOR="#A020F0">import</FONT></B> System

producer n m mv | n == m = return m
		| True   = putMVar mv n &gt;&gt; producer (n+1) m mv

consumer 0 m mv = return m
consumer n m mv = takeMVar mv &gt;&gt; consumer (n-1) m mv

main = do [a] &lt;- getArgs
          <B><FONT COLOR="#A020F0">let</FONT></B> n = read a <B><FONT COLOR="#228B22">:: Int
</FONT></B>          mvar &lt;- newEmptyMVar 
	  ret  &lt;- newEmptyMVar
          forkIO (producer 0 n mvar &gt;&gt;= putMVar ret)
	  m &lt;- consumer n n mvar 
	  r &lt;- takeMVar ret
	  putStrLn (show r ++ <B><FONT COLOR="#BC8F8F">&quot; &quot;</FONT></B> ++ show m)</pre></td></tr></table>
