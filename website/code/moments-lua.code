<table width="100%" border="0" cellpadding="5" cellspacing="0"><tr><td bgcolor="#FFFFFF"><pre>
<I><FONT COLOR="#B22222">-- $Id: moments-lua.code,v 1.2 2004-11-08 08:15:17 bfulgham Exp $
</FONT></I><I><FONT COLOR="#B22222">-- http://www.bagley.org/~doug/shootout/
</FONT></I><I><FONT COLOR="#B22222">-- implemented by: Roberto Ierusalimschy
</FONT></I>
<B><FONT COLOR="#A020F0">local</FONT></B> nums <B><FONT COLOR="#5F9EA0">=</FONT></B> {}
<B><FONT COLOR="#A020F0">local</FONT></B> n <B><FONT COLOR="#5F9EA0">=</FONT></B> 0
<B><FONT COLOR="#A020F0">local</FONT></B> sum <B><FONT COLOR="#5F9EA0">=</FONT></B> 0
<B><FONT COLOR="#A020F0">while</FONT></B> 1 <B><FONT COLOR="#A020F0">do</FONT></B>
  <B><FONT COLOR="#A020F0">local</FONT></B> line <B><FONT COLOR="#5F9EA0">=</FONT></B> io.read()
  <B><FONT COLOR="#A020F0">if</FONT></B> line <B><FONT COLOR="#5F9EA0">==</FONT></B> <B><FONT COLOR="#A020F0">nil</FONT></B> <B><FONT COLOR="#A020F0">then</FONT></B> <B><FONT COLOR="#A020F0">break</FONT></B> <B><FONT COLOR="#A020F0">end</FONT></B>
  line <B><FONT COLOR="#5F9EA0">=</FONT></B> line<B><FONT COLOR="#5F9EA0">+</FONT></B>0        <I><FONT COLOR="#B22222">-- convert line to number
</FONT></I>  sum <B><FONT COLOR="#5F9EA0">=</FONT></B> sum <B><FONT COLOR="#5F9EA0">+</FONT></B> line
  n <B><FONT COLOR="#5F9EA0">=</FONT></B> n <B><FONT COLOR="#5F9EA0">+</FONT></B> 1
  nums[n] <B><FONT COLOR="#5F9EA0">=</FONT></B> line
<B><FONT COLOR="#A020F0">end</FONT></B>

<B><FONT COLOR="#A020F0">local</FONT></B> mean <B><FONT COLOR="#5F9EA0">=</FONT></B> sum/n

<B><FONT COLOR="#A020F0">local</FONT></B> average_deviation, variance, skew, kurtosis <B><FONT COLOR="#5F9EA0">=</FONT></B> 0, 0, 0, 0

<B><FONT COLOR="#A020F0">for</FONT></B> i <B><FONT COLOR="#5F9EA0">=</FONT></B> 1, n <B><FONT COLOR="#A020F0">do</FONT></B>
  <B><FONT COLOR="#A020F0">local</FONT></B> deviation <B><FONT COLOR="#5F9EA0">=</FONT></B> nums[i] <B><FONT COLOR="#5F9EA0">-</FONT></B> mean
  average_deviation <B><FONT COLOR="#5F9EA0">=</FONT></B> average_deviation <B><FONT COLOR="#5F9EA0">+</FONT></B> math.abs(deviation)
  variance <B><FONT COLOR="#5F9EA0">=</FONT></B> variance <B><FONT COLOR="#5F9EA0">+</FONT></B> deviation^2
  skew <B><FONT COLOR="#5F9EA0">=</FONT></B> skew <B><FONT COLOR="#5F9EA0">+</FONT></B> deviation^3
  kurtosis <B><FONT COLOR="#5F9EA0">=</FONT></B> kurtosis <B><FONT COLOR="#5F9EA0">+</FONT></B> deviation^4
<B><FONT COLOR="#A020F0">end</FONT></B>

average_deviation <B><FONT COLOR="#5F9EA0">=</FONT></B> average_deviation/n
variance <B><FONT COLOR="#5F9EA0">=</FONT></B> variance/(n<B><FONT COLOR="#5F9EA0">-</FONT></B>1)
<B><FONT COLOR="#A020F0">local</FONT></B> standard_deviation <B><FONT COLOR="#5F9EA0">=</FONT></B> math.sqrt(variance)
<B><FONT COLOR="#A020F0">if</FONT></B> variance <B><FONT COLOR="#5F9EA0">~=</FONT></B> 0 <B><FONT COLOR="#A020F0">then</FONT></B>
  skew <B><FONT COLOR="#5F9EA0">=</FONT></B> skew / (n <B><FONT COLOR="#5F9EA0">*</FONT></B> variance <B><FONT COLOR="#5F9EA0">*</FONT></B> standard_deviation)
  kurtosis <B><FONT COLOR="#5F9EA0">=</FONT></B> kurtosis/(n <B><FONT COLOR="#5F9EA0">*</FONT></B> variance <B><FONT COLOR="#5F9EA0">*</FONT></B> variance) <B><FONT COLOR="#5F9EA0">-</FONT></B> 3.0
<B><FONT COLOR="#A020F0">end</FONT></B>

table.sort(nums)
<B><FONT COLOR="#A020F0">local</FONT></B> mid <B><FONT COLOR="#5F9EA0">=</FONT></B> math.floor(n/2)
<B><FONT COLOR="#A020F0">local</FONT></B> median
<B><FONT COLOR="#A020F0">if</FONT></B> math.mod(n,2) <B><FONT COLOR="#5F9EA0">==</FONT></B> 1 <B><FONT COLOR="#A020F0">then</FONT></B>
  median <B><FONT COLOR="#5F9EA0">=</FONT></B> nums[mid<B><FONT COLOR="#5F9EA0">+</FONT></B>1]
<B><FONT COLOR="#A020F0">else</FONT></B>
  median <B><FONT COLOR="#5F9EA0">=</FONT></B> (nums[mid] <B><FONT COLOR="#5F9EA0">+</FONT></B> nums[mid<B><FONT COLOR="#5F9EA0">+</FONT></B>1])/2
<B><FONT COLOR="#A020F0">end</FONT></B>

io.write(string.format(<B><FONT COLOR="#BC8F8F">&quot;n:                  %d\n&quot;</FONT></B>, n))
io.write(string.format(<B><FONT COLOR="#BC8F8F">&quot;median:             %f\n&quot;</FONT></B>, median))
io.write(string.format(<B><FONT COLOR="#BC8F8F">&quot;mean:               %f\n&quot;</FONT></B>, mean))
io.write(string.format(<B><FONT COLOR="#BC8F8F">&quot;average_deviation:  %f\n&quot;</FONT></B>, average_deviation))
io.write(string.format(<B><FONT COLOR="#BC8F8F">&quot;standard_deviation: %f\n&quot;</FONT></B>, standard_deviation))
io.write(string.format(<B><FONT COLOR="#BC8F8F">&quot;variance:           %f\n&quot;</FONT></B>, variance))
io.write(string.format(<B><FONT COLOR="#BC8F8F">&quot;skew:               %f\n&quot;</FONT></B>, skew))
io.write(string.format(<B><FONT COLOR="#BC8F8F">&quot;kurtosis:           %f\n&quot;</FONT></B>, kurtosis))</pre></td></tr></table>
