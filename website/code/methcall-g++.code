<table width="100%" border="0" cellpadding="5" cellspacing="0"><tr><td bgcolor="#FFFFFF"><pre>
<I><FONT COLOR="#B22222">// -*- mode: c++ -*-
</FONT></I><I><FONT COLOR="#B22222">// $Id: methcall-g++.code,v 1.1 2004-11-02 08:52:36 bfulgham Exp $
</FONT></I><I><FONT COLOR="#B22222">// http://www.bagley.org/~doug/shootout/
</FONT></I>
<I><FONT COLOR="#B22222">// with some help from Bill Lear
</FONT></I>
#<B><FONT COLOR="#5F9EA0">include</FONT></B> <B><FONT COLOR="#BC8F8F">&lt;stdlib.h&gt;</FONT></B>
#<B><FONT COLOR="#5F9EA0">include</FONT></B> <B><FONT COLOR="#BC8F8F">&lt;iostream&gt;</FONT></B>

using namespace std;

<B><FONT COLOR="#228B22">class</FONT></B> Toggle {
<B><FONT COLOR="#228B22">public</FONT></B>:
    Toggle(<B><FONT COLOR="#228B22">bool</FONT></B> start_state) : state(start_state) { }
    <B><FONT COLOR="#228B22">virtual</FONT></B> ~Toggle() {  }
    <B><FONT COLOR="#228B22">bool</FONT></B> value() {
	<B><FONT COLOR="#A020F0">return</FONT></B>(state);
    }
    <B><FONT COLOR="#228B22">virtual</FONT></B> Toggle&amp; activate() {
	state = !state;
	<B><FONT COLOR="#A020F0">return</FONT></B>(*<B><FONT COLOR="#A020F0">this</FONT></B>);
    }
    <B><FONT COLOR="#228B22">bool</FONT></B> state;
};

<B><FONT COLOR="#228B22">class</FONT></B> NthToggle : <B><FONT COLOR="#228B22">public</FONT></B> Toggle {
<B><FONT COLOR="#228B22">public</FONT></B>:
    NthToggle(<B><FONT COLOR="#228B22">bool</FONT></B> start_state, <B><FONT COLOR="#228B22">int</FONT></B> max_counter) :
	Toggle(start_state), count_max(max_counter), counter(0) {
    }
    Toggle&amp; activate() {
	<B><FONT COLOR="#A020F0">if</FONT></B> (++<B><FONT COLOR="#A020F0">this</FONT></B>-&gt;counter &gt;= <B><FONT COLOR="#A020F0">this</FONT></B>-&gt;count_max) {
	    state = !state;
	    counter = 0;
	}
	<B><FONT COLOR="#A020F0">return</FONT></B>(*<B><FONT COLOR="#A020F0">this</FONT></B>);
    }
<B><FONT COLOR="#228B22">private</FONT></B>:
    <B><FONT COLOR="#228B22">int</FONT></B> count_max;
    <B><FONT COLOR="#228B22">int</FONT></B> counter;
};


<B><FONT COLOR="#228B22">int</FONT></B>
<B><FONT COLOR="#0000FF">main</FONT></B>(<B><FONT COLOR="#228B22">int</FONT></B> argc, <B><FONT COLOR="#228B22">char</FONT></B> *argv[]) {
    <B><FONT COLOR="#228B22">int</FONT></B> n = ((argc == 2) ? atoi(argv[1]) : 1);

    <B><FONT COLOR="#228B22">bool</FONT></B> val = true;
    Toggle *toggle = <B><FONT COLOR="#A020F0">new</FONT></B> Toggle(val);
    <B><FONT COLOR="#A020F0">for</FONT></B> (<B><FONT COLOR="#228B22">int</FONT></B> i=0; i&lt;n; i++) {
	val = toggle-&gt;activate().value();
    }
    cout &lt;&lt; ((val) ? <B><FONT COLOR="#BC8F8F">&quot;true&quot;</FONT></B> : <B><FONT COLOR="#BC8F8F">&quot;false&quot;</FONT></B>) &lt;&lt; endl;
    <B><FONT COLOR="#A020F0">delete</FONT></B> toggle;

    val = true;
    NthToggle *ntoggle = <B><FONT COLOR="#A020F0">new</FONT></B> NthToggle(val, 3);
    <B><FONT COLOR="#A020F0">for</FONT></B> (<B><FONT COLOR="#228B22">int</FONT></B> i=0; i&lt;n; i++) {
	val = ntoggle-&gt;activate().value();
    }
    cout &lt;&lt; ((val) ? <B><FONT COLOR="#BC8F8F">&quot;true&quot;</FONT></B> : <B><FONT COLOR="#BC8F8F">&quot;false&quot;</FONT></B>) &lt;&lt; endl;
    <B><FONT COLOR="#A020F0">delete</FONT></B> ntoggle;

    <B><FONT COLOR="#A020F0">return</FONT></B> 0;
}</pre></td></tr></table>
