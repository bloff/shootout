<table width="100%" border="0" cellpadding="5" cellspacing="0"><tr><td bgcolor="#FFFFFF"><pre>
<I><FONT COLOR="#B22222">-- $Id: matrix-nhc98.code,v 1.1 2004-11-02 08:52:36 bfulgham Exp $
</FONT></I><I><FONT COLOR="#B22222">-- http://shootout.alioth.debian.org/
</FONT></I><I><FONT COLOR="#B22222">-- originally from Julian Assange, but
</FONT></I><I><FONT COLOR="#B22222">-- rewritten by Malcolm Wallace
</FONT></I>
<B><FONT COLOR="#A020F0">module</FONT></B> Main(main) <B><FONT COLOR="#A020F0">where</FONT></B>
<B><FONT COLOR="#A020F0">import</FONT></B> System(getArgs, exitWith, ExitCode(..))
<B><FONT COLOR="#A020F0">import</FONT></B> Numeric(readDec)
<B><FONT COLOR="#A020F0">import</FONT></B> List(transpose)

main = do
       arg &lt;- getArgs
       <B><FONT COLOR="#A020F0">let</FONT></B> n = <B><FONT COLOR="#A020F0">case</FONT></B> arg <B><FONT COLOR="#A020F0">of</FONT></B> [n] -&gt; (fst.head.readDec) n; <B><FONT COLOR="#A020F0">_ </FONT></B>-&gt; 1
           m1 = mkmat size
           m2 = m1
           mm = strictlast (zipWith mmult (replicate n m1) (replicate n m2))
       putStrLn (disp mm 0 0 ++ <B><FONT COLOR="#BC8F8F">&quot; &quot;</FONT></B> ++
		  disp mm 3 2 ++ <B><FONT COLOR="#BC8F8F">&quot; &quot;</FONT></B> ++
		  disp mm 2 3 ++ <B><FONT COLOR="#BC8F8F">&quot; &quot;</FONT></B> ++
		  disp mm 4 4)
    <B><FONT COLOR="#A020F0">where</FONT></B>
	  disp m row col  = show (m!!row!!col)

strictlast [x] = x
strictlast (x:xs) | force x = strictlast xs
force [] = True
force (x:xs) | inner x = force xs
inner [] = True
inner (x:xs) = x `seq` inner xs

size = 30
mkmat x    = [[(y-1)*x+1..y*x]| y &lt;- [1..x]]
mmult a b  = [[dot row col 0 | col &lt;- a]| row &lt;- transpose b]
       <B><FONT COLOR="#A020F0">where</FONT></B>
	       dot <B><FONT COLOR="#228B22">:: [Int] -&gt; [Int] -&gt; Int -&gt; Int
</FONT></B>	       dot (x:xs) (y:ys) z = dot xs ys (z + x*y)
	       dot  <B><FONT COLOR="#A020F0">_ </FONT></B>     <B><FONT COLOR="#A020F0">_ </FONT></B>    z = z

<I><FONT COLOR="#B22222">-- slightly slower transposing mmult in one line:
</FONT></I><I><FONT COLOR="#B22222">--  mmult a b  = [[sum$zipWith (*) row col 0 | col &lt;- transpose a]| row &lt;-b]
</FONT></I></pre></td></tr></table>
