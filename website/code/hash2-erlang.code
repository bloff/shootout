<table width="100%" border="0" cellpadding="5" cellspacing="0"><tr><td bgcolor="#FFFFFF"><pre>
<I><FONT COLOR="#B22222">%%% -*- mode: erlang -*-
</FONT></I><I><FONT COLOR="#B22222">%%% $Id: hash2-erlang.code,v 1.2 2004-11-08 08:15:14 bfulgham Exp $
</FONT></I><I><FONT COLOR="#B22222">%%%
</FONT></I><I><FONT COLOR="#B22222">%%% http://shootout.alioth.debian.org
</FONT></I><I><FONT COLOR="#B22222">%%%
</FONT></I><I><FONT COLOR="#B22222">%%% Improvements by James Hague
</FONT></I>
<I><FONT COLOR="#B22222">%% Use ETS tables (Erlang's associative store).
</FONT></I>
<B><FONT COLOR="#5F9EA0">-module</FONT></B>(hash2).
<B><FONT COLOR="#5F9EA0">-export</FONT></B>([main/0, main/1]).

<B><FONT COLOR="#0000FF">main</FONT></B>() -&gt; main([<B><FONT COLOR="#BC8F8F">'1'</FONT></B>]).
<B><FONT COLOR="#0000FF">main</FONT></B>([<FONT COLOR="#B8860B">Arg</FONT>]) -&gt;
    <FONT COLOR="#B8860B">N</FONT> = <B><FONT COLOR="#A020F0">list_to_integer</FONT></B>(<B><FONT COLOR="#A020F0">atom_to_list</FONT></B>(<FONT COLOR="#B8860B">Arg</FONT>)),
    <FONT COLOR="#B8860B">H1</FONT> = ets:new(one, [set]),
    <FONT COLOR="#B8860B">H2</FONT> = ets:new(two, [set]),
    doinserts1(0, <FONT COLOR="#B8860B">H1</FONT>),
    doinserts2(<FONT COLOR="#B8860B">N</FONT>, <FONT COLOR="#B8860B">H1</FONT>, <FONT COLOR="#B8860B">H2</FONT>),
    io:format(<B><FONT COLOR="#BC8F8F">&quot;~w ~w ~w ~w~n&quot;</FONT></B>, [value(<FONT COLOR="#B8860B">H1</FONT>, <B><FONT COLOR="#A020F0">list_to_atom</FONT></B>(<B><FONT COLOR="#BC8F8F">&quot;foo_1&quot;</FONT></B>)),
				value(<FONT COLOR="#B8860B">H1</FONT>, <B><FONT COLOR="#A020F0">list_to_atom</FONT></B>(<B><FONT COLOR="#BC8F8F">&quot;foo_9999&quot;</FONT></B>)),
				value(<FONT COLOR="#B8860B">H2</FONT>, <B><FONT COLOR="#A020F0">list_to_atom</FONT></B>(<B><FONT COLOR="#BC8F8F">&quot;foo_1&quot;</FONT></B>)),
				value(<FONT COLOR="#B8860B">H2</FONT>, <B><FONT COLOR="#A020F0">list_to_atom</FONT></B>(<B><FONT COLOR="#BC8F8F">&quot;foo_9999&quot;</FONT></B>))]),
    <B><FONT COLOR="#A020F0">halt</FONT></B>(0).

<B><FONT COLOR="#0000FF">doinserts1</FONT></B>(10000, <FONT COLOR="#B8860B">_</FONT>) -&gt; ok;
<B><FONT COLOR="#0000FF">doinserts1</FONT></B>(<FONT COLOR="#B8860B">I</FONT>, <FONT COLOR="#B8860B">H</FONT>) -&gt;
    <FONT COLOR="#B8860B">Key</FONT> = <B><FONT COLOR="#A020F0">list_to_atom</FONT></B>(lists:append(<B><FONT COLOR="#BC8F8F">&quot;foo_&quot;</FONT></B>, <B><FONT COLOR="#A020F0">integer_to_list</FONT></B>(<FONT COLOR="#B8860B">I</FONT>))),
    ets:insert(<FONT COLOR="#B8860B">H</FONT>, { <FONT COLOR="#B8860B">Key</FONT>, <FONT COLOR="#B8860B">I</FONT> }),
    doinserts1(<FONT COLOR="#B8860B">I</FONT>+1, <FONT COLOR="#B8860B">H</FONT>).

<B><FONT COLOR="#0000FF">doinserts2</FONT></B>(0, <FONT COLOR="#B8860B">_</FONT>, <FONT COLOR="#B8860B">_</FONT>) -&gt; ok;
<B><FONT COLOR="#0000FF">doinserts2</FONT></B>(<FONT COLOR="#B8860B">I</FONT>, <FONT COLOR="#B8860B">H1</FONT>, <FONT COLOR="#B8860B">H2</FONT>) -&gt;
    addTables(<FONT COLOR="#B8860B">H1</FONT>, <FONT COLOR="#B8860B">H2</FONT>),
    doinserts2(<FONT COLOR="#B8860B">I</FONT>-1, <FONT COLOR="#B8860B">H1</FONT>, <FONT COLOR="#B8860B">H2</FONT>).

<B><FONT COLOR="#0000FF">addTables</FONT></B>(<FONT COLOR="#B8860B">H1</FONT>, <FONT COLOR="#B8860B">H2</FONT>) -&gt;
    <FONT COLOR="#B8860B">Key</FONT> = ets:first(<FONT COLOR="#B8860B">H1</FONT>),
    addTables(<FONT COLOR="#B8860B">Key</FONT>, <FONT COLOR="#B8860B">H1</FONT>, <FONT COLOR="#B8860B">H2</FONT>).

<B><FONT COLOR="#0000FF">value</FONT></B>(<FONT COLOR="#B8860B">Tab</FONT>, <FONT COLOR="#B8860B">Key</FONT>) -&gt; { <FONT COLOR="#B8860B">_</FONT>, <FONT COLOR="#B8860B">V</FONT> } = <B><FONT COLOR="#A020F0">hd</FONT></B>(ets:lookup(<FONT COLOR="#B8860B">Tab</FONT>, <FONT COLOR="#B8860B">Key</FONT>)), <FONT COLOR="#B8860B">V</FONT>.

<B><FONT COLOR="#0000FF">addTables</FONT></B>(<B><FONT COLOR="#BC8F8F">'$end_of_table'</FONT></B>, <FONT COLOR="#B8860B">_</FONT>, <FONT COLOR="#B8860B">_</FONT>) -&gt; ok;
<B><FONT COLOR="#0000FF">addTables</FONT></B>(<FONT COLOR="#B8860B">Key</FONT>, <FONT COLOR="#B8860B">H1</FONT>, <FONT COLOR="#B8860B">H2</FONT>) -&gt;
    <FONT COLOR="#B8860B">Val1</FONT> = value(<FONT COLOR="#B8860B">H1</FONT>, <FONT COLOR="#B8860B">Key</FONT>),
    <B><FONT COLOR="#A020F0">case</FONT></B> (<B><FONT COLOR="#A020F0">catch</FONT></B> ets:update_counter(<FONT COLOR="#B8860B">H2</FONT>, <FONT COLOR="#B8860B">Key</FONT>, <FONT COLOR="#B8860B">Val1</FONT>)) <B><FONT COLOR="#A020F0">of</FONT></B>
	{<B><FONT COLOR="#BC8F8F">'EXIT'</FONT></B>, {badarg, <FONT COLOR="#B8860B">_</FONT>}} -&gt; ets:insert(<FONT COLOR="#B8860B">H2</FONT>, {<FONT COLOR="#B8860B">Key</FONT>, <FONT COLOR="#B8860B">Val1</FONT>});
	<FONT COLOR="#B8860B">_</FONT>                     -&gt; true
    <B><FONT COLOR="#A020F0">end</FONT></B>,
    addTables(ets:next(<FONT COLOR="#B8860B">H1</FONT>, <FONT COLOR="#B8860B">Key</FONT>), <FONT COLOR="#B8860B">H1</FONT>, <FONT COLOR="#B8860B">H2</FONT>).
</pre></td></tr></table>
