<table width="100%" border="0" cellpadding="5" cellspacing="0"><tr><td bgcolor="#FFFFFF"><pre>
/* The Great Computer Language Shootout  
   contributed by John van Groningen (Clean Guru!)

   http://shootout.alioth.debian.org/
*/


<B><FONT COLOR="#A020F0">module</FONT></B> wc
<B><FONT COLOR="#A020F0">import</FONT></B> StdEnv

Start world
	# (console, world) = stdio world
	# (nl, nw, nc) = count_file console 0 0 0 False
	= toString nl +++ <B><FONT COLOR="#BC8F8F">&quot; &quot;</FONT></B> +++ toString nw +++ <B><FONT COLOR="#BC8F8F">&quot; &quot;</FONT></B> +++ toString nc +++ <B><FONT COLOR="#BC8F8F">&quot;\n&quot;</FONT></B>

count_file <B><FONT COLOR="#228B22">:: !*File !Int !Int !Int !Bool -&gt; .(Int,Int,Int)
</FONT></B>count_file f nc nw nl inside
	# (s,f) = freads f 4096
	# n=size s
	| n==0
		= (nl, nw, nc)
		# (nw,nl,inside) = <B><FONT COLOR="#A020F0">if</FONT></B> inside
							(count_sw 0 n nw nl s)
							(count_s 0 n nw nl s)
		= count_file f (nc+n) nw nl inside

count_s <B><FONT COLOR="#228B22">:: !Int !Int !Int !Int !{#Char} -&gt; (!Int,!Int,!Bool)
</FONT></B>count_s i n nw nl s
	| i&lt;n
	    # c=s.[i]
	    | c==<B><FONT COLOR="#BC8F8F">' '</FONT></B> || c=='\t'
          	= count_s (i+1) n nw nl s
	    | c=='\n'
        	= count_s (i+1) n nw (nl+1) s
          	= count_sw (i+1) n (nw+1) nl s
		= (nw,nl,False)

count_sw <B><FONT COLOR="#228B22">:: !Int !Int !Int !Int !{#Char} -&gt; (!Int,!Int,!Bool)
</FONT></B>count_sw i n nw nl s
	| i&lt;n
	    | s.[i]&gt;<B><FONT COLOR="#BC8F8F">' '</FONT></B>
          	= count_sw (i+1) n nw nl s
	    # c=s.[i]
	    | c==<B><FONT COLOR="#BC8F8F">' '</FONT></B> || c=='\t'
          	= count_s (i+1) n nw nl s
	    | s.[i]=='\n'
          	= count_s (i+1) n nw (nl+1) s
          	= count_sw (i+1) n nw nl s
		= (nw,nl,True)</pre></td></tr></table>
