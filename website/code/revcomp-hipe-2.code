<span class="slc">%% The Computer Language Shootout</span>
<span class="slc">%% http://shootout.alioth.debian.org/</span>
<span class="slc">%%</span>
<span class="slc">%% contributed by Mats Cronqvist</span>

<span class="sym">-</span><span class="kwd">module</span><span class="sym">(</span>revcomp<span class="sym">)</span>.

<span class="sym">-</span><span class="kwd">export</span><span class="sym">([</span>main<span class="sym">/</span><span class="num">1</span><span class="sym">])</span>.

<span class="kwd">main</span><span class="sym">([</span>_Args<span class="sym">]) -&gt;</span>
    <span class="kwd">do</span><span class="sym">(</span>io<span class="sym">:</span><span class="kwd">get_line</span><span class="sym">(</span><span class="str">''</span><span class="sym">),[]),</span>
    <span class="kwb">halt</span><span class="sym">()</span>.

<span class="kwd">do</span><span class="sym">(</span>eof<span class="sym">,</span>RevCompSeq<span class="sym">) -&gt;</span>
    <span class="slc">%% end of file. flush last sequence</span>
    <span class="kwd">flush</span><span class="sym">(</span>RevCompSeq<span class="sym">);</span>
<span class="kwd">do</span><span class="sym">(</span><span class="str">&quot;&gt;&quot;</span><span class="sym">++</span>_<span class="sym">=</span>Descr<span class="sym">,</span>RevCompSeq<span class="sym">) -&gt;</span>
    <span class="slc">%% description. flush sequence, write description, get next line</span>
    <span class="kwd">flush</span><span class="sym">(</span>RevCompSeq<span class="sym">),</span>
    io<span class="sym">:</span><span class="kwd">fwrite</span><span class="sym">(</span><span class="str">&quot;~s&quot;</span><span class="sym">,[</span>Descr<span class="sym">]),</span>
    <span class="kwd">do</span><span class="sym">(</span>io<span class="sym">:</span><span class="kwd">get_line</span><span class="sym">(</span><span class="str">''</span><span class="sym">),[]);</span>
<span class="kwd">do</span><span class="sym">(</span>Str<span class="sym">,</span>RevCompSeq<span class="sym">) -&gt;</span>
    <span class="slc">%% sequence data. reverse-complement it and get next line</span>
    <span class="kwd">do</span><span class="sym">(</span>io<span class="sym">:</span><span class="kwd">get_line</span><span class="sym">(</span><span class="str">''</span><span class="sym">),</span><span class="kwd">rev_comp</span><span class="sym">(</span>Str<span class="sym">,</span>RevCompSeq<span class="sym">))</span>.

<span class="slc">%% take reverse-complemented sequence, insert line-feed char every</span>
<span class="slc">%% 60th byte, toss to stdout</span>
<span class="kwd">flush</span><span class="sym">([]) -&gt;</span> ok<span class="sym">;</span>
<span class="kwd">flush</span><span class="sym">(</span>RevComp<span class="sym">) -&gt;</span> <span class="kwd">flush</span><span class="sym">(</span>RevComp<span class="sym">,</span><span class="num">60</span><span class="sym">,[],[])</span>.

<span class="kwd">flush</span><span class="sym">([],</span>_<span class="sym">,</span>Lin<span class="sym">,</span>Seq<span class="sym">) -&gt;</span> io<span class="sym">:</span><span class="kwd">put_chars</span><span class="sym">([</span>Seq<span class="sym">,</span><span class="num">10</span><span class="sym">,</span>lists<span class="sym">:</span><span class="kwd">reverse</span><span class="sym">(</span>Lin<span class="sym">),</span><span class="num">10</span><span class="sym">]);</span>
<span class="kwd">flush</span><span class="sym">(</span>RevComp<span class="sym">,</span><span class="num">0</span><span class="sym">,</span>Lin<span class="sym">,[]) -&gt;</span> <span class="kwd">flush</span><span class="sym">(</span>RevComp<span class="sym">,</span><span class="num">60</span><span class="sym">,[],[</span>lists<span class="sym">:</span><span class="kwd">reverse</span><span class="sym">(</span>Lin<span class="sym">)]);</span>
<span class="kwd">flush</span><span class="sym">(</span>RevComp<span class="sym">,</span><span class="num">0</span><span class="sym">,</span>Lin<span class="sym">,</span>Seq<span class="sym">) -&gt;</span> <span class="kwd">flush</span><span class="sym">(</span>RevComp<span class="sym">,</span><span class="num">60</span><span class="sym">,[],[</span>Seq<span class="sym">,</span><span class="num">10</span><span class="sym">,</span>lists<span class="sym">:</span><span class="kwd">reverse</span><span class="sym">(</span>Lin<span class="sym">)]);</span>
<span class="kwd">flush</span><span class="sym">([</span>H<span class="sym">|</span>RevComp<span class="sym">],</span>N<span class="sym">,</span>Lin<span class="sym">,</span>Seq<span class="sym">) -&gt;</span> <span class="kwd">flush</span><span class="sym">(</span>RevComp<span class="sym">,</span>N<span class="sym">-</span><span class="num">1</span><span class="sym">,[</span>H<span class="sym">|</span>Lin<span class="sym">],</span>Seq<span class="sym">)</span>.

<span class="slc">%% reverse-complement sequence data. toss line-feeds</span>
<span class="kwd">rev_comp</span><span class="sym">([</span>$A<span class="sym">|</span>T<span class="sym">],</span>A<span class="sym">) -&gt;</span> <span class="kwd">rev_comp</span><span class="sym">(</span>T<span class="sym">,[</span>$T<span class="sym">|</span>A<span class="sym">]);</span>
<span class="kwd">rev_comp</span><span class="sym">([</span>$a<span class="sym">|</span>T<span class="sym">],</span>A<span class="sym">) -&gt;</span> <span class="kwd">rev_comp</span><span class="sym">(</span>T<span class="sym">,[</span>$T<span class="sym">|</span>A<span class="sym">]);</span>
<span class="kwd">rev_comp</span><span class="sym">([</span>$C<span class="sym">|</span>T<span class="sym">],</span>A<span class="sym">) -&gt;</span> <span class="kwd">rev_comp</span><span class="sym">(</span>T<span class="sym">,[</span>$G<span class="sym">|</span>A<span class="sym">]);</span>
<span class="kwd">rev_comp</span><span class="sym">([</span>$c<span class="sym">|</span>T<span class="sym">],</span>A<span class="sym">) -&gt;</span> <span class="kwd">rev_comp</span><span class="sym">(</span>T<span class="sym">,[</span>$G<span class="sym">|</span>A<span class="sym">]);</span>
<span class="kwd">rev_comp</span><span class="sym">([</span>$G<span class="sym">|</span>T<span class="sym">],</span>A<span class="sym">) -&gt;</span> <span class="kwd">rev_comp</span><span class="sym">(</span>T<span class="sym">,[</span>$C<span class="sym">|</span>A<span class="sym">]);</span>
<span class="kwd">rev_comp</span><span class="sym">([</span>$g<span class="sym">|</span>T<span class="sym">],</span>A<span class="sym">) -&gt;</span> <span class="kwd">rev_comp</span><span class="sym">(</span>T<span class="sym">,[</span>$C<span class="sym">|</span>A<span class="sym">]);</span>
<span class="kwd">rev_comp</span><span class="sym">([</span>$T<span class="sym">|</span>T<span class="sym">],</span>A<span class="sym">) -&gt;</span> <span class="kwd">rev_comp</span><span class="sym">(</span>T<span class="sym">,[</span>$A<span class="sym">|</span>A<span class="sym">]);</span>
<span class="kwd">rev_comp</span><span class="sym">([</span>$t<span class="sym">|</span>T<span class="sym">],</span>A<span class="sym">) -&gt;</span> <span class="kwd">rev_comp</span><span class="sym">(</span>T<span class="sym">,[</span>$A<span class="sym">|</span>A<span class="sym">]);</span>
<span class="kwd">rev_comp</span><span class="sym">([</span>$U<span class="sym">|</span>T<span class="sym">],</span>A<span class="sym">) -&gt;</span> <span class="kwd">rev_comp</span><span class="sym">(</span>T<span class="sym">,[</span>$A<span class="sym">|</span>A<span class="sym">]);</span>
<span class="kwd">rev_comp</span><span class="sym">([</span>$u<span class="sym">|</span>T<span class="sym">],</span>A<span class="sym">) -&gt;</span> <span class="kwd">rev_comp</span><span class="sym">(</span>T<span class="sym">,[</span>$A<span class="sym">|</span>A<span class="sym">]);</span>
<span class="kwd">rev_comp</span><span class="sym">([</span>$M<span class="sym">|</span>T<span class="sym">],</span>A<span class="sym">) -&gt;</span> <span class="kwd">rev_comp</span><span class="sym">(</span>T<span class="sym">,[</span>$K<span class="sym">|</span>A<span class="sym">]);</span>
<span class="kwd">rev_comp</span><span class="sym">([</span>$m<span class="sym">|</span>T<span class="sym">],</span>A<span class="sym">) -&gt;</span> <span class="kwd">rev_comp</span><span class="sym">(</span>T<span class="sym">,[</span>$K<span class="sym">|</span>A<span class="sym">]);</span>
<span class="kwd">rev_comp</span><span class="sym">([</span>$R<span class="sym">|</span>T<span class="sym">],</span>A<span class="sym">) -&gt;</span> <span class="kwd">rev_comp</span><span class="sym">(</span>T<span class="sym">,[</span>$Y<span class="sym">|</span>A<span class="sym">]);</span>
<span class="kwd">rev_comp</span><span class="sym">([</span>$r<span class="sym">|</span>T<span class="sym">],</span>A<span class="sym">) -&gt;</span> <span class="kwd">rev_comp</span><span class="sym">(</span>T<span class="sym">,[</span>$Y<span class="sym">|</span>A<span class="sym">]);</span>
<span class="kwd">rev_comp</span><span class="sym">([</span>$W<span class="sym">|</span>T<span class="sym">],</span>A<span class="sym">) -&gt;</span> <span class="kwd">rev_comp</span><span class="sym">(</span>T<span class="sym">,[</span>$W<span class="sym">|</span>A<span class="sym">]);</span>
<span class="kwd">rev_comp</span><span class="sym">([</span>$w<span class="sym">|</span>T<span class="sym">],</span>A<span class="sym">) -&gt;</span> <span class="kwd">rev_comp</span><span class="sym">(</span>T<span class="sym">,[</span>$W<span class="sym">|</span>A<span class="sym">]);</span>
<span class="kwd">rev_comp</span><span class="sym">([</span>$S<span class="sym">|</span>T<span class="sym">],</span>A<span class="sym">) -&gt;</span> <span class="kwd">rev_comp</span><span class="sym">(</span>T<span class="sym">,[</span>$S<span class="sym">|</span>A<span class="sym">]);</span>
<span class="kwd">rev_comp</span><span class="sym">([</span>$s<span class="sym">|</span>T<span class="sym">],</span>A<span class="sym">) -&gt;</span> <span class="kwd">rev_comp</span><span class="sym">(</span>T<span class="sym">,[</span>$S<span class="sym">|</span>A<span class="sym">]);</span>
<span class="kwd">rev_comp</span><span class="sym">([</span>$Y<span class="sym">|</span>T<span class="sym">],</span>A<span class="sym">) -&gt;</span> <span class="kwd">rev_comp</span><span class="sym">(</span>T<span class="sym">,[</span>$R<span class="sym">|</span>A<span class="sym">]);</span>
<span class="kwd">rev_comp</span><span class="sym">([</span>$y<span class="sym">|</span>T<span class="sym">],</span>A<span class="sym">) -&gt;</span> <span class="kwd">rev_comp</span><span class="sym">(</span>T<span class="sym">,[</span>$R<span class="sym">|</span>A<span class="sym">]);</span>
<span class="kwd">rev_comp</span><span class="sym">([</span>$K<span class="sym">|</span>T<span class="sym">],</span>A<span class="sym">) -&gt;</span> <span class="kwd">rev_comp</span><span class="sym">(</span>T<span class="sym">,[</span>$M<span class="sym">|</span>A<span class="sym">]);</span>
<span class="kwd">rev_comp</span><span class="sym">([</span>$k<span class="sym">|</span>T<span class="sym">],</span>A<span class="sym">) -&gt;</span> <span class="kwd">rev_comp</span><span class="sym">(</span>T<span class="sym">,[</span>$M<span class="sym">|</span>A<span class="sym">]);</span>
<span class="kwd">rev_comp</span><span class="sym">([</span>$V<span class="sym">|</span>T<span class="sym">],</span>A<span class="sym">) -&gt;</span> <span class="kwd">rev_comp</span><span class="sym">(</span>T<span class="sym">,[</span>$B<span class="sym">|</span>A<span class="sym">]);</span>
<span class="kwd">rev_comp</span><span class="sym">([</span>$v<span class="sym">|</span>T<span class="sym">],</span>A<span class="sym">) -&gt;</span> <span class="kwd">rev_comp</span><span class="sym">(</span>T<span class="sym">,[</span>$B<span class="sym">|</span>A<span class="sym">]);</span>
<span class="kwd">rev_comp</span><span class="sym">([</span>$H<span class="sym">|</span>T<span class="sym">],</span>A<span class="sym">) -&gt;</span> <span class="kwd">rev_comp</span><span class="sym">(</span>T<span class="sym">,[</span>$D<span class="sym">|</span>A<span class="sym">]);</span>
<span class="kwd">rev_comp</span><span class="sym">([</span>$h<span class="sym">|</span>T<span class="sym">],</span>A<span class="sym">) -&gt;</span> <span class="kwd">rev_comp</span><span class="sym">(</span>T<span class="sym">,[</span>$D<span class="sym">|</span>A<span class="sym">]);</span>
<span class="kwd">rev_comp</span><span class="sym">([</span>$D<span class="sym">|</span>T<span class="sym">],</span>A<span class="sym">) -&gt;</span> <span class="kwd">rev_comp</span><span class="sym">(</span>T<span class="sym">,[</span>$H<span class="sym">|</span>A<span class="sym">]);</span>
<span class="kwd">rev_comp</span><span class="sym">([</span>$d<span class="sym">|</span>T<span class="sym">],</span>A<span class="sym">) -&gt;</span> <span class="kwd">rev_comp</span><span class="sym">(</span>T<span class="sym">,[</span>$H<span class="sym">|</span>A<span class="sym">]);</span>
<span class="kwd">rev_comp</span><span class="sym">([</span>$B<span class="sym">|</span>T<span class="sym">],</span>A<span class="sym">) -&gt;</span> <span class="kwd">rev_comp</span><span class="sym">(</span>T<span class="sym">,[</span>$V<span class="sym">|</span>A<span class="sym">]);</span>
<span class="kwd">rev_comp</span><span class="sym">([</span>$b<span class="sym">|</span>T<span class="sym">],</span>A<span class="sym">) -&gt;</span> <span class="kwd">rev_comp</span><span class="sym">(</span>T<span class="sym">,[</span>$V<span class="sym">|</span>A<span class="sym">]);</span>
<span class="kwd">rev_comp</span><span class="sym">([</span>$N<span class="sym">|</span>T<span class="sym">],</span>A<span class="sym">) -&gt;</span> <span class="kwd">rev_comp</span><span class="sym">(</span>T<span class="sym">,[</span>$N<span class="sym">|</span>A<span class="sym">]);</span>
<span class="kwd">rev_comp</span><span class="sym">([</span>$n<span class="sym">|</span>T<span class="sym">],</span>A<span class="sym">) -&gt;</span> <span class="kwd">rev_comp</span><span class="sym">(</span>T<span class="sym">,[</span>$N<span class="sym">|</span>A<span class="sym">]);</span>
<span class="kwd">rev_comp</span><span class="sym">([</span><span class="num">10</span><span class="sym">],</span>A<span class="sym">) -&gt;</span> A.
