<span class="slc">;;; -*- mode: emacs-lisp -*-
</span><span class="slc">;;; $Id: methcall-xemacs.code,v 1.5 2005-03-31 10:40:33 bfulgham Exp $
</span><span class="slc">;;; http://www.bagley.org/~doug/shootout/
</span>
<span class="sym">(</span>require <span class="str">'eieio)

(defun print-bool (b)
  (if b (princ &quot;true</span><span class="esc">\n</span><span class="str">&quot;) (princ &quot;false</span><span class="esc">\n</span><span class="str">&quot;)))

(defclass toggle ()
  ((state :initarg state
	  :initform t)))

(defmethod toggle-value ((this toggle))
  (oref this state))

(defmethod activate ((this toggle))
  (oset this state (not (oref this state)))
  this)

(defclass nth-toggle (toggle)
    ((count-max :initarg :max-counter
		:initform 1)
     (counter :initform 0)))

(defmethod activate ((this nth-toggle))
  (oset this counter (+ 1 (oref this counter)))
  (cond ((&gt;= (oref this counter)
	     (oref this count-max))
	 (oset this state (not (oref this state)))
	 (oset this counter 0)))
  this)

(defun main ()
  (let* ((arg (car command-line-args-left))
	 (n (if arg (string-to-number arg) 1)))
    (let ((tog (toggle &quot;foo&quot;))
	  (val t))
      (dotimes (i n)
	(setq val (toggle-value (activate tog))))
      (print-bool val)

    (let ((ntog (nth-toggle &quot;bar&quot; :max-counter 3))
	  (val t))
      (dotimes (i n)
	(setq val (toggle-value (activate ntog))))
      (print-bool val)))))
</span>
