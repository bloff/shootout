<table width="100%" border="0" cellpadding="5" cellspacing="0"><tr><td bgcolor="#FFFFFF"><pre>
<I><FONT COLOR="#B22222">%% The Great Computer Language Shootout
</FONT></I><I><FONT COLOR="#B22222">%% contributed by Isaac Gouy (Erlang novice)
</FONT></I><I><FONT COLOR="#B22222">%%
</FONT></I><I><FONT COLOR="#B22222">%% http://shootout.alioth.debian.org/
</FONT></I><I><FONT COLOR="#B22222">%%
</FONT></I><I><FONT COLOR="#B22222">%% Erlang by-design uses soft-real-time lightweight threads.
</FONT></I><I><FONT COLOR="#B22222">%% Message send/receive gives synchronization &amp; data access.
</FONT></I><I><FONT COLOR="#B22222">%%
</FONT></I><I><FONT COLOR="#B22222">%% Usage: start from command line with
</FONT></I><I><FONT COLOR="#B22222">%%     erlc prodcons.erl
</FONT></I><I><FONT COLOR="#B22222">%%     erl -noinput -s prodcons main 100000
</FONT></I>
<B><FONT COLOR="#5F9EA0">-module</FONT></B>(prodcons). 
<B><FONT COLOR="#5F9EA0">-export</FONT></B>([main/1, producer/3, consumer/4]). 


<B><FONT COLOR="#0000FF">producer</FONT></B>(0, <FONT COLOR="#B8860B">NP</FONT>, <FONT COLOR="#B8860B">Main</FONT>) -&gt; <FONT COLOR="#B8860B">Main</FONT> ! {<B><FONT COLOR="#A020F0">self</FONT></B>(), <FONT COLOR="#B8860B">NP</FONT>};
<B><FONT COLOR="#0000FF">producer</FONT></B>(<FONT COLOR="#B8860B">N</FONT>, <FONT COLOR="#B8860B">NP</FONT>, <FONT COLOR="#B8860B">Main</FONT>) -&gt; 
    <B><FONT COLOR="#A020F0">receive</FONT></B>                                           <I><FONT COLOR="#B22222">%% receive buffer empty
</FONT></I>        {<FONT COLOR="#B8860B">From</FONT>, next} -&gt; 
            <FONT COLOR="#B8860B">From</FONT> ! {data, <FONT COLOR="#B8860B">NP</FONT>},                        <I><FONT COLOR="#B22222">%% signal buffer full
</FONT></I>            producer(<FONT COLOR="#B8860B">N</FONT>-1, <FONT COLOR="#B8860B">NP</FONT>+1, <FONT COLOR="#B8860B">Main</FONT>)
    <B><FONT COLOR="#A020F0">end</FONT></B>.


<B><FONT COLOR="#0000FF">consumer</FONT></B>(0, <FONT COLOR="#B8860B">NC</FONT>, <FONT COLOR="#B8860B">_</FONT>, <FONT COLOR="#B8860B">Main</FONT>) -&gt; <FONT COLOR="#B8860B">Main</FONT> ! {<B><FONT COLOR="#A020F0">self</FONT></B>(), <FONT COLOR="#B8860B">NC</FONT>};
<B><FONT COLOR="#0000FF">consumer</FONT></B>(<FONT COLOR="#B8860B">N</FONT>, <FONT COLOR="#B8860B">NC</FONT>, <FONT COLOR="#B8860B">P</FONT>, <FONT COLOR="#B8860B">Main</FONT>) -&gt;
    <FONT COLOR="#B8860B">P</FONT> ! {<B><FONT COLOR="#A020F0">self</FONT></B>(), next},                               <I><FONT COLOR="#B22222">%% signal buffer empty
</FONT></I>    <B><FONT COLOR="#A020F0">receive</FONT></B>                                           <I><FONT COLOR="#B22222">%% receive buffer full
</FONT></I>        {data, <FONT COLOR="#B8860B">Value</FONT>} -&gt; consumer(<FONT COLOR="#B8860B">N</FONT>-1, <FONT COLOR="#B8860B">NC</FONT>+1, <FONT COLOR="#B8860B">P</FONT>, <FONT COLOR="#B8860B">Main</FONT>) <I><FONT COLOR="#B22222">%% empty buffer
</FONT></I>    <B><FONT COLOR="#A020F0">end</FONT></B>.


<B><FONT COLOR="#0000FF">main</FONT></B>([<FONT COLOR="#B8860B">Arg</FONT>]) -&gt;
    <FONT COLOR="#B8860B">N</FONT> = <B><FONT COLOR="#A020F0">list_to_integer</FONT></B>(<B><FONT COLOR="#A020F0">atom_to_list</FONT></B>(<FONT COLOR="#B8860B">Arg</FONT>)),
    <FONT COLOR="#B8860B">P</FONT> = <B><FONT COLOR="#A020F0">spawn</FONT></B>(prodcons, producer, [<FONT COLOR="#B8860B">N</FONT>, 0, <B><FONT COLOR="#A020F0">self</FONT></B>()]),     <I><FONT COLOR="#B22222">%% spawn producer thread
</FONT></I>    <FONT COLOR="#B8860B">C</FONT> = <B><FONT COLOR="#A020F0">spawn</FONT></B>(prodcons, consumer, [<FONT COLOR="#B8860B">N</FONT>, 0, <FONT COLOR="#B8860B">P</FONT>, <B><FONT COLOR="#A020F0">self</FONT></B>()]),  <I><FONT COLOR="#B22222">%% spawn consumer thread
</FONT></I>    <B><FONT COLOR="#A020F0">receive</FONT></B> {<FONT COLOR="#B8860B">P</FONT>, <FONT COLOR="#B8860B">NP</FONT>} -&gt; ok <B><FONT COLOR="#A020F0">end</FONT></B>,                        <I><FONT COLOR="#B22222">%% wait on producer thread
</FONT></I>    <B><FONT COLOR="#A020F0">receive</FONT></B> {<FONT COLOR="#B8860B">C</FONT>, <FONT COLOR="#B8860B">NC</FONT>} -&gt; ok <B><FONT COLOR="#A020F0">end</FONT></B>,                        <I><FONT COLOR="#B22222">%% wait on consumer thread
</FONT></I>    io:format(<B><FONT COLOR="#BC8F8F">&quot;~w ~w~n&quot;</FONT></B>, [<FONT COLOR="#B8860B">NP</FONT>, <FONT COLOR="#B8860B">NC</FONT>]),
    <B><FONT COLOR="#A020F0">halt</FONT></B>(0).



</pre></td></tr></table>
