<table width="100%" border="0" cellpadding="5" cellspacing="0"><tr><td bgcolor="#FFFFFF"><pre>
<I><FONT COLOR="#B22222">// $Id: echo-gcj.code,v 1.1 2004-11-02 08:52:30 bfulgham Exp $
</FONT></I><I><FONT COLOR="#B22222">// http://www.bagley.org/~doug/shootout/
</FONT></I><I><FONT COLOR="#B22222">// author: Dirus@programmer.net
</FONT></I>
<B><FONT COLOR="#A020F0">import</FONT></B> java.io.*;
<B><FONT COLOR="#A020F0">import</FONT></B> java.net.*;

<B><FONT COLOR="#A020F0">public</FONT></B> <B><FONT COLOR="#A020F0">class</FONT></B> echo {
    <B><FONT COLOR="#A020F0">public</FONT></B> <B><FONT COLOR="#A020F0">static</FONT></B> <B><FONT COLOR="#A020F0">void</FONT></B> main(String[] args) <B><FONT COLOR="#A020F0">throws</FONT></B> Exception {
	<B><FONT COLOR="#A020F0">int</FONT></B> iIterations = 1;
	<B><FONT COLOR="#A020F0">try</FONT></B> {
	    iIterations = Integer.parseInt(args[0]);
	} <B><FONT COLOR="#A020F0">catch</FONT></B>(Exception e) { }

	EchoServer esServer = <B><FONT COLOR="#A020F0">new</FONT></B> EchoServer(0);
	<B><FONT COLOR="#A020F0">new</FONT></B> EchoClient(InetAddress.getLocalHost(), esServer.getPort(), iIterations);
    }
}

<B><FONT COLOR="#A020F0">class</FONT></B> EchoClient <B><FONT COLOR="#A020F0">extends</FONT></B> Thread {
    <B><FONT COLOR="#A020F0">private</FONT></B> <B><FONT COLOR="#A020F0">static</FONT></B> <B><FONT COLOR="#A020F0">final</FONT></B> String GREETING = <B><FONT COLOR="#BC8F8F">&quot;Hello there sailor\n&quot;</FONT></B>;
    <B><FONT COLOR="#A020F0">private</FONT></B> <B><FONT COLOR="#A020F0">final</FONT></B> InetAddress inetaServer;
    <B><FONT COLOR="#A020F0">private</FONT></B> <B><FONT COLOR="#A020F0">final</FONT></B> <B><FONT COLOR="#A020F0">int</FONT></B>         iPort;
    <B><FONT COLOR="#A020F0">private</FONT></B> <B><FONT COLOR="#A020F0">final</FONT></B> <B><FONT COLOR="#A020F0">int</FONT></B>         iIterations;

    <B><FONT COLOR="#A020F0">public</FONT></B> EchoClient(InetAddress inetaServer, <B><FONT COLOR="#A020F0">int</FONT></B> iPort, <B><FONT COLOR="#A020F0">int</FONT></B> iIterations) {
	<B><FONT COLOR="#A020F0">this</FONT></B>.inetaServer = inetaServer;
	<B><FONT COLOR="#A020F0">this</FONT></B>.iPort = iPort;
	<B><FONT COLOR="#A020F0">this</FONT></B>.iIterations = iIterations;
	start();
    }

    <B><FONT COLOR="#A020F0">public</FONT></B> <B><FONT COLOR="#A020F0">void</FONT></B> run() {
	Socket socketFromServer = <B><FONT COLOR="#A020F0">null</FONT></B>;
	<B><FONT COLOR="#A020F0">try</FONT></B> {
	    socketFromServer = <B><FONT COLOR="#A020F0">new</FONT></B> Socket(inetaServer, iPort);
	    BufferedReader in = <B><FONT COLOR="#A020F0">new</FONT></B> BufferedReader(<B><FONT COLOR="#A020F0">new</FONT></B> InputStreamReader(socketFromServer.getInputStream()));
	    OutputStream out = socketFromServer.getOutputStream();

	    <B><FONT COLOR="#A020F0">byte</FONT></B>[] bytesOut = GREETING.getBytes();
	    String strIn = GREETING.trim();
	    <B><FONT COLOR="#A020F0">for</FONT></B>(<B><FONT COLOR="#A020F0">int</FONT></B> i = 0; i &lt; iIterations; ++i) {
		out.write(bytesOut);
		out.flush();
		String strRead = in.readLine();
		<B><FONT COLOR="#A020F0">if</FONT></B>(!strRead.equals(strIn))
		    <B><FONT COLOR="#A020F0">throw</FONT></B> <B><FONT COLOR="#A020F0">new</FONT></B> RuntimeException(<B><FONT COLOR="#BC8F8F">&quot;client: \&quot;&quot;</FONT></B> + strIn + <B><FONT COLOR="#BC8F8F">&quot;\&quot; ne \&quot;&quot;</FONT></B> + strRead + <B><FONT COLOR="#BC8F8F">&quot;\&quot;&quot;</FONT></B>);
	    }
	} <B><FONT COLOR="#A020F0">catch</FONT></B>(Exception e) {
	    e.printStackTrace();
	}

	<B><FONT COLOR="#A020F0">try</FONT></B> {
	    socketFromServer.close();
	} <B><FONT COLOR="#A020F0">catch</FONT></B>(Exception e) { }
    }
}

<B><FONT COLOR="#A020F0">class</FONT></B> EchoServer <B><FONT COLOR="#A020F0">extends</FONT></B> Thread {
    <B><FONT COLOR="#A020F0">private</FONT></B> <B><FONT COLOR="#A020F0">static</FONT></B> <B><FONT COLOR="#A020F0">final</FONT></B> <B><FONT COLOR="#A020F0">int</FONT></B>   BUFFER_SIZE = 1024;
    <B><FONT COLOR="#A020F0">private</FONT></B> <B><FONT COLOR="#A020F0">final</FONT></B> ServerSocket ssAccepting;
    <B><FONT COLOR="#A020F0">private</FONT></B> <B><FONT COLOR="#A020F0">final</FONT></B> <B><FONT COLOR="#A020F0">int</FONT></B>          iPort;

    <B><FONT COLOR="#A020F0">public</FONT></B> EchoServer(<B><FONT COLOR="#A020F0">int</FONT></B> iPort) <B><FONT COLOR="#A020F0">throws</FONT></B> IOException {
	ssAccepting = <B><FONT COLOR="#A020F0">new</FONT></B> ServerSocket(iPort);
	<B><FONT COLOR="#A020F0">this</FONT></B>.iPort = ssAccepting.getLocalPort();
	start();
    }

    <B><FONT COLOR="#A020F0">public</FONT></B> <B><FONT COLOR="#A020F0">final</FONT></B> <B><FONT COLOR="#A020F0">int</FONT></B> getPort() {
	<B><FONT COLOR="#A020F0">return</FONT></B> iPort;
    }

    <B><FONT COLOR="#A020F0">public</FONT></B> <B><FONT COLOR="#A020F0">void</FONT></B> run() {
	<B><FONT COLOR="#A020F0">byte</FONT></B> bytesIn[] = <B><FONT COLOR="#A020F0">new</FONT></B> <B><FONT COLOR="#A020F0">byte</FONT></B>[BUFFER_SIZE];
	<B><FONT COLOR="#A020F0">try</FONT></B> {
	    Socket socketClient = ssAccepting.accept();
	    InputStream in = socketClient.getInputStream();
	    OutputStream out = socketClient.getOutputStream();
	    <B><FONT COLOR="#A020F0">int</FONT></B> iLength, iCount = 0;
	    <B><FONT COLOR="#A020F0">while</FONT></B> ((iLength = in.read(bytesIn)) != -1) {
		out.write(bytesIn, 0, iLength);
		out.flush();
		iCount += iLength;
	    }
	    System.out.println(<B><FONT COLOR="#BC8F8F">&quot;server processed &quot;</FONT></B> + iCount + <B><FONT COLOR="#BC8F8F">&quot; bytes&quot;</FONT></B>);
	} <B><FONT COLOR="#A020F0">catch</FONT></B> (Exception e) {
	    e.printStackTrace();
	}
    }
}</pre></td></tr></table>
