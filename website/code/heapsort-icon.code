<table width="100%" border="0" cellpadding="5" cellspacing="0"><tr><td bgcolor="#FFFFFF"><pre>
<I><FONT COLOR="#B22222"># -*- mode: icon -*-
</FONT></I><I><FONT COLOR="#B22222"># $Id: heapsort-icon.code,v 1.1 2004-11-02 08:52:32 bfulgham Exp $
</FONT></I><I><FONT COLOR="#B22222"># http://www.bagley.org/~doug/shootout/
</FONT></I>
$define IM 139968
$define IA 3877
$define IC 29573

<B><FONT COLOR="#A020F0">procedure </FONT></B><B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">gen_random</FONT></I></B></FONT></B>(max)
    <B><FONT COLOR="#5F9EA0">static</FONT></B> LAST; <B><FONT COLOR="#5F9EA0">initial</FONT></B> LAST <B><FONT COLOR="#5F9EA0">:=</FONT></B> 42;
    <B><FONT COLOR="#A020F0">repeat</FONT></B> { <B><FONT COLOR="#5F9EA0">suspend</FONT></B>((max <B><FONT COLOR="#5F9EA0">*</FONT></B> (LAST <B><FONT COLOR="#5F9EA0">:=</FONT></B> (LAST <B><FONT COLOR="#5F9EA0">*</FONT></B> IA <B><FONT COLOR="#5F9EA0">+</FONT></B> IC) % IM)) <B><FONT COLOR="#5F9EA0">/</FONT></B> IM) }
<B><FONT COLOR="#A020F0">end</FONT></B>

<B><FONT COLOR="#A020F0">procedure </FONT></B><B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">heapsort</FONT></I></B></FONT></B>(n, ra)
    <B><FONT COLOR="#5F9EA0">local</FONT></B> l, j, ir, i, rra

    l <B><FONT COLOR="#5F9EA0">:=</FONT></B> <B><FONT COLOR="#A020F0">ishift</FONT></B>(n, <B><FONT COLOR="#5F9EA0">-</FONT></B>1) <B><FONT COLOR="#5F9EA0">+</FONT></B> 1
    ir <B><FONT COLOR="#5F9EA0">:=</FONT></B> n
    <B><FONT COLOR="#A020F0">repeat</FONT></B> {
        <B><FONT COLOR="#A020F0">if</FONT></B> (l <B><FONT COLOR="#5F9EA0">&gt;</FONT></B> 1) <B><FONT COLOR="#A020F0">then</FONT></B> {
	    l <B><FONT COLOR="#5F9EA0">:=</FONT></B> l <B><FONT COLOR="#5F9EA0">-</FONT></B> 1
            rra <B><FONT COLOR="#5F9EA0">:=</FONT></B> ra[l]
        } <B><FONT COLOR="#A020F0">else</FONT></B> {
            rra <B><FONT COLOR="#5F9EA0">:=</FONT></B> ra[ir]
            ra[ir] <B><FONT COLOR="#5F9EA0">:=</FONT></B> ra[1]
	    ir <B><FONT COLOR="#5F9EA0">:=</FONT></B> ir <B><FONT COLOR="#5F9EA0">-</FONT></B> 1
            <B><FONT COLOR="#A020F0">if</FONT></B> (ir <B><FONT COLOR="#5F9EA0">==</FONT></B> 1) <B><FONT COLOR="#A020F0">then</FONT></B> {
                ra[1] <B><FONT COLOR="#5F9EA0">:=</FONT></B> rra
                <B><FONT COLOR="#A020F0">return</FONT></B>
            }
        }
        i <B><FONT COLOR="#5F9EA0">:=</FONT></B> l
        j <B><FONT COLOR="#5F9EA0">:=</FONT></B> <B><FONT COLOR="#A020F0">ishift</FONT></B>(l, 1)
        <B><FONT COLOR="#A020F0">while</FONT></B> (j <B><FONT COLOR="#5F9EA0">&lt;=</FONT></B> ir) <B><FONT COLOR="#A020F0">do</FONT></B> {
            <B><FONT COLOR="#A020F0">if</FONT></B> ((j &lt; ir) &amp; (ra[j] &lt; ra[j<B><FONT COLOR="#5F9EA0">+</FONT></B>1])) <B><FONT COLOR="#A020F0">then</FONT></B> {
		j <B><FONT COLOR="#5F9EA0">:=</FONT></B> j <B><FONT COLOR="#5F9EA0">+</FONT></B> 1
	    }
            <B><FONT COLOR="#A020F0">if</FONT></B> (rra &lt; ra[j]) <B><FONT COLOR="#A020F0">then</FONT></B> {
                ra[i] <B><FONT COLOR="#5F9EA0">:=</FONT></B> ra[j]
		i <B><FONT COLOR="#5F9EA0">:=</FONT></B> j
                j <B><FONT COLOR="#5F9EA0">:=</FONT></B> j <B><FONT COLOR="#5F9EA0">+</FONT></B> i
            } <B><FONT COLOR="#A020F0">else</FONT></B> {
                j <B><FONT COLOR="#5F9EA0">:=</FONT></B> ir <B><FONT COLOR="#5F9EA0">+</FONT></B> 1
            }
        }
        ra[i] <B><FONT COLOR="#5F9EA0">:=</FONT></B> rra
    }
<B><FONT COLOR="#A020F0">end</FONT></B>

<B><FONT COLOR="#A020F0">procedure </FONT></B><B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">main</FONT></I></B></FONT></B>(argv)
    n <B><FONT COLOR="#5F9EA0">:=</FONT></B> argv[1] <B><FONT COLOR="#5F9EA0">|</FONT></B> 1
    ary <B><FONT COLOR="#5F9EA0">:=</FONT></B> <B><FONT COLOR="#A020F0">list</FONT></B>(n)
    <B><FONT COLOR="#A020F0">every</FONT></B> i <B><FONT COLOR="#5F9EA0">:=</FONT></B> 1 <B><FONT COLOR="#A020F0">to</FONT></B> n <B><FONT COLOR="#A020F0">do</FONT></B> ary[i] <B><FONT COLOR="#5F9EA0">:=</FONT></B> gen_random(1.0)
    heapsort(n, ary)
    <B><FONT COLOR="#A020F0">write</FONT></B>(ary[n])
<B><FONT COLOR="#A020F0">end</FONT></B>
</pre></td></tr></table>
