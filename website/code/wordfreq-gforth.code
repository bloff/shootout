<table width="100%" border="0" cellpadding="5" cellspacing="0"><tr><td bgcolor="#FFFFFF"><pre>
<I><FONT COLOR="#B22222">\ -*- mode: forth -*-
</FONT></I><I><FONT COLOR="#B22222">\ $Id: wordfreq-gforth.code,v 1.1 2004-11-02 08:53:33 bfulgham Exp $
</FONT></I><I><FONT COLOR="#B22222">\ http://www.bagley.org/~doug/shootout/
</FONT></I><I><FONT COLOR="#B22222">\ from Anton Ertl:
</FONT></I>
wordlist <B><FONT COLOR="#A020F0">constant</FONT></B> word<B><FONT COLOR="#5F9EA0">-</FONT></B>counts
create word<B><FONT COLOR="#5F9EA0">-</FONT></B>pointers 10000 cells allot
<B><FONT COLOR="#A020F0">variable</FONT></B> endwp word<B><FONT COLOR="#5F9EA0">-</FONT></B>pointers endwp <B><FONT COLOR="#5F9EA0">!</FONT></B>
1024 <B><FONT COLOR="#A020F0">constant</FONT></B> <B><FONT COLOR="#A020F0">max</FONT></B><B><FONT COLOR="#5F9EA0">-</FONT></B>line
create line <B><FONT COLOR="#A020F0">max</FONT></B><B><FONT COLOR="#5F9EA0">-</FONT></B>line 2 <B><FONT COLOR="#5F9EA0">+</FONT></B> allot

struct
    <B><FONT COLOR="#228B22">cell</FONT></B>% field    wf<B><FONT COLOR="#5F9EA0">-</FONT></B>count
    <B><FONT COLOR="#228B22">cell</FONT></B>% 2<B><FONT COLOR="#5F9EA0">*</FONT></B> field wf<B><FONT COLOR="#5F9EA0">-</FONT></B>name
<B><FONT COLOR="#A020F0">end</FONT></B><B><FONT COLOR="#5F9EA0">-</FONT></B>struct wf%

<B><FONT COLOR="#A020F0">: </FONT></B><B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">count-word</FONT></I></B></FONT></B> ( addr u <B><FONT COLOR="#5F9EA0">-</FONT></B><B><FONT COLOR="#5F9EA0">-</FONT></B> )
    <B><FONT COLOR="#5F9EA0">2dup</FONT></B> word<B><FONT COLOR="#5F9EA0">-</FONT></B>counts search<B><FONT COLOR="#5F9EA0">-</FONT></B>wordlist <B><FONT COLOR="#A020F0">if</FONT></B>
	1 <B><FONT COLOR="#5F9EA0">swap</FONT></B> <B><FONT COLOR="#5F9EA0">&gt;</FONT></B>body <B><FONT COLOR="#5F9EA0">+</FONT></B><B><FONT COLOR="#5F9EA0">!</FONT></B> <B><FONT COLOR="#5F9EA0">2drop</FONT></B>
    <B><FONT COLOR="#A020F0">else</FONT></B>
	nextname get<B><FONT COLOR="#5F9EA0">-</FONT></B>current word<B><FONT COLOR="#5F9EA0">-</FONT></B>counts set<B><FONT COLOR="#5F9EA0">-</FONT></B>current create set<B><FONT COLOR="#5F9EA0">-</FONT></B>current
	<B><FONT COLOR="#A020F0">here</FONT></B> endwp @ <B><FONT COLOR="#5F9EA0">tuck</FONT></B> <B><FONT COLOR="#5F9EA0">!</FONT></B> <B><FONT COLOR="#228B22">cell</FONT></B><B><FONT COLOR="#5F9EA0">+</FONT></B> endwp <B><FONT COLOR="#5F9EA0">!</FONT></B>
	1 , last @ name<B><FONT COLOR="#5F9EA0">&gt;</FONT></B>string 2,
    <B><FONT COLOR="#A020F0">endif</FONT></B> ;

<B><FONT COLOR="#A020F0">: </FONT></B><B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">no-letter?</FONT></I></B></FONT></B> ( c <B><FONT COLOR="#5F9EA0">-</FONT></B><B><FONT COLOR="#5F9EA0">-</FONT></B> )
    <B><FONT COLOR="#5F9EA0">dup</FONT></B> 'a &lt; <B><FONT COLOR="#5F9EA0">swap</FONT></B> 'z <B><FONT COLOR="#5F9EA0">&gt;</FONT></B> <B><FONT COLOR="#A020F0">or</FONT></B> ; 

<B><FONT COLOR="#A020F0">: </FONT></B><B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">process-word</FONT></I></B></FONT></B> ( start <B><FONT COLOR="#A020F0">end</FONT></B> <B><FONT COLOR="#5F9EA0">-</FONT></B><B><FONT COLOR="#5F9EA0">-</FONT></B> )
    <B><FONT COLOR="#5F9EA0">2dup</FONT></B> u&lt; <B><FONT COLOR="#A020F0">if</FONT></B>
	<B><FONT COLOR="#5F9EA0">over</FONT></B> <B><FONT COLOR="#5F9EA0">-</FONT></B> count<B><FONT COLOR="#5F9EA0">-</FONT></B>word
    <B><FONT COLOR="#A020F0">else</FONT></B>
	<B><FONT COLOR="#5F9EA0">2drop</FONT></B>
    <B><FONT COLOR="#A020F0">endif</FONT></B> ;

<B><FONT COLOR="#A020F0">: </FONT></B><B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">process-line</FONT></I></B></FONT></B> ( addr u <B><FONT COLOR="#5F9EA0">-</FONT></B><B><FONT COLOR="#5F9EA0">-</FONT></B> )
    bounds <B><FONT COLOR="#5F9EA0">2dup</FONT></B> ?<B><FONT COLOR="#A020F0">do</FONT></B> ( <B><FONT COLOR="#A020F0">end</FONT></B> wordstart )
	i c@ $20 <B><FONT COLOR="#A020F0">or</FONT></B> <B><FONT COLOR="#5F9EA0">dup</FONT></B> i c<B><FONT COLOR="#5F9EA0">!</FONT></B> ( <B><FONT COLOR="#A020F0">end</FONT></B> wordstart c )
	no<B><FONT COLOR="#5F9EA0">-</FONT></B>letter? <B><FONT COLOR="#A020F0">if</FONT></B> ( <B><FONT COLOR="#A020F0">end</FONT></B> wordstart )
	    i process<B><FONT COLOR="#5F9EA0">-</FONT></B>word  i 1<B><FONT COLOR="#5F9EA0">+</FONT></B> 
	<B><FONT COLOR="#A020F0">endif</FONT></B>
    <B><FONT COLOR="#A020F0">loop</FONT></B> ( <B><FONT COLOR="#A020F0">end</FONT></B> wordstart )
    <B><FONT COLOR="#5F9EA0">swap</FONT></B> process<B><FONT COLOR="#5F9EA0">-</FONT></B>word ;

<B><FONT COLOR="#A020F0">: </FONT></B><B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">process-file</FONT></I></B></FONT></B> ( fid <B><FONT COLOR="#5F9EA0">-</FONT></B><B><FONT COLOR="#5F9EA0">-</FONT></B> )
    <B><FONT COLOR="#5F9EA0">&gt;</FONT></B>r <B><FONT COLOR="#A020F0">begin</FONT></B>
	line <B><FONT COLOR="#A020F0">max</FONT></B><B><FONT COLOR="#5F9EA0">-</FONT></B>line r@ read<B><FONT COLOR="#5F9EA0">-</FONT></B>line <B><FONT COLOR="#5F9EA0">throw</FONT></B>
    <B><FONT COLOR="#A020F0">while</FONT></B>
	line <B><FONT COLOR="#5F9EA0">swap</FONT></B> process<B><FONT COLOR="#5F9EA0">-</FONT></B>line
    <B><FONT COLOR="#A020F0">repeat</FONT></B>
    rdrop ;

<B><FONT COLOR="#A020F0">: </FONT></B><B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">output</FONT></I></B></FONT></B> ( <B><FONT COLOR="#5F9EA0">-</FONT></B><B><FONT COLOR="#5F9EA0">-</FONT></B> )
    endwp @ word<B><FONT COLOR="#5F9EA0">-</FONT></B>pointers ?<B><FONT COLOR="#A020F0">do</FONT></B>
	i @ <B><FONT COLOR="#5F9EA0">dup</FONT></B> wf<B><FONT COLOR="#5F9EA0">-</FONT></B>count @ 7 .r #tab emit wf<B><FONT COLOR="#5F9EA0">-</FONT></B>name 2@ type cr
    <B><FONT COLOR="#228B22">cell</FONT></B> <B><FONT COLOR="#5F9EA0">+</FONT></B><B><FONT COLOR="#A020F0">loop</FONT></B> ;

<B><FONT COLOR="#A020F0">: </FONT></B><B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">wf&lt;</FONT></I></B></FONT></B> ( wf1 wf2 <B><FONT COLOR="#5F9EA0">-</FONT></B><B><FONT COLOR="#5F9EA0">-</FONT></B> f )
    <B><FONT COLOR="#5F9EA0">over</FONT></B> wf<B><FONT COLOR="#5F9EA0">-</FONT></B>count @ <B><FONT COLOR="#5F9EA0">over</FONT></B> wf<B><FONT COLOR="#5F9EA0">-</FONT></B>count @ <B><FONT COLOR="#5F9EA0">2dup</FONT></B> = <B><FONT COLOR="#A020F0">if</FONT></B>
	<B><FONT COLOR="#5F9EA0">2drop</FONT></B> <B><FONT COLOR="#5F9EA0">&gt;</FONT></B>r wf<B><FONT COLOR="#5F9EA0">-</FONT></B>name 2@ r<B><FONT COLOR="#5F9EA0">&gt;</FONT></B> wf<B><FONT COLOR="#5F9EA0">-</FONT></B>name 2@ compare 0<B><FONT COLOR="#5F9EA0">&gt;</FONT></B>
    <B><FONT COLOR="#A020F0">else</FONT></B>
	u<B><FONT COLOR="#5F9EA0">&gt;</FONT></B> <B><FONT COLOR="#5F9EA0">nip</FONT></B> <B><FONT COLOR="#5F9EA0">nip</FONT></B>
    <B><FONT COLOR="#A020F0">endif</FONT></B> ;

(field) <B><FONT COLOR="#228B22">cell</FONT></B><B><FONT COLOR="#5F9EA0">-</FONT></B> <B><FONT COLOR="#5F9EA0">-</FONT></B>1 cells ,

<B><FONT COLOR="#A020F0">: </FONT></B><B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">partition</FONT></I></B></FONT></B> ( first last lessthan<B><FONT COLOR="#5F9EA0">-</FONT></B>xt <B><FONT COLOR="#5F9EA0">-</FONT></B><B><FONT COLOR="#5F9EA0">-</FONT></B> middle )
    <I><FONT COLOR="#B22222">\ partition array addr1 u1 into all elements less than pivot and all
</FONT></I>    <I><FONT COLOR="#B22222">\ others, addr1 u2 and addr3 u3 are the two partitions.
</FONT></I>    <I><FONT COLOR="#B22222">\ lessthan-xt ( elemptr1 elemptr2 -- f ) compares the two elements
</FONT></I>    { lessthan<B><FONT COLOR="#5F9EA0">-</FONT></B>xt }
    <B><FONT COLOR="#5F9EA0">over</FONT></B> @ { pivot }
    <B><FONT COLOR="#A020F0">begin</FONT></B> ( i j )
	<B><FONT COLOR="#5F9EA0">2dup</FONT></B> u&lt;
    <B><FONT COLOR="#A020F0">while</FONT></B>
	<B><FONT COLOR="#A020F0">begin</FONT></B>
	    pivot <B><FONT COLOR="#5F9EA0">over</FONT></B> @ lessthan<B><FONT COLOR="#5F9EA0">-</FONT></B>xt execute
	<B><FONT COLOR="#A020F0">while</FONT></B>
	    <B><FONT COLOR="#228B22">cell</FONT></B><B><FONT COLOR="#5F9EA0">-</FONT></B>
	<B><FONT COLOR="#A020F0">repeat</FONT></B>
	<B><FONT COLOR="#5F9EA0">swap</FONT></B> <B><FONT COLOR="#5F9EA0">over</FONT></B> @ <B><FONT COLOR="#5F9EA0">over</FONT></B> <B><FONT COLOR="#5F9EA0">!</FONT></B>
	<B><FONT COLOR="#A020F0">begin</FONT></B> ( j i )
	    <B><FONT COLOR="#5F9EA0">2dup</FONT></B> u<B><FONT COLOR="#5F9EA0">&gt;</FONT></B>
	<B><FONT COLOR="#A020F0">while</FONT></B>
	    pivot <B><FONT COLOR="#5F9EA0">over</FONT></B> @ lessthan<B><FONT COLOR="#5F9EA0">-</FONT></B>xt execute 0=
	<B><FONT COLOR="#A020F0">while</FONT></B>
	    <B><FONT COLOR="#228B22">cell</FONT></B><B><FONT COLOR="#5F9EA0">+</FONT></B>
	<B><FONT COLOR="#A020F0">repeat</FONT></B> <B><FONT COLOR="#A020F0">then</FONT></B>
	<B><FONT COLOR="#5F9EA0">swap</FONT></B> <B><FONT COLOR="#5F9EA0">over</FONT></B> @ <B><FONT COLOR="#5F9EA0">over</FONT></B> <B><FONT COLOR="#5F9EA0">!</FONT></B>
    <B><FONT COLOR="#A020F0">repeat</FONT></B>
    <B><FONT COLOR="#5F9EA0">drop</FONT></B> pivot <B><FONT COLOR="#5F9EA0">over</FONT></B> <B><FONT COLOR="#5F9EA0">!</FONT></B> ;

<B><FONT COLOR="#A020F0">: </FONT></B><B><FONT COLOR="#0000FF"><B><I><FONT COLOR="#000000">sort1</FONT></I></B></FONT></B> ( first last lesstthan<B><FONT COLOR="#5F9EA0">-</FONT></B>xt <B><FONT COLOR="#5F9EA0">-</FONT></B><B><FONT COLOR="#5F9EA0">-</FONT></B> ) recursive
    <B><FONT COLOR="#5F9EA0">&gt;</FONT></B>r <B><FONT COLOR="#A020F0">begin</FONT></B>
	<B><FONT COLOR="#5F9EA0">2dup</FONT></B> u&lt;
    <B><FONT COLOR="#A020F0">while</FONT></B>
	<B><FONT COLOR="#5F9EA0">2dup</FONT></B> r@ partition ( first last middle )
	<B><FONT COLOR="#5F9EA0">rot</FONT></B> <B><FONT COLOR="#5F9EA0">over</FONT></B> <B><FONT COLOR="#228B22">cell</FONT></B><B><FONT COLOR="#5F9EA0">-</FONT></B> r@ sort1
	<B><FONT COLOR="#228B22">cell</FONT></B><B><FONT COLOR="#5F9EA0">+</FONT></B> <B><FONT COLOR="#5F9EA0">swap</FONT></B>
    <B><FONT COLOR="#A020F0">repeat</FONT></B>
    rdrop <B><FONT COLOR="#5F9EA0">2drop</FONT></B> ;

stdin process<B><FONT COLOR="#5F9EA0">-</FONT></B>file word<B><FONT COLOR="#5F9EA0">-</FONT></B>pointers endwp @ <B><FONT COLOR="#228B22">cell</FONT></B><B><FONT COLOR="#5F9EA0">-</FONT></B> ' wf&lt; sort1 output <B><FONT COLOR="#5F9EA0">bye</FONT></B></pre></td></tr></table>
