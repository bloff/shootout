<span class="hl slc">## The Computer Language Benchmarks Game</span>
<span class="hl slc">## http://shootout.alioth.debian.org/</span>
<span class="hl slc">## contributed by Mark Smithfield,</span>
<span class="hl slc">## tiny modification by Andrew McParland</span>

<span class="hl kwa">proc</span> bump <span class="hl sym">{</span> next_thread msg <span class="hl sym">} {</span>
	<span class="hl kwa">if</span> <span class="hl sym">{</span> <span class="hl kwb">$next_thread</span> <span class="hl sym">==</span> <span class="hl num">0</span>  <span class="hl sym">} {</span> <span class="hl kwa">expr</span> <span class="hl sym">{</span><span class="hl kwb">$msg</span><span class="hl sym">} }</span> else <span class="hl sym">{</span>
		<span class="hl kwb">$next_thread</span> <span class="hl kwa">eval</span> <span class="hl sym">[</span><span class="hl kwa">list</span> bump <span class="hl sym">[</span><span class="hl kwa">expr</span> <span class="hl sym">{</span><span class="hl kwb">$msg</span><span class="hl sym">+</span><span class="hl num">1</span><span class="hl sym">}]]</span>
	<span class="hl sym">}</span>
<span class="hl sym">}</span>
<span class="hl kwa">set</span> N <span class="hl sym">[</span><span class="hl kwa">lindex</span> <span class="hl kwb">$argv</span> <span class="hl num">0</span><span class="hl sym">]</span>
<span class="hl kwa">interp</span> recursionlimit <span class="hl sym">{}</span> <span class="hl num">1024</span>
<span class="hl kwa">for</span> <span class="hl sym">{</span><span class="hl kwa">set</span> i <span class="hl num">0</span><span class="hl sym">} {</span><span class="hl kwb">$i</span> <span class="hl sym">&lt;</span> <span class="hl num">500</span><span class="hl sym">} {</span><span class="hl kwa">incr</span> i<span class="hl sym">} {</span>
	<span class="hl kwa">interp</span> create <span class="hl sym">-</span>safe thread<span class="hl sym">-</span><span class="hl kwb">$i</span>
	<span class="hl kwa">interp</span> alias thread<span class="hl sym">-</span><span class="hl kwb">$i</span> bump <span class="hl sym">{}</span> bump thread<span class="hl sym">-[</span><span class="hl kwa">expr</span> <span class="hl sym">{</span><span class="hl kwb">$i</span><span class="hl sym">+</span><span class="hl num">1</span><span class="hl sym">}]</span>
<span class="hl sym">}</span>
<span class="hl kwa">interp</span> alias thread<span class="hl sym">-[</span><span class="hl kwa">expr</span> <span class="hl sym">{</span><span class="hl kwb">$i</span><span class="hl sym">-</span><span class="hl num">1</span><span class="hl sym">}]</span> bump <span class="hl sym">{}</span> bump <span class="hl num">0</span>
<span class="hl kwa">set</span> cc <span class="hl num">0</span>
<span class="hl kwa">for</span> <span class="hl sym">{</span><span class="hl kwa">set</span> i <span class="hl num">0</span><span class="hl sym">} {</span><span class="hl kwb">$i</span> <span class="hl sym">&lt;</span> <span class="hl kwb">$N</span><span class="hl sym">} {</span><span class="hl kwa">incr</span> i<span class="hl sym">} {</span><span class="hl kwa">incr</span> cc <span class="hl sym">[</span>bump thread<span class="hl sym">-</span><span class="hl num">0 0</span><span class="hl sym">]}</span>
<span class="hl kwa">puts</span> <span class="hl kwb">$cc</span>
