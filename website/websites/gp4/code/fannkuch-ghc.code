<span class="com">{-# OPTIONS -O2 -optc-O3 #-}</span>
<span class="slc">-- The Great Computer Language Shootout</span>
<span class="slc">-- http://shootout.alioth.debian.org/</span>
<span class="slc">-- written by Bertram Felgenhauer, Don Stewart, Matthias Neubauer, Josh Goldfoot and David Place.</span>

<span class="kwa">import</span> System
<span class="kwa">import</span> Data.List

rotate <span class="num">2</span> <span class="sym">(</span>x1<span class="sym">:</span>x2<span class="sym">:</span>xs<span class="sym">) =</span> x2<span class="sym">:</span>x1<span class="sym">:</span>xs
rotate <span class="num">3</span> <span class="sym">(</span>x1<span class="sym">:</span>x2<span class="sym">:</span>x3<span class="sym">:</span>xs<span class="sym">) =</span> x2<span class="sym">:</span>x3<span class="sym">:</span>x1<span class="sym">:</span>xs
rotate <span class="num">4</span> <span class="sym">(</span>x1<span class="sym">:</span>x2<span class="sym">:</span>x3<span class="sym">:</span>x4<span class="sym">:</span>xs<span class="sym">) =</span> x2<span class="sym">:</span>x3<span class="sym">:</span>x4<span class="sym">:</span>x1<span class="sym">:</span>xs
rotate <span class="num">5</span> <span class="sym">(</span>x1<span class="sym">:</span>x2<span class="sym">:</span>x3<span class="sym">:</span>x4<span class="sym">:</span>x5<span class="sym">:</span>xs<span class="sym">) =</span> x2<span class="sym">:</span>x3<span class="sym">:</span>x4<span class="sym">:</span>x5<span class="sym">:</span>x1<span class="sym">:</span>xs
rotate <span class="num">6</span> <span class="sym">(</span>x1<span class="sym">:</span>x2<span class="sym">:</span>x3<span class="sym">:</span>x4<span class="sym">:</span>x5<span class="sym">:</span>x6<span class="sym">:</span>xs<span class="sym">) =</span> x2<span class="sym">:</span>x3<span class="sym">:</span>x4<span class="sym">:</span>x5<span class="sym">:</span>x6<span class="sym">:</span>x1<span class="sym">:</span>xs
rotate <span class="num">7</span> <span class="sym">(</span>x1<span class="sym">:</span>x2<span class="sym">:</span>x3<span class="sym">:</span>x4<span class="sym">:</span>x5<span class="sym">:</span>x6<span class="sym">:</span>x7<span class="sym">:</span>xs<span class="sym">) =</span> x2<span class="sym">:</span>x3<span class="sym">:</span>x4<span class="sym">:</span>x5<span class="sym">:</span>x6<span class="sym">:</span>x7<span class="sym">:</span>x1<span class="sym">:</span>xs
rotate <span class="num">8</span> <span class="sym">(</span>x1<span class="sym">:</span>x2<span class="sym">:</span>x3<span class="sym">:</span>x4<span class="sym">:</span>x5<span class="sym">:</span>x6<span class="sym">:</span>x7<span class="sym">:</span>x8<span class="sym">:</span>xs<span class="sym">) =</span> x2<span class="sym">:</span>x3<span class="sym">:</span>x4<span class="sym">:</span>x5<span class="sym">:</span>x6<span class="sym">:</span>x7<span class="sym">:</span>x8<span class="sym">:</span>x1<span class="sym">:</span>xs
rotate <span class="num">9</span> <span class="sym">(</span>x1<span class="sym">:</span>x2<span class="sym">:</span>x3<span class="sym">:</span>x4<span class="sym">:</span>x5<span class="sym">:</span>x6<span class="sym">:</span>x7<span class="sym">:</span>x8<span class="sym">:</span>x9<span class="sym">:</span>xs<span class="sym">) =</span> x2<span class="sym">:</span>x3<span class="sym">:</span>x4<span class="sym">:</span>x5<span class="sym">:</span>x6<span class="sym">:</span>x7<span class="sym">:</span>x8<span class="sym">:</span>x9<span class="sym">:</span>x1<span class="sym">:</span>xs
rotate <span class="num">10</span> <span class="sym">(</span>x1<span class="sym">:</span>x2<span class="sym">:</span>x3<span class="sym">:</span>x4<span class="sym">:</span>x5<span class="sym">:</span>x6<span class="sym">:</span>x7<span class="sym">:</span>x8<span class="sym">:</span>x9<span class="sym">:</span>x10<span class="sym">:</span>xs<span class="sym">) =</span> x2<span class="sym">:</span>x3<span class="sym">:</span>x4<span class="sym">:</span>x5<span class="sym">:</span>x6<span class="sym">:</span>x7<span class="sym">:</span>x8<span class="sym">:</span>x9<span class="sym">:</span>x10<span class="sym">:</span>x1<span class="sym">:</span>xs
rotate n <span class="sym">(</span>x<span class="sym">:</span>xs<span class="sym">) =</span> rotate<span class="str">' n xs</span>
<span class="str">    where rotate'</span> <span class="num">1</span> xs     <span class="sym">=</span> x<span class="sym">:</span>xs
          rotate<span class="str">' n (x:xs) = x:rotate'</span> <span class="sym">(</span>n<span class="sym">-</span><span class="num">1</span><span class="sym">)</span> xs

permutations l <span class="sym">=</span> foldr permutations<span class="str">' [l] [2..length l]</span>
<span class="str">    where permutations'</span> n <span class="sym">=</span> foldr <span class="sym">(</span>takeIter n <span class="sym">(</span>rotate n<span class="sym">)) []</span>

takeIter <span class="num">0</span> f x rest <span class="sym">=</span> rest
takeIter n f x rest <span class="sym">=</span> x <span class="sym">:</span> takeIter <span class="sym">(</span>n<span class="sym">-</span><span class="num">1</span><span class="sym">::</span><span class="kwb">Int</span><span class="sym">)</span> f <span class="sym">(</span>f x<span class="sym">)</span> rest

flop <span class="sym">::</span> <span class="kwb">Int</span> <span class="sym">-&gt; [</span><span class="kwb">Int</span><span class="sym">] -&gt; (</span><span class="kwb">Int</span><span class="sym">, [</span><span class="kwb">Int</span><span class="sym">])</span>
flop <span class="num">2</span>  <span class="sym">(</span>x2<span class="sym">:</span>xs<span class="sym">) = (</span>x2<span class="sym">,</span> <span class="num">2</span><span class="sym">:</span>xs<span class="sym">)</span>
flop <span class="num">3</span>  <span class="sym">(</span>x2<span class="sym">:</span>x3<span class="sym">:</span>xs<span class="sym">) = (</span>x3<span class="sym">,</span> x2<span class="sym">:</span><span class="num">3</span><span class="sym">:</span>xs<span class="sym">)</span>
flop <span class="num">4</span>  <span class="sym">(</span>x2<span class="sym">:</span>x3<span class="sym">:</span>x4<span class="sym">:</span>xs<span class="sym">) = (</span>x4<span class="sym">,</span> x3<span class="sym">:</span>x2<span class="sym">:</span><span class="num">4</span><span class="sym">:</span>xs<span class="sym">)</span>
flop <span class="num">5</span>  <span class="sym">(</span>x2<span class="sym">:</span>x3<span class="sym">:</span>x4<span class="sym">:</span>x5<span class="sym">:</span>xs<span class="sym">) = (</span>x5<span class="sym">,</span> x4<span class="sym">:</span>x3<span class="sym">:</span>x2<span class="sym">:</span><span class="num">5</span><span class="sym">:</span>xs<span class="sym">)</span>
flop <span class="num">6</span>  <span class="sym">(</span>x2<span class="sym">:</span>x3<span class="sym">:</span>x4<span class="sym">:</span>x5<span class="sym">:</span>x6<span class="sym">:</span>xs<span class="sym">) = (</span>x6<span class="sym">,</span> x5<span class="sym">:</span>x4<span class="sym">:</span>x3<span class="sym">:</span>x2<span class="sym">:</span><span class="num">6</span><span class="sym">:</span>xs<span class="sym">)</span>
flop <span class="num">7</span>  <span class="sym">(</span>x2<span class="sym">:</span>x3<span class="sym">:</span>x4<span class="sym">:</span>x5<span class="sym">:</span>x6<span class="sym">:</span>x7<span class="sym">:</span>xs<span class="sym">) = (</span>x7<span class="sym">,</span> x6<span class="sym">:</span>x5<span class="sym">:</span>x4<span class="sym">:</span>x3<span class="sym">:</span>x2<span class="sym">:</span><span class="num">7</span><span class="sym">:</span>xs<span class="sym">)</span>
flop <span class="num">8</span>  <span class="sym">(</span>x2<span class="sym">:</span>x3<span class="sym">:</span>x4<span class="sym">:</span>x5<span class="sym">:</span>x6<span class="sym">:</span>x7<span class="sym">:</span>x8<span class="sym">:</span>xs<span class="sym">) = (</span>x8<span class="sym">,</span> x7<span class="sym">:</span>x6<span class="sym">:</span>x5<span class="sym">:</span>x4<span class="sym">:</span>x3<span class="sym">:</span>x2<span class="sym">:</span><span class="num">8</span><span class="sym">:</span>xs<span class="sym">)</span>
flop <span class="num">9</span>  <span class="sym">(</span>x2<span class="sym">:</span>x3<span class="sym">:</span>x4<span class="sym">:</span>x5<span class="sym">:</span>x6<span class="sym">:</span>x7<span class="sym">:</span>x8<span class="sym">:</span>x9<span class="sym">:</span>xs<span class="sym">) = (</span>x9<span class="sym">,</span> x8<span class="sym">:</span>x7<span class="sym">:</span>x6<span class="sym">:</span>x5<span class="sym">:</span>x4<span class="sym">:</span>x3<span class="sym">:</span>x2<span class="sym">:</span><span class="num">9</span><span class="sym">:</span>xs<span class="sym">)</span>
flop <span class="num">10</span> <span class="sym">(</span>x2<span class="sym">:</span>x3<span class="sym">:</span>x4<span class="sym">:</span>x5<span class="sym">:</span>x6<span class="sym">:</span>x7<span class="sym">:</span>x8<span class="sym">:</span>x9<span class="sym">:</span>x10<span class="sym">:</span>xs<span class="sym">) = (</span>x10<span class="sym">,</span>x9<span class="sym">:</span>x8<span class="sym">:</span>x7<span class="sym">:</span>x6<span class="sym">:</span>x5<span class="sym">:</span>x4<span class="sym">:</span>x3<span class="sym">:</span>x2<span class="sym">:</span><span class="num">10</span><span class="sym">:</span>xs<span class="sym">)</span>
flop n xs <span class="sym">=</span> rs
  <span class="kwa">where</span> <span class="sym">(</span>rs<span class="sym">,</span> ys<span class="sym">)          =</span> flop<span class="str">' n xs ys</span>
<span class="str">        flop'</span> <span class="num">2</span> <span class="sym">(</span>x<span class="sym">:</span>xs<span class="sym">)</span> ys <span class="sym">= ((</span>x<span class="sym">,</span> ys<span class="sym">),</span> n<span class="sym">:</span>xs<span class="sym">)</span>
        flop<span class="str">' n (x:xs) ys = flop'</span> <span class="sym">(</span>n<span class="sym">-</span><span class="num">1</span><span class="sym">)</span> xs <span class="sym">(</span>x<span class="sym">:</span>ys<span class="sym">)</span>

steps <span class="sym">::</span> <span class="kwb">Int</span> <span class="sym">-&gt; [</span><span class="kwb">Int</span><span class="sym">] -&gt;</span> <span class="kwb">Int</span>
steps n    <span class="sym">(</span>a<span class="sym">:</span><span class="kwa">as</span><span class="sym">) =</span> steps<span class="str">' n (a,as)</span>
<span class="str"></span>
<span class="str">steps'</span> n <span class="sym">(</span><span class="num">1</span><span class="sym">,</span>_<span class="sym">)  =</span> n
steps<span class="str">' n (t,ts) = steps'</span> <span class="sym">(</span>n<span class="sym">+</span><span class="num">1</span><span class="sym">) (</span>flop t ts<span class="sym">)</span>

main <span class="sym">=</span> <span class="kwa">do</span> n <span class="sym">&lt;-</span> getArgs <span class="sym">&gt;&gt;=</span> return . read . head
          <span class="kwa">let</span> p <span class="sym">=</span> permutations <span class="sym">[</span><span class="num">1</span>..n<span class="sym">]</span>
          mapM_ <span class="sym">(</span>putStrLn . concatMap show<span class="sym">)</span> $ take <span class="num">30</span> p
          putStr $ <span class="str">&quot;Pfannkuchen(&quot;</span> <span class="sym">++</span> show n <span class="sym">++</span> <span class="str">&quot;) = &quot;</span>
          putStrLn . show $ foldl<span class="str">' (flip (max . steps 0)) 0 p</span>
