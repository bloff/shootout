<span class="slc">;;; $Id: random-chicken-2.code,v 1.7 2005-11-02 01:28:21 igouy-guest Exp $
</span><span class="slc">;;; http://www.bagley.org/~doug/shootout/
</span>
<span class="slc">;; compile: csc random.chicken -O3 -d0 -disable-interrupts -block -lambda-lift -o random
</span>
<span class="sym">(</span>define<span class="sym">-</span>constant IM   <span class="num">139968</span><span class="sym">)
(</span>define<span class="sym">-</span>constant IA     <span class="num">3877</span><span class="sym">)
(</span>define<span class="sym">-</span>constant IC    <span class="num">29573</span><span class="sym">)

(</span>define LAST <span class="num">42</span><span class="sym">)

(</span>define SCALE <span class="num">1000000000.0</span><span class="sym">)

(</span>define <span class="sym">(</span>gen<span class="sym">-</span>random <span class="kwa">max</span><span class="sym">)
  (</span><span class="kwa">set</span><span class="sym">!</span> LAST <span class="sym">(</span>fxmod <span class="sym">(</span>fx<span class="sym">+ (*</span> LAST IA<span class="sym">)</span> IC<span class="sym">)</span> IM<span class="sym">))
  (</span>fp<span class="sym">/ (</span>fp<span class="sym">*</span> <span class="kwa">max</span> <span class="sym">(</span>exact<span class="sym">-&gt;</span>inexact LAST<span class="sym">)) (</span>exact<span class="sym">-&gt;</span>inexact IM<span class="sym">)))

(</span>define <span class="sym">(</span>main args<span class="sym">)
  (</span>let <span class="sym">((</span>n <span class="sym">(</span><span class="kwa">or</span> <span class="sym">(</span><span class="kwa">and</span> <span class="sym">(= (</span><span class="kwa">length</span> args<span class="sym">)</span> <span class="num">2</span><span class="sym">) (</span>string<span class="sym">-&gt;</span>number <span class="sym">(</span><span class="kwa">cadr</span> args<span class="sym">)))</span> <span class="num">1</span><span class="sym">)))
    (</span>let loop <span class="sym">((</span>iter n<span class="sym">))
      (</span><span class="kwa">if</span> <span class="sym">(</span>fx<span class="sym">&gt;</span> iter <span class="num">1</span><span class="sym">)
        (</span>begin
          <span class="sym">(</span>gen<span class="sym">-</span>random <span class="num">100.0</span><span class="sym">)
          (</span>loop <span class="sym">(</span>fx<span class="sym">-</span> iter <span class="num">1</span><span class="sym">)))))
    (</span><span class="kwa">print</span> <span class="sym">(/ (</span>round <span class="sym">(* (</span>gen<span class="sym">-</span>random <span class="num">100.0</span><span class="sym">)</span> SCALE<span class="sym">))</span> SCALE<span class="sym">))))

(</span>main <span class="sym">(</span>argv<span class="sym">))</span>
