<span class="slc">\ The Great Computer Language Shootout</span>
<span class="slc">\ http://shootout.alioth.debian.org/</span>
<span class="slc">\</span>
<span class="slc">\ contributed by Ian Osgood</span>

<span class="slc">\ read NUM from last command line argument</span>
<span class="num">0</span><span class="sym">.</span> argc <span class="sym">&#64;</span> <span class="num">1</span><span class="sym">-</span> arg <span class="sym">&gt;</span>number <span class="num">2</span><span class="kwa">drop drop</span> <span class="num">2</span> <span class="kwa">max constant</span> NUM

<span class="sym">:</span> bit<span class="sym">-</span>mask <span class="com">( n -- addr mask )</span>
  <span class="kwa">dup</span> <span class="num">5</span> <span class="kwa">rshift cells here</span> <span class="sym">+</span>  <span class="num">1</span> <span class="kwa">rot</span> <span class="num">31</span> <span class="kwa">and lshift</span> <span class="sym">;</span>

<span class="sym">:</span> bit<span class="sym">-</span>on<span class="sym">?</span> <span class="com">( n -- f )</span> bit<span class="sym">-</span>mask <span class="kwa">swap</span> <span class="sym">&#64;</span> <span class="kwa">and</span> <span class="sym">;</span>

<span class="sym">:</span> bit<span class="sym">-</span>off <span class="com">( n -- )</span> bit<span class="sym">-</span>mask <span class="kwa">invert over</span> <span class="sym">&#64;</span> <span class="kwa">and swap</span> <span class="sym">! ;</span>

<span class="sym">:</span> sieve <span class="com">( size -- n )</span>
  <span class="kwa">here over</span> <span class="num">7</span> <span class="sym">+</span> <span class="num">8</span> <span class="sym">/ -</span><span class="num">1</span> <span class="kwa">fill</span>
  <span class="num">0</span> <span class="kwa">over</span> <span class="num">2</span> <span class="kwa">do</span>
    <span class="kwa">i</span> bit<span class="sym">-</span>on<span class="sym">?</span> <span class="kwa">if</span> <span class="num">1</span><span class="sym">+</span>
      <span class="kwa">over i</span> <span class="num">2</span><span class="sym">*</span> <span class="kwa">over min</span> <span class="sym">?</span><span class="kwa">do</span>
        <span class="kwa">i</span> bit<span class="sym">-</span>off
      <span class="kwa">j</span> <span class="sym">+</span><span class="kwa">loop</span>
    <span class="kwa">then</span>
  <span class="kwa">loop</span> nip <span class="sym">;</span>

<span class="slc">\ count primes up to 2^n*10000</span>
<span class="sym">:</span> test <span class="com">( n -- )</span>
  <span class="num">1</span> <span class="kwa">swap lshift</span> <span class="num">10000</span> <span class="sym">*</span>
  <span class="sym">.</span><span class="str">&quot; Primes up to &quot;</span> <span class="kwa">dup</span> <span class="num">8</span> u<span class="sym">.</span>r sieve <span class="num">9</span> u<span class="sym">.</span>r <span class="kwa">cr</span> <span class="sym">;</span>

<span class="slc">\ run sieve for N, N-1, N-2</span>
  NUM test  NUM <span class="num">1</span><span class="sym">-</span> test  NUM <span class="num">2</span> <span class="sym">-</span> test

bye  <span class="slc">\ done!</span>

