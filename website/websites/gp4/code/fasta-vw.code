<span class="str">&quot;  The Computer Language Shootout</span>
<span class="str">   http://shootout.alioth.debian.org/</span>
<span class="str">   contributed by Isaac Gouy&quot;</span><span class="sym">!</span>

<span class="sym">!</span>Shootout.Tests class methodsFor<span class="sym">:</span> <span class="str">'benchmarking'</span><span class="sym">!</span>

fasta
   <span class="sym">|</span> n r <span class="sym">|</span>
   n <span class="sym">:=</span> CEnvironment argv first asNumber.

   OS.Stdout writeFasta<span class="sym">:</span> <span class="str">'ONE Homo sapiens alu'</span> sequence<span class="sym">:</span>
   <span class="sym">(</span> RepeatStream to<span class="sym">:</span> n<span class="sym">*</span><span class="num">2</span> on<span class="sym">:</span>
      <span class="str">'GGCCGGGCGCGGTGGCTCACGCCTGTAATCCCAGCACTTTGG'</span><span class="sym">,</span>
      <span class="str">'GAGGCCGAGGCGGGCGGATCACCTGAGGTCAGGAGTTCGAGA'</span><span class="sym">,</span>
      <span class="str">'CCAGCCTGGCCAACATGGTGAAACCCCGTCTCTACTAAAAAT'</span><span class="sym">,</span>
      <span class="str">'ACAAAAATTAGCCGGGCGTGGTGGCGCGCGCCTGTAATCCCA'</span><span class="sym">,</span>
      <span class="str">'GCTACTCGGGAGGCTGAGGCAGGAGAATCGCTTGAACCCGGG'</span><span class="sym">,</span>
      <span class="str">'AGGCGGAGGTTGCAGTGAGCCGAGATCGCGCCACTGCACTCC'</span><span class="sym">,</span>
      <span class="str">'AGCCTGGGCGACAGAGCGAGACTCCGTCTCAAAAA'</span> <span class="sym">)</span>.

   r <span class="sym">:=</span> RandomNumber to<span class="sym">:</span> <span class="num">1</span>. <span class="str">&quot;Shared random sequence&quot;</span>

   OS.Stdout writeFasta<span class="sym">:</span> <span class="str">'TWO IUB ambiguity codes'</span> sequence<span class="sym">:</span>
   <span class="sym">((</span> RandomStream to<span class="sym">:</span> n<span class="sym">*</span><span class="num">3</span> on<span class="sym">: (</span>
      OrderedCollection new
         add<span class="sym">: (</span>Association key<span class="sym">:</span> <span class="kwb">$a</span> value<span class="sym">:</span> <span class="num">0.27</span>d<span class="sym">);</span>
         add<span class="sym">: (</span>Association key<span class="sym">:</span> <span class="kwb">$c</span> value<span class="sym">:</span> <span class="num">0.12</span>d<span class="sym">);</span>
         add<span class="sym">: (</span>Association key<span class="sym">:</span> <span class="kwb">$g</span> value<span class="sym">:</span> <span class="num">0.12</span>d<span class="sym">);</span>
         add<span class="sym">: (</span>Association key<span class="sym">:</span> <span class="kwb">$t</span> value<span class="sym">:</span> <span class="num">0.27</span>d<span class="sym">);</span>

         add<span class="sym">: (</span>Association key<span class="sym">:</span> <span class="kwb">$B</span> value<span class="sym">:</span> <span class="num">0.02</span>d<span class="sym">);</span>
         add<span class="sym">: (</span>Association key<span class="sym">:</span> <span class="kwb">$D</span> value<span class="sym">:</span> <span class="num">0.02</span>d<span class="sym">);</span>
         add<span class="sym">: (</span>Association key<span class="sym">:</span> <span class="kwb">$H</span> value<span class="sym">:</span> <span class="num">0.02</span>d<span class="sym">);</span>
         add<span class="sym">: (</span>Association key<span class="sym">:</span> <span class="kwb">$K</span> value<span class="sym">:</span> <span class="num">0.02</span>d<span class="sym">);</span>
         add<span class="sym">: (</span>Association key<span class="sym">:</span> <span class="kwb">$M</span> value<span class="sym">:</span> <span class="num">0.02</span>d<span class="sym">);</span>
         add<span class="sym">: (</span>Association key<span class="sym">:</span> <span class="kwb">$N</span> value<span class="sym">:</span> <span class="num">0.02</span>d<span class="sym">);</span>
         add<span class="sym">: (</span>Association key<span class="sym">:</span> <span class="kwb">$R</span> value<span class="sym">:</span> <span class="num">0.02</span>d<span class="sym">);</span>
         add<span class="sym">: (</span>Association key<span class="sym">:</span> <span class="kwb">$S</span> value<span class="sym">:</span> <span class="num">0.02</span>d<span class="sym">);</span>
         add<span class="sym">: (</span>Association key<span class="sym">:</span> <span class="kwb">$V</span> value<span class="sym">:</span> <span class="num">0.02</span>d<span class="sym">);</span>
         add<span class="sym">: (</span>Association key<span class="sym">:</span> <span class="kwb">$W</span> value<span class="sym">:</span> <span class="num">0.02</span>d<span class="sym">);</span>
         add<span class="sym">: (</span>Association key<span class="sym">:</span> <span class="kwb">$Y</span> value<span class="sym">:</span> <span class="num">0.02</span>d<span class="sym">);</span>
         yourself <span class="sym">))</span> random<span class="sym">:</span> r<span class="sym">)</span>.

   OS.Stdout writeFasta<span class="sym">:</span> <span class="str">'THREE Homo sapiens frequency'</span> sequence<span class="sym">:</span>
   <span class="sym">((</span> RandomStream to<span class="sym">:</span> n<span class="sym">*</span><span class="num">5</span> on<span class="sym">: (</span>
      OrderedCollection new
         add<span class="sym">: (</span>Association key<span class="sym">:</span> <span class="kwb">$a</span> value<span class="sym">:</span> <span class="num">0.3029549426680</span>d<span class="sym">);</span>
         add<span class="sym">: (</span>Association key<span class="sym">:</span> <span class="kwb">$c</span> value<span class="sym">:</span> <span class="num">0.1979883004921</span>d<span class="sym">);</span>
         add<span class="sym">: (</span>Association key<span class="sym">:</span> <span class="kwb">$g</span> value<span class="sym">:</span> <span class="num">0.1975473066391</span>d<span class="sym">);</span>
         add<span class="sym">: (</span>Association key<span class="sym">:</span> <span class="kwb">$t</span> value<span class="sym">:</span> <span class="num">0.3015094502008</span>d<span class="sym">);</span>
         yourself <span class="sym">))</span> random<span class="sym">:</span> r<span class="sym">)</span>.

   ^<span class="str">''</span> <span class="sym">! !</span>


Smalltalk.Shootout defineClass<span class="sym">:</span> <span class="slc">#RepeatStream</span>
	superclass<span class="sym">:</span> <span class="slc">#{Core.ReadStream}</span>
	indexedType<span class="sym">:</span> <span class="slc">#none</span>
	private<span class="sym">:</span> false
	instanceVariableNames<span class="sym">:</span> <span class="str">'repeatPtr repeatLimit'</span>
	classInstanceVariableNames<span class="sym">:</span> <span class="str">''</span>
	imports<span class="sym">:</span> <span class="str">''</span>
	category<span class="sym">:</span> <span class="str">'Shootout'</span><span class="sym">!</span>

<span class="sym">!</span>Shootout.RepeatStream class methodsFor<span class="sym">:</span> <span class="str">'instance creation'</span><span class="sym">!</span>

to<span class="sym">:</span> anInteger on<span class="sym">:</span> aCollection
   ^<span class="sym">(</span>super on<span class="sym">:</span> aCollection<span class="sym">)</span> to<span class="sym">:</span> anInteger <span class="sym">! !</span>

<span class="sym">!</span>Shootout.RepeatStream methodsFor<span class="sym">:</span> <span class="str">'initialize-release'</span><span class="sym">!</span>

to<span class="sym">:</span> anInteger
   repeatPtr <span class="sym">:=</span> <span class="num">0</span>.
   repeatLimit <span class="sym">:=</span> anInteger <span class="sym">! !</span>

<span class="sym">!</span>Shootout.RepeatStream methodsFor<span class="sym">:</span> <span class="str">'accessing'</span><span class="sym">!</span>

<span class="kwa">next</span>
   position <span class="sym">&gt;=</span> readLimit ifTrue<span class="sym">: [</span> self position<span class="sym">:</span> <span class="num">0</span> <span class="sym">]</span>.
   repeatPtr <span class="sym">:=</span> repeatPtr <span class="sym">+</span> <span class="num">1</span>.
   ^collection at<span class="sym">: (</span>position <span class="sym">:=</span> position <span class="sym">+</span> <span class="num">1</span><span class="sym">) ! !</span>

<span class="sym">!</span>Shootout.RepeatStream methodsFor<span class="sym">:</span> <span class="str">'testing'</span><span class="sym">!</span>

atEnd
   ^repeatPtr <span class="sym">&gt;=</span> repeatLimit <span class="sym">! !</span>


Smalltalk.Shootout defineClass<span class="sym">:</span> <span class="slc">#RandomStream</span>
	superclass<span class="sym">:</span> <span class="slc">#{Shootout.RepeatStream}</span>
	indexedType<span class="sym">:</span> <span class="slc">#none</span>
	private<span class="sym">:</span> false
	instanceVariableNames<span class="sym">:</span> <span class="str">'random percentages'</span>
	classInstanceVariableNames<span class="sym">:</span> <span class="str">''</span>
	imports<span class="sym">:</span> <span class="str">''</span>
	category<span class="sym">:</span> <span class="str">'Shootout'</span><span class="sym">!</span>

<span class="sym">!</span>Shootout.RepeatStream methodsFor<span class="sym">:</span> <span class="str">'initialize-release'</span><span class="sym">!</span>

on<span class="sym">:</span> aCollection
   <span class="sym">|</span> size cp <span class="sym">|</span>
   repeatPtr <span class="sym">:=</span> <span class="num">0</span>.
   random <span class="sym">:=</span> RandomNumber to<span class="sym">:</span> <span class="num">1.0</span>.
   size <span class="sym">:=</span> aCollection size.
   percentages <span class="sym">:=</span> Array new<span class="sym">:</span> size.
   collection <span class="sym">:=</span> Array new<span class="sym">:</span> size.
   cp <span class="sym">:=</span> <span class="num">0.0</span>d.
   <span class="num">1</span> to<span class="sym">:</span> size <span class="kwa">do</span><span class="sym">: [:</span>i<span class="sym">|</span>
      collection at<span class="sym">:</span> i put<span class="sym">: (</span>aCollection at<span class="sym">:</span> i<span class="sym">)</span> key.
      percentages at<span class="sym">:</span> i put<span class="sym">: (</span>cp <span class="sym">:=</span> cp <span class="sym">+ (</span>aCollection at<span class="sym">:</span> i<span class="sym">)</span> value<span class="sym">)</span>.
   <span class="sym">] ! !</span>

<span class="sym">!</span>Shootout.RepeatStream methodsFor<span class="sym">:</span> <span class="str">'accessing'</span><span class="sym">!</span>

<span class="kwa">next</span>
   <span class="sym">|</span> r <span class="sym">|</span>
   r <span class="sym">:=</span> random <span class="kwa">next</span>.
   repeatPtr <span class="sym">:=</span> repeatPtr <span class="sym">+</span> <span class="num">1</span>.
   <span class="num">1</span> to<span class="sym">:</span> percentages size <span class="kwa">do</span><span class="sym">: [:</span>i<span class="sym">|</span>
      <span class="sym">(</span>r <span class="sym">&lt; (</span>percentages at<span class="sym">:</span> i<span class="sym">))</span> ifTrue<span class="sym">: [</span>^collection at<span class="sym">:</span> i<span class="sym">]] !</span>

random<span class="sym">:</span> aRandomNumber
<span class="str">&quot;Share the random number generator so we can get the expected results.&quot;</span>
   random <span class="sym">:=</span> aRandomNumber <span class="sym">! !</span>


<span class="sym">!</span> StandardIOStream methodsFor<span class="sym">:</span> <span class="str">'accessing'</span><span class="sym">!</span>

writeFasta<span class="sym">:</span> aString sequence<span class="sym">:</span> aStream
   <span class="sym">|</span> i <span class="sym">|</span>
   self nextPut<span class="sym">: $&gt;;</span> nextPutAll<span class="sym">:</span> aString<span class="sym">;</span> cr.
   i <span class="sym">:=</span> <span class="num">0</span>.
   <span class="sym">[</span>aStream atEnd<span class="sym">]</span> whileFalse<span class="sym">: [</span>
      <span class="sym">(</span>i <span class="sym">==</span> <span class="num">60</span><span class="sym">)</span> ifTrue<span class="sym">: [</span>self cr. i <span class="sym">:=</span> <span class="num">0</span><span class="sym">]</span>.
      self nextPut<span class="sym">:</span> aStream <span class="kwa">next</span>.
      i <span class="sym">:=</span> i <span class="sym">+</span> <span class="num">1</span>.
      <span class="sym">]</span>.
   self cr <span class="sym">! !</span>


Smalltalk.Shootout defineClass<span class="sym">:</span> <span class="slc">#RandomNumber</span>
	superclass<span class="sym">:</span> <span class="slc">#{Core.Object}</span>
	indexedType<span class="sym">:</span> <span class="slc">#none</span>
	private<span class="sym">:</span> false
	instanceVariableNames<span class="sym">:</span> <span class="str">'seed scale '</span>
	classInstanceVariableNames<span class="sym">:</span> <span class="str">''</span>
	imports<span class="sym">:</span> <span class="str">''</span>
	category<span class="sym">:</span> <span class="str">'Shootout'</span><span class="sym">!</span>

Shootout.RandomNumber defineSharedVariable<span class="sym">:</span> <span class="slc">#Modulus</span>
	private<span class="sym">:</span> false
	constant<span class="sym">:</span> false
	category<span class="sym">:</span> <span class="str">'computer language shootout'</span>
	initializer<span class="sym">:</span> <span class="str">'139968'</span><span class="sym">!</span>

<span class="slc">#{Shootout.RandomNumber.Modulus} initialize!</span>

Shootout.RandomNumber defineSharedVariable<span class="sym">:</span> <span class="slc">#FModulus</span>
	private<span class="sym">:</span> false
	constant<span class="sym">:</span> false
	category<span class="sym">:</span> <span class="str">'computer language shootout'</span>
	initializer<span class="sym">:</span> <span class="str">'139968.0d'</span><span class="sym">!</span>

<span class="slc">#{Shootout.RandomNumber.FModulus} initialize!</span>

Shootout.RandomNumber defineSharedVariable<span class="sym">:</span> <span class="slc">#Multiplier</span>
	private<span class="sym">:</span> false
	constant<span class="sym">:</span> false
	category<span class="sym">:</span> <span class="str">'computer language shootout'</span>
	initializer<span class="sym">:</span> <span class="str">'3877'</span><span class="sym">!</span>

<span class="slc">#{Shootout.RandomNumber.Multiplier} initialize!</span>

Shootout.RandomNumber defineSharedVariable<span class="sym">:</span> <span class="slc">#Increment</span>
	private<span class="sym">:</span> false
	constant<span class="sym">:</span> false
	category<span class="sym">:</span> <span class="str">'computer language shootout'</span>
	initializer<span class="sym">:</span> <span class="str">'29573'</span><span class="sym">!</span>

<span class="slc">#{Shootout.RandomNumber.Increment} initialize!</span>


<span class="sym">!</span>Shootout.RandomNumber class methodsFor<span class="sym">:</span> <span class="str">'instance creation'</span><span class="sym">!</span>

to<span class="sym">:</span> anInteger
   ^self basicNew to<span class="sym">:</span> anInteger <span class="sym">! !</span>


<span class="sym">!</span>Shootout.RandomNumber methodsFor<span class="sym">:</span> <span class="str">'accessing'</span><span class="sym">!</span>

<span class="kwa">next</span>
   seed <span class="sym">:= (</span>seed <span class="sym">*</span> Multiplier <span class="sym">+</span> Increment<span class="sym">)</span> <span class="esc">\\</span> Modulus.
   ^<span class="sym">(</span>seed <span class="sym">*</span> scale<span class="sym">)</span> asDouble <span class="sym">/</span> FModulus <span class="sym">! !</span>

<span class="sym">!</span>Shootout.RandomNumber methodsFor<span class="sym">:</span> <span class="str">'private'</span><span class="sym">!</span>

to<span class="sym">:</span> anInteger
   seed <span class="sym">:=</span> <span class="num">42</span>.
   scale <span class="sym">:=</span> anInteger <span class="sym">! !</span>


