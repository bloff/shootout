<span class="hl com">/**</span>
<span class="hl com"> * The Computer Language Benchmarks Game</span>
<span class="hl com"> * Based on the CAL Open Quark version</span>
<span class="hl com"> * Contributed by Magnus Byne.</span>
<span class="hl com"> */</span>
module Knucleotide<span class="hl sym">;</span>

<span class="hl kwa">import</span> Cal<span class="hl sym">.</span>Core<span class="hl sym">.</span>Prelude using
    typeClass <span class="hl sym">=</span> Inputable<span class="hl sym">,</span> Outputable<span class="hl sym">;</span>
    typeConstructor <span class="hl sym">=</span> <span class="hl kwc">Boolean</span><span class="hl sym">,</span> Int<span class="hl sym">,</span> JObject<span class="hl sym">,</span> <span class="hl kwc">String</span><span class="hl sym">;</span>
    function <span class="hl sym">=</span>
        combineComparators<span class="hl sym">,</span> eager<span class="hl sym">,</span> fromInt<span class="hl sym">,</span> fst<span class="hl sym">,</span> induceComparator<span class="hl sym">,</span> input<span class="hl sym">,</span> not<span class="hl sym">,</span>
        reverseComparator<span class="hl sym">,</span> seq<span class="hl sym">,</span> snd<span class="hl sym">;</span>
    <span class="hl sym">;</span>

<span class="hl kwa">import</span> Cal<span class="hl sym">.</span>Core<span class="hl sym">.</span>Debug using
    typeClass <span class="hl sym">=</span> Show<span class="hl sym">;</span>
    function <span class="hl sym">=</span> show<span class="hl sym">;</span>
    <span class="hl sym">;</span>

<span class="hl kwa">import</span> Cal<span class="hl sym">.</span>Core<span class="hl sym">.</span><span class="hl kwc">String</span> using
    function <span class="hl sym">=</span> length<span class="hl sym">,</span> startsWith<span class="hl sym">,</span> subscript<span class="hl sym">,</span> substring<span class="hl sym">,</span> toUpperCase<span class="hl sym">;</span>
    <span class="hl sym">;</span>

<span class="hl kwa">import</span> Cal<span class="hl sym">.</span><span class="hl kwc">Collections</span><span class="hl sym">.</span><span class="hl kwc">List</span> using
    function <span class="hl sym">=</span> dropWhile<span class="hl sym">,</span> foldLeftStrict<span class="hl sym">,</span> map<span class="hl sym">,</span> sortBy<span class="hl sym">,</span> tail<span class="hl sym">,</span> takeWhile<span class="hl sym">;</span>
    <span class="hl sym">;</span>

<span class="hl kwa">import</span> Cal<span class="hl sym">.</span><span class="hl kwc">Collections</span><span class="hl sym">.</span><span class="hl kwc">Map</span><span class="hl sym">;</span>

<span class="hl kwa">import</span> Cal<span class="hl sym">.</span><span class="hl kwc">Utilities</span><span class="hl sym">.</span><span class="hl kwc">MessageFormat</span> using
    function <span class="hl sym">=</span> formatWithPattern<span class="hl sym">;</span>
    <span class="hl sym">;</span>

<span class="hl kwa">import</span> Cal<span class="hl sym">.</span><span class="hl kwc">Utilities</span><span class="hl sym">.</span><span class="hl kwc">Locale</span> using
    function <span class="hl sym">=</span> invariantLocale<span class="hl sym">;</span>
    <span class="hl sym">;</span>


data foreign unsafe <span class="hl kwa">import</span> jvm <span class="hl str">&quot;java.io.BufferedReader&quot;</span> <span class="hl kwa">private</span> JBufferedReader<span class="hl sym">;</span>

data foreign unsafe <span class="hl kwa">import</span> jvm <span class="hl str">&quot;java.io.InputStream&quot;</span> <span class="hl kwa">private</span> JInputStream<span class="hl sym">;</span>

data foreign unsafe <span class="hl kwa">import</span> jvm <span class="hl str">&quot;java.io.InputStreamReader&quot;</span>
    <span class="hl kwa">private</span> JInputStreamReader<span class="hl sym">;</span>

data foreign unsafe <span class="hl kwa">import</span> jvm <span class="hl str">&quot;java.io.Reader&quot;</span> <span class="hl kwa">private</span> JReader<span class="hl sym">;</span>

data foreign unsafe <span class="hl kwa">import</span> jvm <span class="hl str">&quot;java.io.FileReader&quot;</span> <span class="hl kwa">private</span> JFileReader<span class="hl sym">;</span>

data foreign unsafe <span class="hl kwa">import</span> jvm <span class="hl str">&quot;java.io.PrintStream&quot;</span> <span class="hl kwa">private</span> JPrintStream<span class="hl sym">;</span>

data foreign unsafe <span class="hl kwa">import</span> jvm <span class="hl str">&quot;java.lang.StringBuffer&quot;</span>
    <span class="hl kwa">private</span> JStringBuffer deriving Show<span class="hl sym">;</span>

data foreign unsafe <span class="hl kwa">import</span> jvm <span class="hl str">&quot;java.util.Collection&quot;</span> <span class="hl kwa">private</span> JCollection<span class="hl sym">;</span>

foreign unsafe <span class="hl kwa">import</span> jvm <span class="hl str">&quot;constructor&quot;</span>
    <span class="hl kwa">private</span> createStringBuffer <span class="hl sym">::</span> JStringBuffer<span class="hl sym">;</span>

foreign unsafe <span class="hl kwa">import</span> jvm <span class="hl str">&quot;constructor&quot;</span>
    <span class="hl kwa">private</span> createBufferedReader <span class="hl sym">::</span> JReader <span class="hl sym">-&gt;</span> JBufferedReader<span class="hl sym">;</span>

foreign unsafe <span class="hl kwa">import</span> jvm <span class="hl str">&quot;constructor&quot;</span>
    <span class="hl kwa">private</span> createInputStreamReaderStream <span class="hl sym">::</span> JInputStream <span class="hl sym">-&gt;</span> JInputStreamReader<span class="hl sym">;</span>

foreign unsafe <span class="hl kwa">import</span> jvm <span class="hl str">&quot;method append&quot;</span>
    <span class="hl kwa">private</span> append <span class="hl sym">::</span> JStringBuffer <span class="hl sym">-&gt;</span> <span class="hl kwc">String</span> <span class="hl sym">-&gt;</span> JStringBuffer<span class="hl sym">;</span>

foreign unsafe <span class="hl kwa">import</span> jvm <span class="hl str">&quot;method readLine&quot;</span>
    <span class="hl kwa">private</span> readLine <span class="hl sym">::</span> JBufferedReader <span class="hl sym">-&gt;</span> <span class="hl kwc">String</span><span class="hl sym">;</span>

foreign unsafe <span class="hl kwa">import</span> jvm <span class="hl str">&quot;static field java.lang.System.out&quot;</span>
    <span class="hl kwa">private</span> stdout <span class="hl sym">::</span> JPrintStream<span class="hl sym">;</span>

foreign unsafe <span class="hl kwa">import</span> jvm <span class="hl str">&quot;static field java.lang.System.in&quot;</span>
    <span class="hl kwa">private</span> stdin <span class="hl sym">::</span> JInputStream<span class="hl sym">;</span>

foreign unsafe <span class="hl kwa">import</span> jvm <span class="hl str">&quot;isNull&quot;</span> <span class="hl kwa">private</span> isNull <span class="hl sym">::</span> <span class="hl kwc">String</span> <span class="hl sym">-&gt;</span> <span class="hl kwc">Boolean</span><span class="hl sym">;</span>

foreign unsafe <span class="hl kwa">import</span> jvm <span class="hl str">&quot;method print&quot;</span>
    <span class="hl kwa">private</span> print <span class="hl sym">::</span> JPrintStream <span class="hl sym">-&gt;</span> <span class="hl kwc">String</span> <span class="hl sym">-&gt; ();</span>

data foreign unsafe <span class="hl kwa">import</span> jvm <span class="hl str">&quot;int[]&quot;</span>
    JIntArray deriving Inputable<span class="hl sym">,</span> Outputable<span class="hl sym">,</span> Show<span class="hl sym">;</span>

<span class="hl slc">//Import Java integer arrays</span>
foreign unsafe <span class="hl kwa">import</span> jvm <span class="hl str">&quot;newArray&quot;</span> newArray <span class="hl sym">::</span> Int <span class="hl sym">-&gt;</span> JIntArray<span class="hl sym">;</span>

foreign unsafe <span class="hl kwa">import</span> jvm <span class="hl str">&quot;subscriptArray&quot;</span>
    subscriptArray <span class="hl sym">::</span> JIntArray <span class="hl sym">-&gt;</span> Int <span class="hl sym">-&gt;</span> Int<span class="hl sym">;</span>

foreign unsafe <span class="hl kwa">import</span> jvm <span class="hl str">&quot;updateArray&quot;</span>
    updateArray <span class="hl sym">::</span> JIntArray <span class="hl sym">-&gt;</span> Int <span class="hl sym">-&gt;</span> Int <span class="hl sym">-&gt;</span> Int<span class="hl sym">;</span>

data foreign unsafe <span class="hl kwa">import</span> jvm <span class="hl str">&quot;java.util.HashMap&quot;</span>
    <span class="hl kwa">private</span> JHashMap deriving Show<span class="hl sym">;</span>

data foreign unsafe <span class="hl kwa">import</span> jvm <span class="hl str">&quot;java.util.Set&quot;</span> <span class="hl kwa">private</span> JSet<span class="hl sym">;</span>

<span class="hl slc">//Import mutable Java Hash Maps</span>

foreign unsafe <span class="hl kwa">import</span> jvm <span class="hl str">&quot;constructor&quot;</span> <span class="hl kwa">private</span> createHashMap <span class="hl sym">::</span> JHashMap<span class="hl sym">;</span>

foreign unsafe <span class="hl kwa">import</span> jvm <span class="hl str">&quot;isNull&quot;</span> <span class="hl kwa">private</span> isArrayNull <span class="hl sym">::</span> JIntArray <span class="hl sym">-&gt;</span> <span class="hl kwc">Boolean</span><span class="hl sym">;</span>

foreign unsafe <span class="hl kwa">import</span> jvm <span class="hl str">&quot;method get&quot;</span>
    <span class="hl kwa">private</span> lookup <span class="hl sym">::</span> JHashMap <span class="hl sym">-&gt;</span> JObject <span class="hl sym">-&gt;</span> JObject<span class="hl sym">;</span>

foreign unsafe <span class="hl kwa">import</span> jvm <span class="hl str">&quot;method keySet&quot;</span> <span class="hl kwa">private</span> keySet <span class="hl sym">::</span> JHashMap <span class="hl sym">-&gt;</span> JSet<span class="hl sym">;</span>

foreign unsafe <span class="hl kwa">import</span> jvm <span class="hl str">&quot;method put&quot;</span>
    <span class="hl kwa">private</span> insert <span class="hl sym">::</span> JHashMap <span class="hl sym">-&gt;</span> JObject <span class="hl sym">-&gt;</span> JObject <span class="hl sym">-&gt;</span> JObject<span class="hl sym">;</span>

foreign unsafe <span class="hl kwa">import</span> jvm <span class="hl str">&quot;cast&quot;</span> stringToObject <span class="hl sym">::</span> <span class="hl kwc">String</span> <span class="hl sym">-&gt;</span> JObject<span class="hl sym">;</span>

foreign unsafe <span class="hl kwa">import</span> jvm <span class="hl str">&quot;cast&quot;</span> objectToJIntArray <span class="hl sym">::</span> JObject <span class="hl sym">-&gt;</span> JIntArray<span class="hl sym">;</span>

foreign unsafe <span class="hl kwa">import</span> jvm <span class="hl str">&quot;cast&quot;</span> jIntArrayToJObject <span class="hl sym">::</span> JIntArray <span class="hl sym">-&gt;</span> JObject<span class="hl sym">;</span>

foreign unsafe <span class="hl kwa">import</span> jvm <span class="hl str">&quot;cast&quot;</span>
    jInputStreamReaderToJReader <span class="hl sym">::</span> JInputStreamReader <span class="hl sym">-&gt;</span> JReader<span class="hl sym">;</span>

foreign unsafe <span class="hl kwa">import</span> jvm <span class="hl str">&quot;cast&quot;</span> jSetToJObject <span class="hl sym">::</span> JSet <span class="hl sym">-&gt;</span> JObject<span class="hl sym">;</span>

<span class="hl com">/**</span>
<span class="hl com"> * update the count for a given key in the map</span>
<span class="hl com"> * if the key is not in the map, it is added with value 1.</span>
<span class="hl com"> */</span>
update <span class="hl sym">::</span> JHashMap <span class="hl sym">-&gt;</span> <span class="hl kwc">String</span> <span class="hl sym">-&gt;</span> Int<span class="hl sym">;</span>
update <span class="hl sym">!</span>map <span class="hl sym">!</span>string <span class="hl sym">=</span>
    let
        value <span class="hl sym">::</span> JIntArray<span class="hl sym">;</span>
        value <span class="hl sym">=</span>
            eager $ <span class="hl kwd">objectToJIntArray</span> <span class="hl sym">(</span>lookup <span class="hl kwd">map</span> <span class="hl sym">(</span>stringToObject string<span class="hl sym">));</span>
    in
        <span class="hl kwa">if</span> <span class="hl kwd">not</span> <span class="hl sym">(</span>isArrayNull value<span class="hl sym">)</span> then
            updateArray value <span class="hl kwd">0</span> <span class="hl sym">(</span><span class="hl num">1</span> <span class="hl sym">+</span> value `subscriptArray` <span class="hl num">0</span><span class="hl sym">)</span>
        <span class="hl kwa">else</span>
            let
                array <span class="hl sym">::</span> JIntArray<span class="hl sym">;</span>
                array <span class="hl sym">=</span> <span class="hl kwd">eager</span> <span class="hl sym">(</span>newArray <span class="hl num">1</span><span class="hl sym">);</span>
            in
                insert <span class="hl kwd">map</span> <span class="hl sym">(</span>stringToObject string<span class="hl sym">) (</span>jIntArrayToJObject array<span class="hl sym">)</span>
                `seq`
                updateArray array <span class="hl num">0 1</span>
    <span class="hl sym">;</span>

<span class="hl com">/**</span>
<span class="hl com"> * Lookup a value in a hashmap.</span>
<span class="hl com"> * Return 0 if the key is not in the hashmap</span>
<span class="hl com"> */</span>
getValue <span class="hl sym">::</span> JHashMap <span class="hl sym">-&gt;</span> <span class="hl kwc">String</span> <span class="hl sym">-&gt;</span> Int<span class="hl sym">;</span>
getValue <span class="hl sym">!</span>map <span class="hl sym">!</span>string <span class="hl sym">=</span>
    let
        value <span class="hl sym">::</span> JIntArray<span class="hl sym">;</span>
        value <span class="hl sym">=</span>
            eager $ <span class="hl kwd">objectToJIntArray</span> <span class="hl sym">(</span>lookup <span class="hl kwd">map</span> <span class="hl sym">(</span>stringToObject string<span class="hl sym">));</span>
    in
        <span class="hl kwa">if</span> <span class="hl kwd">not</span> <span class="hl sym">(</span>isArrayNull value<span class="hl sym">)</span> then
            value `subscriptArray` <span class="hl num">0</span>
        <span class="hl kwa">else</span>
            <span class="hl slc">//the key is not in the map</span>
            <span class="hl num">0</span>
    <span class="hl sym">;</span>

<span class="hl com">/**convert a JhashMap to a list of key, value pairs.*/</span>
hashMapToPairs <span class="hl sym">::</span> JHashMap <span class="hl sym">-&gt; [(</span><span class="hl kwc">String</span><span class="hl sym">,</span> Int<span class="hl sym">)];</span>
hashMapToPairs <span class="hl sym">!</span>jmap <span class="hl sym">=</span>
    let
        keys <span class="hl sym">:: [</span><span class="hl kwc">String</span><span class="hl sym">];</span>
        keys <span class="hl sym">=</span> <span class="hl kwd">input</span> <span class="hl sym">(</span><span class="hl kwd">jSetToJObject</span> <span class="hl sym">(</span>keySet jmap<span class="hl sym">));</span>
    in
        <span class="hl kwd">map</span> <span class="hl sym">(</span>\<span class="hl sym">!</span>key <span class="hl sym">-&gt; (</span>key<span class="hl sym">,</span> getValue jmap key<span class="hl sym">))</span> keys
    <span class="hl sym">;</span>

<span class="hl com">/**compute the frequency table for a specified fragment length*/</span>
calculateFrequencies <span class="hl sym">::</span> <span class="hl kwc">String</span> <span class="hl sym">-&gt;</span> Int <span class="hl sym">-&gt;</span> JHashMap<span class="hl sym">;</span>
calculateFrequencies <span class="hl sym">!</span>sequence <span class="hl sym">!</span>fragmentLength <span class="hl sym">=</span>
    let
        len <span class="hl sym">::</span> Int<span class="hl sym">;</span>
        len <span class="hl sym">=</span> eager $ length sequence <span class="hl sym">-</span> fragmentLength <span class="hl sym">+</span> <span class="hl num">1</span><span class="hl sym">;</span>

        freqMap <span class="hl sym">::</span> JHashMap<span class="hl sym">;</span>
        freqMap <span class="hl sym">=</span> eager createHashMap<span class="hl sym">;</span>

        process <span class="hl sym">::</span> Int <span class="hl sym">-&gt;</span> Int <span class="hl sym">-&gt;</span> JHashMap<span class="hl sym">;</span>
        process <span class="hl sym">!</span>offset <span class="hl sym">!</span>index <span class="hl sym">=</span>
            <span class="hl kwa">if</span> index <span class="hl sym">&lt;</span> len then
                update
                    freqMap
                    <span class="hl sym">(</span>substring sequence <span class="hl kwd">index</span> <span class="hl sym">(</span>index <span class="hl sym">+</span> fragmentLength<span class="hl sym">))</span>
                `seq`
                process <span class="hl kwd">offset</span> <span class="hl sym">(</span>index <span class="hl sym">+</span> <span class="hl num">1</span><span class="hl sym">)</span>
            <span class="hl kwa">else</span>
                freqMap
            <span class="hl sym">;</span>
    in
        process <span class="hl num">0 0</span>
    <span class="hl sym">;</span>

<span class="hl slc">//read the sequence from the input lines</span>
sequence <span class="hl sym">:: [</span><span class="hl kwc">String</span><span class="hl sym">] -&gt;</span> <span class="hl kwc">String</span><span class="hl sym">;</span>
sequence <span class="hl sym">!</span>input <span class="hl sym">=</span>
    let
        stringBuffer <span class="hl sym">::</span> JStringBuffer<span class="hl sym">;</span>
        stringBuffer <span class="hl sym">=</span> eager $ createStringBuffer<span class="hl sym">;</span>

        addIfNotComment <span class="hl sym">::</span> JStringBuffer <span class="hl sym">-&gt;</span> <span class="hl kwc">String</span> <span class="hl sym">-&gt;</span> JStringBuffer<span class="hl sym">;</span>
        addIfNotComment <span class="hl sym">!</span>stringBuffer <span class="hl sym">!</span>line <span class="hl sym">=</span>
            <span class="hl kwa">if</span> subscript line <span class="hl num">0</span> <span class="hl sym">!=</span> <span class="hl str">';'</span> then
                append <span class="hl kwd">stringBuffer</span> <span class="hl sym">(</span>toUpperCase line<span class="hl sym">)</span>
                `seq`
                stringBuffer
            <span class="hl kwa">else</span>
                stringBuffer
            <span class="hl sym">;</span>

        isNotThree <span class="hl sym">::</span> <span class="hl kwc">String</span> <span class="hl sym">-&gt;</span> <span class="hl kwc">Boolean</span><span class="hl sym">;</span>
        isNotThree <span class="hl sym">!</span>line <span class="hl sym">=</span> <span class="hl kwd">not</span> <span class="hl sym">(</span>startsWith <span class="hl str">&quot;&gt;THREE&quot;</span> line<span class="hl sym">);</span>

        isNotStartOfSequence <span class="hl sym">::</span> <span class="hl kwc">String</span> <span class="hl sym">-&gt;</span> <span class="hl kwc">Boolean</span><span class="hl sym">;</span>
        isNotStartOfSequence <span class="hl sym">!</span>line <span class="hl sym">=</span> subscript line <span class="hl num">0</span> <span class="hl sym">!=</span> <span class="hl str">'&gt;'</span><span class="hl sym">;</span>
    in
        show
            <span class="hl sym">(</span>foldLeftStrict
                addIfNotComment
                stringBuffer
                <span class="hl sym">(</span>takeWhile
                    isNotStartOfSequence
                    <span class="hl sym">(</span><span class="hl kwd">tail</span> <span class="hl sym">(</span>dropWhile isNotThree input<span class="hl sym">))</span>
                <span class="hl sym">)</span>
            <span class="hl sym">)</span>
    <span class="hl sym">;</span>

<span class="hl slc">//list of lines representing the input</span>
lines <span class="hl sym">::</span> JBufferedReader <span class="hl sym">-&gt; [</span><span class="hl kwc">String</span><span class="hl sym">];</span>
lines <span class="hl sym">!</span>bufferedReader <span class="hl sym">=</span>
    let
        line <span class="hl sym">::</span> <span class="hl kwc">String</span><span class="hl sym">;</span>
        line <span class="hl sym">=</span> eager $ readLine bufferedReader<span class="hl sym">;</span>
    in
        <span class="hl kwa">if</span> isNull line then
            <span class="hl sym">[]</span>
        <span class="hl kwa">else</span>
            line <span class="hl sym">:</span> lines bufferedReader
    <span class="hl sym">;</span>

showFreq <span class="hl sym">:: [(</span><span class="hl kwc">String</span><span class="hl sym">,</span> Int<span class="hl sym">)] -&gt;</span> Int <span class="hl sym">-&gt;</span> <span class="hl kwc">String</span><span class="hl sym">;</span>
showFreq <span class="hl sym">!</span>freqList <span class="hl sym">!</span>total <span class="hl sym">=</span>
    foldLeftStrict
        <span class="hl sym">(</span>
            \str item <span class="hl sym">-&gt;</span>
                <span class="hl kwa">case</span> item of
                <span class="hl sym">(</span>name<span class="hl sym">,</span> freq<span class="hl sym">)</span>
                <span class="hl sym">-&gt;</span>
                    formatWithPattern
                        <span class="hl str">&quot;{0}{1} {2,number,0.000}</span><span class="hl esc">\n</span><span class="hl str">&quot;</span>
                        invariantLocale
                        <span class="hl sym">(</span>str<span class="hl sym">,</span> name<span class="hl sym">,</span> fromInt freq <span class="hl sym">/</span> fromInt total <span class="hl sym">*</span> <span class="hl num">100.0</span><span class="hl sym">)</span>
                    <span class="hl sym">;</span>
        <span class="hl sym">)</span>
        <span class="hl str">&quot;&quot;</span>
        <span class="hl sym">(</span>sortBy
            <span class="hl sym">(</span>combineComparators
                <span class="hl sym">(</span><span class="hl kwd">reverseComparator</span> <span class="hl sym">(</span>induceComparator snd<span class="hl sym">))</span>
                <span class="hl sym">(</span>induceComparator fst<span class="hl sym">)</span>
            <span class="hl sym">)</span>
            freqList
        <span class="hl sym">)</span>
    <span class="hl sym">++</span> <span class="hl str">&quot;</span><span class="hl esc">\n</span><span class="hl str">&quot;</span>
    <span class="hl sym">;</span>

showCount <span class="hl sym">::</span> JHashMap <span class="hl sym">-&gt;</span> <span class="hl kwc">String</span> <span class="hl sym">-&gt;</span> <span class="hl kwc">String</span><span class="hl sym">;</span>
showCount <span class="hl sym">!</span>hashmap <span class="hl sym">!</span>nucleotide <span class="hl sym">=</span>
    <span class="hl kwd">show</span> <span class="hl sym">(</span>getValue hashmap nucleotide<span class="hl sym">) ++</span> <span class="hl str">&quot;</span><span class="hl esc">\t</span><span class="hl str">&quot;</span> <span class="hl sym">++</span> nucleotide <span class="hl sym">++</span> <span class="hl str">&quot;</span><span class="hl esc">\n</span><span class="hl str">&quot;</span><span class="hl sym">;</span>

main <span class="hl sym">:: [</span><span class="hl kwc">String</span><span class="hl sym">] -&gt; ();</span>
<span class="hl kwa">public</span> main <span class="hl sym">!</span>args <span class="hl sym">=</span>
    let
        reader <span class="hl sym">::</span> JBufferedReader<span class="hl sym">;</span>
        reader <span class="hl sym">=</span>
            createBufferedReader
                <span class="hl sym">(</span>jInputStreamReaderToJReader
                    <span class="hl sym">(</span>createInputStreamReaderStream stdin<span class="hl sym">)</span>
                <span class="hl sym">)</span>
            <span class="hl sym">;</span>

        sq <span class="hl sym">::</span> <span class="hl kwc">String</span><span class="hl sym">;</span>
        sq <span class="hl sym">=</span> eager $ <span class="hl kwd">sequence</span> <span class="hl sym">(</span>lines reader<span class="hl sym">);</span>

        <span class="hl slc">//build freqnece map for length 1 nucledotides</span>
        freq1 <span class="hl sym">:: [(</span><span class="hl kwc">String</span><span class="hl sym">,</span> Int<span class="hl sym">)];</span>
        freq1 <span class="hl sym">=</span> <span class="hl kwd">hashMapToPairs</span> <span class="hl sym">(</span>calculateFrequencies sq <span class="hl num">1</span><span class="hl sym">);</span>

        <span class="hl slc">//build freqnece map for length 2 nucledotides</span>
        freq2 <span class="hl sym">:: [(</span><span class="hl kwc">String</span><span class="hl sym">,</span> Int<span class="hl sym">)];</span>
        freq2 <span class="hl sym">=</span> <span class="hl kwd">hashMapToPairs</span> <span class="hl sym">(</span>calculateFrequencies sq <span class="hl num">2</span><span class="hl sym">);</span>

        seqLength <span class="hl sym">::</span> Int<span class="hl sym">;</span>
        seqLength <span class="hl sym">=</span> length sq<span class="hl sym">;</span>

        <span class="hl slc">//build 3,4,6,12,18 nucledotide maps and get counts for some specific instances.</span>
        counts <span class="hl sym">::</span> <span class="hl kwc">String</span><span class="hl sym">;</span>
        counts <span class="hl sym">=</span>
            foldLeftStrict
                <span class="hl sym">(</span>
                    \str item <span class="hl sym">-&gt;</span>
                        str
                        <span class="hl sym">++</span> showCount
                            <span class="hl sym">(</span>calculateFrequencies <span class="hl kwd">sq</span> <span class="hl sym">(</span>length item<span class="hl sym">))</span>
                            item
                <span class="hl sym">)</span>
                <span class="hl str">&quot;&quot;</span>
                <span class="hl sym">[</span>
                    <span class="hl str">&quot;GGT&quot;</span><span class="hl sym">,</span>
                    <span class="hl str">&quot;GGTA&quot;</span><span class="hl sym">,</span>
                    <span class="hl str">&quot;GGTATT&quot;</span><span class="hl sym">,</span>
                    <span class="hl str">&quot;GGTATTTTAATT&quot;</span><span class="hl sym">,</span>
                    <span class="hl str">&quot;GGTATTTTAATTTATAGT&quot;</span>
                <span class="hl sym">]</span>
            <span class="hl sym">;</span>
    in

        print <span class="hl kwd">stdout</span> <span class="hl sym">(</span>showFreq freq1 seqLength<span class="hl sym">)</span>
        `seq`
        print <span class="hl kwd">stdout</span> <span class="hl sym">(</span>showFreq <span class="hl kwd">freq2</span> <span class="hl sym">(</span>seqLength <span class="hl sym">-</span> <span class="hl num">1</span><span class="hl sym">))</span>
        `seq`
        print stdout counts
    <span class="hl sym">;</span>

