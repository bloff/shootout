<span class="com">&quot;  The Computer Language Shootout</span>
<span class="com">   http://shootout.alioth.debian.org/</span>
<span class="com"></span>
<span class="com">   contributed by Paolo Bonzini</span>
<span class="com">   would have never gotten the permutations right without Isaac Gouy's program&quot;</span>
<span class="com"></span>
<span class="com">Object subclass: #PermGenerator</span>
<span class="com">	instanceVariableNames: 'timesRotated perm atEnd'</span>
<span class="com">	classVariableNames: ''</span>
<span class="com">	poolDictionaries: ''</span>
<span class="com">	category: nil!</span>
<span class="com"></span>
<span class="com">!PermGenerator class methodsFor: 'create'!</span>
<span class="com"></span>
<span class="com">new: size</span>
<span class="com">    ^self new</span>
<span class="com">	initialize: size;</span>
<span class="com">	yourself! !</span>
<span class="com"></span>
<span class="com">!PermGenerator methodsFor: 'create'!</span>
<span class="com"></span>
<span class="com">atEnd</span>
<span class="com">    ^atEnd!</span>
<span class="com"></span>
<span class="com">next</span>
<span class="com">    | result |</span>
<span class="com">    result := perm copy.</span>
<span class="com">    self makeNext.</span>
<span class="com">    ^result!</span>
<span class="com"></span>
<span class="com">makeNext</span>
<span class="com">    | temp i remainder |</span>
<span class="com">    &quot;Generate the next permutation.&quot;</span>
<span class="com">    2 to: perm size do: [ :r |</span>
<span class="com">	&quot;Rotate the first r items to the left.&quot;</span>
<span class="com">        temp := perm at: 1.</span>
<span class="com">        1 to: r - 1 do: [ :i | perm at: i put: (perm at: i + 1) ].</span>
<span class="com">        perm at: r put: temp.</span>
<span class="com"></span>
<span class="com">        remainder := timesRotated at: r put: ((timesRotated at: r) + 1) \\ r.</span>
<span class="com">        remainder = 0 ifFalse: [ ^self ].</span>
<span class="com"></span>
<span class="com">	&quot;After r rotations, the first r items are in their original positions.</span>
<span class="com">	 Go on rotating the first r+1 items.&quot;</span>
<span class="com">    ].</span>
<span class="com"></span>
<span class="com">    &quot;We are past the final permutation.&quot;</span>
<span class="com">    atEnd := true!</span>
<span class="com"></span>
<span class="com">initialize: size</span>
<span class="com">    perm := (1 to: size) asArray.</span>
<span class="com">    timesRotated := Array new: size withAll: 0.</span>
<span class="com">    atEnd := false! !</span>
<span class="com"></span>
<span class="com">!Array methodsFor: 'pfannkuchen'!</span>
<span class="com"></span>
<span class="com">pfannkuchen</span>
<span class="com">    | first complement a b k |</span>
<span class="com">    k := 0.</span>
<span class="com">    [ (first := self at: 1) == 1 ] whileFalse: [</span>
<span class="com">	k := k + 1.</span>
<span class="com">	complement := first + 1.</span>
<span class="com">	1 to: first // 2 do: [ :i |</span>
<span class="com">	    a := self at: i.</span>
<span class="com">	    b := self at: complement - i.</span>
<span class="com">	    self at: i put: b.</span>
<span class="com">	    self at: complement - i put: a.</span>
<span class="com">	]</span>
<span class="com">    ].</span>
<span class="com">    ^k! !</span>
<span class="com"></span>
<span class="com">!SmallInteger methodsFor: 'pfannkuchen'!</span>
<span class="com"></span>
<span class="com">maxPfannkuchen</span>
<span class="com">    | max gen perm check |</span>
<span class="com">    max := 0.</span>
<span class="com">    check := 0.</span>
<span class="com">    gen := PermGenerator new: self.</span>
<span class="com">    [ gen atEnd ] whileFalse: [</span>
<span class="com">	perm := gen next.</span>
<span class="com">        check &lt; 30 ifTrue: [</span>
<span class="com">	    perm do: [ :each | each print ].</span>
<span class="com">	    Transcript nl.</span>
<span class="com">	    check := check + 1 ].</span>
<span class="com">	max := max max: perm pfannkuchen</span>
<span class="com">    ].</span>
<span class="com">    ^max! !</span>
<span class="com"></span>
<span class="com">| n |</span>
<span class="com">n := Smalltalk arguments first asInteger.</span>
<span class="com">Transcript</span>
<span class="com">    show: ('Pfannkuchen(%1) = %2' bindWith: n with: n maxPfannkuchen);</span>
<span class="com">    nl!</span>
