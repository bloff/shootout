<span class="str">&quot;  The Computer Language Shootout</span>
<span class="str">   http://shootout.alioth.debian.org/</span>
<span class="str">   contributed by Isaac Gouy&quot;</span><span class="sym">!</span>

<span class="sym">!</span>ComputerLanguageShootout.Benchmarks class methodsFor<span class="sym">:</span> <span class="str">'benchmarking'</span><span class="sym">!</span>

spectralnorm<span class="sym">:</span> argvString
   <span class="sym">|</span> n u v vBv vv answer <span class="sym">|</span>
   n <span class="sym">:=</span> argvString asNumber.
   u <span class="sym">:=</span> Array new<span class="sym">:</span> n withAll<span class="sym">:</span> <span class="num">1.0</span>d.
   v <span class="sym">:=</span> Array new<span class="sym">:</span> n withAll<span class="sym">:</span> <span class="num">0.0</span>d.

   <span class="num">1</span> to<span class="sym">:</span> <span class="num">10</span> <span class="kwa">do</span><span class="sym">: [:</span>i<span class="sym">|</span>
      v <span class="sym">:=</span> u multiplyAtAv.
      u <span class="sym">:=</span> v multiplyAtAv.
   <span class="sym">]</span>.

   vBv <span class="sym">:=</span> <span class="num">0.0</span>d.
   vv <span class="sym">:=</span> <span class="num">0.0</span>d.
   <span class="num">1</span> to<span class="sym">:</span> n <span class="kwa">do</span><span class="sym">: [:</span>i<span class="sym">|</span>
      vBv <span class="sym">:=</span> vBv <span class="sym">+ ((</span>u at<span class="sym">:</span> i<span class="sym">) * (</span>v at<span class="sym">:</span> i<span class="sym">))</span>.
      vv <span class="sym">:=</span> vv <span class="sym">+ ((</span>v at<span class="sym">:</span> i<span class="sym">) * (</span>v at<span class="sym">:</span> i<span class="sym">))</span>.
   <span class="sym">]</span>.

   answer <span class="sym">:= (</span>vBv<span class="sym">/</span>vv<span class="sym">)</span> sqrt.
   OS.Stdout nextPutAll<span class="sym">: ((</span>answer asFixedPoint<span class="sym">:</span> <span class="num">9</span><span class="sym">)</span> printString copyWithout<span class="sym">:</span> <span class="kwb">$s</span><span class="sym">);</span> cr<span class="sym">! !</span>


<span class="sym">!</span>Core.Integer methodsFor<span class="sym">:</span> <span class="str">'computer language shootout'</span><span class="sym">!</span>

matrixA<span class="sym">:</span> anInteger
<span class="str">&quot;fixup one-based indexing to zero-based indexing - cleanup later&quot;</span>
   <span class="sym">|</span> i j <span class="sym">|</span>
   i <span class="sym">:=</span> self <span class="sym">-</span> <span class="num">1</span>.
   j <span class="sym">:=</span> anInteger <span class="sym">-</span> <span class="num">1</span>.
   ^<span class="num">1.0</span>d <span class="sym">/ (</span>i <span class="sym">+</span> j <span class="sym">* (</span>i <span class="sym">+</span> j <span class="sym">+</span> <span class="num">1</span><span class="sym">) /</span><span class="num">2</span>  <span class="sym">+</span> i <span class="sym">+</span> <span class="num">1</span><span class="sym">)</span> asDouble<span class="sym">! !</span>


<span class="sym">!</span>Core.Array methodsFor<span class="sym">:</span> <span class="str">'computer language shootout'</span><span class="sym">!</span>

multiplyAv
   <span class="sym">|</span> n av <span class="sym">|</span>
   n <span class="sym">:=</span> self size.
   av <span class="sym">:=</span> Array new<span class="sym">:</span> n withAll<span class="sym">:</span> <span class="num">0.0</span>d.
   <span class="num">1</span> to<span class="sym">:</span> n <span class="kwa">do</span><span class="sym">: [:</span>i<span class="sym">|</span>
      <span class="num">1</span> to<span class="sym">:</span> n <span class="kwa">do</span><span class="sym">: [:</span>j<span class="sym">|</span>
         av at<span class="sym">:</span> i put<span class="sym">: (</span>av at<span class="sym">:</span> i<span class="sym">) + ((</span>i matrixA<span class="sym">:</span> j<span class="sym">) * (</span>self at<span class="sym">:</span> j<span class="sym">)) ]]</span>.
   ^av<span class="sym">! !</span>

<span class="sym">!</span>Core.Array methodsFor<span class="sym">:</span> <span class="str">'computer language shootout'</span><span class="sym">!</span>

multiplyAtv
   <span class="sym">|</span> n atv <span class="sym">|</span>
   n <span class="sym">:=</span> self size.
   atv <span class="sym">:=</span> Array new<span class="sym">:</span> n withAll<span class="sym">:</span> <span class="num">0.0</span>d.
   <span class="num">1</span> to<span class="sym">:</span> n <span class="kwa">do</span><span class="sym">: [:</span>i<span class="sym">|</span>
      <span class="num">1</span> to<span class="sym">:</span> n <span class="kwa">do</span><span class="sym">: [:</span>j<span class="sym">|</span>
         atv at<span class="sym">:</span> i put<span class="sym">: (</span>atv at<span class="sym">:</span> i<span class="sym">) + ((</span>j matrixA<span class="sym">:</span> i<span class="sym">) * (</span>self at<span class="sym">:</span> j<span class="sym">)) ]]</span>.
   ^atv<span class="sym">! !</span>

<span class="sym">!</span>Core.Array methodsFor<span class="sym">:</span> <span class="str">'computer language shootout'</span><span class="sym">!</span>

multiplyAtAv
   ^<span class="sym">(</span>self multiplyAv<span class="sym">)</span> multiplyAtv<span class="sym">! !</span>
