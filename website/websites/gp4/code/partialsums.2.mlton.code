<span class="hl com">(* The Computer Language Shootout</span>
<span class="hl com">   http://shootout.alioth.debian.org/</span>
<span class="hl com">   contributed by Scott Cruzen</span>
<span class="hl com">*)</span>

<span class="hl kwa">open Real</span>.Math

<span class="hl kwa">val</span> n <span class="hl sym">=</span> valOf <span class="hl sym">(</span><span class="hl kwa">Int</span>.fromString <span class="hl sym">(</span>hd <span class="hl sym">(</span>CommandLine.arguments<span class="hl sym">())))</span>

<span class="hl kwa">fun</span> nsum <span class="hl sym">(</span>i<span class="hl sym">,</span>f1<span class="hl sym">,</span>r1<span class="hl sym">,</span>f2<span class="hl sym">,</span>r2<span class="hl sym">,</span>f3<span class="hl sym">,</span>r3<span class="hl sym">,</span>f4<span class="hl sym">,</span>r4<span class="hl sym">,</span>f5<span class="hl sym">,</span>r5<span class="hl sym">,</span>f6<span class="hl sym">,</span>r6<span class="hl sym">,</span>f7<span class="hl sym">,</span>r7<span class="hl sym">,</span>f8<span class="hl sym">,</span>r8<span class="hl sym">,</span>f9<span class="hl sym">,</span>r9<span class="hl sym">,</span>a<span class="hl sym">:</span><span class="hl kwb">real</span><span class="hl sym">) =</span>
   <span class="hl kwa">let val</span> k <span class="hl sym">=</span> <span class="hl kwa">Real</span>.fromInt i <span class="hl kwa">in</span>
      <span class="hl kwa">if</span> i <span class="hl sym">&lt;=</span> n <span class="hl kwa">then</span> nsum <span class="hl sym">(</span>i <span class="hl sym">+</span> <span class="hl num">1</span><span class="hl sym">,</span> f1<span class="hl sym">,</span> f1 <span class="hl sym">(</span>k <span class="hl sym">-</span> <span class="hl num">1.0</span><span class="hl sym">,</span> r1<span class="hl sym">),</span> f2<span class="hl sym">,</span> f2 <span class="hl sym">(</span>k<span class="hl sym">,</span> r2<span class="hl sym">),</span> f3<span class="hl sym">,</span> f3 <span class="hl sym">(</span>k<span class="hl sym">,</span> r3<span class="hl sym">),</span>
         f4<span class="hl sym">,</span> f4 <span class="hl sym">(</span>k<span class="hl sym">,</span> r4<span class="hl sym">),</span> f5<span class="hl sym">,</span> f5 <span class="hl sym">(</span>k<span class="hl sym">,</span> r5<span class="hl sym">),</span> f6<span class="hl sym">,</span> f6 <span class="hl sym">(</span>k<span class="hl sym">,</span> r6<span class="hl sym">),</span> f7<span class="hl sym">,</span> f7 <span class="hl sym">(</span>k<span class="hl sym">,</span> r7<span class="hl sym">),</span>
         f8<span class="hl sym">,</span> f8 <span class="hl sym">(</span>k<span class="hl sym">,</span> r8<span class="hl sym">,</span> a<span class="hl sym">),</span> f9<span class="hl sym">,</span> f9 <span class="hl sym">(</span>k<span class="hl sym">,</span> r9<span class="hl sym">,</span> a<span class="hl sym">),</span> ~a<span class="hl sym">)</span>
      <span class="hl kwa">else</span>
         <span class="hl sym">[</span>f1 <span class="hl sym">(</span>k <span class="hl sym">-</span> <span class="hl num">1.0</span><span class="hl sym">,</span> r1<span class="hl sym">),</span> r2<span class="hl sym">,</span> r3<span class="hl sym">,</span> r4<span class="hl sym">,</span> r5<span class="hl sym">,</span> r6<span class="hl sym">,</span> r7<span class="hl sym">,</span> r8<span class="hl sym">,</span> r9<span class="hl sym">]</span> <span class="hl kwa">end</span>

<span class="hl kwa">val</span> _ <span class="hl sym">=</span> map <span class="hl sym">(</span><span class="hl kwa">fn</span> <span class="hl sym">(</span>s<span class="hl sym">,</span>x<span class="hl sym">) =&gt;</span> print<span class="hl sym">(</span>concat<span class="hl sym">[</span><span class="hl kwa">Real</span>.fmt <span class="hl sym">(</span><span class="hl kwa">StringCvt</span>.FIX <span class="hl sym">(</span>SOME <span class="hl num">9</span><span class="hl sym">))</span> x<span class="hl sym">,</span><span class="hl str">&quot;</span><span class="hl esc">\t</span><span class="hl str">&quot;</span><span class="hl sym">,</span>s<span class="hl sym">,</span><span class="hl str">&quot;</span><span class="hl esc">\n</span><span class="hl str">&quot;</span><span class="hl sym">]))</span>
   <span class="hl sym">(</span><span class="hl kwa">ListPair</span>.zip <span class="hl sym">([</span><span class="hl str">&quot;(2/3)^k&quot;</span><span class="hl sym">,</span> <span class="hl str">&quot;k^-0.5&quot;</span><span class="hl sym">,</span> <span class="hl str">&quot;1/k(k+1)&quot;</span><span class="hl sym">,</span> <span class="hl str">&quot;Flint Hills&quot;</span><span class="hl sym">,</span> <span class="hl str">&quot;Cookson Hills&quot;</span><span class="hl sym">,</span>
                   <span class="hl str">&quot;Harmonic&quot;</span><span class="hl sym">,</span> <span class="hl str">&quot;Riemann Zeta&quot;</span><span class="hl sym">,</span> <span class="hl str">&quot;Alternating Harmonic&quot;</span><span class="hl sym">,</span> <span class="hl str">&quot;Gregory&quot;</span><span class="hl sym">],</span>
      nsum <span class="hl sym">(</span><span class="hl num">1</span><span class="hl sym">, (</span><span class="hl kwa">fn</span> <span class="hl sym">(</span>k<span class="hl sym">,</span> r<span class="hl sym">) =&gt;</span> r <span class="hl sym">+</span> pow<span class="hl sym">(</span><span class="hl num">2.0</span> <span class="hl sym">/</span> <span class="hl num">3.0</span><span class="hl sym">,</span> k<span class="hl sym">)),</span> <span class="hl num">0.0</span><span class="hl sym">,</span>
         <span class="hl sym">(</span><span class="hl kwa">fn</span> <span class="hl sym">(</span>k<span class="hl sym">,</span> r<span class="hl sym">) =&gt;</span> r <span class="hl sym">+</span> <span class="hl num">1.0</span> <span class="hl sym">/</span> sqrt k<span class="hl sym">),</span> <span class="hl num">0.0</span><span class="hl sym">,</span>
         <span class="hl sym">(</span><span class="hl kwa">fn</span> <span class="hl sym">(</span>k<span class="hl sym">,</span> r<span class="hl sym">) =&gt;</span> r <span class="hl sym">+</span> <span class="hl num">1.0</span> <span class="hl sym">/ (</span>k <span class="hl sym">* (</span>k <span class="hl sym">+</span> <span class="hl num">1.0</span><span class="hl sym">))),</span> <span class="hl num">0.0</span><span class="hl sym">,</span>
         <span class="hl sym">(</span><span class="hl kwa">fn</span> <span class="hl sym">(</span>k<span class="hl sym">,</span> r<span class="hl sym">) =&gt;</span> r <span class="hl sym">+</span> <span class="hl num">1.0</span> <span class="hl sym">/ (</span>k <span class="hl sym">*</span> k <span class="hl sym">*</span> k <span class="hl sym">*</span> sin k <span class="hl sym">*</span> sin k<span class="hl sym">)),</span> <span class="hl num">0.0</span><span class="hl sym">,</span>
         <span class="hl sym">(</span><span class="hl kwa">fn</span> <span class="hl sym">(</span>k<span class="hl sym">,</span> r<span class="hl sym">) =&gt;</span> r <span class="hl sym">+</span> <span class="hl num">1.0</span> <span class="hl sym">/ (</span>k <span class="hl sym">*</span> k <span class="hl sym">*</span> k <span class="hl sym">*</span> cos k <span class="hl sym">*</span> cos k<span class="hl sym">)),</span> <span class="hl num">0.0</span><span class="hl sym">,</span>
         <span class="hl sym">(</span><span class="hl kwa">fn</span> <span class="hl sym">(</span>k<span class="hl sym">,</span> r<span class="hl sym">) =&gt;</span> r <span class="hl sym">+</span> <span class="hl num">1.0</span> <span class="hl sym">/</span> k<span class="hl sym">),</span> <span class="hl num">0.0</span><span class="hl sym">, (</span><span class="hl kwa">fn</span> <span class="hl sym">(</span>k<span class="hl sym">,</span> r<span class="hl sym">) =&gt;</span> r <span class="hl sym">+</span> <span class="hl num">1.0</span> <span class="hl sym">/ (</span>k <span class="hl sym">*</span> k<span class="hl sym">)),</span> <span class="hl num">0.0</span><span class="hl sym">,</span>
         <span class="hl sym">(</span><span class="hl kwa">fn</span> <span class="hl sym">(</span>k<span class="hl sym">,</span> r<span class="hl sym">,</span> a<span class="hl sym">) =&gt;</span> r <span class="hl sym">+</span> a <span class="hl sym">/</span> k<span class="hl sym">),</span> <span class="hl num">0.0</span><span class="hl sym">,</span>
         <span class="hl sym">(</span><span class="hl kwa">fn</span> <span class="hl sym">(</span>k<span class="hl sym">,</span> r<span class="hl sym">,</span> a<span class="hl sym">) =&gt;</span> r <span class="hl sym">+</span> a <span class="hl sym">/ (</span><span class="hl num">2.0</span> <span class="hl sym">*</span> k <span class="hl sym">-</span> <span class="hl num">1.0</span><span class="hl sym">)),</span> <span class="hl num">0.0</span><span class="hl sym">,</span> <span class="hl num">1.0</span><span class="hl sym">)))</span>
