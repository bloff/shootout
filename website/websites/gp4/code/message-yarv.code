<span class="hl slc"># The Computer Language Shootout</span>
<span class="hl slc"># http://shootout.alioth.debian.org/</span>
<span class="hl slc">#</span>
<span class="hl slc"># Contributed by Jesse Millikan</span>

require <span class="hl str">'thread'</span>

N <span class="hl sym">=</span> <span class="hl kwc">ARGV</span><span class="hl sym">[</span><span class="hl num">0</span><span class="hl sym">].</span>to_i
next_q <span class="hl sym">=</span> last_q <span class="hl sym">=</span> SizedQueue<span class="hl sym">.</span><span class="hl kwd">new</span><span class="hl sym">(</span><span class="hl num">1</span><span class="hl sym">)</span>

<span class="hl num">500</span><span class="hl sym">.</span>times <span class="hl sym">{</span>
 q <span class="hl sym">=</span> SizedQueue<span class="hl sym">.</span><span class="hl kwd">new</span><span class="hl sym">(</span><span class="hl num">1</span><span class="hl sym">)</span>
 q2 <span class="hl sym">=</span> next_q
 Thread<span class="hl sym">.</span>new<span class="hl sym">{</span>
  i <span class="hl sym">=</span> N
  <span class="hl kwa">while</span> i <span class="hl sym">&gt;</span> <span class="hl num">0</span>
   q2<span class="hl sym">.</span><span class="hl kwd">push</span><span class="hl sym">(</span>q<span class="hl sym">.</span>pop<span class="hl sym">+</span><span class="hl num">1</span><span class="hl sym">)</span>
   i <span class="hl sym">-=</span> <span class="hl num">1</span>
  <span class="hl kwa">end</span>
 <span class="hl sym">}</span>
 next_q <span class="hl sym">=</span> q
<span class="hl sym">}</span>

Thread<span class="hl sym">.</span>new<span class="hl sym">{</span>N<span class="hl sym">.</span>times<span class="hl sym">{</span>next_q<span class="hl sym">.</span><span class="hl kwd">push</span><span class="hl sym">(</span><span class="hl num">0</span><span class="hl sym">)}}</span>

t <span class="hl sym">=</span> <span class="hl num">0</span>
N<span class="hl sym">.</span>times<span class="hl sym">{</span>t<span class="hl sym">+=</span>last_q<span class="hl sym">.</span>pop<span class="hl sym">}</span>
puts t

