<span class="hl slc">#!/usr/bin/env ruby</span>
<span class="hl slc">#</span>
<span class="hl slc"># Gonzalo Garramuno -- Dec.31 2006</span>
<span class="hl slc">#</span>

<span class="hl kwa">def</span> <span class="hl kwd">coroutine</span><span class="hl sym">(</span>n<span class="hl sym">)</span>
  <span class="hl kwa">if</span> n <span class="hl sym">&gt;</span> <span class="hl num">1</span>
    <span class="hl kwd">coroutine</span><span class="hl sym">(</span>n-1<span class="hl sym">) { |</span>x<span class="hl sym">|</span> <span class="hl kwa">yield</span> x <span class="hl sym">+</span> <span class="hl num">1</span> <span class="hl sym">}</span>
  <span class="hl kwa">else</span>
    <span class="hl kwa">yield</span> <span class="hl num">1</span> <span class="hl kwa">while true</span>
  <span class="hl kwa">end</span>
<span class="hl kwa">end</span>

iter  <span class="hl sym">=</span> <span class="hl num">0</span>
last  <span class="hl sym">=</span> <span class="hl kwc">ARGV</span><span class="hl sym">[</span><span class="hl num">0</span><span class="hl sym">].</span>to_i
count <span class="hl sym">=</span> <span class="hl num">0</span>

<span class="hl kwd">coroutine</span><span class="hl sym">(</span> <span class="hl num">500</span> <span class="hl sym">) { |</span>x<span class="hl sym">|</span>
  <span class="hl kwa">break if</span> iter <span class="hl sym">&gt;=</span> last
  count <span class="hl sym">+=</span> x
  iter  <span class="hl sym">+=</span> <span class="hl num">1</span>
<span class="hl sym">}</span>

puts count
