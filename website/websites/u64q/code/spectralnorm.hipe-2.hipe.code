<source>
<def></def><slc>%The Computer Language Benchmarks Game</slc><br />
<def></def><slc>%http://shootout.alioth.debian.org/</slc><br />
<def></def><slc>%contributed by Isaac Gouy</slc><br />
<def></def><slc>%minor modifications by Fredrik Svahn</slc><br />
<def></def><br />
<sym>-</sym><def></def><kwa>module</kwa><def></def><sym>(</sym><def>spectralnorm</def><sym>).</sym><br />
<def></def><sym>-</sym><def></def><kwa>export</kwa><def></def><sym>([</sym><def>main</def><sym>/</sym><def></def><num>1</num><def></def><sym>]).</sym><br />
<def></def><sym>-</sym><def></def><kwa>define</kwa><def></def><sym>(</sym><def></def><kwd>F</kwd><def></def><sym>(</sym><def>X</def><sym>),</sym> <def></def><kwd>is_float</kwd><def></def><sym>(</sym><def>X</def><sym>)).</sym><br />
<def></def><br />
<kwd>main</kwd><def></def><sym>([</sym><def>Arg</def><sym>]) -&gt;</sym><br />
<def>    N</def> <sym>=</sym> <def></def><kwb>list_to_integer</kwb><def></def><sym>(</sym><def>Arg</def><sym>),</sym><br />
<def></def>    <sym>{</sym><def>U</def><sym>,</sym><def>V</def><sym>} =</sym> <def></def><kwd>powerMethod</kwd><def></def><sym>(</sym><def>N</def><sym>,</sym><def></def><num>10</num><def></def><sym>,</sym> <def></def><kwd>array</kwd><def></def><sym>(</sym><def></def><num>1.0</num><def></def><sym>,</sym><def>N</def><sym>,[]),</sym> <def></def><kwd>array</kwd><def></def><sym>(</sym><def></def><num>0.0</num><def></def><sym>,</sym><def>N</def><sym>,[]) ),</sym><br />
<def>    io</def><sym>:</sym><def></def><kwd>format</kwd><def></def><sym>(</sym><def></def><str>&quot;~.9f</str><esc>\</esc><str>n&quot;</str><def></def><sym>,[</sym> <def></def><kwd>loop</kwd><def></def><sym>(</sym><def>N</def><sym>,</sym><def>U</def><sym>,</sym><def>V</def><sym>,</sym><def></def><num>0.0</num><def></def><sym>,</sym><def></def><num>0.0</num><def></def><sym>) ]),</sym><br />
<def>    erlang</def><sym>:</sym><def></def><kwb>halt</kwb><def></def><sym>(</sym><def></def><num>0</num><def></def><sym>).</sym><br />
<def></def><br />
<slc>% eigenvalue of V</slc><br />
<def></def><kwd>loop</kwd><def></def><sym>(</sym><def></def><num>0</num><def></def><sym>,</sym><def>_</def><sym>,</sym><def>_</def><sym>,</sym><def>VBV</def><sym>,</sym><def>VV</def><sym>)</sym> <def></def><kwa>when</kwa> <def></def><sym>?</sym><def></def><kwd>F</kwd><def></def><sym>(</sym><def>VBV</def><sym>), ?</sym><def></def><kwd>F</kwd><def></def><sym>(</sym><def>VV</def><sym>) -&gt;</sym> <def></def><kwb>math</kwb><def></def><sym>:</sym><def></def><kwb>sqrt</kwb><def></def><sym>(</sym><def>VBV</def><sym>/</sym><def>VV</def><sym>);</sym><br />
<def></def><kwd>loop</kwd><def></def><sym>(</sym><def>I</def><sym>,</sym><def>U</def><sym>,</sym><def>V</def><sym>,</sym><def>VBV</def><sym>,</sym><def>VV</def><sym>)</sym> <def></def><kwa>when</kwa> <def></def><sym>?</sym><def></def><kwd>F</kwd><def></def><sym>(</sym><def>VBV</def><sym>), ?</sym><def></def><kwd>F</kwd><def></def><sym>(</sym><def>VV</def><sym>) -&gt;</sym><br />
<def>   VI</def> <sym>=</sym> <def></def><kwb>element</kwb><def></def><sym>(</sym><def>I</def><sym>,</sym><def>V</def><sym>),</sym><br />
<def></def>   <kwd>loop</kwd><def></def><sym>(</sym><def>I</def><sym>-</sym><def></def><num>1</num><def></def><sym>,</sym><def>U</def><sym>,</sym><def>V</def><sym>,</sym> <def>VBV</def> <sym>+</sym> <def></def><kwb>element</kwb><def></def><sym>(</sym><def>I</def><sym>,</sym><def>U</def><sym>)*</sym><def>VI</def><sym>,</sym> <def>VV</def> <sym>+</sym> <def>VI</def><sym>*</sym><def>VI</def><sym>).</sym><br />
<def></def><br />
<slc>% 2I steps of the power method</slc><br />
<def></def><kwd>powerMethod</kwd><def></def><sym>(</sym><def>_</def><sym>,</sym><def></def><num>0</num><def></def><sym>,</sym><def>A</def><sym>,</sym><def>B</def><sym>) -&gt; {</sym><def>A</def><sym>,</sym><def>B</def><sym>};</sym><br />
<def></def><kwd>powerMethod</kwd><def></def><sym>(</sym><def>N</def><sym>,</sym><def>I</def><sym>,</sym><def>A</def><sym>,</sym><def>B</def><sym>) -&gt;</sym><br />
<def>   V</def> <sym>=</sym> <def></def><kwd>atav</kwd><def></def><sym>(</sym><def>N</def><sym>,</sym><def>A</def><sym>,</sym><def>B</def><sym>),</sym><br />
<def>   U</def> <sym>=</sym> <def></def><kwd>atav</kwd><def></def><sym>(</sym><def>N</def><sym>,</sym><def>V</def><sym>,</sym><def>A</def><sym>),</sym><br />
<def></def>   <kwd>powerMethod</kwd><def></def><sym>(</sym><def>N</def><sym>,</sym><def>I</def><sym>-</sym><def></def><num>1</num><def></def><sym>,</sym><def>U</def><sym>,</sym><def>V</def><sym>).</sym><br />
<def></def><br />
<slc>% return element i,j of infinite matrix A</slc><br />
<def></def><kwd>a</kwd><def></def><sym>(</sym><def>II</def><sym>,</sym><def>JJ</def><sym>) -&gt;</sym><br />
<def>   I</def> <sym>=</sym> <def>II</def><sym>-</sym><def></def><num>1</num><def></def><sym>,</sym> <def>J</def> <sym>=</sym> <def>JJ</def><sym>-</sym><def></def><num>1</num><def></def><sym>,</sym><br />
<def></def>   <num>1</num><def></def><sym>/((</sym><def>I</def><sym>+</sym><def>J</def><sym>)*(</sym><def>I</def><sym>+</sym><def>J</def><sym>+</sym><def></def><num>1</num><def></def><sym>)/</sym><def></def><num>2</num><def></def><sym>+</sym><def>I</def><sym>+</sym><def></def><num>1</num><def></def><sym>).</sym><br />
<def></def><br />
<slc>% multiply vector v by matrix A</slc><br />
<def></def><kwd>av</kwd><def></def><sym>(</sym><def>_</def><sym>,</sym><def></def><num>0</num><def></def><sym>,</sym><def>_</def><sym>,</sym><def>AV</def><sym>) -&gt;</sym> <def>AV</def><sym>;</sym><br />
<def></def><kwd>av</kwd><def></def><sym>(</sym><def>N</def><sym>,</sym><def>I</def><sym>,</sym><def>V</def><sym>,</sym><def>AV</def><sym>) -&gt;</sym><br />
<def></def>   <kwd>av</kwd><def></def><sym>(</sym><def>N</def><sym>,</sym><def>I</def><sym>-</sym><def></def><num>1</num><def></def><sym>,</sym><def>V</def><sym>,</sym> <def></def><kwb>setelement</kwb><def></def><sym>(</sym><def>I</def><sym>,</sym><def>AV</def><sym>,</sym> <def></def><kwd>avloop</kwd><def></def><sym>(</sym><def>N</def><sym>,</sym><def>I</def><sym>,</sym><def>V</def><sym>,</sym><def></def><num>0.0</num><def></def><sym>) )).</sym><br />
<def></def><br />
<kwd>avloop</kwd><def></def><sym>(</sym><def></def><num>0</num><def></def><sym>,</sym><def>_</def><sym>,</sym><def>_</def><sym>,</sym><def>X</def><sym>)</sym> <def></def><kwa>when</kwa> <def></def><sym>?</sym><def></def><kwd>F</kwd><def></def><sym>(</sym><def>X</def><sym>) -&gt;</sym> <def>X</def><sym>;</sym><br />
<def></def><kwd>avloop</kwd><def></def><sym>(</sym><def>J</def><sym>,</sym><def>I</def><sym>,</sym><def>V</def><sym>,</sym><def>X</def><sym>)</sym> <def></def><kwa>when</kwa> <def></def><sym>?</sym><def></def><kwd>F</kwd><def></def><sym>(</sym><def>X</def><sym>) -&gt;</sym><br />
<def></def>   <kwd>avloop</kwd><def></def><sym>(</sym><def>J</def><sym>-</sym><def></def><num>1</num><def></def><sym>,</sym><def>I</def><sym>,</sym><def>V</def><sym>,</sym> <def>X</def> <sym>+</sym> <def></def><kwd>a</kwd><def></def><sym>(</sym><def>I</def><sym>,</sym><def>J</def><sym>)*</sym><def></def><kwb>element</kwb><def></def><sym>(</sym><def>J</def><sym>,</sym><def>V</def><sym>) ).</sym><br />
<def></def><br />
<slc>% multiply vector v by matrix A transposed</slc><br />
<def></def><kwd>atv</kwd><def></def><sym>(</sym><def>_</def><sym>,</sym><def></def><num>0</num><def></def><sym>,</sym><def>_</def><sym>,</sym><def>ATV</def><sym>)  -&gt;</sym> <def>ATV</def><sym>;</sym><br />
<def></def><kwd>atv</kwd><def></def><sym>(</sym><def>N</def><sym>,</sym><def>I</def><sym>,</sym><def>V</def><sym>,</sym><def>ATV</def><sym>)  -&gt;</sym><br />
<def></def>   <kwd>atv</kwd><def></def><sym>(</sym><def>N</def><sym>,</sym><def>I</def><sym>-</sym><def></def><num>1</num><def></def><sym>,</sym><def>V</def><sym>,</sym> <def></def><kwb>setelement</kwb><def></def><sym>(</sym><def>I</def><sym>,</sym><def>ATV</def><sym>,</sym> <def></def><kwd>atvloop</kwd><def></def><sym>(</sym><def>N</def><sym>,</sym><def>I</def><sym>,</sym><def>V</def><sym>,</sym><def></def><num>0.0</num><def></def><sym>) )).</sym><br />
<def></def><br />
<kwd>atvloop</kwd><def></def><sym>(</sym><def></def><num>0</num><def></def><sym>,</sym><def>_</def><sym>,</sym><def>_</def><sym>,</sym><def>X</def><sym>)</sym> <def></def><kwa>when</kwa> <def></def><sym>?</sym><def></def><kwd>F</kwd><def></def><sym>(</sym><def>X</def><sym>) -&gt;</sym> <def>X</def><sym>;</sym><br />
<def></def><kwd>atvloop</kwd><def></def><sym>(</sym><def>J</def><sym>,</sym><def>I</def><sym>,</sym><def>V</def><sym>,</sym><def>X</def><sym>)</sym> <def></def><kwa>when</kwa> <def></def><sym>?</sym><def></def><kwd>F</kwd><def></def><sym>(</sym><def>X</def><sym>) -&gt;</sym><br />
<def></def>    <kwd>atvloop</kwd><def></def><sym>(</sym><def>J</def><sym>-</sym><def></def><num>1</num><def></def><sym>,</sym><def>I</def><sym>,</sym><def>V</def><sym>,</sym> <def>X</def> <sym>+</sym> <def></def><kwd>a</kwd><def></def><sym>(</sym><def>J</def><sym>,</sym><def>I</def><sym>)*</sym><def></def><kwb>element</kwb><def></def><sym>(</sym><def>J</def><sym>,</sym><def>V</def><sym>) ).</sym><br />
<def></def><br />
<slc>% multiply vector v by matrix A and then by matrix A transposed</slc><br />
<def></def><kwd>atav</kwd><def></def><sym>(</sym><def>N</def><sym>,</sym><def>V</def><sym>,</sym><def>ATAV</def><sym>) -&gt;</sym><br />
<def></def>   <kwd>atv</kwd><def></def><sym>(</sym><def>N</def><sym>,</sym><def>N</def><sym>,</sym> <def></def><kwd>av</kwd><def></def><sym>(</sym><def>N</def><sym>,</sym><def>N</def><sym>,</sym><def>V</def><sym>,</sym><def></def><kwd>array</kwd><def></def><sym>(</sym><def></def><num>0.0</num><def></def><sym>,</sym><def>N</def><sym>,[])) ,</sym><def>ATAV</def><sym>).</sym><br />
<def></def><br />
<slc>% initialize a list and convert it to a tuple</slc><br />
<def></def><kwd>array</kwd><def></def><sym>(</sym><def>_</def><sym>,</sym><def></def><num>0</num><def></def><sym>,</sym><def>L</def><sym>) -&gt;</sym> <def></def><kwb>list_to_tuple</kwb><def></def><sym>(</sym><def>L</def><sym>);</sym><br />
<def></def><kwd>array</kwd><def></def><sym>(</sym><def>X</def><sym>,</sym><def>N</def><sym>,</sym><def>L</def><sym>)</sym> <def></def><kwa>when</kwa> <def></def><sym>?</sym><def></def><kwd>F</kwd><def></def><sym>(</sym><def>X</def><sym>) -&gt;</sym> <def></def><kwd>array</kwd><def></def><sym>(</sym><def>X</def><sym>,</sym><def>N</def><sym>-</sym><def></def><num>1</num><def></def><sym>,[</sym><def>X</def><sym>|</sym><def>L</def><sym>]).</sym><def></def><br />
</source>
