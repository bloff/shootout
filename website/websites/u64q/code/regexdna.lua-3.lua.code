<source>
<def></def><slc>-- The Computer Language Shootout</slc><br />
<def></def><slc>-- http://shootout.alioth.debian.org/</slc><br />
<def></def><slc>-- contributed by Mike Pall</slc><br />
<def></def><br />
<kwa>local</kwa> <def>gfind</def><sym>,</sym> <def></def><kwb>gsub</kwb><def></def><sym>,</sym> <def></def><kwb>write</kwb> <def></def><sym>=</sym> <def></def><kwb>string</kwb><def></def><sym>.</sym><def>gfind</def><sym>,</sym> <def></def><kwb>string</kwb><def></def><sym>.</sym><def></def><kwb>gsub</kwb><def></def><sym>,</sym> <def>io</def><sym>.</sym><def></def><kwb>write</kwb><br />
<def></def><br />
<kwa>local</kwa> <def>seq</def> <sym>=</sym> <def>io</def><sym>.</sym><def></def><kwb>read</kwb><def></def><sym>(</sym><def></def><str>&quot;*a&quot;</str><def></def><sym>)</sym><br />
<def></def><kwa>local</kwa> <def>ilen</def> <sym>=</sym> <def></def><slc>#seq</slc><br />
<def><br />
seq</def> <sym>=</sym> <def></def><kwb>gsub</kwb><def></def><sym>(</sym><def>seq</def><sym>,</sym> <def></def><str>&quot;&gt;.-</str><esc>\n</esc><str>&quot;</str><def></def><sym>,</sym> <def></def><str>&quot;&quot;</str><def></def><sym>)</sym><br />
<def>seq</def> <sym>=</sym> <def></def><kwb>gsub</kwb><def></def><sym>(</sym><def>seq</def><sym>,</sym> <def></def><str>&quot;</str><esc>\n</esc><str>&quot;</str><def></def><sym>,</sym> <def></def><str>&quot;&quot;</str><def></def><sym>)</sym><br />
<def></def><kwa>local</kwa> <def>clen</def> <sym>=</sym> <def></def><slc>#seq</slc><br />
<def></def><br />
<kwa>local</kwa> <def>variants</def> <sym>= {</sym><br />
<def></def>  <str>&quot;agggtaaa&quot;</str><def></def><sym>,</sym> <def></def><str>&quot;tttaccct&quot;</str><def></def><sym>,</sym><br />
<def></def>  <str>&quot;[cgt]gggtaaa&quot;</str><def></def><sym>,</sym> <def></def><str>&quot;tttaccc[acg]&quot;</str><def></def><sym>,</sym><br />
<def></def>  <str>&quot;a[act]ggtaaa&quot;</str><def></def><sym>,</sym> <def></def><str>&quot;tttacc[agt]t&quot;</str><def></def><sym>,</sym><br />
<def></def>  <str>&quot;ag[act]gtaaa&quot;</str><def></def><sym>,</sym> <def></def><str>&quot;tttac[agt]ct&quot;</str><def></def><sym>,</sym><br />
<def></def>  <str>&quot;agg[act]taaa&quot;</str><def></def><sym>,</sym> <def></def><str>&quot;ttta[agt]cct&quot;</str><def></def><sym>,</sym><br />
<def></def>  <str>&quot;aggg[acg]aaa&quot;</str><def></def><sym>,</sym> <def></def><str>&quot;ttt[cgt]ccct&quot;</str><def></def><sym>,</sym><br />
<def></def>  <str>&quot;agggt[cgt]aa&quot;</str><def></def><sym>,</sym> <def></def><str>&quot;tt[acg]accct&quot;</str><def></def><sym>,</sym><br />
<def></def>  <str>&quot;agggta[cgt]a&quot;</str><def></def><sym>,</sym> <def></def><str>&quot;t[acg]taccct&quot;</str><def></def><sym>,</sym><br />
<def></def>  <str>&quot;agggtaa[cgt]&quot;</str><def></def><sym>,</sym> <def></def><str>&quot;[acg]ttaccct&quot;</str><def></def><sym>,</sym><br />
<def></def><sym>}</sym><br />
<def></def><kwa>local</kwa> <def>count</def><sym>,</sym> <def>prev</def> <sym>=</sym> <def></def><num>0</num><br />
<def></def><kwa>for</kwa> <def>i</def><sym>,</sym><def>pattern</def> <kwa>in</kwa> <def></def><kwd>ipairs</kwd><def></def><sym>(</sym><def>variants</def><sym>)</sym> <def></def><kwa>do</kwa><br />
<def></def>  <kwa>for</kwa> <def>_</def> <kwa>in</kwa> <def></def><kwd>gfind</kwd><def></def><sym>(</sym><def>seq</def><sym>,</sym> <def>pattern</def><sym>)</sym> <def></def><kwa>do</kwa> <def>count</def> <sym>=</sym> <def>count</def> <sym>+</sym> <def></def><num>1</num> <def></def><kwa>end</kwa><br />
<def></def>  <kwa>if</kwa> <def>prev</def> <kwa>then</kwa><br />
<def></def>    <kwb>write</kwb><def></def><sym>(</sym><def>prev</def><sym>,</sym> <def></def><str>&quot;|&quot;</str><def></def><sym>,</sym> <def>pattern</def><sym>,</sym> <def></def><str>&quot; &quot;</str><def></def><sym>,</sym> <def>count</def><sym>,</sym> <def></def><str>&quot;</str><esc>\n</esc><str>&quot;</str><def></def><sym>)</sym><br />
<def>    count</def> <sym>=</sym> <def></def><num>0</num><br />
<def>    prev</def> <sym>=</sym> <def></def><kwa>nil</kwa><br />
<def></def>  <kwa>else</kwa><br />
<def>    prev</def> <sym>=</sym> <def>pattern</def><br />
  <kwa>end</kwa><br />
<def></def><kwa>end</kwa><br />
<def></def><br />
<kwa>local</kwa> <def>subst</def> <sym>= {</sym><br />
<def>  B</def> <sym>=</sym> <def></def><str>&quot;(c|g|t)&quot;</str><def></def><sym>,</sym> <def>D</def> <sym>=</sym> <def></def><str>&quot;(a|g|t)&quot;</str><def></def><sym>,</sym>   <def>H</def> <sym>=</sym> <def></def><str>&quot;(a|c|t)&quot;</str><def></def><sym>,</sym> <def>K</def> <sym>=</sym> <def></def><str>&quot;(g|t)&quot;</str><def></def><sym>,</sym><br />
<def>  M</def> <sym>=</sym> <def></def><str>&quot;(a|c)&quot;</str><def></def><sym>,</sym>   <def>N</def> <sym>=</sym> <def></def><str>&quot;(a|c|g|t)&quot;</str><def></def><sym>,</sym> <def>R</def> <sym>=</sym> <def></def><str>&quot;(a|g)&quot;</str><def></def><sym>,</sym>   <def>S</def> <sym>=</sym> <def></def><str>&quot;(c|g)&quot;</str><def></def><sym>,</sym><br />
<def>  V</def> <sym>=</sym> <def></def><str>&quot;(a|c|g)&quot;</str><def></def><sym>,</sym> <def>W</def> <sym>=</sym> <def></def><str>&quot;(a|t)&quot;</str><def></def><sym>,</sym>     <def>Y</def> <sym>=</sym> <def></def><str>&quot;(c|t)&quot;</str><def></def><sym>,</sym><br />
<def></def><sym>}</sym><br />
<def></def><slc>-- Dumbing down forced by &quot;the rules&quot;:</slc><br />
<def></def><kwa>for</kwa> <def>k</def><sym>,</sym><def>v</def> <kwa>in</kwa> <def></def><kwd>pairs</kwd><def></def><sym>(</sym><def>subst</def><sym>)</sym> <def></def><kwa>do</kwa> <def>seq</def> <sym>=</sym> <def></def><kwb>gsub</kwb><def></def><sym>(</sym><def>seq</def><sym>,</sym> <def>k</def><sym>,</sym> <def>v</def><sym>)</sym> <def></def><kwa>end</kwa><br />
<def></def><slc>-- Otherwise you're better off with: seq = gsub(seq, &quot;[BDHKMNRSVWY]&quot;, subst)</slc><br />
<def></def><br />
<kwb>write</kwb><def></def><sym>(</sym><def></def><str>&quot;</str><esc>\n</esc><str>&quot;</str><def></def><sym>,</sym> <def>ilen</def><sym>,</sym> <def></def><str>&quot;</str><esc>\n</esc><str>&quot;</str><def></def><sym>,</sym> <def>clen</def><sym>,</sym> <def></def><str>&quot;</str><esc>\n</esc><str>&quot;</str><def></def><sym>,</sym> <def></def><slc>#seq, &quot;\n&quot;)</slc><def></def><br />
</source>
