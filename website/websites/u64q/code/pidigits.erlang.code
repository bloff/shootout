<source>
<def></def><slc>%  The Great Computer Language Shootout</slc><br />
<def></def><slc>%   http://shootout.alioth.debian.org/</slc><br />
<def></def><slc>%</slc><br />
<def></def><slc>%   contributed by Mark Scandariato</slc><br />
<def></def><slc>%</slc><br />
<def></def><slc>%   erl -noshell -noinput -run pidigits main 7</slc><br />
<def></def><br />
<br />
<sym>-</sym><def></def><kwa>module</kwa><def></def><sym>(</sym><def>pidigits</def><sym>).</sym><br />
<def></def><sym>-</sym><def></def><kwa>export</kwa><def></def><sym>([</sym><def>main</def><sym>/</sym><def></def><num>1</num><def></def><sym>]).</sym><br />
<def></def><br />
<slc>% conversion</slc><br />
<def></def><kwd>is_safe</kwd><def></def><sym>(</sym><def>Z</def><sym>,</sym> <def>N</def><sym>) -&gt;</sym> <def>N</def> <sym>==</sym> <def></def><kwd>extr</kwd><def></def><sym>(</sym><def>Z</def><sym>,</sym> <def></def><num>4</num><def></def><sym>).</sym><br />
<def></def><kwd>next</kwd><def></def><sym>(</sym><def>Z</def><sym>)       -&gt;</sym> <def></def><kwd>extr</kwd><def></def><sym>(</sym><def>Z</def><sym>,</sym> <def></def><num>3</num><def></def><sym>).</sym><br />
<def></def><kwd>prod</kwd><def></def><sym>(</sym><def>Z</def><sym>,</sym> <def>N</def><sym>)    -&gt;</sym> <def></def><kwd>comp</kwd><def></def><sym>({</sym><def></def><num>10</num><def></def><sym>, -</sym><def></def><num>10</num><def></def><sym>*</sym><def>N</def><sym>,</sym> <def></def><num>0</num><def></def><sym>,</sym> <def></def><num>1</num><def></def><sym>},</sym> <def>Z</def><sym>).</sym><br />
<def></def><kwd>cons</kwd><def></def><sym>(</sym><def>Z</def><sym>,</sym> <def>Zp</def><sym>)   -&gt;</sym> <def></def><kwd>comp</kwd><def></def><sym>(</sym><def>Z</def><sym>,</sym> <def>Zp</def><sym>).</sym><br />
<def></def><br />
<slc>% LFT</slc><br />
<def></def><sym>-</sym><def></def><kwa>define</kwa><def></def><sym>(</sym><def>unit</def><sym>, {</sym><def></def><num>1</num><def></def><sym>,</sym><def></def><num>0</num><def></def><sym>,</sym><def></def><num>0</num><def></def><sym>,</sym><def></def><num>1</num><def></def><sym>}).</sym><br />
<def></def><kwd>comp</kwd><def></def><sym>({</sym><def>Q</def><sym>,</sym><def>R</def><sym>,</sym><def>S</def><sym>,</sym><def>T</def><sym>}, {</sym><def>Qp</def><sym>,</sym> <def>Rp</def><sym>,</sym> <def>Sp</def><sym>,</sym> <def>Tp</def><sym>}) -&gt;</sym><br />
<def></def>    <sym>{</sym><def>Q</def><sym>*</sym><def>Qp</def> <sym>+</sym> <def>R</def><sym>*</sym><def>Sp</def><sym>,</sym> <def>Q</def><sym>*</sym><def>Rp</def> <sym>+</sym> <def>R</def><sym>*</sym><def>Tp</def><sym>,</sym> <def>S</def><sym>*</sym><def>Qp</def> <sym>+</sym> <def>T</def><sym>*</sym><def>Sp</def><sym>,</sym> <def>S</def><sym>*</sym><def>Rp</def> <sym>+</sym> <def>T</def><sym>*</sym><def>Tp</def><sym>}.</sym><br />
<def></def><kwd>extr</kwd><def></def><sym>({</sym><def>Q</def><sym>,</sym><def>R</def><sym>,</sym><def>S</def><sym>,</sym><def>T</def><sym>},</sym> <def>X</def><sym>) -&gt; (</sym><def>Q</def> <sym>*</sym> <def>X</def> <sym>+</sym> <def>R</def><sym>)</sym> <def></def><kwa>div</kwa> <def></def><sym>(</sym><def>S</def> <sym>*</sym> <def>X</def> <sym>+</sym> <def>T</def><sym>).</sym><br />
<def></def><br />
<kwd>lft</kwd><def></def><sym>(</sym><def>K</def><sym>) -&gt; {</sym><def>K</def><sym>,</sym> <def></def><num>4</num><def></def><sym>*</sym><def>K</def><sym>+</sym><def></def><num>2</num><def></def><sym>,</sym> <def></def><num>0</num><def></def><sym>,</sym> <def></def><num>2</num><def></def><sym>*</sym><def>K</def><sym>+</sym><def></def><num>1</num><def></def><sym>}.</sym><br />
<def></def><br />
<kwd>stream</kwd><def></def><sym>(</sym><def>N</def><sym>) -&gt;</sym> <def></def><kwd>stream</kwd><def></def><sym>(</sym><def>N</def><sym>,</sym> <def></def><num>0</num><def></def><sym>,</sym> <def></def><num>1</num><def></def><sym>, ?</sym><def>unit</def><sym>, []).</sym><br />
<def></def><kwd>stream</kwd><def></def><sym>(</sym><def>N</def><sym>,</sym> <def>N</def><sym>,</sym> <def>_</def><sym>,</sym> <def>_</def><sym>,</sym> <def>P</def><sym>) -&gt;</sym> <def></def><kwd>print</kwd><def></def><sym>(</sym><def>N</def><sym>,</sym><def>P</def><sym>);</sym><br />
<def></def><kwd>stream</kwd><def></def><sym>(</sym><def>N</def><sym>,</sym> <def>C</def><sym>,</sym> <def>K</def><sym>,</sym> <def>Z</def><sym>,</sym> <def>P</def><sym>) -&gt;</sym><br />
<def>    Y</def> <sym>=</sym> <def></def><kwd>next</kwd><def></def><sym>(</sym><def>Z</def><sym>),</sym><br />
<def></def>    <kwa>case</kwa> <def></def><kwd>is_safe</kwd><def></def><sym>(</sym><def>Z</def><sym>,</sym> <def>Y</def><sym>)</sym> <def></def><kwa>of</kwa><br />
<def>        true</def>  <sym>-&gt;</sym><br />
<def></def>            <kwd>stream</kwd><def></def><sym>(</sym><def>N</def><sym>,</sym> <def>C</def><sym>+</sym><def></def><num>1</num><def></def><sym>,</sym> <def>K</def><sym>,</sym> <def></def><kwd>prod</kwd><def></def><sym>(</sym><def>Z</def><sym>,</sym><def>Y</def><sym>),</sym> <def></def><kwd>update</kwd><def></def><sym>(</sym><def>C</def><sym>,</sym><def>Y</def><sym>,</sym><def>P</def><sym>));</sym><br />
<def>        false</def> <sym>-&gt;</sym><br />
<def></def>            <kwd>stream</kwd><def></def><sym>(</sym><def>N</def><sym>,</sym> <def>C</def><sym>,</sym> <def>K</def><sym>+</sym><def></def><num>1</num><def></def><sym>,</sym> <def></def><kwd>cons</kwd><def></def><sym>(</sym><def>Z</def><sym>,</sym> <def></def><kwd>lft</kwd><def></def><sym>(</sym><def>K</def><sym>)),</sym> <def>P</def><sym>)</sym><br />
<def></def>    <kwa>end</kwa><def></def><sym>.</sym><br />
<def></def><br />
<br />
<kwd>update</kwd><def></def><sym>(</sym><def>C</def><sym>,</sym> <def>D</def><sym>,</sym> <def>P</def><sym>)</sym> <def></def><kwa>when</kwa> <def>C</def> <kwa>rem</kwa> <def></def><num>10</num> <def></def><sym>==</sym> <def></def><num>0</num><def></def><sym>,</sym> <def>C</def> <sym>&gt;</sym> <def></def><num>0</num> <def></def><sym>-&gt;</sym><br />
<def></def>    <kwd>print</kwd><def></def><sym>(</sym><def>C</def><sym>,</sym> <def>P</def><sym>),</sym><br />
<def></def>    <sym>[</sym><def>D</def><sym>];</sym><br />
<def></def><br />
<kwd>update</kwd><def></def><sym>(</sym><def>_</def><sym>,</sym> <def>D</def><sym>,</sym> <def>P</def><sym>) -&gt; [</sym><def>D</def><sym>|</sym><def>P</def><sym>].</sym><br />
<def></def><br />
<br />
<kwd>print</kwd><def></def><sym>(</sym><def>C</def><sym>,</sym> <def>P</def><sym>) -&gt;</sym> <def></def><kwd>do_print</kwd><def></def><sym>(</sym><def>C</def><sym>,</sym> <def>lists</def><sym>:</sym><def></def><kwd>reverse</kwd><def></def><sym>(</sym><def>P</def><sym>)).</sym><br />
<def></def><br />
<br />
<kwd>do_print</kwd><def></def><sym>(</sym><def>C</def><sym>, [])</sym> <def></def><kwa>when</kwa> <def>C</def> <kwa>rem</kwa> <def></def><num>10</num> <def></def><sym>==</sym> <def></def><num>0</num> <def></def><sym>-&gt;</sym> <def>io</def><sym>:</sym><def></def><kwd>fwrite</kwd><def></def><sym>(</sym><def></def><str>&quot;</str><esc>\</esc><str>t:~p~n&quot;</str><def></def><sym>, [</sym><def>C</def><sym>]);</sym><br />
<def></def><kwd>do_print</kwd><def></def><sym>(</sym><def>C</def><sym>, []) -&gt;</sym> <def>io</def><sym>:</sym><def></def><kwd>fwrite</kwd><def></def><sym>(</sym><def></def><str>&quot;~*.1c:~p~n&quot;</str><def></def><sym>, [</sym><def></def><num>10</num> <def></def><sym>-</sym> <def>C</def> <kwa>rem</kwa> <def></def><num>10</num><def></def><sym>,</sym> <def>$\t</def><sym>,</sym> <def>C</def><sym>]);</sym><br />
<def></def><kwd>do_print</kwd><def></def><sym>(</sym><def>C</def><sym>, [</sym><def>H</def><sym>|</sym><def>T</def><sym>]) -&gt;</sym> <def>io</def><sym>:</sym><def></def><kwd>fwrite</kwd><def></def><sym>(</sym><def></def><str>&quot;~p&quot;</str><def></def><sym>, [</sym><def>H</def><sym>]),</sym> <def></def><kwd>do_print</kwd><def></def><sym>(</sym><def>C</def><sym>,</sym> <def>T</def><sym>).</sym><br />
<def></def><br />
<br />
<kwd>main</kwd><def></def><sym>([</sym><def>Arg</def><sym>]) -&gt;</sym><br />
<def>    N</def> <sym>=</sym> <def></def><kwb>list_to_integer</kwb><def></def><sym>(</sym><def>Arg</def><sym>),</sym><br />
<def></def>    <kwd>main</kwd><def></def><sym>(</sym><def>N</def><sym>),</sym><br />
<def>    erlang</def><sym>:</sym><def></def><kwb>halt</kwb><def></def><sym>(</sym><def></def><num>0</num><def></def><sym>);</sym><br />
<def></def><br />
<kwd>main</kwd><def></def><sym>(</sym><def>N</def><sym>)</sym> <def></def><kwa>when</kwa> <def>N</def> <sym>&gt;</sym> <def></def><num>1</num> <def></def><sym>-&gt;</sym> <def></def><kwd>stream</kwd><def></def><sym>(</sym><def>N</def><sym>).</sym><def></def><br />
</source>
