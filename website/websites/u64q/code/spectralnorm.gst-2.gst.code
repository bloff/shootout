<source>
<def></def><com>&quot;* The Computer Language Benchmarks Game</com><br />
<com>    http://shootout.alioth.debian.org/</com><br />
<com>    contributed by Paolo Bonzini *&quot;</com><def>!<br />
<br />
!</def><kwc>Array</kwc> <def></def><kwb>methodsFor:</kwb> <def></def><str>'benchmarking'</str><def>!</def><br />
<kwb>multiplyAtAv</kwb><br />
<def></def>   <sym>^(</sym><def></def><kwa>self</kwa> <def></def><kwb>multiplyAv</kwb><def></def><sym>)</sym> <def></def><kwb>multiplyAtv</kwb><def>! !<br />
<br />
!</def><kwc>Array</kwc> <def></def><kwb>methodsFor:</kwb> <def></def><str>'benchmarking'</str><def>!</def><br />
<kwb>multiplyAtv</kwb><br />
<def></def>   <kwd>| n atv sum |</kwd><br />
<def>   n</def> <sym>:=</sym> <def></def><kwa>self</kwa> <def></def><kwb>size</kwb><def></def><sym>.</sym><br />
<def>   atv</def> <sym>:=</sym> <def></def><kwc>Array</kwc> <def></def><kwb>new:</kwb> <def>n</def><sym>.</sym><br />
<def></def>   <num>1</num> <def></def><kwb>to:</kwb> <def>n</def> <kwb>do:</kwb> <def></def><sym>[</sym><def></def><kwd>:i</kwd><def></def><sym>|</sym><br />
<def>      sum</def> <sym>:=</sym> <def></def><num>0.0</num><def>d</def><sym>.</sym><br />
<def></def>      <num>1</num> <def></def><kwb>to:</kwb> <def>n</def> <kwb>do:</kwb> <def></def><sym>[</sym><def></def><kwd>:j</kwd><def></def><sym>|</sym><br />
<def>         sum</def> <sym>:=</sym> <def>sum</def> <kwb>+</kwb> <def></def><sym>((</sym><def>j</def> <kwb>matrixA:</kwb> <def>i</def><sym>)</sym> <def></def><kwb>*</kwb> <def></def><sym>(</sym><def></def><kwa>self</kwa> <def></def><kwb>at:</kwb> <def>j</def><sym>)) ].</sym><br />
<def>      atv</def> <kwb>at:</kwb> <def>i</def> <kwb>put:</kwb> <def>sum</def><sym>].</sym><br />
<def></def>   <sym>^</sym><def>atv! !<br />
<br />
!</def><kwc>Array</kwc> <def></def><kwb>methodsFor:</kwb> <def></def><str>'benchmarking'</str><def>!</def><br />
<kwb>multiplyAv</kwb><br />
<def></def>   <kwd>| n av sum |</kwd><br />
<def>   n</def> <sym>:=</sym> <def></def><kwa>self</kwa> <def></def><kwb>size</kwb><def></def><sym>.</sym><br />
<def>   av</def> <sym>:=</sym> <def></def><kwc>Array</kwc> <def></def><kwb>new:</kwb> <def>n</def><sym>.</sym><br />
<def></def>   <num>1</num> <def></def><kwb>to:</kwb> <def>n</def> <kwb>do:</kwb> <def></def><sym>[</sym><def></def><kwd>:i</kwd><def></def><sym>|</sym><br />
<def>      sum</def> <sym>:=</sym> <def></def><num>0.0</num><def>d</def><sym>.</sym><br />
<def></def>      <num>1</num> <def></def><kwb>to:</kwb> <def>n</def> <kwb>do:</kwb> <def></def><sym>[</sym><def></def><kwd>:j</kwd><def></def><sym>|</sym><br />
<def>         sum</def> <sym>:=</sym> <def>sum</def> <kwb>+</kwb> <def></def><sym>((</sym><def>i</def> <kwb>matrixA:</kwb> <def>j</def><sym>)</sym> <def></def><kwb>*</kwb> <def></def><sym>(</sym><def></def><kwa>self</kwa> <def></def><kwb>at:</kwb> <def>j</def><sym>)) ].</sym><br />
<def>      av</def> <kwb>at:</kwb> <def>i</def> <kwb>put:</kwb> <def>sum</def><sym>].</sym><br />
<def></def>   <sym>^</sym><def>av! !<br />
<br />
<br />
!</def><kwc>SmallInteger</kwc> <def></def><kwb>methodsFor:</kwb> <def></def><str>'benchmarking'</str><def>!</def><br />
<kwb>matrixA:</kwb> <def>anInteger</def><br />
   <sym>^</sym><def></def><num>1.0</num><def>d0</def> <kwb>/</kwb> <def></def><sym>((</sym><def></def><kwa>self</kwa> <def></def><kwb>+</kwb> <def>anInteger</def> <kwb>-</kwb> <def></def><num>2</num><def></def><sym>)</sym> <def></def><kwb>*</kwb> <def></def><sym>(</sym><def></def><kwa>self</kwa> <def></def><kwb>+</kwb> <def>anInteger</def> <kwb>-</kwb> <def></def><num>1</num><def></def><sym>)</sym> <def></def><kwb>/</kwb><def></def><num>2</num>  <def></def><kwb>+</kwb> <def></def><kwa>self</kwa><def></def><sym>)</sym><def>! !<br />
<br />
<br />
!</def><kwc>Tests</kwc> <def></def><kwb>class methodsFor:</kwb> <def></def><str>'benchmarking'</str><def>!</def><br />
<kwb>spectralnorm:</kwb> <def>n</def><br />
   <kwd>| u v vBv vv |</kwd><br />
<def>   u</def> <sym>:=</sym> <def></def><kwc>Array</kwc> <def></def><kwb>new:</kwb> <def>n</def> <kwb>withAll:</kwb> <def></def><num>1.0</num><def>d0</def><sym>.</sym><br />
<def></def>   <num>10</num> <def></def><kwb>timesRepeat:</kwb><br />
<def></def>      <sym>[</sym><def>v</def> <sym>:=</sym> <def>u</def> <kwb>multiplyAtAv</kwb><def></def><sym>.</sym><br />
<def>       u</def> <sym>:=</sym> <def>v</def> <kwb>multiplyAtAv</kwb><def></def><sym>].</sym><br />
<def>   vBv</def> <sym>:=</sym> <def></def><num>0.0</num><def>d0</def><sym>.</sym><br />
<def>   vv</def> <sym>:=</sym> <def></def><num>0.0</num><def>d0</def><sym>.</sym><br />
<def></def>   <num>1</num> <def></def><kwb>to:</kwb> <def>n</def> <kwb>do:</kwb><br />
<def></def>      <sym>[</sym><def></def><kwd>:i</kwd> <def></def><sym>|</sym><br />
<def>       vBv</def> <sym>:=</sym> <def>vBv</def> <kwb>+</kwb> <def></def><sym>((</sym><def>u</def> <kwb>at:</kwb> <def>i</def><sym>)</sym> <def></def><kwb>*</kwb> <def></def><sym>(</sym><def>v</def> <kwb>at:</kwb> <def>i</def><sym>)).</sym><br />
<def>       vv</def> <sym>:=</sym> <def>vv</def> <kwb>+</kwb> <def></def><sym>((</sym><def>v</def> <kwb>at:</kwb> <def>i</def><sym>)</sym> <def></def><kwb>*</kwb> <def></def><sym>(</sym><def>v</def> <kwb>at:</kwb> <def>i</def><sym>))].</sym><br />
<def></def>   <sym>^(</sym><def>vBv</def> <kwb>/</kwb> <def>vv</def><sym>)</sym> <def></def><kwb>sqrt</kwb><def>! !<br />
<br />
<br />
!</def><kwc>Tests</kwc> <def></def><kwb>class methodsFor:</kwb> <def></def><str>'benchmark scripts'</str><def>!</def><br />
<kwb>spectralnorm2</kwb><br />
<def></def>   <kwa>self</kwa> <def></def><kwb>stdout print:</kwb> <def></def><sym>(</sym><def></def><kwa>self</kwa> <def></def><kwb>spectralnorm:</kwb> <def></def><kwa>self</kwa> <def></def><kwb>arg</kwb><def></def><sym>)</sym> <def></def><kwb>digits:</kwb> <def></def><num>9</num><def></def><sym>;</sym> <def></def><kwb>nl</kwb><def></def><sym>.</sym><br />
<def></def>   <sym>^</sym><def></def><str>''</str><def>! !</def><br />
<br />
<kwc>Tests</kwc> <def></def><kwb>spectralnorm</kwb><def></def><num>2</num><def>!</def><br />
</source>
