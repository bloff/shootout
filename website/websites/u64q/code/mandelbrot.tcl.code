<source>
<def></def><slc># The Computer Language Benchmarks Game</slc><br />
<def></def><slc># http://shootout.alioth.debian.org/</slc><br />
<def></def><slc># contributed by Stephane Arnold</slc><br />
<def></def><br />
<kwa>proc</kwa> <def>main</def> <sym>{</sym><def>W</def><sym>} {</sym><br />
<def></def>    <kwa>set</kwa> <def>H</def> <kwb>$W</kwb><br />
<def></def><br />
    <kwa>puts</kwa> <def>stdout</def> <str>&quot;P4</str><esc>\n</esc><str>$W $H&quot;</str><def></def><br />
	<kwa>fconfigure</kwa> <def>stdout</def> <kwc>-translation</kwc> <def></def><kwa>binary</kwa><br />
<def></def>	<kwa>set</kwa> <def>iter</def> <num>50</num><br />
<def></def>	<kwa>set</kwa> <def>limit2</def> <num>4.0</num><br />
<def></def>	<kwa>set</kwa> <def>wscale</def> <sym>[</sym><def></def><kwa>expr</kwa> <def></def><sym>{</sym><def></def><num>2</num><def>.</def><sym>/</sym><def></def><kwb>$W</kwb><def></def><sym>}]</sym><br />
<def></def>	<kwa>set</kwa> <def>hscale</def> <sym>[</sym><def></def><kwa>expr</kwa> <def></def><sym>{</sym><def></def><num>2</num><def>.</def><sym>/</sym><def></def><kwb>$H</kwb><def></def><sym>}]</sym><br />
<def></def>	<kwa>set</kwa> <def>offset</def> <sym>[</sym><def></def><kwa>expr</kwa> <def></def><sym>{</sym><def></def><kwb>$W</kwb><def></def><sym>%</sym><def></def><num>8</num><def></def><sym>}]</sym><br />
<def></def>    <kwa>for</kwa> <def></def><sym>{</sym><def></def><kwa>set</kwa> <def>y</def> <num>0</num><def></def><sym>} {</sym><def></def><kwb>$y</kwb> <def></def><sym>&lt;</sym> <def></def><kwb>$H</kwb><def></def><sym>} {</sym><def></def><kwa>incr</kwa> <def>y</def><sym>} {</sym><br />
<def></def>        <kwa>set</kwa> <def>Ci</def> <sym>[</sym><def></def><kwa>expr</kwa> <def></def><sym>{</sym><def></def><kwb>$hscale</kwb><def></def><sym>*</sym> <def>double</def><sym>(</sym><def></def><kwb>$y</kwb><def></def><sym>)</sym> <def></def><kwc>-1</kwc><def>.0</def><sym>}]</sym><br />
<def></def>        <kwa>for</kwa> <def></def><sym>{</sym><def></def><kwa>set</kwa> <def>xb</def> <num>0</num><def></def><sym>} {</sym><def></def><kwb>$xb</kwb> <def></def><sym>&lt;</sym> <def></def><kwb>$W</kwb><def></def><sym>} {</sym><def></def><kwa>incr</kwa> <def>xb</def> <num>8</num><def></def><sym>} {</sym><br />
<def></def>			<kwa>set</kwa> <def>bits</def> <num>0</num><br />
<def></def>			<kwa>set</kwa> <def>xbb</def> <sym>[</sym><def></def><kwa>expr</kwa> <def></def><sym>{</sym><def></def><kwb>$xb</kwb><def></def><sym>+</sym><def></def><num>8</num> <def></def><sym>&gt;</sym> <def></def><kwb>$W</kwb> <def>?</def> <kwb>$W</kwb> <def></def><sym>:</sym> <def></def><kwb>$xb</kwb><def></def><sym>+</sym><def></def><num>8</num><def></def><sym>}]</sym><br />
<def></def>			<kwa>for</kwa> <def></def><sym>{</sym><def></def><kwa>set</kwa> <def>x</def> <kwb>$xb</kwb><def></def><sym>} {</sym><def></def><kwb>$x</kwb><def></def><sym>&lt;</sym><def></def><kwb>$xbb</kwb><def></def><sym>} {</sym><def></def><kwa>incr</kwa> <def>x</def><sym>} {</sym><br />
<def></def>			  <kwa>set</kwa> <def>bits</def> <sym>[</sym><def></def><kwa>expr</kwa> <def></def><sym>{</sym><def></def><kwb>$bits</kwb><def></def><sym>&lt;&lt;</sym><def></def><num>1</num><def></def><sym>}]</sym><br />
<def></def>			   <kwa>set</kwa> <def>Zr</def> <sym>[</sym><def></def><kwa>set</kwa> <def>Zi</def> <num>0.0</num><def></def><sym>]</sym><br />
<def></def>            <kwa>set</kwa> <def>Zrq</def> <sym>[</sym><def></def><kwa>set</kwa> <def>Ziq</def> <num>0.0</num><def></def><sym>]</sym><br />
<def></def>            <kwa>set</kwa> <def>Cr</def> <sym>[</sym><def></def><kwa>expr</kwa> <def></def><sym>{</sym><def></def><kwb>$wscale</kwb> <def></def><sym>*</sym> <def>double</def><sym>(</sym><def></def><kwb>$x</kwb><def></def><sym>)-</sym> <def></def><num>1.5</num><def></def><sym>}]</sym><br />
<def></def>            <kwa>for</kwa> <def></def><sym>{</sym><def></def><kwa>set</kwa> <def>i</def> <num>0</num><def></def><sym>} {</sym><def></def><kwb>$i</kwb><def></def><sym>&lt;</sym><def></def><kwb>$iter</kwb><def></def><sym>} {</sym><def></def><kwa>incr</kwa> <def>i</def><sym>} {</sym><br />
<def></def>               <kwa>set</kwa> <def>Zri</def> <sym>[</sym><def></def><kwa>expr</kwa> <def></def><sym>{</sym><def></def><kwb>$Zr</kwb><def></def><sym>*</sym><def></def><kwb>$Zi</kwb><def></def><sym>}]</sym><br />
<def></def>               <kwa>set</kwa> <def>Zr</def> <sym>[</sym><def></def><kwa>expr</kwa> <def></def><sym>{</sym> <def></def><kwb>$Zrq</kwb> <def></def><sym>-</sym> <def></def><kwb>$Ziq</kwb> <def></def><sym>+</sym> <def></def><kwb>$Cr</kwb> <def></def><sym>}]</sym><br />
<def></def>               <kwa>set</kwa> <def>Zi</def> <sym>[</sym><def></def><kwa>expr</kwa> <def></def><sym>{</sym> <def></def><kwb>$Zri</kwb> <def></def><sym>+</sym> <def></def><kwb>$Zri</kwb> <def></def><sym>+</sym> <def></def><kwb>$Ci</kwb> <def></def><sym>}]</sym><br />
<def></def>               <kwa>set</kwa> <def>Zrq</def> <sym>[</sym><def></def><kwa>expr</kwa> <def></def><sym>{</sym><def></def><kwb>$Zr</kwb><def></def><sym>*</sym><def></def><kwb>$Zr</kwb><def></def><sym>}]</sym><br />
<def></def>               <kwa>set</kwa> <def>Ziq</def> <sym>[</sym><def></def><kwa>expr</kwa> <def></def><sym>{</sym><def></def><kwb>$Zi</kwb><def></def><sym>*</sym><def></def><kwb>$Zi</kwb><def></def><sym>}]</sym><br />
<def></def>               <kwa>if</kwa> <def></def><sym>{</sym><def></def><kwb>$Zrq</kwb> <def></def><sym>+</sym> <def></def><kwb>$Ziq</kwb> <def></def><sym>&gt;</sym> <def></def><kwb>$limit2</kwb><def></def><sym>} {</sym><br />
<def></def>                  <kwa>incr</kwa> <def>bits</def><br />
                  <kwa>break</kwa><br />
<def></def>               <sym>}</sym><br />
<def></def>            <sym>}</sym><br />
<def></def>         <sym>}</sym><br />
<def></def>         <kwa>if</kwa> <def></def><sym>{</sym><def></def><kwb>$xb</kwb><def></def><sym>+</sym><def></def><num>7</num><def></def><sym>&gt;=</sym><def></def><kwb>$W</kwb><def></def><sym>} {</sym><def></def><kwa>set</kwa> <def>bits</def> <sym>[</sym><def></def><kwa>expr</kwa> <def></def><sym>{((</sym><def></def><kwb>$bits</kwb><def></def><sym>+</sym><def></def><num>1</num><def></def><sym>)&lt;&lt;</sym><def></def><kwb>$offset</kwb><def></def><sym>)</sym><def></def><kwc>-1</kwc><def></def><sym>}]}</sym><br />
<def></def>         <kwa>puts</kwa> <def></def><kwc>-nonewline</kwc> <def>stdout</def> <sym>[</sym><def></def><kwa>binary format</kwa> <def>c</def> <sym>[</sym><def></def><kwa>expr</kwa> <def></def><sym>{</sym><def></def><num>255</num><def></def><sym>-</sym><def></def><kwb>$bits</kwb><def></def><sym>}]]</sym><br />
<def></def>        <sym>}</sym><br />
<def></def>    <sym>}</sym><br />
<def></def><sym>}</sym><br />
<def></def><kwa>eval</kwa> <def>main</def> <kwb>$argv</kwb><def></def><br />
</source>
