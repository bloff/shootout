<source>
<def></def><slc>-- The Great Computer Language Shootout</slc><br />
<def></def><slc>-- http://shootout.alioth.debian.org/</slc><br />
<def></def><slc>-- contributed by Mike Pall</slc><br />
<def></def><br />
<kwa>local function</kwa> <def></def><kwd>kfrequency</kwd><def></def><sym>(</sym><def>seq</def><sym>,</sym> <def>freq</def><sym>,</sym> <def>k</def><sym>,</sym> <def>frame</def><sym>)</sym><br />
<def></def>  <kwa>local</kwa> <def>sub</def> <sym>=</sym> <def></def><kwb>string</kwb><def></def><sym>.</sym><def>sub</def><br />
  <kwa>local</kwa> <def>k1</def> <sym>=</sym> <def>k</def> <sym>-</sym> <def></def><num>1</num><br />
<def></def>  <kwa>for</kwa> <def>i</def><sym>=</sym><def>frame</def><sym>,</sym><def></def><kwb>string</kwb><def></def><sym>.</sym><def></def><kwd>len</kwd><def></def><sym>(</sym><def>seq</def><sym>)-</sym><def>k1</def><sym>,</sym><def>k</def> <kwa>do</kwa><br />
<def></def>    <kwa>local</kwa> <def>c</def> <sym>=</sym> <def></def><kwd>sub</kwd><def></def><sym>(</sym><def>seq</def><sym>,</sym> <def>i</def><sym>,</sym> <def>i</def><sym>+</sym><def>k1</def><sym>)</sym><br />
<def>    freq</def><sym>[</sym><def>c</def><sym>] =</sym> <def>freq</def><sym>[</sym><def>c</def><sym>] +</sym> <def></def><num>1</num><br />
<def></def>  <kwa>end</kwa><br />
<def></def><kwa>end</kwa><br />
<def></def><br />
<kwa>local function</kwa> <def></def><kwd>freqdefault</kwd><def></def><sym>()</sym><br />
<def></def>  <kwa>return</kwa> <def></def><num>0</num><br />
<def></def><kwa>end</kwa><br />
<def></def><br />
<kwa>local function</kwa> <def></def><kwd>count</kwd><def></def><sym>(</sym><def>seq</def><sym>,</sym> <def>frag</def><sym>)</sym><br />
<def></def>  <kwa>local</kwa> <def>k</def> <sym>=</sym> <def></def><kwb>string</kwb><def></def><sym>.</sym><def></def><kwd>len</kwd><def></def><sym>(</sym><def>frag</def><sym>)</sym><br />
<def></def>  <kwa>local</kwa> <def>freq</def> <sym>=</sym> <def></def><kwd>setmetatable</kwd><def></def><sym>({}, {</sym> <def>__index</def> <sym>=</sym> <def>freqdefault</def> <sym>})</sym><br />
<def></def>  <kwa>for</kwa> <def>frame</def><sym>=</sym><def></def><num>1</num><def></def><sym>,</sym><def>k</def> <kwa>do</kwa> <def></def><kwd>kfrequency</kwd><def></def><sym>(</sym><def>seq</def><sym>,</sym> <def>freq</def><sym>,</sym> <def>k</def><sym>,</sym> <def>frame</def><sym>)</sym> <def></def><kwa>end</kwa><br />
<def>  io</def><sym>.</sym><def></def><kwb>write</kwb><def></def><sym>(</sym><def>freq</def><sym>[</sym><def>frag</def><sym>]</sym> <def></def><kwa>or</kwa> <def></def><num>0</num><def></def><sym>,</sym> <def></def><str>&quot;</str><esc>\t</esc><str>&quot;</str><def></def><sym>,</sym> <def>frag</def><sym>,</sym> <def></def><str>&quot;</str><esc>\n</esc><str>&quot;</str><def></def><sym>)</sym><br />
<def></def><kwa>end</kwa><br />
<def></def><br />
<kwa>local function</kwa> <def></def><kwd>frequency</kwd><def></def><sym>(</sym><def>seq</def><sym>,</sym> <def>k</def><sym>)</sym><br />
<def></def>  <kwa>local</kwa> <def>freq</def> <sym>=</sym> <def></def><kwd>setmetatable</kwd><def></def><sym>({}, {</sym> <def>__index</def> <sym>=</sym> <def>freqdefault</def> <sym>})</sym><br />
<def></def>  <kwa>for</kwa> <def>frame</def><sym>=</sym><def></def><num>1</num><def></def><sym>,</sym><def>k</def> <kwa>do</kwa> <def></def><kwd>kfrequency</kwd><def></def><sym>(</sym><def>seq</def><sym>,</sym> <def>freq</def><sym>,</sym> <def>k</def><sym>,</sym> <def>frame</def><sym>)</sym> <def></def><kwa>end</kwa><br />
<def></def>  <kwa>local</kwa> <def>sfreq</def><sym>,</sym> <def>sn</def> <sym>= {},</sym> <def></def><num>1</num><br />
<def></def>  <kwa>for</kwa> <def>c</def><sym>,</sym><def>v</def> <kwa>in</kwa> <def></def><kwd>pairs</kwd><def></def><sym>(</sym><def>freq</def><sym>)</sym> <def></def><kwa>do</kwa> <def>sfreq</def><sym>[</sym><def>sn</def><sym>] =</sym> <def>c</def><sym>;</sym> <def>sn</def> <sym>=</sym> <def>sn</def> <sym>+</sym> <def></def><num>1</num> <def></def><kwa>end</kwa><br />
<def></def>  <kwb>table</kwb><def></def><sym>.</sym><def></def><kwb>sort</kwb><def></def><sym>(</sym><def>sfreq</def><sym>,</sym> <def></def><kwa>function</kwa><def></def><sym>(</sym><def>a</def><sym>,</sym> <def>b</def><sym>)</sym><br />
<def></def>    <kwa>local</kwa> <def>fa</def><sym>,</sym> <def>fb</def> <sym>=</sym> <def>freq</def><sym>[</sym><def>a</def><sym>],</sym> <def>freq</def><sym>[</sym><def>b</def><sym>]</sym><br />
<def></def>    <kwa>return</kwa> <def>fa</def> <sym>==</sym> <def>fb</def> <kwa>and</kwa> <def>a</def> <sym>&gt;</sym> <def>b</def> <kwa>or</kwa> <def>fa</def> <sym>&gt;</sym> <def>fb</def><br />
  <kwa>end</kwa><def></def><sym>)</sym><br />
<def>  sum</def> <sym>=</sym> <def></def><kwb>string</kwb><def></def><sym>.</sym><def></def><kwd>len</kwd><def></def><sym>(</sym><def>seq</def><sym>)-</sym><def>k</def><sym>+</sym><def></def><num>1</num><br />
<def></def>  <kwa>for</kwa> <def>_</def><sym>,</sym><def>c</def> <kwa>in</kwa> <def></def><kwd>ipairs</kwd><def></def><sym>(</sym><def>sfreq</def><sym>)</sym> <def></def><kwa>do</kwa><br />
<def>    io</def><sym>.</sym><def></def><kwb>write</kwb><def></def><sym>(</sym><def></def><kwb>string</kwb><def></def><sym>.</sym><def></def><kwb>format</kwb><def></def><sym>(</sym><def></def><str>&quot;%s %0.3f</str><esc>\n</esc><str>&quot;</str><def></def><sym>,</sym> <def>c</def><sym>, (</sym><def>freq</def><sym>[</sym><def>c</def><sym>]*</sym><def></def><num>100</num><def></def><sym>)/</sym><def>sum</def><sym>))</sym><br />
<def></def>  <kwa>end</kwa><br />
<def>  io</def><sym>.</sym><def></def><kwb>write</kwb><def></def><sym>(</sym><def></def><str>&quot;</str><esc>\n</esc><str>&quot;</str><def></def><sym>)</sym><br />
<def></def><kwa>end</kwa><br />
<def></def><br />
<kwa>local function</kwa> <def></def><kwd>readseq</kwd><def></def><sym>()</sym><br />
<def></def>  <kwa>local</kwa> <def>sub</def> <sym>=</sym> <def></def><kwb>string</kwb><def></def><sym>.</sym><def>sub</def><br />
  <kwa>for</kwa> <def>line</def> <kwa>in</kwa> <def>io</def><sym>.</sym><def></def><kwd>lines</kwd><def></def><sym>()</sym> <def></def><kwa>do</kwa><br />
<def></def>    <kwa>if</kwa> <def></def><kwd>sub</kwd><def></def><sym>(</sym><def>line</def><sym>,</sym> <def></def><num>1</num><def></def><sym>,</sym> <def></def><num>1</num><def></def><sym>) ==</sym> <def></def><str>&quot;&gt;&quot;</str><def></def> <kwa>and</kwa> <def></def><kwd>sub</kwd><def></def><sym>(</sym><def>line</def><sym>,</sym> <def></def><num>2</num><def></def><sym>,</sym> <def></def><num>6</num><def></def><sym>) ==</sym> <def></def><str>&quot;THREE&quot;</str><def></def> <kwa>then break end</kwa><br />
<def></def>  <kwa>end</kwa><br />
<def></def>  <kwa>local</kwa> <def>lines</def><sym>,</sym> <def>ln</def> <sym>= {},</sym> <def></def><num>0</num><br />
<def></def>  <kwa>for</kwa> <def>line</def> <kwa>in</kwa> <def>io</def><sym>.</sym><def></def><kwd>lines</kwd><def></def><sym>()</sym> <def></def><kwa>do</kwa><br />
<def></def>    <kwa>local</kwa> <def>c</def> <sym>=</sym> <def></def><kwd>sub</kwd><def></def><sym>(</sym><def>line</def><sym>,</sym> <def></def><num>1</num><def></def><sym>,</sym> <def></def><num>1</num><def></def><sym>)</sym><br />
<def></def>    <kwa>if</kwa> <def>c</def> <sym>==</sym> <def></def><str>&quot;&gt;&quot;</str><def></def> <kwa>then</kwa><br />
<def></def>      <kwa>break</kwa><br />
<def></def>    <kwa>elseif</kwa> <def>c ~</def><sym>=</sym> <def></def><str>&quot;;&quot;</str><def></def> <kwa>then</kwa><br />
<def>      ln</def> <sym>=</sym> <def>ln</def> <sym>+</sym> <def></def><num>1</num><br />
<def>      lines</def><sym>[</sym><def>ln</def><sym>] =</sym> <def>line</def><br />
    <kwa>end</kwa><br />
<def></def>  <kwa>end</kwa><br />
<def></def>  <kwa>return</kwa> <def></def><kwb>string</kwb><def></def><sym>.</sym><def></def><kwd>upper</kwd><def></def><sym>(</sym><def></def><kwb>table</kwb><def></def><sym>.</sym><def></def><kwd>concat</kwd><def></def><sym>(</sym><def>lines</def><sym>,</sym> <def></def><str>&quot;&quot;</str><def></def><sym>,</sym> <def></def><num>1</num><def></def><sym>,</sym> <def>ln</def><sym>))</sym><br />
<def></def><kwa>end</kwa><br />
<def></def><br />
<kwa>local</kwa> <def>seq</def> <sym>=</sym> <def></def><kwd>readseq</kwd><def></def><sym>()</sym><br />
<def></def><kwd>frequency</kwd><def></def><sym>(</sym><def>seq</def><sym>,</sym> <def></def><num>1</num><def></def><sym>)</sym><br />
<def></def><kwd>frequency</kwd><def></def><sym>(</sym><def>seq</def><sym>,</sym> <def></def><num>2</num><def></def><sym>)</sym><br />
<def></def><kwd>count</kwd><def></def><sym>(</sym><def>seq</def><sym>,</sym> <def></def><str>&quot;GGT&quot;</str><def></def><sym>)</sym><br />
<def></def><kwd>count</kwd><def></def><sym>(</sym><def>seq</def><sym>,</sym> <def></def><str>&quot;GGTA&quot;</str><def></def><sym>)</sym><br />
<def></def><kwd>count</kwd><def></def><sym>(</sym><def>seq</def><sym>,</sym> <def></def><str>&quot;GGTATT&quot;</str><def></def><sym>)</sym><br />
<def></def><kwd>count</kwd><def></def><sym>(</sym><def>seq</def><sym>,</sym> <def></def><str>&quot;GGTATTTTAATT&quot;</str><def></def><sym>)</sym><br />
<def></def><kwd>count</kwd><def></def><sym>(</sym><def>seq</def><sym>,</sym> <def></def><str>&quot;GGTATTTTAATTTATAGT&quot;</str><def></def><sym>)</sym><def></def><br />
</source>
