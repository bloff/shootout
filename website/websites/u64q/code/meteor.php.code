<source>
<def></def><sym>&lt;</sym><def>?</def> <com>/* The Computer Language Shootout</com><br />
<com>   http://shootout.alioth.debian.org/</com><br />
<com></com><br />
<com>   contributed by Isaac Gouy (PHP novice)</com><br />
<com>*/</com><def></def><br />
<br />
<kwa>define</kwa><def></def><sym>(</sym><def></def><str>&quot;NW&quot;</str><def></def><sym>,</sym> <def></def><num>0</num><def></def><sym>);</sym><br />
<def></def><kwa>define</kwa><def></def><sym>(</sym><def></def><str>&quot;NE&quot;</str><def></def><sym>,</sym> <def></def><num>1</num><def></def><sym>);</sym><br />
<def></def><kwa>define</kwa><def></def><sym>(</sym><def></def><str>&quot;W&quot;</str><def></def><sym>,</sym> <def></def><num>2</num><def></def><sym>);</sym><br />
<def></def><kwa>define</kwa><def></def><sym>(</sym><def></def><str>&quot;E&quot;</str><def></def><sym>,</sym> <def></def><num>3</num><def></def><sym>);</sym><br />
<def></def><kwa>define</kwa><def></def><sym>(</sym><def></def><str>&quot;SW&quot;</str><def></def><sym>,</sym> <def></def><num>4</num><def></def><sym>);</sym><br />
<def></def><kwa>define</kwa><def></def><sym>(</sym><def></def><str>&quot;SE&quot;</str><def></def><sym>,</sym> <def></def><num>5</num><def></def><sym>);</sym><br />
<def></def><kwa>define</kwa><def></def><sym>(</sym><def></def><str>&quot;SIDES&quot;</str><def></def><sym>,</sym> <def></def><num>6</num><def></def><sym>);</sym><br />
<def></def><br />
<kwa>class</kwa> <def>Cell</def> <sym>{</sym><br />
<def>   var</def> <kwc>$marked</kwc> <def></def><sym>=</sym> <def>false</def><sym>;</sym><br />
<def>   var</def> <kwc>$next</kwc><def></def><sym>;</sym><br />
<def></def>   <kwa>function</kwa> <def></def><kwd>Cell</kwd><def></def><sym>() {</sym> <def></def><kwa>for</kwa> <def></def><sym>(</sym><def></def><kwc>$i</kwc><def></def><sym>=</sym><def></def><num>0</num><def></def><sym>;</sym> <def></def><kwc>$i</kwc><def></def><sym>&lt;</sym><def>SIDES</def><sym>;</sym> <def></def><kwc>$i</kwc><def></def><sym>++)</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def></def><kwc>$i</kwc><def></def><sym>] =</sym> <def>null</def><sym>; }</sym><br />
<def></def>   <kwa>function</kwa> <def></def><kwd>mark</kwd><def></def><sym>(){</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>marked</def> <sym>=</sym> <def>true</def><sym>; }</sym><br />
<def></def>   <kwa>function</kwa> <def></def><kwd>unmark</kwd><def></def><sym>(){</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>marked</def> <sym>=</sym> <def>false</def><sym>; }</sym><br />
<def></def><sym>}</sym><br />
<def></def><br />
<kwa>class</kwa> <def>BoardCell</def> <kwa>extends</kwa> <def>Cell</def> <sym>{</sym><br />
<def>   var</def> <kwc>$number</kwc><def></def><sym>;</sym><br />
<def>   var</def> <kwc>$piece</kwc><def></def><sym>;</sym><br />
<def></def><br />
   <kwa>function</kwa> <def></def><kwd>BoardCell</kwd><def></def><sym>(</sym><def></def><kwc>$i</kwc><def></def><sym>) {</sym><br />
<def>      Cell</def><sym>::</sym><def></def><kwd>Cell</kwd><def></def><sym>();</sym><br />
<def></def>      <kwc>$this</kwc><def></def><sym>-&gt;</sym><def>number</def> <sym>=</sym> <def></def><kwc>$i</kwc><def></def><sym>;</sym><br />
<def></def>   <sym>}</sym><br />
<def></def><br />
   <kwa>function</kwa> <def></def><kwd>isEmpty</kwd><def></def><sym>() {</sym> <def></def><kwa>return</kwa> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>piece</def> <sym>==</sym> <def>null</def><sym>; }</sym><br />
<def></def>   <kwa>function</kwa> <def></def><kwd>setEmpty</kwd><def></def><sym>() {</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>piece</def> <sym>=</sym> <def>null</def><sym>; }</sym><br />
<def></def><br />
   <kwa>function</kwa> <def></def><kwd>contiguousEmptyCells</kwd><def></def><sym>() {</sym><br />
<def></def>      <kwa>if</kwa> <def></def><sym>((!</sym><def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>marked</def><sym>) &amp;&amp; (</sym><def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def></def><kwd>isEmpty</kwd><def></def><sym>())){</sym><br />
<def></def>         <kwc>$this</kwc><def></def><sym>-&gt;</sym><def></def><kwd>mark</kwd><def></def><sym>();</sym><br />
<def></def>         <kwc>$count</kwc> <def></def><sym>=</sym> <def></def><num>1</num><def></def><sym>;</sym><br />
<def></def>         <kwa>for</kwa> <def></def><sym>(</sym><def></def><kwc>$i</kwc> <def></def><sym>=</sym> <def></def><num>0</num> <def></def><sym>;</sym> <def></def><kwc>$i</kwc> <def></def><sym>&lt;</sym> <def>SIDES</def> <sym>;</sym> <def></def><kwc>$i</kwc><def></def><sym>++){</sym><br />
<def></def>            <kwc>$neighbour</kwc> <def></def><sym>=</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def></def><kwc>$i</kwc><def></def><sym>];</sym><br />
<def></def>            <kwa>if</kwa> <def></def><sym>(</sym><def></def><kwc>$neighbour</kwc> <def></def><sym>!=</sym> <def>null</def> <sym>&amp;&amp;</sym> <def></def><kwc>$neighbour</kwc><def></def><sym>-&gt;</sym><def></def><kwd>isEmpty</kwd><def></def><sym>())</sym><br />
<def></def>               <kwc>$count</kwc> <def></def><sym>+=</sym> <def></def><kwc>$neighbour</kwc><def></def><sym>-&gt;</sym><def></def><kwd>contiguousEmptyCells</kwd><def></def><sym>();</sym><br />
<def></def>         <sym>}</sym><br />
<def></def>      <sym>}</sym> <def></def><kwa>else</kwa> <def></def><sym>{</sym><br />
<def></def>         <kwc>$count</kwc> <def></def><sym>=</sym> <def></def><num>0</num><def></def><sym>;</sym><br />
<def></def>      <sym>}</sym><br />
<def></def>      <kwa>return</kwa> <def></def><kwc>$count</kwc><def></def><sym>;</sym><br />
<def></def>   <sym>}</sym><br />
<def></def><sym>}</sym><br />
<def></def><br />
<br />
<kwa>define</kwa><def></def><sym>(</sym><def></def><str>&quot;BOARD_COLS&quot;</str><def></def><sym>,</sym> <def></def><num>5</num><def></def><sym>);</sym><br />
<def></def><kwa>define</kwa><def></def><sym>(</sym><def></def><str>&quot;BOARD_ROWS&quot;</str><def></def><sym>,</sym> <def></def><num>10</num><def></def><sym>);</sym><br />
<def></def><kwa>define</kwa><def></def><sym>(</sym><def></def><str>&quot;BOARD_SIZE&quot;</str><def></def><sym>,</sym> <def>BOARD_COLS</def> <sym>*</sym> <def>BOARD_ROWS</def><sym>);</sym><br />
<def></def><br />
<kwa>define</kwa><def></def><sym>(</sym><def></def><str>&quot;PIECES&quot;</str><def></def><sym>,</sym> <def></def><num>10</num><def></def><sym>);</sym><br />
<def></def><kwa>define</kwa><def></def><sym>(</sym><def></def><str>&quot;PIECE_SIZE&quot;</str><def></def><sym>,</sym> <def></def><num>5</num><def></def><sym>);</sym><br />
<def></def><kwa>define</kwa><def></def><sym>(</sym><def></def><str>&quot;PIECE_ROTATIONS&quot;</str><def></def><sym>,</sym> <def>SIDES</def><sym>);</sym><br />
<def></def><kwa>define</kwa><def></def><sym>(</sym><def></def><str>&quot;PIECE_FLIPS&quot;</str><def></def><sym>,</sym> <def></def><num>2</num><def></def><sym>);</sym><br />
<def></def><kwa>define</kwa><def></def><sym>(</sym><def></def><str>&quot;PIECE_ORIENTATIONS&quot;</str><def></def><sym>,</sym> <def>PIECE_ROTATIONS</def> <sym>*</sym> <def>PIECE_FLIPS</def><sym>);</sym><br />
<def></def><br />
<kwa>class</kwa> <def>Board</def> <sym>{</sym><br />
<def>   var</def> <kwc>$cells</kwc><def></def><sym>;</sym><br />
<def>   var</def> <kwc>$cellsPieceWillFill</kwc><def></def><sym>;</sym><br />
<def>   var</def> <kwc>$cellCount</kwc> <def></def><sym>=</sym> <def></def><num>0</num><def></def><sym>;</sym><br />
<def>   var</def> <kwc>$cache</kwc><def></def><sym>;</sym><br />
<def>   var</def> <kwc>$noFit</kwc> <def></def><sym>=</sym> <def></def><kwa>array</kwa><def></def><sym>();</sym><br />
<def></def><br />
   <kwa>function</kwa> <def></def><kwd>Board</kwd><def></def><sym>(){</sym><br />
<def></def>      <kwa>for</kwa> <def></def><sym>(</sym><def></def><kwc>$i</kwc><def></def><sym>=</sym><def></def><num>0</num><def></def><sym>;</sym> <def></def><kwc>$i</kwc><def></def><sym>&lt;</sym><def>BOARD_SIZE</def><sym>;</sym> <def></def><kwc>$i</kwc><def></def><sym>++)</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>cells</def><sym>[</sym><def></def><kwc>$i</kwc><def></def><sym>] =</sym> <def>new</def> <kwd>BoardCell</kwd><def></def><sym>(</sym><def></def><kwc>$i</kwc><def></def><sym>);</sym><br />
<def></def>      <kwc>$m</kwc> <def></def><sym>=</sym> <def></def><kwa>floor</kwa><def></def><sym>(</sym><def>BOARD_SIZE</def> <sym>/</sym> <def>BOARD_COLS</def><sym>) -</sym> <def></def><num>1</num><def></def><sym>;</sym><br />
<def></def><br />
      <kwa>for</kwa> <def></def><sym>(</sym><def></def><kwc>$i</kwc><def></def><sym>=</sym><def></def><num>0</num><def></def><sym>;</sym> <def></def><kwc>$i</kwc><def></def><sym>&lt;</sym><def>BOARD_SIZE</def><sym>;</sym> <def></def><kwc>$i</kwc><def></def><sym>++){</sym><br />
<def></def>         <kwc>$row</kwc> <def></def><sym>=</sym> <def></def><kwa>floor</kwa><def></def><sym>(</sym><def></def><kwc>$i</kwc> <def></def><sym>/</sym> <def>BOARD_COLS</def><sym>);</sym><br />
<def></def>         <kwc>$isFirst</kwc> <def></def><sym>=</sym> <def></def><kwc>$i</kwc> <def>% BOARD_COLS</def> <sym>==</sym> <def></def><num>0</num><def></def><sym>;</sym><br />
<def></def>         <kwc>$isLast</kwc> <def></def><sym>= (</sym><def></def><kwc>$i</kwc> <def></def><sym>+</sym> <def></def><num>1</num><def></def><sym>)</sym> <def>% BOARD_COLS</def> <sym>==</sym> <def></def><num>0</num><def></def><sym>;</sym><br />
<def></def>         <kwc>$c</kwc> <def></def><sym>=</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>cells</def><sym>[</sym><def></def><kwc>$i</kwc><def></def><sym>];</sym><br />
<def></def><br />
         <kwa>if</kwa> <def></def><sym>(</sym><def></def><kwc>$row</kwc> <def>%</def> <num>2</num> <def></def><sym>==</sym> <def></def><num>1</num><def></def><sym>) {</sym><br />
<def></def>            <kwa>if</kwa> <def></def><sym>(!</sym><def></def><kwc>$isLast</kwc><def></def><sym>)</sym> <def></def><kwc>$c</kwc><def></def><sym>-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>NE</def><sym>] =</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>cells</def><sym>[</sym><def></def><kwc>$i</kwc><def></def><sym>-(</sym><def>BOARD_COLS</def><sym>-</sym><def></def><num>1</num><def></def><sym>)];</sym><br />
<def></def>            <kwc>$c</kwc><def></def><sym>-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>NW</def><sym>] =</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>cells</def><sym>[</sym><def></def><kwc>$i</kwc><def></def><sym>-</sym><def>BOARD_COLS</def><sym>];</sym><br />
<def></def>            <kwa>if</kwa> <def></def><sym>(</sym><def></def><kwc>$row</kwc> <def></def><sym>!=</sym> <def></def><kwc>$m</kwc><def></def><sym>) {</sym><br />
<def></def>               <kwa>if</kwa> <def></def><sym>(!</sym><def></def><kwc>$isLast</kwc><def></def><sym>)</sym> <def></def><kwc>$c</kwc><def></def><sym>-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>SE</def><sym>] =</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>cells</def><sym>[</sym><def></def><kwc>$i</kwc><def></def><sym>+(</sym><def>BOARD_COLS</def><sym>+</sym><def></def><num>1</num><def></def><sym>)];</sym><br />
<def></def>               <kwc>$c</kwc><def></def><sym>-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>SW</def><sym>] =</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>cells</def><sym>[</sym><def></def><kwc>$i</kwc><def></def><sym>+</sym><def>BOARD_COLS</def><sym>];</sym><br />
<def></def>            <sym>}</sym><br />
<def></def>         <sym>}</sym> <def></def><kwa>else</kwa> <def></def><sym>{</sym><br />
<def></def>            <kwa>if</kwa> <def></def><sym>(</sym><def></def><kwc>$row</kwc> <def></def><sym>!=</sym> <def></def><num>0</num><def></def><sym>) {</sym><br />
<def></def>               <kwa>if</kwa> <def></def><sym>(!</sym><def></def><kwc>$isFirst</kwc><def></def><sym>)</sym> <def></def><kwc>$c</kwc><def></def><sym>-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>NW</def><sym>] =</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>cells</def><sym>[</sym><def></def><kwc>$i</kwc><def></def><sym>-(</sym><def>BOARD_COLS</def><sym>+</sym><def></def><num>1</num><def></def><sym>)];</sym><br />
<def></def>               <kwc>$c</kwc><def></def><sym>-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>NE</def><sym>] =</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>cells</def><sym>[</sym><def></def><kwc>$i</kwc><def></def><sym>-</sym><def>BOARD_COLS</def><sym>];</sym><br />
<def></def>            <sym>}</sym><br />
<def></def>            <kwa>if</kwa> <def></def><sym>(</sym><def></def><kwc>$row</kwc> <def></def><sym>!=</sym> <def></def><kwc>$m</kwc><def></def><sym>) {</sym><br />
<def></def>               <kwa>if</kwa> <def></def><sym>(!</sym><def></def><kwc>$isFirst</kwc><def></def><sym>)</sym> <def></def><kwc>$c</kwc><def></def><sym>-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>SW</def><sym>] =</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>cells</def><sym>[</sym><def></def><kwc>$i</kwc><def></def><sym>+(</sym><def>BOARD_COLS</def><sym>-</sym><def></def><num>1</num><def></def><sym>)];</sym><br />
<def></def>               <kwc>$c</kwc><def></def><sym>-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>SE</def><sym>] =</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>cells</def><sym>[</sym><def></def><kwc>$i</kwc><def></def><sym>+</sym><def>BOARD_COLS</def><sym>];</sym><br />
<def></def>            <sym>}</sym><br />
<def></def>         <sym>}</sym><br />
<def></def>         <kwa>if</kwa> <def></def><sym>(!</sym><def></def><kwc>$isFirst</kwc><def></def><sym>)</sym> <def></def><kwc>$c</kwc><def></def><sym>-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>W</def><sym>] =</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>cells</def><sym>[</sym><def></def><kwc>$i</kwc><def></def><sym>-</sym><def></def><num>1</num><def></def><sym>];</sym><br />
<def></def>         <kwa>if</kwa> <def></def><sym>(!</sym><def></def><kwc>$isLast</kwc><def></def><sym>)</sym> <def></def><kwc>$c</kwc><def></def><sym>-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>E</def><sym>] =</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>cells</def><sym>[</sym><def></def><kwc>$i</kwc><def></def><sym>+</sym><def></def><num>1</num><def></def><sym>];</sym><br />
<def></def>      <sym>}</sym><br />
<def></def>      <kwc>$this</kwc><def></def><sym>-&gt;</sym><def></def><kwd>initializeCache</kwd><def></def><sym>();</sym><br />
<def></def>   <sym>}</sym><br />
<def></def><br />
   <kwa>function</kwa> <def></def><kwd>initializeCache</kwd><def></def><sym>(){</sym><br />
<def></def>      <kwa>for</kwa> <def></def><sym>(</sym><def></def><kwc>$i</kwc><def></def><sym>=</sym><def></def><num>0</num><def></def><sym>;</sym> <def></def><kwc>$i</kwc><def></def><sym>&lt;</sym><def>PIECES</def><sym>;</sym> <def></def><kwc>$i</kwc><def></def><sym>++)</sym><br />
<def></def>         <kwa>for</kwa> <def></def><sym>(</sym><def></def><kwc>$j</kwc><def></def><sym>=</sym><def></def><num>0</num><def></def><sym>;</sym> <def></def><kwc>$j</kwc><def></def><sym>&lt;</sym><def>PIECE_ORIENTATIONS</def><sym>;</sym> <def></def><kwc>$j</kwc><def></def><sym>++)</sym><br />
<def></def>            <kwa>for</kwa> <def></def><sym>(</sym><def></def><kwc>$k</kwc><def></def><sym>=</sym><def></def><num>0</num><def></def><sym>;</sym> <def></def><kwc>$k</kwc><def></def><sym>&lt;</sym><def>PIECE_SIZE</def><sym>;</sym> <def></def><kwc>$k</kwc><def></def><sym>++)</sym><br />
<def></def>               <kwa>for</kwa> <def></def><sym>(</sym><def></def><kwc>$m</kwc><def></def><sym>=</sym><def></def><num>0</num><def></def><sym>;</sym> <def></def><kwc>$m</kwc><def></def><sym>&lt;</sym><def>BOARD_SIZE</def><sym>;</sym> <def></def><kwc>$m</kwc><def></def><sym>++)</sym><br />
<def></def>                  <kwc>$this</kwc><def></def><sym>-&gt;</sym><def>cache</def><sym>[</sym><def></def><kwc>$i</kwc><def></def><sym>][</sym><def></def><kwc>$j</kwc><def></def><sym>][</sym><def></def><kwc>$k</kwc><def></def><sym>][</sym><def></def><kwc>$m</kwc><def></def><sym>] =</sym> <def>null</def><sym>;</sym><br />
<def></def>   <sym>}</sym><br />
<def></def><br />
   <kwa>function</kwa> <def></def><kwd>unmark</kwd><def></def><sym>(){</sym><br />
<def></def>      <kwa>for</kwa> <def></def><sym>(</sym><def></def><kwc>$i</kwc><def></def><sym>=</sym><def></def><num>0</num><def></def><sym>;</sym> <def></def><kwc>$i</kwc><def></def><sym>&lt;</sym><def>BOARD_SIZE</def><sym>;</sym> <def></def><kwc>$i</kwc><def></def><sym>++)</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>cells</def><sym>[</sym><def></def><kwc>$i</kwc><def></def><sym>]-&gt;</sym><def></def><kwd>unmark</kwd><def></def><sym>();</sym><br />
<def></def>   <sym>}</sym><br />
<def></def><br />
   <kwa>function</kwa> <def></def><kwd>firstEmptyCellIndex</kwd><def></def><sym>(){</sym><br />
<def></def>      <kwa>for</kwa> <def></def><sym>(</sym><def></def><kwc>$i</kwc><def></def><sym>=</sym><def></def><num>0</num><def></def><sym>;</sym> <def></def><kwc>$i</kwc><def></def><sym>&lt;</sym><def>BOARD_SIZE</def><sym>;</sym> <def></def><kwc>$i</kwc><def></def><sym>++)</sym><br />
<def></def>         <kwa>if</kwa> <def></def><sym>(</sym><def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>cells</def><sym>[</sym><def></def><kwc>$i</kwc><def></def><sym>]-&gt;</sym><def></def><kwd>isEmpty</kwd><def></def><sym>())</sym> <def></def><kwa>return</kwa> <def></def><kwc>$i</kwc><def></def><sym>;</sym><br />
<def></def>      <kwa>return</kwa> <def></def><sym>-</sym><def></def><num>1</num><def></def><sym>;</sym><br />
<def></def>   <sym>}</sym><br />
<def></def><br />
   <kwa>function</kwa> <def></def><kwd>remove</kwd><def></def><sym>(&amp;</sym><def></def><kwc>$p</kwc><def></def><sym>){</sym><br />
<def></def>      <kwa>for</kwa> <def></def><sym>(</sym><def></def><kwc>$i</kwc><def></def><sym>=</sym><def></def><num>0</num><def></def><sym>;</sym> <def></def><kwc>$i</kwc><def></def><sym>&lt;</sym><def>BOARD_SIZE</def><sym>;</sym> <def></def><kwc>$i</kwc><def></def><sym>++)</sym><br />
<def></def>         <kwa>if</kwa> <def></def><sym>(</sym><def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>cells</def><sym>[</sym><def></def><kwc>$i</kwc><def></def><sym>]-&gt;</sym><def>piece</def> <sym>==</sym> <def></def><kwc>$p</kwc><def></def><sym>)</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>cells</def><sym>[</sym><def></def><kwc>$i</kwc><def></def><sym>]-&gt;</sym><def>piece</def> <sym>=</sym> <def>null</def><sym>;</sym><br />
<def></def>   <sym>}</sym><br />
<def></def><br />
   <kwa>function</kwa> <def></def><kwd>find</kwd><def></def><sym>(&amp;</sym><def></def><kwc>$p</kwc><def></def><sym>,&amp;</sym><def></def><kwc>$c</kwc><def></def><sym>){</sym><br />
<def></def>      <kwa>if</kwa> <def></def><sym>((</sym><def></def><kwc>$p</kwc> <def></def><sym>!=</sym> <def>null</def><sym>) &amp;&amp; ((!</sym><def></def><kwc>$p</kwc><def></def><sym>-&gt;</sym><def>marked</def><sym>) &amp;&amp; (</sym><def></def><kwc>$c</kwc> <def></def><sym>!=</sym> <def>null</def><sym>))){</sym><br />
<def></def>         <kwc>$this</kwc><def></def><sym>-&gt;</sym><def>cellsPieceWillFill</def><sym>[</sym><def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>cellCount</def><sym>] =</sym> <def></def><kwc>$c</kwc><def></def><sym>;</sym><br />
<def></def>         <kwc>$this</kwc><def></def><sym>-&gt;</sym><def>cellCount</def><sym>++;</sym><br />
<def></def>         <kwc>$p</kwc><def></def><sym>-&gt;</sym><def></def><kwd>mark</kwd><def></def><sym>();</sym><br />
<def></def>         <kwa>for</kwa> <def></def><sym>(</sym><def></def><kwc>$i</kwc><def></def><sym>=</sym><def></def><num>0</num><def></def><sym>;</sym> <def></def><kwc>$i</kwc><def></def><sym>&lt;</sym><def>SIDES</def><sym>;</sym> <def></def><kwc>$i</kwc><def></def><sym>++){</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def></def><kwd>find</kwd><def></def><sym>(</sym><def></def><kwc>$p</kwc><def></def><sym>-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def></def><kwc>$i</kwc><def></def><sym>],</sym><def></def><kwc>$c</kwc><def></def><sym>-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def></def><kwc>$i</kwc><def></def><sym>]); }</sym><br />
<def></def>      <sym>}</sym><br />
<def></def>   <sym>}</sym><br />
<def></def><br />
   <kwa>function</kwa> <def></def><kwd>add</kwd><def></def><sym>(</sym><def></def><kwc>$pieceIndex</kwc><def></def><sym>,</sym><def></def><kwc>$boardIndex</kwc><def></def><sym>,&amp;</sym><def></def><kwc>$p</kwc><def></def><sym>){</sym><br />
<def></def>      <kwc>$a</kwc> <def></def><sym>=</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>cache</def><sym>[</sym><def></def><kwc>$p</kwc><def></def><sym>-&gt;</sym><def>number</def><sym>][</sym><def></def><kwc>$p</kwc><def></def><sym>-&gt;</sym><def>orientation</def><sym>][</sym><def></def><kwc>$pieceIndex</kwc><def></def><sym>][</sym><def></def><kwc>$boardIndex</kwc><def></def><sym>];</sym><br />
<def></def>      <kwc>$this</kwc><def></def><sym>-&gt;</sym><def>cellCount</def> <sym>=</sym> <def></def><num>0</num><def></def><sym>;</sym><br />
<def></def>      <kwc>$p</kwc><def></def><sym>-&gt;</sym><def></def><kwd>unmark</kwd><def></def><sym>();</sym><br />
<def></def><br />
      <kwa>if</kwa> <def></def><sym>(</sym><def></def><kwc>$a</kwc> <def></def><sym>==</sym> <def>null</def><sym>){</sym><br />
<def></def>         <kwc>$this</kwc><def></def><sym>-&gt;</sym><def></def><kwd>find</kwd><def></def><sym>(</sym><def></def><kwc>$p</kwc><def></def><sym>-&gt;</sym><def></def><kwd>cell</kwd><def></def><sym>(</sym><def></def><kwc>$pieceIndex</kwc><def></def><sym>),</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>cells</def><sym>[</sym><def></def><kwc>$boardIndex</kwc><def></def><sym>]);</sym><br />
<def></def>         <kwa>if</kwa> <def></def><sym>(</sym><def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>cellCount</def> <sym>!=</sym> <def>PIECE_SIZE</def><sym>){</sym><br />
<def></def>            <kwc>$this</kwc><def></def><sym>-&gt;</sym><def>cache</def><sym>[</sym><def></def><kwc>$p</kwc><def></def><sym>-&gt;</sym><def>number</def><sym>][</sym><def></def><kwc>$p</kwc><def></def><sym>-&gt;</sym><def>orientation</def><sym>]</sym><br />
<def></def>               <sym>[</sym><def></def><kwc>$pieceIndex</kwc><def></def><sym>][</sym><def></def><kwc>$boardIndex</kwc><def></def><sym>] =</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>noFit</def><sym>;</sym><br />
<def></def>            <kwa>return</kwa> <def>false</def><sym>;</sym><br />
<def></def>         <sym>}</sym><br />
<def></def>         <kwc>$a</kwc> <def></def><sym>=</sym> <def></def><kwa>array_slice</kwa><def></def><sym>(</sym><def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>cellsPieceWillFill</def><sym>,</sym><def></def><num>0</num><def></def><sym>);</sym><br />
<def></def>         <kwc>$this</kwc><def></def><sym>-&gt;</sym><def>cache</def><sym>[</sym><def></def><kwc>$p</kwc><def></def><sym>-&gt;</sym><def>number</def><sym>][</sym><def></def><kwc>$p</kwc><def></def><sym>-&gt;</sym><def>orientation</def><sym>][</sym><def></def><kwc>$pieceIndex</kwc><def></def><sym>][</sym><def></def><kwc>$boardIndex</kwc><def></def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>;</sym><br />
<def></def>      <sym>}</sym> <def></def><kwa>else</kwa> <def></def><sym>{</sym><br />
<def></def>         <kwa>if</kwa> <def></def><sym>(</sym><def></def><kwc>$a</kwc> <def></def><sym>==</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>noFit</def><sym>)</sym> <def></def><kwa>return</kwa> <def>false</def><sym>;</sym><br />
<def></def>      <sym>}</sym><br />
<def></def>      <kwa>for</kwa> <def></def><sym>(</sym><def></def><kwc>$i</kwc><def></def><sym>=</sym><def></def><num>0</num><def></def><sym>;</sym> <def></def><kwc>$i</kwc><def></def><sym>&lt;</sym><def>PIECE_SIZE</def><sym>;</sym> <def></def><kwc>$i</kwc><def></def><sym>++){</sym> <def></def><kwa>if</kwa> <def></def><sym>(!</sym><def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><kwc>$i</kwc><def></def><sym>]-&gt;</sym><def></def><kwd>isEmpty</kwd><def></def><sym>())</sym> <def></def><kwa>return</kwa> <def>false</def><sym>; }</sym><br />
<def></def>      <kwa>for</kwa> <def></def><sym>(</sym><def></def><kwc>$i</kwc><def></def><sym>=</sym><def></def><num>0</num><def></def><sym>;</sym> <def></def><kwc>$i</kwc><def></def><sym>&lt;</sym><def>PIECE_SIZE</def><sym>;</sym> <def></def><kwc>$i</kwc><def></def><sym>++){</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><kwc>$i</kwc><def></def><sym>]-&gt;</sym><def>piece</def> <sym>=</sym> <def></def><kwc>$p</kwc><def></def><sym>; }</sym><br />
<def></def>      <kwa>return</kwa> <def>true</def><sym>;</sym><br />
<def></def>   <sym>}</sym><br />
<def></def><br />
   <kwa>function</kwa> <def></def><kwd>asString</kwd><def></def><sym>(){</sym><br />
<def></def>      <kwc>$a</kwc> <def></def><sym>=</sym> <def></def><kwa>array</kwa><def></def><sym>();</sym><br />
<def></def>      <kwa>for</kwa> <def></def><sym>(</sym><def></def><kwc>$i</kwc><def></def><sym>=</sym><def></def><num>0</num><def></def><sym>;</sym> <def></def><kwc>$i</kwc><def></def><sym>&lt;</sym><def>BOARD_SIZE</def><sym>;</sym> <def></def><kwc>$i</kwc><def></def><sym>++)</sym> <def></def><kwc>$a</kwc><def></def><sym>[] =</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>cells</def><sym>[</sym><def></def><kwc>$i</kwc><def></def><sym>]-&gt;</sym><def>piece</def><sym>-&gt;</sym><def>number</def><sym>;</sym><br />
<def></def>      <kwa>return implode</kwa><def></def><sym>(</sym><def></def><str>&quot;&quot;</str><def></def><sym>,</sym><def></def><kwc>$a</kwc><def></def><sym>);</sym><br />
<def></def>   <sym>}</sym><br />
<def></def><br />
<com>/*</com><br />
<com>   function printBoard(){</com><br />
<com>      print(&quot;cell\tNW NE W  E  SW SE\n&quot;);</com><br />
<com>      for ($i=0; $i&lt;BOARD_SIZE; $i++){</com><br />
<com>         printf(&quot;%d \t&quot;, $i);</com><br />
<com>         for ($j=0; $j&lt;SIDES; $j++){</com><br />
<com>            $c = $this-&gt;cells[$i]-&gt;next[$j];</com><br />
<com>            if ($c == null) print(&quot;-- &quot;); else printf(&quot;%2d &quot;, $c-&gt;number);</com><br />
<com>         }</com><br />
<com>         print(&quot;\n&quot;);</com><br />
<com>      }</com><br />
<com>      print(&quot;\n&quot;);</com><br />
<com>   }</com><br />
<com>*/</com><def></def><br />
<sym>}</sym><br />
<def></def><br />
<br />
<kwa>class</kwa> <def>PieceCell</def> <kwa>extends</kwa> <def>Cell</def> <sym>{</sym><br />
<def></def>   <kwa>function</kwa> <def></def><kwd>PieceCell</kwd><def></def><sym>() {</sym> <def>Cell</def><sym>::</sym><def></def><kwd>Cell</kwd><def></def><sym>(); }</sym><br />
<def></def><br />
   <kwa>function</kwa> <def></def><kwd>flip</kwd><def></def><sym>() {</sym><br />
<def></def>      <kwc>$swap</kwc> <def></def><sym>=</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>NE</def><sym>];</sym><br />
<def></def>      <kwc>$this</kwc><def></def><sym>-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>NE</def><sym>] =</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>NW</def><sym>];</sym><br />
<def></def>      <kwc>$this</kwc><def></def><sym>-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>NW</def><sym>] =</sym> <def></def><kwc>$swap</kwc><def></def><sym>;</sym><br />
<def></def><br />
      <kwc>$swap</kwc> <def></def><sym>=</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>E</def><sym>];</sym><br />
<def></def>      <kwc>$this</kwc><def></def><sym>-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>E</def><sym>] =</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>W</def><sym>];</sym><br />
<def></def>      <kwc>$this</kwc><def></def><sym>-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>W</def><sym>] =</sym> <def></def><kwc>$swap</kwc><def></def><sym>;</sym><br />
<def></def><br />
      <kwc>$swap</kwc> <def></def><sym>=</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>SE</def><sym>];</sym><br />
<def></def>      <kwc>$this</kwc><def></def><sym>-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>SE</def><sym>] =</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>SW</def><sym>];</sym><br />
<def></def>      <kwc>$this</kwc><def></def><sym>-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>SW</def><sym>] =</sym> <def></def><kwc>$swap</kwc><def></def><sym>;</sym><br />
<def></def>   <sym>}</sym><br />
<def></def><br />
   <kwa>function</kwa> <def></def><kwd>rotate</kwd><def></def><sym>() {</sym><br />
<def></def>      <kwc>$swap</kwc> <def></def><sym>=</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>E</def><sym>];</sym><br />
<def></def>      <kwc>$this</kwc><def></def><sym>-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>E</def><sym>] =</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>NE</def><sym>];</sym><br />
<def></def>      <kwc>$this</kwc><def></def><sym>-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>NE</def><sym>] =</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>NW</def><sym>];</sym><br />
<def></def>      <kwc>$this</kwc><def></def><sym>-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>NW</def><sym>] =</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>W</def><sym>];</sym><br />
<def></def>      <kwc>$this</kwc><def></def><sym>-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>W</def><sym>] =</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>SW</def><sym>];</sym><br />
<def></def>      <kwc>$this</kwc><def></def><sym>-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>SW</def><sym>] =</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>SE</def><sym>];</sym><br />
<def></def>      <kwc>$this</kwc><def></def><sym>-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>SE</def><sym>] =</sym> <def></def><kwc>$swap</kwc><def></def><sym>;</sym><br />
<def></def>   <sym>}</sym><br />
<def></def><sym>}</sym><br />
<def></def><br />
<br />
<kwa>class</kwa> <def>Piece</def> <sym>{</sym><br />
<def>   var</def> <kwc>$number</kwc><def></def><sym>;</sym><br />
<def>   var</def> <kwc>$orientation</kwc> <def></def><sym>=</sym> <def></def><num>0</num><def></def><sym>;</sym><br />
<def>   var</def> <kwc>$cache</kwc><def></def><sym>;</sym><br />
<def></def><br />
   <kwa>function</kwa> <def></def><kwd>Piece</kwd><def></def><sym>(</sym><def></def><kwc>$n</kwc><def></def><sym>) {</sym><br />
<def></def>      <kwc>$this</kwc><def></def><sym>-&gt;</sym><def>number</def> <sym>=</sym> <def></def><kwc>$n</kwc><def></def><sym>;</sym><br />
<def></def>      <kwa>for</kwa> <def></def><sym>(</sym><def></def><kwc>$k</kwc><def></def><sym>=</sym><def></def><num>0</num><def></def><sym>;</sym> <def></def><kwc>$k</kwc><def></def><sym>&lt;</sym><def>PIECE_ORIENTATIONS</def><sym>;</sym> <def></def><kwc>$k</kwc><def></def><sym>++){</sym><br />
<def></def><br />
         <kwa>for</kwa> <def></def><sym>(</sym><def></def><kwc>$i</kwc><def></def><sym>=</sym><def></def><num>0</num><def></def><sym>;</sym> <def></def><kwc>$i</kwc><def></def><sym>&lt;</sym><def>PIECE_SIZE</def><sym>;</sym> <def></def><kwc>$i</kwc><def></def><sym>++)</sym><br />
<def></def>            <kwc>$this</kwc><def></def><sym>-&gt;</sym><def>cache</def><sym>[</sym><def></def><kwc>$k</kwc><def></def><sym>][</sym><def></def><kwc>$i</kwc><def></def><sym>] =</sym> <def>new</def> <kwd>PieceCell</kwd><def></def><sym>();</sym><br />
<def></def><br />
         <kwa>switch</kwa> <def></def><sym>(</sym><def></def><kwc>$n</kwc><def></def><sym>){</sym><br />
<def>            case</def> <num>0</num><def></def><sym>:</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def></def><kwd>make0</kwd><def></def><sym>(</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>cache</def><sym>[</sym><def></def><kwc>$k</kwc><def></def><sym>] );</sym> <def></def><kwa>break</kwa><def></def><sym>;</sym><br />
<def>            case</def> <num>1</num><def></def><sym>:</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def></def><kwd>make1</kwd><def></def><sym>(</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>cache</def><sym>[</sym><def></def><kwc>$k</kwc><def></def><sym>] );</sym> <def></def><kwa>break</kwa><def></def><sym>;</sym><br />
<def>            case</def> <num>2</num><def></def><sym>:</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def></def><kwd>make2</kwd><def></def><sym>(</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>cache</def><sym>[</sym><def></def><kwc>$k</kwc><def></def><sym>] );</sym> <def></def><kwa>break</kwa><def></def><sym>;</sym><br />
<def>            case</def> <num>3</num><def></def><sym>:</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def></def><kwd>make3</kwd><def></def><sym>(</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>cache</def><sym>[</sym><def></def><kwc>$k</kwc><def></def><sym>] );</sym> <def></def><kwa>break</kwa><def></def><sym>;</sym><br />
<def>            case</def> <num>4</num><def></def><sym>:</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def></def><kwd>make4</kwd><def></def><sym>(</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>cache</def><sym>[</sym><def></def><kwc>$k</kwc><def></def><sym>] );</sym> <def></def><kwa>break</kwa><def></def><sym>;</sym><br />
<def>            case</def> <num>5</num><def></def><sym>:</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def></def><kwd>make5</kwd><def></def><sym>(</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>cache</def><sym>[</sym><def></def><kwc>$k</kwc><def></def><sym>] );</sym> <def></def><kwa>break</kwa><def></def><sym>;</sym><br />
<def>            case</def> <num>6</num><def></def><sym>:</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def></def><kwd>make6</kwd><def></def><sym>(</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>cache</def><sym>[</sym><def></def><kwc>$k</kwc><def></def><sym>] );</sym> <def></def><kwa>break</kwa><def></def><sym>;</sym><br />
<def>            case</def> <num>7</num><def></def><sym>:</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def></def><kwd>make7</kwd><def></def><sym>(</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>cache</def><sym>[</sym><def></def><kwc>$k</kwc><def></def><sym>] );</sym> <def></def><kwa>break</kwa><def></def><sym>;</sym><br />
<def>            case</def> <num>8</num><def></def><sym>:</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def></def><kwd>make8</kwd><def></def><sym>(</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>cache</def><sym>[</sym><def></def><kwc>$k</kwc><def></def><sym>] );</sym> <def></def><kwa>break</kwa><def></def><sym>;</sym><br />
<def>            case</def> <num>9</num><def></def><sym>:</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def></def><kwd>make9</kwd><def></def><sym>(</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>cache</def><sym>[</sym><def></def><kwc>$k</kwc><def></def><sym>] );</sym> <def></def><kwa>break</kwa><def></def><sym>;</sym><br />
<def></def>         <sym>}</sym><br />
<def></def><br />
         <kwa>for</kwa> <def></def><sym>(</sym><def></def><kwc>$i</kwc><def></def><sym>=</sym><def></def><num>0</num><def></def><sym>;</sym> <def></def><kwc>$i</kwc><def></def><sym>&lt;</sym><def></def><kwc>$k</kwc><def></def><sym>;</sym> <def></def><kwc>$i</kwc><def></def><sym>++)</sym><br />
<def></def>            <kwa>if</kwa> <def></def><sym>(</sym><def></def><kwc>$i</kwc> <def>% PIECE_ROTATIONS</def> <sym>==</sym> <def></def><num>0</num><def></def><sym>)</sym><br />
<def></def>               <kwa>for</kwa> <def></def><sym>(</sym><def></def><kwc>$j</kwc><def></def><sym>=</sym><def></def><num>0</num><def></def><sym>;</sym> <def></def><kwc>$j</kwc><def></def><sym>&lt;</sym><def>PIECE_SIZE</def><sym>;</sym> <def></def><kwc>$j</kwc><def></def><sym>++)</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>cache</def><sym>[</sym><def></def><kwc>$k</kwc><def></def><sym>][</sym><def></def><kwc>$j</kwc><def></def><sym>]-&gt;</sym><def></def><kwd>flip</kwd><def></def><sym>();</sym><br />
<def></def>            <kwa>else</kwa><br />
<def></def>               <kwa>for</kwa> <def></def><sym>(</sym><def></def><kwc>$j</kwc><def></def><sym>=</sym><def></def><num>0</num><def></def><sym>;</sym> <def></def><kwc>$j</kwc><def></def><sym>&lt;</sym><def>PIECE_SIZE</def><sym>;</sym> <def></def><kwc>$j</kwc><def></def><sym>++)</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>cache</def><sym>[</sym><def></def><kwc>$k</kwc><def></def><sym>][</sym><def></def><kwc>$j</kwc><def></def><sym>]-&gt;</sym><def></def><kwd>rotate</kwd><def></def><sym>();</sym><br />
<def></def>      <sym>}</sym><br />
<def></def>   <sym>}</sym><br />
<def></def><br />
   <kwa>function</kwa> <def></def><kwd>unmark</kwd><def></def><sym>(){</sym><br />
<def></def>      <kwa>for</kwa> <def></def><sym>(</sym><def></def><kwc>$i</kwc><def></def><sym>=</sym><def></def><num>0</num><def></def><sym>;</sym> <def></def><kwc>$i</kwc><def></def><sym>&lt;</sym><def>PIECE_SIZE</def><sym>;</sym> <def></def><kwc>$i</kwc><def></def><sym>++)</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>cache</def><sym>[</sym><def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>orientation</def><sym>][</sym><def></def><kwc>$i</kwc><def></def><sym>]-&gt;</sym><def></def><kwd>unmark</kwd><def></def><sym>();</sym><br />
<def></def>   <sym>}</sym><br />
<def></def><br />
   <kwa>function</kwa> <def></def><kwd>nextOrientation</kwd><def></def><sym>(){</sym><br />
<def></def>      <kwc>$this</kwc><def></def><sym>-&gt;</sym><def>orientation</def> <sym>= (</sym><def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>orientation</def> <sym>+</sym> <def></def><num>1</num><def></def><sym>)</sym> <def>% PIECE_ORIENTATIONS</def><sym>;</sym><br />
<def></def>      <kwa>return</kwa> <def></def><kwc>$this</kwc><def></def><sym>;</sym><br />
<def></def>   <sym>}</sym><br />
<def></def><br />
   <kwa>function</kwa> <def></def><kwd>cell</kwd><def></def><sym>(</sym><def></def><kwc>$i</kwc><def></def><sym>){</sym> <def></def><kwa>return</kwa> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>cache</def><sym>[</sym><def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>orientation</def><sym>][</sym><def></def><kwc>$i</kwc><def></def><sym>]; }</sym><br />
<def></def><br />
   <kwa>function</kwa> <def></def><kwd>make0</kwd><def></def><sym>(&amp;</sym><def></def><kwc>$a</kwc><def></def><sym>) {</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>0</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>E</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>1</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>1</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>W</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>0</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>1</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>E</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>2</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>2</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>W</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>1</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>2</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>E</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>3</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>3</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>W</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>2</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>3</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>SE</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>4</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>4</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>NW</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>3</num><def></def><sym>];</sym><br />
<def></def>   <sym>}</sym><br />
<def></def><br />
   <kwa>function</kwa> <def></def><kwd>make1</kwd><def></def><sym>(&amp;</sym><def></def><kwc>$a</kwc><def></def><sym>) {</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>0</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>SE</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>1</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>1</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>NW</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>0</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>1</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>SW</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>2</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>2</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>NE</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>1</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>2</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>W</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>3</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>3</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>E</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>2</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>3</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>SW</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>4</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>4</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>NE</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>3</num><def></def><sym>];</sym><br />
<def></def>   <sym>}</sym><br />
<def></def><br />
   <kwa>function</kwa> <def></def><kwd>make2</kwd><def></def><sym>(&amp;</sym><def></def><kwc>$a</kwc><def></def><sym>) {</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>0</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>W</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>1</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>1</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>E</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>0</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>1</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>SW</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>2</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>2</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>NE</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>1</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>2</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>SE</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>3</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>3</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>NW</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>2</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>3</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>SE</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>4</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>4</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>NW</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>3</num><def></def><sym>];</sym><br />
<def></def>   <sym>}</sym><br />
<def></def><br />
   <kwa>function</kwa> <def></def><kwd>make3</kwd><def></def><sym>(&amp;</sym><def></def><kwc>$a</kwc><def></def><sym>) {</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>0</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>SW</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>1</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>1</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>NE</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>0</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>1</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>W</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>2</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>2</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>E</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>1</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>1</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>SW</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>3</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>3</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>NE</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>1</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>2</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>SE</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>3</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>3</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>NW</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>2</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>3</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>SE</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>4</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>4</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>NW</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>3</num><def></def><sym>];</sym><br />
<def></def>   <sym>}</sym><br />
<def></def><br />
   <kwa>function</kwa> <def></def><kwd>make4</kwd><def></def><sym>(&amp;</sym><def></def><kwc>$a</kwc><def></def><sym>) {</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>0</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>SE</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>1</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>1</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>NW</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>0</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>1</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>SW</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>2</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>2</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>NE</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>1</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>1</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>E</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>3</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>3</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>W</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>1</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>3</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>SE</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>4</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>4</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>NW</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>3</num><def></def><sym>];</sym><br />
<def></def>   <sym>}</sym><br />
<def></def><br />
   <kwa>function</kwa> <def></def><kwd>make5</kwd><def></def><sym>(&amp;</sym><def></def><kwc>$a</kwc><def></def><sym>) {</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>0</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>SW</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>1</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>1</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>NE</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>0</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>0</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>SE</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>2</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>2</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>NW</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>0</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>1</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>SE</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>3</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>3</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>NW</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>1</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>2</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>SW</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>3</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>3</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>NE</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>2</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>3</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>SW</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>4</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>4</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>NE</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>3</num><def></def><sym>];</sym><br />
<def></def>   <sym>}</sym><br />
<def></def><br />
   <kwa>function</kwa> <def></def><kwd>make6</kwd><def></def><sym>(&amp;</sym><def></def><kwc>$a</kwc><def></def><sym>) {</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>0</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>SW</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>1</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>1</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>NE</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>0</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>2</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>SE</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>1</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>1</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>NW</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>2</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>1</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>SE</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>3</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>3</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>NW</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>1</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>3</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>SW</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>4</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>4</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>NE</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>3</num><def></def><sym>];</sym><br />
<def></def>   <sym>}</sym><br />
<def></def><br />
   <kwa>function</kwa> <def></def><kwd>make7</kwd><def></def><sym>(&amp;</sym><def></def><kwc>$a</kwc><def></def><sym>) {</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>0</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>SE</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>1</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>1</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>NW</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>0</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>0</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>SW</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>2</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>2</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>NE</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>0</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>2</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>SW</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>3</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>3</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>NE</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>2</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>3</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>SE</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>4</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>4</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>NW</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>3</num><def></def><sym>];</sym><br />
<def></def>   <sym>}</sym><br />
<def></def><br />
   <kwa>function</kwa> <def></def><kwd>make8</kwd><def></def><sym>(&amp;</sym><def></def><kwc>$a</kwc><def></def><sym>) {</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>0</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>E</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>1</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>1</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>W</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>0</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>1</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>E</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>2</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>2</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>W</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>1</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>2</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>NE</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>3</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>3</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>SW</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>2</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>3</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>E</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>4</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>4</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>W</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>3</num><def></def><sym>];</sym><br />
<def></def>   <sym>}</sym><br />
<def></def><br />
   <kwa>function</kwa> <def></def><kwd>make9</kwd><def></def><sym>(&amp;</sym><def></def><kwc>$a</kwc><def></def><sym>) {</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>0</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>E</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>1</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>1</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>W</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>0</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>1</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>E</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>2</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>2</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>W</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>1</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>2</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>NE</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>3</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>3</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>SW</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>2</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>2</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>E</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>4</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>4</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>W</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>2</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>4</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>NW</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>3</num><def></def><sym>];</sym><br />
<def></def>      <kwc>$a</kwc><def></def><sym>[</sym><def></def><num>3</num><def></def><sym>]-&gt;</sym><def></def><kwa>next</kwa><def></def><sym>[</sym><def>SE</def><sym>] =</sym> <def></def><kwc>$a</kwc><def></def><sym>[</sym><def></def><num>4</num><def></def><sym>];</sym><br />
<def></def>   <sym>}</sym><br />
<def></def><br />
<com>/*</com><br />
<com>   function printPiece(){</com><br />
<com>      printf(&quot;Piece # %d\n&quot;, $this-&gt;number);</com><br />
<com>      print(&quot;cell\tNW NE W  E  SW SE\n&quot;);</com><br />
<com>      for ($i=0; $i&lt;PIECE_SIZE; $i++){</com><br />
<com>         printf(&quot;%d \t&quot;, $i);</com><br />
<com>         for ($j=0; $j&lt;SIDES; $j++){</com><br />
<com>            $neighbour = $this-&gt;cell($i)-&gt;next[$j];</com><br />
<com>            if ($neighbour == null){</com><br />
<com>               print(&quot;-- &quot;);</com><br />
<com>            } else {</com><br />
<com>               for ($k=0; $k&lt;PIECE_SIZE; $k++)</com><br />
<com>                  if (($this-&gt;cell($k)) == $neighbour) printf(&quot;%2d &quot;, $k);</com><br />
<com>            }</com><br />
<com>         }</com><br />
<com>         print(&quot;\n&quot;);</com><br />
<com>      }</com><br />
<com>      print(&quot;\n&quot;);</com><br />
<com>   }</com><br />
<com>*/</com><def></def><br />
<sym>}</sym><br />
<def></def><br />
<br />
<kwa>class</kwa> <def>Solver</def> <sym>{</sym><br />
<def>   var</def> <kwc>$countdown</kwc><def></def><sym>,</sym> <def></def><kwc>$n</kwc><def></def><sym>,</sym> <def></def><kwc>$board</kwc><def></def><sym>,</sym> <def></def><kwc>$pieces</kwc><def></def><sym>,</sym> <def></def><kwc>$unplaced</kwc><def></def><sym>,</sym> <def></def><kwc>$unplacedSize</kwc><def></def><sym>,</sym> <def></def><kwc>$once</kwc><def></def><sym>,</sym><br />
<def></def>       <kwc>$first</kwc><def></def><sym>,</sym> <def></def><kwc>$last</kwc><def></def><sym>,</sym> <def></def><kwc>$current</kwc><def></def><sym>;</sym><br />
<def></def><br />
   <kwa>function</kwa> <def></def><kwd>Solver</kwd><def></def><sym>(</sym><def></def><kwc>$arg</kwc><def></def><sym>) {</sym><br />
<def></def>      <kwc>$this</kwc><def></def><sym>-&gt;</sym><def>n</def> <sym>=</sym> <def></def><kwc>$arg</kwc><def></def><sym>;</sym><br />
<def></def>      <kwc>$this</kwc><def></def><sym>-&gt;</sym><def>countdown</def> <sym>=</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>n</def><sym>;</sym><br />
<def></def>      <kwc>$this</kwc><def></def><sym>-&gt;</sym><def>board</def> <sym>=</sym> <def>new</def> <kwd>Board</kwd><def></def><sym>();</sym><br />
<def></def><br />
      <kwa>for</kwa> <def></def><sym>(</sym><def></def><kwc>$i</kwc><def></def><sym>=</sym><def></def><num>0</num><def></def><sym>;</sym> <def></def><kwc>$i</kwc><def></def><sym>&lt;</sym><def>PIECES</def><sym>;</sym> <def></def><kwc>$i</kwc><def></def><sym>++){</sym><br />
<def></def>         <kwc>$this</kwc><def></def><sym>-&gt;</sym><def>pieces</def><sym>[</sym><def></def><kwc>$i</kwc><def></def><sym>] =</sym> <def>new</def> <kwd>Piece</kwd><def></def><sym>(</sym><def></def><kwc>$i</kwc><def></def><sym>);</sym><br />
<def></def>         <kwc>$this</kwc><def></def><sym>-&gt;</sym><def>unplaced</def><sym>[</sym><def></def><kwc>$i</kwc><def></def><sym>] =</sym> <def>true</def><sym>;</sym><br />
<def></def>      <sym>}</sym><br />
<def></def>      <kwc>$this</kwc><def></def><sym>-&gt;</sym><def>unplacedSize</def> <sym>=</sym> <def>PIECES</def><sym>;</sym><br />
<def></def><br />
      <kwc>$this</kwc><def></def><sym>-&gt;</sym><def>once</def> <sym>=</sym> <def>true</def><sym>;</sym><br />
<def></def>   <sym>}</sym><br />
<def></def><br />
   <kwa>function</kwa> <def></def><kwd>shouldPrune</kwd><def></def><sym>() {</sym><br />
<def></def>      <kwc>$this</kwc><def></def><sym>-&gt;</sym><def>board</def><sym>-&gt;</sym><def></def><kwd>unmark</kwd><def></def><sym>();</sym><br />
<def></def>      <kwa>for</kwa> <def></def><sym>(</sym><def></def><kwc>$i</kwc><def></def><sym>=</sym><def></def><num>0</num><def></def><sym>;</sym> <def></def><kwc>$i</kwc><def></def><sym>&lt;</sym><def>BOARD_SIZE</def><sym>;</sym> <def></def><kwc>$i</kwc><def></def><sym>++) {</sym><br />
<def></def>         <kwc>$forall</kwc> <def></def><sym>= (</sym><def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>board</def><sym>-&gt;</sym><def>cells</def><sym>[</sym><def></def><kwc>$i</kwc><def></def><sym>]-&gt;</sym><def></def><kwd>contiguousEmptyCells</kwd><def></def><sym>()</sym> <def>% PIECE_SIZE</def><sym>) ==</sym> <def></def><num>0</num><def></def><sym>;</sym><br />
<def></def>         <kwa>if</kwa> <def></def><sym>(!</sym><def></def><kwc>$forall</kwc><def></def><sym>)</sym> <def></def><kwa>return</kwa> <def></def><sym>!</sym><def></def><kwc>$forall</kwc><def></def><sym>;</sym><br />
<def></def>      <sym>}</sym><br />
<def></def>      <kwa>return</kwa> <def></def><sym>!</sym><def></def><kwc>$forall</kwc><def></def><sym>;</sym><br />
<def></def>   <sym>}</sym><br />
<def></def><br />
   <kwa>function</kwa> <def></def><kwd>puzzleSolved</kwd><def></def><sym>() {</sym><br />
<def></def>      <kwc>$a</kwc> <def></def><sym>=</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>board</def><sym>-&gt;</sym><def></def><kwd>asString</kwd><def></def><sym>();</sym><br />
<def></def>      <kwa>if</kwa> <def></def><sym>(</sym><def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>first</def> <sym>==</sym> <def>null</def><sym>){</sym><br />
<def></def>         <kwc>$this</kwc><def></def><sym>-&gt;</sym><def>first</def> <sym>=</sym> <def></def><kwc>$a</kwc><def></def><sym>;</sym><br />
<def></def>         <kwc>$this</kwc><def></def><sym>-&gt;</sym><def>last</def> <sym>=</sym> <def></def><kwc>$a</kwc><def></def><sym>;</sym><br />
<def></def>      <sym>}</sym> <def></def><kwa>else</kwa> <def></def><sym>{</sym><br />
<def></def>         <kwa>if</kwa> <def></def><sym>(</sym><def></def><kwc>$a</kwc> <def></def><sym>&lt;</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>first</def><sym>){</sym><br />
<def></def>            <kwc>$this</kwc><def></def><sym>-&gt;</sym><def>first</def> <sym>=</sym> <def></def><kwc>$a</kwc><def></def><sym>;</sym><br />
<def></def>         <sym>}</sym> <def></def><kwa>else</kwa> <def></def><sym>{</sym><br />
<def></def>            <kwa>if</kwa> <def></def><sym>(</sym><def></def><kwc>$a</kwc> <def></def><sym>&gt;</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>last</def><sym>){</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>last</def> <sym>=</sym> <def></def><kwc>$a</kwc><def></def><sym>; }</sym><br />
<def></def>         <sym>}</sym><br />
<def></def>      <sym>}</sym><br />
<def></def>      <kwc>$this</kwc><def></def><sym>-&gt;</sym><def>countdown</def><sym>--;</sym><br />
<def></def>   <sym>}</sym><br />
<def></def><br />
   <kwa>function</kwa> <def></def><kwd>findSolutions</kwd><def></def><sym>() {</sym><br />
<def></def>      <kwa>if</kwa> <def></def><sym>(</sym><def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>countdown</def> <sym>&gt;</sym> <def></def><num>0</num><def></def><sym>){</sym><br />
<def></def>         <kwa>if</kwa> <def></def><sym>(</sym><def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>unplacedSize</def> <sym>&gt;</sym> <def></def><num>0</num><def></def><sym>){</sym><br />
<def></def>            <kwc>$emptyCellIndex</kwc> <def></def><sym>=</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>board</def><sym>-&gt;</sym><def></def><kwd>firstEmptyCellIndex</kwd><def></def><sym>();</sym><br />
<def></def><br />
            <kwa>for</kwa> <def></def><sym>(</sym><def></def><kwc>$k</kwc><def></def><sym>=</sym><def></def><num>0</num><def></def><sym>;</sym> <def></def><kwc>$k</kwc><def></def><sym>&lt;</sym><def>PIECES</def><sym>;</sym> <def></def><kwc>$k</kwc><def></def><sym>++){</sym><br />
<def></def>               <kwa>if</kwa> <def></def><sym>(</sym><def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>unplaced</def><sym>[</sym><def></def><kwc>$k</kwc><def></def><sym>]){</sym><br />
<def></def>                  <kwc>$this</kwc><def></def><sym>-&gt;</sym><def>unplaced</def><sym>[</sym><def></def><kwc>$k</kwc><def></def><sym>] =</sym> <def>false</def><sym>;</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>unplacedSize</def><sym>--;</sym><br />
<def></def><br />
                  <kwa>for</kwa> <def></def><sym>(</sym><def></def><kwc>$i</kwc><def></def><sym>=</sym><def></def><num>0</num><def></def><sym>;</sym> <def></def><kwc>$i</kwc><def></def><sym>&lt;</sym><def>PIECE_ORIENTATIONS</def><sym>;</sym> <def></def><kwc>$i</kwc><def></def><sym>++){</sym><br />
<def></def>                     <kwc>$piece</kwc> <def></def><sym>=</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>pieces</def><sym>[</sym><def></def><kwc>$k</kwc><def></def><sym>]-&gt;</sym><def></def><kwd>nextOrientation</kwd><def></def><sym>();</sym><br />
<def></def>                     <kwa>for</kwa> <def></def><sym>(</sym><def></def><kwc>$j</kwc><def></def><sym>=</sym><def></def><num>0</num><def></def><sym>;</sym> <def></def><kwc>$j</kwc><def></def><sym>&lt;</sym><def>PIECE_SIZE</def><sym>;</sym> <def></def><kwc>$j</kwc><def></def><sym>++){</sym><br />
<def></def>                        <kwa>if</kwa> <def></def><sym>(</sym><def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>board</def><sym>-&gt;</sym><def></def><kwd>add</kwd><def></def><sym>(</sym><def></def><kwc>$j</kwc><def></def><sym>,</sym><def></def><kwc>$emptyCellIndex</kwc><def></def><sym>,</sym><def></def><kwc>$piece</kwc><def></def><sym>)){</sym><br />
<def></def>                           <kwa>if</kwa> <def></def><sym>(!</sym><def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def></def><kwd>shouldPrune</kwd><def></def><sym>())</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def></def><kwd>findSolutions</kwd><def></def><sym>();</sym><br />
<def></def>                           <kwc>$this</kwc><def></def><sym>-&gt;</sym><def>board</def><sym>-&gt;</sym><def></def><kwd>remove</kwd><def></def><sym>(</sym><def></def><kwc>$piece</kwc><def></def><sym>);</sym><br />
<def></def>                        <sym>}</sym><br />
<def></def>                     <sym>}</sym><br />
<def></def>                  <sym>}</sym><br />
<def></def>                  <kwc>$this</kwc><def></def><sym>-&gt;</sym><def>unplaced</def><sym>[</sym><def></def><kwc>$k</kwc><def></def><sym>] =</sym> <def>true</def><sym>;</sym> <def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>unplacedSize</def><sym>++;</sym><br />
<def></def>               <sym>}</sym><br />
<def></def>            <sym>}</sym><br />
<def></def>         <sym>}</sym> <def></def><kwa>else</kwa> <def></def><sym>{</sym><br />
<def></def>            <kwc>$this</kwc><def></def><sym>-&gt;</sym><def></def><kwd>puzzleSolved</kwd><def></def><sym>();</sym><br />
<def></def>         <sym>}</sym><br />
<def></def>      <sym>}</sym><br />
<def></def>   <sym>}</sym><br />
<def></def><br />
   <kwa>function</kwa> <def></def><kwd>printBoard</kwd><def></def><sym>(&amp;</sym><def></def><kwc>$s</kwc><def></def><sym>) {</sym><br />
<def></def>      <kwc>$indent</kwc> <def></def><sym>=</sym> <def>false</def><sym>;</sym><br />
<def></def>      <kwc>$i</kwc> <def></def><sym>=</sym> <def></def><num>0</num><def></def><sym>;</sym><br />
<def></def>      <kwa>while</kwa> <def></def><sym>(</sym><def></def><kwc>$i</kwc> <def></def><sym>&lt;</sym> <def></def><kwa>strlen</kwa><def></def><sym>(</sym><def></def><kwc>$s</kwc><def></def><sym>)){</sym><br />
<def></def>         <kwa>if</kwa> <def></def><sym>(</sym><def></def><kwc>$indent</kwc><def></def><sym>)</sym> <def></def><kwa>print</kwa><def></def><sym>(</sym><def></def><str>&quot; &quot;</str><def></def><sym>);</sym><br />
<def></def>         <kwc>$j</kwc> <def></def><sym>=</sym> <def></def><num>0</num><def></def><sym>;</sym><br />
<def></def>         <kwa>while</kwa> <def></def><sym>(</sym><def></def><kwc>$j</kwc> <def></def><sym>&lt;</sym> <def>BOARD_COLS</def><sym>){</sym><br />
<def></def>            <kwa>print</kwa><def></def><sym>(</sym><def></def><kwc>$s</kwc><def></def><sym>[</sym><def></def><kwc>$i</kwc><def></def><sym>]);</sym> <def></def><kwa>print</kwa><def></def><sym>(</sym><def></def><str>&quot; &quot;</str><def></def><sym>);</sym><br />
<def></def>            <kwc>$j</kwc><def></def><sym>++;</sym><br />
<def></def>            <kwc>$i</kwc><def></def><sym>++;</sym><br />
<def></def>         <sym>}</sym><br />
<def></def>         <kwa>print</kwa><def></def><sym>(</sym><def></def><str>&quot;</str><esc>\n</esc><str>&quot;</str><def></def><sym>);</sym><br />
<def></def>         <kwc>$indent</kwc> <def></def><sym>= !</sym><def></def><kwc>$indent</kwc><def></def><sym>;</sym><br />
<def></def>      <sym>}</sym><br />
<def></def>      <kwa>print</kwa><def></def><sym>(</sym><def></def><str>&quot;</str><esc>\n</esc><str>&quot;</str><def></def><sym>);</sym><br />
<def></def>   <sym>}</sym><br />
<def></def><br />
   <kwa>function</kwa> <def></def><kwd>printSolutions</kwd><def></def><sym>() {</sym><br />
<def></def>      <kwa>printf</kwa><def></def><sym>(</sym><def></def><str>&quot;%d solutions found</str><esc>\n\n</esc><str>&quot;</str><def></def><sym>,</sym><def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>n</def><sym>);</sym><br />
<def></def>      <kwc>$this</kwc><def></def><sym>-&gt;</sym><def></def><kwd>printBoard</kwd><def></def><sym>(</sym><def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>first</def><sym>);</sym><br />
<def></def>      <kwc>$this</kwc><def></def><sym>-&gt;</sym><def></def><kwd>printBoard</kwd><def></def><sym>(</sym><def></def><kwc>$this</kwc><def></def><sym>-&gt;</sym><def>last</def><sym>);</sym><br />
<def></def>   <sym>}</sym><br />
<def></def><sym>}</sym><br />
<def></def><br />
<br />
<kwc>$s</kwc> <def></def><sym>=</sym> <def>new</def> <kwd>Solver</kwd><def></def><sym>(</sym><def></def><kwc>$argv</kwc><def></def><sym>[</sym><def></def><num>1</num><def></def><sym>]);</sym><br />
<def></def><kwc>$s</kwc><def></def><sym>-&gt;</sym><def></def><kwd>findSolutions</kwd><def></def><sym>();</sym><br />
<def></def><kwc>$s</kwc><def></def><sym>-&gt;</sym><def></def><kwd>printSolutions</kwd><def></def><sym>();</sym><br />
<def><br />
?</def><sym>&gt;</sym><def></def><br />
</source>
