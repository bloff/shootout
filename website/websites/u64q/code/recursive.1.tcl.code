<span class="hl slc"># ----------------------------------------------------------------------</span>
<span class="hl slc"># The Computer Language Shootout</span>
<span class="hl slc"># http://shootout.alioth.debian.org/</span>
<span class="hl slc">#</span>
<span class="hl slc"># Contributed by Michael Schlenker</span>
<span class="hl slc"># modified by Andrew McParland</span>
<span class="hl slc"># ----------------------------------------------------------------------</span>

<span class="hl kwa">proc</span> Ack <span class="hl sym">{</span>x y<span class="hl sym">} {</span>
    <span class="hl kwa">expr</span> <span class="hl sym">{</span> <span class="hl kwb">$x</span> <span class="hl sym">==</span> <span class="hl num">0</span> ? <span class="hl kwb">$y</span><span class="hl sym">+</span><span class="hl num">1</span> <span class="hl sym">: (</span><span class="hl kwb">$y</span> <span class="hl sym">==</span> <span class="hl num">0</span> ? <span class="hl sym">[</span>Ack <span class="hl sym">[</span><span class="hl kwa">expr</span> <span class="hl sym">{</span><span class="hl kwb">$x</span><span class="hl kwc">-1</span><span class="hl sym">}]</span> <span class="hl num">1</span><span class="hl sym">] :</span>
       <span class="hl sym">[</span>Ack <span class="hl sym">[</span><span class="hl kwa">expr</span> <span class="hl sym">{</span><span class="hl kwb">$x</span><span class="hl kwc">-1</span><span class="hl sym">}] [</span>Ack <span class="hl kwb">$x</span> <span class="hl sym">[</span><span class="hl kwa">expr</span> <span class="hl sym">{</span><span class="hl kwb">$y</span> <span class="hl kwc">-1</span><span class="hl sym">}]]])}</span>
<span class="hl sym">}</span>
<span class="hl kwa">proc</span> Fib <span class="hl sym">{</span>n<span class="hl sym">} {</span>
    <span class="hl kwa">expr</span> <span class="hl sym">{</span><span class="hl kwb">$n</span> <span class="hl sym">&lt;</span> <span class="hl num">2</span> ? <span class="hl num">1</span> <span class="hl sym">: [</span>Fib <span class="hl sym">[</span><span class="hl kwa">expr</span> <span class="hl sym">{</span><span class="hl kwb">$n</span> <span class="hl kwc">-2</span><span class="hl sym">}]] + [</span>Fib <span class="hl sym">[</span><span class="hl kwa">expr</span> <span class="hl sym">{</span><span class="hl kwb">$n</span> <span class="hl kwc">-1</span><span class="hl sym">}]]}</span>
<span class="hl sym">}</span>
<span class="hl kwa">proc</span> FibFP <span class="hl sym">{</span>n<span class="hl sym">} {</span>
    <span class="hl kwa">expr</span> <span class="hl sym">{</span>double<span class="hl sym">(</span><span class="hl kwb">$n</span><span class="hl sym">) &lt;</span> <span class="hl num">2.0</span> ? <span class="hl num">1.0</span> <span class="hl sym">: [</span>Fib <span class="hl sym">[</span><span class="hl kwa">expr</span> <span class="hl sym">{</span><span class="hl kwb">$n</span> <span class="hl kwc">-2</span>.0<span class="hl sym">}]] + [</span>Fib <span class="hl sym">[</span><span class="hl kwa">expr</span> <span class="hl sym">{</span><span class="hl kwb">$n</span> <span class="hl kwc">-1</span>.0<span class="hl sym">}]]}</span>
<span class="hl sym">}</span>
<span class="hl kwa">proc</span> Tak <span class="hl sym">{</span>x y z<span class="hl sym">} {</span>
    <span class="hl kwa">expr</span> <span class="hl sym">{</span> <span class="hl kwb">$y</span> <span class="hl sym">&lt;</span> <span class="hl kwb">$x</span> ? <span class="hl sym">([</span>Tak <span class="hl sym">[</span>Tak <span class="hl sym">[</span><span class="hl kwa">expr</span> <span class="hl sym">{</span><span class="hl kwb">$x</span><span class="hl kwc">-1</span><span class="hl sym">}]</span> <span class="hl kwb">$y $z</span><span class="hl sym">] [</span>Tak <span class="hl sym">[</span><span class="hl kwa">expr</span> <span class="hl sym">{</span><span class="hl kwb">$y</span><span class="hl kwc">-1</span><span class="hl sym">}]</span> <span class="hl kwb">$z $x</span><span class="hl sym">]</span> \
       <span class="hl sym">[</span>Tak <span class="hl sym">[</span><span class="hl kwa">expr</span> <span class="hl sym">{</span><span class="hl kwb">$z</span><span class="hl kwc">-1</span><span class="hl sym">}]</span> <span class="hl kwb">$x $y</span><span class="hl sym">]]) :</span> <span class="hl kwb">$z</span> <span class="hl sym">}</span>
<span class="hl sym">}</span>
<span class="hl kwa">proc</span> TakFP <span class="hl sym">{</span>x y z<span class="hl sym">} {</span>
    <span class="hl kwa">expr</span> <span class="hl sym">{</span> double<span class="hl sym">(</span><span class="hl kwb">$y</span><span class="hl sym">) &lt;</span> double<span class="hl sym">(</span><span class="hl kwb">$x</span><span class="hl sym">)</span> ? double<span class="hl sym">([</span>Tak <span class="hl sym">[</span>Tak <span class="hl sym">[</span><span class="hl kwa">expr</span> <span class="hl sym">{</span><span class="hl kwb">$x</span><span class="hl kwc">-1</span>.0<span class="hl sym">}]</span> <span class="hl kwb">$y $z</span><span class="hl sym">]</span> \
       <span class="hl sym">[</span>Tak <span class="hl sym">[</span><span class="hl kwa">expr</span> <span class="hl sym">{</span><span class="hl kwb">$y</span><span class="hl kwc">-1</span><span class="hl sym">}]</span> <span class="hl kwb">$z $x</span><span class="hl sym">] [</span>Tak <span class="hl sym">[</span><span class="hl kwa">expr</span> <span class="hl sym">{</span><span class="hl kwb">$z</span><span class="hl kwc">-1</span><span class="hl sym">}]</span> <span class="hl kwb">$x $y</span><span class="hl sym">]]) :</span> double<span class="hl sym">(</span><span class="hl kwb">$z</span><span class="hl sym">) }</span>
<span class="hl sym">}</span>

<span class="hl kwa">proc</span> main <span class="hl sym">{</span>argv<span class="hl sym">} {</span>
    <span class="hl kwa">set</span> n <span class="hl sym">[</span><span class="hl kwa">lindex</span> <span class="hl kwb">$argv</span> <span class="hl num">0</span><span class="hl sym">]</span>
    <span class="hl kwa">incr</span> n <span class="hl kwc">-1</span>
    <span class="hl kwa">set</span> n1 <span class="hl sym">[</span><span class="hl kwa">expr</span> <span class="hl sym">{</span><span class="hl kwb">$n</span><span class="hl sym">+</span><span class="hl num">1</span><span class="hl sym">}]</span>
    <span class="hl kwa">set</span> n28 <span class="hl sym">[</span><span class="hl kwa">expr</span> <span class="hl sym">{</span><span class="hl num">28.0</span><span class="hl sym">+</span><span class="hl kwb">$n</span><span class="hl sym">}]</span>
    <span class="hl kwa">set</span> n3 <span class="hl sym">[</span><span class="hl kwa">expr</span> <span class="hl sym">{</span><span class="hl kwb">$n</span><span class="hl sym">*</span><span class="hl num">3</span><span class="hl sym">}]</span>
    <span class="hl kwa">set</span> n2 <span class="hl sym">[</span><span class="hl kwa">expr</span> <span class="hl sym">{</span><span class="hl kwb">$n</span><span class="hl sym">*</span><span class="hl num">2</span><span class="hl sym">}]</span>
    <span class="hl kwa">puts</span> <span class="hl sym">[</span><span class="hl kwa">format</span> <span class="hl str">&quot;Ack(3,%d): %d&quot;</span> <span class="hl kwb">$n1</span> <span class="hl sym">[</span>Ack <span class="hl num">3</span> <span class="hl kwb">$n1</span><span class="hl sym">]]</span>
    <span class="hl kwa">puts</span> <span class="hl sym">[</span><span class="hl kwa">format</span> <span class="hl str">&quot;Fib(%.1f): %.1f&quot;</span> <span class="hl kwb">$n28</span> <span class="hl sym">[</span>FibFP <span class="hl kwb">$n28</span><span class="hl sym">]]</span>
    <span class="hl kwa">puts</span> <span class="hl sym">[</span><span class="hl kwa">format</span> <span class="hl str">&quot;Tak(%d,%d,%d): %d&quot;</span> <span class="hl kwb">$n3 $n2 $n</span> <span class="hl sym">[</span>Tak <span class="hl kwb">$n3 $n2 $n</span><span class="hl sym">]]</span>
    <span class="hl kwa">puts</span> <span class="hl sym">[</span><span class="hl kwa">format</span> <span class="hl str">&quot;Fib(3): %d&quot;</span> <span class="hl sym">[</span>Fib <span class="hl num">3</span> <span class="hl sym">]]</span>
    <span class="hl kwa">puts</span> <span class="hl sym">[</span><span class="hl kwa">format</span> <span class="hl str">&quot;Tak(3.0,2.0,1.0): %.1f&quot;</span> <span class="hl sym">[</span>TakFP <span class="hl num">3.0 2.0 1.0</span><span class="hl sym">]]</span>
    <span class="hl kwa">return</span> <span class="hl num">0</span><span class="hl sym">;</span>
<span class="hl sym">}</span>

<span class="hl kwa">interp</span> recursionlimit <span class="hl sym">{}</span> <span class="hl num">100000</span>
main <span class="hl kwb">$argv</span>
