<source>
<def></def><slc>;; The Computer Language Benchmarks Game</slc><br />
<def></def><slc>;; http://shootout.alioth.debian.org/</slc><br />
<def></def><slc>;;</slc><br />
<def></def><slc>;; Based on D language implementation by Dave Fladebo [imperative version]</slc><br />
<def></def><slc>;;</slc><br />
<def></def><slc>;; Derived from the Chicken variant, which was</slc><br />
<def></def><slc>;; Contributed by Anthony Borla</slc><br />
<def></def><br />
<slc>;; Note: as of version 350, this benchmark spends much of</slc><br />
<def></def><slc>;;  its time GCing; it runs 1.5 times as fast in mzscheme3m.</slc><br />
<def></def><br />
<sym>(</sym><def>module partialsums mzscheme</def><br />
<br />
<br />
  <slc>;;; Stupid boiler-plate for formatting floating point value</slc><br />
<def></def>  <sym>(</sym><def>define</def> <sym>(</sym><def>roundto digits n</def><sym>)</sym><br />
<def></def>    <sym>(</sym><def>let</def><sym>* ([</sym><def>e</def> <sym>(</sym><def></def><kwa>expt</kwa> <def></def><num>10</num> <def>digits</def><sym>)]</sym><br />
<def></def>           <sym>[</sym><def>num</def> <sym>(</sym><def>round</def> <sym>(</sym><def></def><kwa>abs</kwa> <def></def><sym>(*</sym> <def>e</def> <sym>(</sym><def>inexact</def><sym>-&gt;</sym><def>exact n</def><sym>))))]</sym><br />
<def></def>           <sym>[</sym><def>str</def> <sym>(</sym><def>number</def><sym>-&gt;</sym><def>string</def> <sym>(</sym><def>remainder num e</def><sym>))])</sym><br />
<def></def>      <sym>(</sym><def>format</def> <str>&quot;~a~a.~a~a&quot;</str><def></def><br />
              <sym>(</sym><def></def><kwa>if</kwa> <def></def><sym>(</sym><def>negative? n</def><sym>)</sym> <def></def><str>&quot;-&quot;</str><def></def> <str>&quot;&quot;</str><def></def><sym>)</sym><br />
<def></def>              <sym>(</sym><def>quotient num e</def><sym>)</sym><br />
<def></def>              <sym>(</sym><def>make</def><sym>-</sym><def>string</def> <sym>(-</sym> <def>digits</def> <sym>(</sym><def>string</def><sym>-</sym><def></def><kwa>length</kwa> <def>str</def><sym>))</sym> <def>#\</def><num>0</num><def></def><sym>)</sym><br />
<def>              str</def><sym>)))</sym><br />
<def></def><br />
  <sym>(</sym><def>let</def> <sym>((</sym><def>n</def> <sym>(</sym><def>exact</def><sym>-&gt;</sym><def>inexact</def><br />
	    <sym>(</sym><def>string</def><sym>-&gt;</sym><def>number</def><br />
	     <sym>(</sym><def>vector</def><sym>-</sym><def>ref</def> <sym>(</sym><def>current</def><sym>-</sym><def></def><kwa>command</kwa><def></def><sym>-</sym><def></def><kwa>line</kwa><def></def><sym>-</sym><def>arguments</def><sym>)</sym> <def></def><num>0</num><def></def><sym>))))</sym><br />
<def></def><br />
	<sym>(</sym><def>alt</def> <num>1</num><def></def><sym>) (</sym><def>d2</def> <num>0</num><def></def><sym>) (</sym><def>d3</def> <num>0</num><def></def><sym>) (</sym><def>ds</def> <num>0</num><def></def><sym>) (</sym><def>dc</def> <num>0</num><def></def><sym>)</sym><br />
<def></def>	<sym>(</sym><def>s0</def> <num>0</num><def></def><sym>) (</sym><def>s1</def> <num>0</num><def></def><sym>) (</sym><def>s2</def> <num>0</num><def></def><sym>) (</sym><def>s3</def> <num>0</num><def></def><sym>) (</sym><def>s4</def> <num>0</num><def></def><sym>) (</sym><def>s5</def> <num>0</num><def></def><sym>) (</sym><def>s6</def> <num>0</num><def></def><sym>) (</sym><def>s7</def> <num>0</num><def></def><sym>) (</sym><def>s8</def> <num>0</num><def></def><sym>))</sym><br />
<def></def><br />
    <sym>(</sym><def>let loop</def> <sym>([</sym><def>d</def> <num>0.0</num><def></def><sym>]</sym><br />
<def></def>	       <sym>(</sym><def>alt</def> <num>1</num><def></def><sym>) (</sym><def>d2</def> <num>0</num><def></def><sym>) (</sym><def>d3</def> <num>0</num><def></def><sym>) (</sym><def>ds</def> <num>0</num><def></def><sym>) (</sym><def>dc</def> <num>0</num><def></def><sym>)</sym><br />
<def></def>	       <sym>(</sym><def>s0</def> <num>0</num><def></def><sym>) (</sym><def>s1</def> <num>0</num><def></def><sym>) (</sym><def>s2</def> <num>0</num><def></def><sym>) (</sym><def>s3</def> <num>0</num><def></def><sym>) (</sym><def>s4</def> <num>0</num><def></def><sym>) (</sym><def>s5</def> <num>0</num><def></def><sym>) (</sym><def>s6</def> <num>0</num><def></def><sym>) (</sym><def>s7</def> <num>0</num><def></def><sym>) (</sym><def>s8</def> <num>0</num><def></def><sym>))</sym><br />
<def></def>      <sym>(</sym><def></def><kwa>if</kwa> <def></def><sym>(=</sym> <def>d n #</def><slc>;(+ n 1))</slc><br />
<def></def>	  <sym>(</sym><def>let</def> <sym>([</sym><def>format</def><sym>-</sym><def>result</def><br />
		 <sym>(</sym><def></def><kwa>lambda</kwa> <def></def><sym>(</sym><def>str n</def><sym>)</sym><br />
<def></def>		   <sym>(</sym><def>printf str</def> <sym>(</sym><def>roundto</def> <num>9</num> <def>n</def><sym>)))])</sym><br />
<def></def><br />
	    <sym>(</sym><def>format</def><sym>-</sym><def>result</def> <str>&quot;~a</str><esc>\</esc><str>t(2/3)^k</str><esc>\</esc><str>n&quot;</str><def> s0</def><sym>)</sym><br />
<def></def>	    <sym>(</sym><def>format</def><sym>-</sym><def>result</def> <str>&quot;~a</str><esc>\</esc><str>tk^-0.5</str><esc>\</esc><str>n&quot;</str><def> s1</def><sym>)</sym><br />
<def></def>	    <sym>(</sym><def>format</def><sym>-</sym><def>result</def> <str>&quot;~a</str><esc>\</esc><str>t1/k(k+1)</str><esc>\</esc><str>n&quot;</str><def> s2</def><sym>)</sym><br />
<def></def>	    <sym>(</sym><def>format</def><sym>-</sym><def>result</def> <str>&quot;~a</str><esc>\</esc><str>tFlint Hills</str><esc>\</esc><str>n&quot;</str><def> s3</def><sym>)</sym><br />
<def></def>	    <sym>(</sym><def>format</def><sym>-</sym><def>result</def> <str>&quot;~a</str><esc>\</esc><str>tCookson Hills</str><esc>\</esc><str>n&quot;</str><def> s4</def><sym>)</sym><br />
<def></def>	    <sym>(</sym><def>format</def><sym>-</sym><def>result</def> <str>&quot;~a</str><esc>\</esc><str>tHarmonic</str><esc>\</esc><str>n&quot;</str><def> s5</def><sym>)</sym><br />
<def></def>	    <sym>(</sym><def>format</def><sym>-</sym><def>result</def> <str>&quot;~a</str><esc>\</esc><str>tRiemann Zeta</str><esc>\</esc><str>n&quot;</str><def> s6</def><sym>)</sym><br />
<def></def>	    <sym>(</sym><def>format</def><sym>-</sym><def>result</def> <str>&quot;~a</str><esc>\</esc><str>tAlternating Harmonic</str><esc>\</esc><str>n&quot;</str><def> s7</def><sym>)</sym><br />
<def></def>	    <sym>(</sym><def>format</def><sym>-</sym><def>result</def> <str>&quot;~a</str><esc>\</esc><str>tGregory</str><esc>\</esc><str>n&quot;</str><def> s8</def><sym>))</sym><br />
<def></def><br />
	  <sym>(</sym><def>let</def><sym>* ((</sym><def>d</def> <sym>(+</sym> <def>d</def> <num>1</num><def></def><sym>))</sym><br />
<def></def>		 <sym>(</sym><def>d2</def> <sym>(*</sym> <def>d d</def><sym>))</sym><br />
<def></def>		 <sym>(</sym><def>d3</def> <sym>(*</sym> <def>d2 d</def><sym>))</sym><br />
<def></def>		 <sym>(</sym><def>ds</def> <sym>(</sym><def></def><kwa>sin</kwa> <def>d</def><sym>))</sym><br />
<def></def>		 <sym>(</sym><def>dc</def> <sym>(</sym><def></def><kwa>cos</kwa> <def>d</def><sym>))</sym><br />
<def></def><br />
		 <sym>(</sym><def>s0</def> <sym>(+</sym> <def>s0</def> <sym>(</sym><def></def><kwa>expt</kwa> <def></def><sym>(/</sym> <def></def><num>2.0 3</num><def></def><sym>) (-</sym> <def>d</def> <num>1</num><def></def><sym>))))</sym><br />
<def></def>		 <sym>(</sym><def>s1</def> <sym>(+</sym> <def>s1</def> <sym>(/</sym> <def></def><num>1</num> <def></def><sym>(</sym><def></def><kwa>sqrt</kwa> <def>d</def><sym>))))</sym><br />
<def></def>		 <sym>(</sym><def>s2</def> <sym>(+</sym> <def>s2</def> <sym>(/</sym> <def></def><num>1</num> <def></def><sym>(*</sym> <def>d</def> <sym>(+</sym> <def>d</def> <num>1</num><def></def><sym>)))))</sym><br />
<def></def>		 <sym>(</sym><def>s3</def> <sym>(+</sym> <def>s3</def> <sym>(/</sym> <def></def><num>1</num> <def></def><sym>(*</sym> <def>d3</def> <sym>(*</sym> <def>ds ds</def><sym>)))))</sym><br />
<def></def>		 <sym>(</sym><def>s4</def> <sym>(+</sym> <def>s4</def> <sym>(/</sym> <def></def><num>1</num> <def></def><sym>(*</sym> <def>d3</def> <sym>(*</sym> <def>dc dc</def><sym>)))))</sym><br />
<def></def>		 <sym>(</sym><def>s5</def> <sym>(+</sym> <def>s5</def> <sym>(/</sym> <def></def><num>1</num> <def>d</def><sym>)))</sym><br />
<def></def>		 <sym>(</sym><def>s6</def> <sym>(+</sym> <def>s6</def> <sym>(/</sym> <def></def><num>1</num> <def>d2</def><sym>)))</sym><br />
<def></def>		 <sym>(</sym><def>s7</def> <sym>(+</sym> <def>s7</def> <sym>(/</sym> <def>alt d</def><sym>)))</sym><br />
<def></def>		 <sym>(</sym><def>s8</def> <sym>(+</sym> <def>s8</def> <sym>(/</sym> <def>alt</def> <sym>(- (*</sym> <def></def><num>2</num> <def>d</def><sym>)</sym> <def></def><num>1</num><def></def><sym>))))</sym><br />
<def></def>		 <sym>(</sym><def>alt</def> <sym>(-</sym> <def>alt</def><sym>)))</sym><br />
<def></def><br />
	  <sym>(</sym><def>loop d<br />
		alt d2 d3 ds dc<br />
		s0 s1 s2 s3 s4 s5 s6 s7 s8</def><sym>))))))</sym><def></def><br />
</source>
