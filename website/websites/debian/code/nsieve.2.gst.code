<span class="hl com">&quot;* The Computer Language Benchmarks Game    http://shootout.alioth.debian.org/    contributed by Isaac Gouy    modified by Eliot Miranda    then by Nicolas Cellier *&quot;</span>!!<span class="hl kwc">Tests</span> <span class="hl kwb">class methodsFor:</span> <span class="hl str">'benchmark scripts'</span>!nsieve2   <span class="hl kwd">| n |</span>   n <span class="hl sym">:=</span> <span class="hl kwa">self</span> <span class="hl kwb">arg</span><span class="hl sym">.   (</span>n &lt; <span class="hl num">2</span><span class="hl sym">)</span> <span class="hl kwb">ifTrue:</span> <span class="hl sym">[</span>n <span class="hl sym">:=</span> <span class="hl num">2</span><span class="hl sym">].</span>   <span class="hl kwa">self</span> <span class="hl kwb">primeBenchmark2For:</span> n <span class="hl kwb">to:</span> <span class="hl kwa">self</span> <span class="hl kwb">stdout using:</span> <span class="hl kwc">Array</span><span class="hl sym">.   ^</span><span class="hl str">''</span>! !!<span class="hl kwc">Tests</span> <span class="hl kwb">class methodsFor:</span> <span class="hl str">'benchmarking'</span>!<span class="hl kwb">nsieve2:</span> n <span class="hl kwb">using:</span> arrayClass    <span class="hl kwd">| count isPrime k |</span>   count <span class="hl sym">:=</span> <span class="hl num">0</span><span class="hl sym">.</span>   isPrime <span class="hl sym">:=</span> arrayClass <span class="hl kwb">new:</span> n <span class="hl kwb">withAll:</span> <span class="hl kwa">true</span><span class="hl sym">.</span>   <span class="hl num">2</span> <span class="hl kwb">to:</span> n <span class="hl kwb">do:</span>      <span class="hl sym">[</span><span class="hl kwd">:i</span> <span class="hl sym">|       (</span>isPrime <span class="hl kwb">at:</span> i<span class="hl sym">)</span> <span class="hl kwb">ifTrue:</span>          <span class="hl sym">[</span>k <span class="hl sym">:=</span> i<span class="hl sym">.         [(</span>k <span class="hl sym">:=</span> k <span class="hl kwb">+</span> i<span class="hl sym">)</span> <span class="hl kwb">&lt;=</span> n<span class="hl sym">]</span> <span class="hl kwb">whileTrue:</span> <span class="hl sym">[</span>isPrime <span class="hl kwb">at:</span> k <span class="hl kwb">put:</span> <span class="hl kwa">false</span><span class="hl sym">].</span>         count <span class="hl sym">:=</span> count <span class="hl kwb">+</span> <span class="hl num">1</span><span class="hl sym">]].   ^</span>count! !!<span class="hl kwc">Tests</span> <span class="hl kwb">class methodsFor:</span> <span class="hl str">'benchmarking'</span>!<span class="hl kwb">primeBenchmark2For:</span> v <span class="hl kwb">to:</span> output <span class="hl kwb">using:</span> arrayClass   v <span class="hl kwb">to:</span> v <span class="hl kwb">-</span> <span class="hl num">2</span> <span class="hl kwb">by: -</span><span class="hl num">1</span> <span class="hl kwb">do:</span>      <span class="hl sym">[</span><span class="hl kwd">:n</span><span class="hl sym">|</span> <span class="hl kwd">| m |</span>      m <span class="hl sym">:= (</span><span class="hl num">2</span> <span class="hl kwb">raisedTo:</span> n<span class="hl sym">)</span> <span class="hl kwb">*</span> <span class="hl num">10000</span><span class="hl sym">.</span>      output         <span class="hl kwb">nextPutAll:</span> <span class="hl str">'Primes up to '</span><span class="hl sym">;</span>         <span class="hl kwb">print:</span> m <span class="hl kwb">paddedTo:</span> <span class="hl num">8</span><span class="hl sym">;</span>         <span class="hl kwb">print:</span> <span class="hl sym">(</span><span class="hl kwa">self</span> <span class="hl kwb">nsieve2:</span> m <span class="hl kwb">using:</span> arrayClass<span class="hl sym">)</span> <span class="hl kwb">paddedTo:</span> <span class="hl num">9</span><span class="hl sym">;</span> <span class="hl kwb">nl</span>      <span class="hl sym">]</span>! !

<span class="hl kwc">Tests</span> <span class="hl kwb">nsieve</span><span class="hl num">2</span>!
