#!/usr/bin/python -OO
# The Computer Language Benchmarks Game
# $Id: extid2new,v 1.1 2008-08-06 02:09:48 igouy-guest Exp $

"""
One off conversion of code file and log file names 
OLD   'binarytrees.gcc' | 'binarytrees.gcc-4.gcc'
NEW   'binarytrees.1.gcc' | 'binarytrees.4.gcc'
"""

from __future__ import with_statement

__author__ =  'Isaac Gouy'

import os, os.path, errno, shutil

def renameFiles(subdirs,dirName):
   for d in subdirs:

      try:
         path = os.path.join(d,dirName)
         files = os.listdir(path)
      except OSError, err: 
         if err[0] == errno.ENOENT: 
            continue # No such file or directory
      else:
         for f in files: 

            try:
               if not f.endswith(dirName): continue

               oldf = os.path.join(path,f)
               parts = f.split('.')
               if parts[1].isdigit(): continue # already new name

               if len(parts) == 2:
                  newf =  os.path.join(path, parts[0]+'.1.'+parts[1])
                  if (os.path.islink(oldf)):
                     os.symlink( os.readlink(oldf),newf)
                  else:
                     shutil.copy2(oldf,newf)

               elif parts[1].find('-') > 0:
                  extid = parts[1].split('-')
                  if len(parts) == 3:
                     newf =  os.path.join(path, '.'.join((parts[0],extid[1],parts[2])) )
                     if (os.path.islink(oldf)):
                        os.symlink( os.readlink(oldf),newf)
                     else:
                        shutil.copy2(oldf,newf)
                  elif len(parts) == 4:
                     newf =  os.path.join(path, '.'.join((parts[0],extid[1],parts[2],parts[3])) )
                     if (os.path.islink(oldf)):
                        os.symlink(oldf,newf)
                     else:
                       shutil.copy2(oldf,newf)
               elif len(parts) == 3:
                  newf =  os.path.join(path, '.'.join((parts[0],'1',parts[1],parts[2])) )
                  if (os.path.islink(oldf)):
                     os.symlink( os.readlink(oldf),newf)
                  else:
                     shutil.copy2(oldf,newf)

            except OSError, err: 
               print err, newf


def main():
   subdirs = [each for each in os.listdir('.') if os.path.isdir(each)]
   #renameFiles(subdirs,'log')
   renameFiles(subdirs,'code')





if __name__ == "__main__":
   main()
