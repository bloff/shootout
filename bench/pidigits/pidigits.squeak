"* The Computer Language Shootout
    http://shootout.alioth.debian.org/
    contributed by Isaac Gouy
    modified by Eliot Miranda *"!

'From Squeak3.9 of 7 November 2006 [latest update: #7067] on 12 April 2007 at 9:15:29 pm'!
Object subclass: #PiDigitSpigot	instanceVariableNames: 'z x inverse'	classVariableNames: ''	poolDictionaries: ''	category: 'Shootout'!
Object subclass: #Tests	instanceVariableNames: ''	classVariableNames: ''	poolDictionaries: ''	category: 'Shootout'!
Object subclass: #Transformation	instanceVariableNames: 'q r s t k'	classVariableNames: ''	poolDictionaries: ''	category: 'Shootout'!!PiDigitSpigot methodsFor: 'private' stamp: '  11/30/2006 16:56'!consume: aTransformation   ^z * aTransformation! !!PiDigitSpigot methodsFor: 'private' stamp: '  11/30/2006 16:56'!digit   ^(z extract: 3) floor! !!PiDigitSpigot methodsFor: 'private' stamp: '  11/30/2006 16:56'!isSafe: aDigit   ^aDigit = (z extract: 4) floor! !!PiDigitSpigot methodsFor: 'private' stamp: '  11/30/2006 16:56'!produce: anInteger   inverse q: 10 r: -10 * anInteger s: 0 t: 1.   ^inverse * z! !!PiDigitSpigot methodsFor: 'accessing' stamp: '  11/30/2006 16:55'!next   | y |   ^(self isSafe: (y := self digit))      ifTrue: [z := self produce: y. y]      ifFalse: [z := self consume: x next. self next]! !!PiDigitSpigot methodsFor: 'initialize-release' stamp: '  11/30/2006 16:55'!initialize   z := Transformation unity.   x := Transformation new.   inverse := Transformation new.! !!PiDigitSpigot class methodsFor: 'instance creation' stamp: '  11/30/2006 16:54'!new   ^super new initialize! !!Tests class methodsFor: 'benchmarking' stamp: '  4/12/2007 21:15'!pidigitsTo: v width: width to: output   | n i pidigits |   n := v.   i := 0.   pidigits := PiDigitSpigot new.   [n > 0] whileTrue:      [n < width         ifTrue:            [n timesRepeat: [output nextPut: (Character digitValue: pidigits next)].            n to: width do: [:each | output space].            i := i + n]         ifFalse:            [width timesRepeat: [output nextPut: (Character digitValue: pidigits next)].            i := i + width].      output         tab;         nextPut: $:;         print: i;         nextPut: Character lf.      n := n - width]! !!Tests class methodsFor: 'platform' stamp: '  4/12/2007 18:57'!arg   ^(SmalltalkImage current getSystemAttribute: 3) asInteger! !!Tests class methodsFor: 'platform' stamp: '  4/13/2007 07:30'!postscript   SmalltalkImage current snapshot: false andQuit: true.   ^''! !!Tests class methodsFor: 'platform' stamp: '  4/12/2007 18:57'!stdout   ^UnixProcess stdOut! !!Tests class methodsFor: 'benchmark scripts' stamp: '  4/12/2007 21:14'!pidigits   self pidigitsTo: self arg width: 10 to: self stdout.   ^self postscript! !!Transformation methodsFor: 'accessing' stamp: '  11/30/2006 16:51'!* aTransformation   ^self species       q: q * aTransformation q      r: q * aTransformation r + (r * aTransformation t)      s: s * aTransformation q + (t * aTransformation s)      t: s * aTransformation r + (t * aTransformation t)! !!Transformation methodsFor: 'accessing' stamp: '  11/30/2006 16:52'!extract: anInteger   ^(q * anInteger + r) // (s * anInteger + t)! !!Transformation methodsFor: 'accessing' stamp: '  11/30/2006 16:52'!next   k := k +1.   q := k.   r := 4 * k + 2.   s := 0.   t := 2 * k + 1.! !!Transformation methodsFor: 'accessing' stamp: '  11/30/2006 16:52'!q   ^q! !!Transformation methodsFor: 'accessing' stamp: '  11/30/2006 16:52'!q: anInteger1 r: anInteger2 s: anInteger3 t: anInteger4   q := anInteger1.   r := anInteger2.   s := anInteger3.   t := anInteger4.   k := 0.! !!Transformation methodsFor: 'accessing' stamp: '  11/30/2006 16:52'!r   ^r! !!Transformation methodsFor: 'accessing' stamp: '  11/30/2006 16:52'!s   ^s! !!Transformation methodsFor: 'accessing' stamp: '  11/30/2006 16:53'!t   ^t! !!Transformation methodsFor: 'initialize-release' stamp: '  11/30/2006 16:51'!initialize   q := 0.   r := 0.   s := 0.   t := 0.   k := 0.! !!Transformation class methodsFor: 'instance creation' stamp: '  11/30/2006 16:53'!new   ^super new initialize! !!Transformation class methodsFor: 'instance creation' stamp: '  11/30/2006 16:53'!q: anInteger1 r: anInteger2 s: anInteger3 t: anInteger4   ^(super new) q: anInteger1 r: anInteger2 s: anInteger3 t: anInteger4! !!Transformation class methodsFor: 'instance creation' stamp: '  11/30/2006 16:53'!unity   ^self q: 1 r: 0 s: 0 t: 1! !
