"* The Computer Language Shootout
    http://shootout.alioth.debian.org/
    contributed by Isaac Gouy
    modified by Eliot Miranda *"!

'From Squeak3.9 of 7 November 2006 [latest update: #7067] on 12 April 2007 at 7:37:02 pm'!
ArrayedCollection variableByteSubclass: #BitArray   instanceVariableNames: ''   classVariableNames: ''   poolDictionaries: ''   category: 'Shootout'!
Object subclass: #Tests   instanceVariableNames: ''   classVariableNames: ''   poolDictionaries: ''   category: 'Shootout'!!BitArray methodsFor: 'accessing' stamp: '  4/12/2007 19:34'!at: index    | wordIndex bitMask |    wordIndex := ((index - 1) bitShift: -3) + 1.    bitMask := 1 bitShift: (index - 1 bitAnd: 7).    ^((self basicAt: wordIndex) bitAnd: bitMask) > 0! !!BitArray methodsFor: 'accessing' stamp: '  4/12/2007 19:34'!at: index put: bit    | wordIndex bitMask word |    wordIndex := ((index - 1) bitShift: -3) + 1.    bitMask := 1 bitShift: (index - 1 bitAnd: 7).    word := self basicAt: wordIndex.    word := word bitOr: bitMask.    bit ifFalse: [word := word - bitMask].    self basicAt: wordIndex put: word.    ^bit! !!BitArray methodsFor: 'accessing' stamp: '  4/12/2007 19:34'!atAllPut: anObject    "Put anObject at every one of the receiver's indices."   | value |   value := anObject ifTrue: [255] ifFalse: [0].   1 to: self basicSize do: [:index | self basicAt: index put: value]! !!BitArray class methodsFor: 'instance creation' stamp: '  4/12/2007 19:34'!new: size    ^super new: (size + 7 bitShift: -3)! !!Integer methodsFor: 'platform' stamp: '  4/12/2007 19:23'!asPaddedString: aWidth   ^self printStringLength: aWidth padded: false! !!Tests class methodsFor: 'platform' stamp: '  4/12/2007 18:57'!arg   ^(SmalltalkImage current getSystemAttribute: 3) asInteger! !!Tests class methodsFor: 'platform' stamp: '  4/13/2007 07:30'!postscript   SmalltalkImage current snapshot: false andQuit: true.   ^''! !!Tests class methodsFor: 'platform' stamp: '  4/12/2007 18:57'!stdout   ^UnixProcess stdOut! !!Tests class methodsFor: 'benchmark scripts' stamp: '  4/12/2007 19:36'!nsievebits   | n |   n := self arg.   (n < 2) ifTrue: [n := 2].   self primeBenchmarkFor: n to: self stdout using: BitArray.   ^self postscript! !!Tests class methodsFor: 'benchmarking' stamp: '  4/12/2007 19:04'!nsieve: n using: arrayClass    | count isPrime |   count := 0.   isPrime := arrayClass new: n withAll: true.   2 to: n do:      [:i |       (isPrime at: i) ifTrue:          [i + i to: n by: i do:            [:k | isPrime at: k put: false].         count := count + 1]].   ^count! !!Tests class methodsFor: 'benchmarking' stamp: '  4/12/2007 19:17'!primeBenchmarkFor: v to: output using: arrayClass   v to: v - 2 by: -1 do:      [:n| | m |      m := (2 raisedTo: n) * 10000.      output         nextPutAll: 'Primes up to '; nextPutAll: (m asPaddedString: 8);         nextPutAll: ((self nsieve: m using: arrayClass) asPaddedString: 9);          nextPut: Character lf]! !
