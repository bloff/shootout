#!/usr/bin/perl
# to be run in top directory

BEGIN {
    foreach my $d qw(. .. ../.. ../../..) {
	my $file = "$d/langs.pl";
	if (-f $file) {
	    require $file;
	    last;
	}
    }
}

sub main {
    print <<EOF;
<div class="app">
  <div class="h3"><h3>Language List</h3></div>
  <table border="1" cellspacing="2" cellpadding="3">
    <tr>
      <th colspan="2">Language</th>
      <th>Imple-<br>mentation<br><small>(local&nbsp;summary)</small></th>
      <th>Version<br><small>(Official&nbsp;Homepage)</small></th>
    </tr>
EOF
    my $count = 1;
    foreach my $impl (sort { $::LANG{$a}->{Lang} cmp $::LANG{$b}->{Lang} } keys %LANG) {
	my $lref = $::LANG{$impl};
	my $ver = $lref->{Verfun}();
	unless ($ver =~ /\d\.?\d/) {
	    print STDERR "Warning Version for $impl may be incorrect: ($ver)\n";
	}
	my $lang = $lref->{Lang};
	my $note = $lref->{Note};

	my $lang_type = ($::LANG{$impl}->{Type} =~ /native compiled/) ?
	    qq{<b><i>$impl</i></b>} : qq{$impl};

	my $impllink = $lang_type;
	$impllink = qq{<a href="lang/$impl/">$lang_type</a>} if (-d "lang/$impl");
	$note = ' &nbsp; ' . $note if ($note);
	my $ab = ($count % 2) ? "a" : "b";
	print qq{    <tr class="$ab">
      <td align="right">$count.</td>
      <td>$lang</td>
      <td>$impllink</td>
      <td><a href="$lref->{Home}">$ver</a>$note</td></tr>\n};
	$count++;
	# now print out lang version table
	my $file = "lang/$impl/version.php";
	unless (open(OUT, ">$file")) {
	    warn "Warning, can't open $file for output ($!)\n";
	    next;
	}
	print OUT qq{<table border="1">
<tr><th colspan="2">$lref->{Lang}</th></tr>
<tr><th align="right">Tested Version</th><td>$ver</td></tr>
<tr><th align="right">Home Page</th><td><a href="$lref->{Home}">$lref->{Home}</a></td></tr>
<tr><th align="right">Download</th><td><a href="$lref->{Down}">$lref->{Down}</a></td></tr>
<tr><th align="right">Build Info:</th><td>
<!--#if expr="\$BUILD" -->
<!--#echo var="BUILD" -->
<!--#else -->
<a href="build.$impl">View Build Script</a>
<!--#endif -->
</td></tr>
<tr><th colspan="2"><a href="allsrc.php">View All Source Code For $lref->{Lang}</a></th></tr>
</table>\n};
	close(OUT);
    }
    print qq{    <tr><td colspan="4"><p class="infomark">Languages that compile to native code are in <i><b>Bold Italics</b></i>.</p></td></tr></table></div></div>\n};
}

main();


