<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
	<title>C:\Fulgham\Projects\shootout\bench\heapsort\heapsort.clean</title>
	<link rel="stylesheet" type="text/css" href="highlight.css">
</head>
<body>
<pre><span class="line">    1 </span>/* The Great Computer Language Shootout  
<span class="line">    2 </span> 
<span class="line">    3 </span>   http://shootout.alioth.debian.org/ 
<span class="line">    4 </span> 
<span class="line">    5 </span>   contributed by Isaac Gouy (Clean novice) 
<span class="line">    6 </span> 
<span class="line">    7 </span>To compile:     
<span class="line">    8 </span>   cleanIDE.exe <span class="com">--batch-force-build &quot;e:\shoot\contrib\clean\heapsort.prj&quot; 
</span><span class="line">    9 </span><span class="com"></span> 
<span class="line">   10 </span>To run: 
<span class="line">   11 </span>   heapsort.exe -con <span class="num">80000 
</span><span class="line">   12 </span><span class="num"></span>*/ 
<span class="line">   13 </span> 
<span class="line">   14 </span> 
<span class="line">   15 </span><span class="key">module </span>heapsort 
<span class="line">   16 </span><span class="key">import </span>StdEnv, StdArrayExtensions, ArgEnv, LanguageShootout 
<span class="line">   17 </span> 
<span class="line">   18 </span>Start = (toStringWith <span class="num">10 </span>sortedValues.[n-1]) +++ <span class="str">&quot;\n&quot;</span> 
<span class="line">   19 </span>   <span class="key">where 
</span><span class="line">   20 </span><span class="key">      </span>argv = getCommandLine 
<span class="line">   21 </span>      n = toInt (argv.[<span class="num">1</span>]) 
<span class="line">   22 </span>      randomValues = nran (n-1) <span class="num">1.0 42 </span>(createUnboxedRealArr n <span class="num">0.0</span>) 
<span class="line">   23 </span>      sortedValues = heapsort randomValues 
<span class="line">   24 </span> 
<span class="line">   25 </span> 
<span class="line">   26 </span>// Heapsort implementation adapted from: 
<span class="line">   27 </span>// 
<span class="line">   28 </span>// <span class="str">&quot;The Implementation and Efficiency of Arrays in Clean 1.1&quot;</span> 
<span class="line">   29 </span>// John H. G. van Groningen 
<span class="line">   30 </span>// volume <span class="num">1268 </span><span class="key">of </span>Lecture Notes <span class="key">in </span>Computer Science,  
<span class="line">   31 </span>// pages <span class="num">105</span><span class="com">--124. Springer-Verlag, 1997 
</span><span class="line">   32 </span><span class="com"></span>// http://www.cs.kun.nl/~clean/publications.html#<span class="num">1997 
</span><span class="line">   33 </span><span class="num"> 
</span><span class="line">   34 </span><span class="num"></span>:: SortElement :== Real 
<span class="line">   35 </span>:: SortArray :== {#SortElement} 
<span class="line">   36 </span> 
<span class="line">   37 </span>heapsort :: !*SortArray -&gt; .SortArray 
<span class="line">   38 </span>heapsort a0 
<span class="line">   39 </span>   | n&lt;<span class="num">2 </span>= a 
<span class="line">   40 </span>   = sort_heap (n-1) (mkheap (n&gt;&gt;1) (n-1) a) 
<span class="line">   41 </span>    
<span class="line">   42 </span>   <span class="key">where 
</span><span class="line">   43 </span><span class="key">   </span>(n,a) = usize a0 
<span class="line">   44 </span>       
<span class="line">   45 </span>   mkheap (<span class="num">-1</span>) m a = a 
<span class="line">   46 </span>   mkheap i m a=:{[i]=ai}  
<span class="line">   47 </span>      = mkheap (i-1) m (add_to_heap i ((i&lt;&lt;<span class="num">1</span>)+<span class="num">1</span>) m ai a) 
<span class="line">   48 </span>       
<span class="line">   49 </span>   sort_heap i a=:{[i]=ai, [<span class="num">0</span>]=a0} 
<span class="line">   50 </span>      | i==<span class="num">1 </span>= {a &amp; [<span class="num">0</span>]=ai, [i]=a0} 
<span class="line">   51 </span>      # b = (add_to_heap <span class="num">0 1 </span>deci ai {a &amp; [i]=a0}) 
<span class="line">   52 </span>      = sort_heap deci ( b) 
<span class="line">   53 </span>      with deci = i-1 
<span class="line">   54 </span> 
<span class="line">   55 </span>   add_to_heap i j m ai a 
<span class="line">   56 </span>      | j &gt;= m  
<span class="line">   57 </span>         = if (j&gt;m) 
<span class="line">   58 </span>            {a &amp; [i] = ai} 
<span class="line">   59 </span>            (if (ai&lt;aj) 
<span class="line">   60 </span>               {a` &amp; [i] = aj, [j]=ai} 
<span class="line">   61 </span>               {a` &amp; [i] = ai} 
<span class="line">   62 </span>            ) 
<span class="line">   63 </span>      with (aj, a`) = uselect a j 
<span class="line">   64 </span>       
<span class="line">   65 </span>   add_to_heap i j m ai a=:{[j]=aj} 
<span class="line">   66 </span>      # j1 = j+1 
<span class="line">   67 </span>      #! aj1 = a.[j1] 
<span class="line">   68 </span>      | aj&lt;aj1 
<span class="line">   69 </span>         = if (ai&lt;aj1) 
<span class="line">   70 </span>            (add_to_heap j1 ((j1&lt;&lt;<span class="num">1</span>)+<span class="num">1</span>) m ai {a &amp; [i]=aj1}) 
<span class="line">   71 </span>            {a &amp; [i]=ai} 
<span class="line">   72 </span>      = if (ai&lt;aj) 
<span class="line">   73 </span>         (add_to_heap j ((j&lt;&lt;<span class="num">1</span>)+<span class="num">1</span>) m ai {a &amp; [i]=aj}) 
<span class="line">   74 </span>         {a &amp; [i]=ai}    
<span class="line">   75 </span>          
<span class="line">   76 </span>          
<span class="line">   77 </span>// Random number generator          
<span class="line">   78 </span>im :== <span class="num">139968 
</span><span class="line">   79 </span><span class="num"></span>ia :== <span class="num">3877 
</span><span class="line">   80 </span><span class="num"></span>ic :== <span class="num">29573 
</span><span class="line">   81 </span><span class="num"></span>imd :== toReal im 
<span class="line">   82 </span> 
<span class="line">   83 </span>nran i max seed numbers 
<span class="line">   84 </span>   | i&lt;<span class="num">0   </span>= numbers 
<span class="line">   85 </span>   = nran (i-1) max newseed {numbers &amp; [i] = newran} 
<span class="line">   86 </span>   <span class="key">where 
</span><span class="line">   87 </span><span class="key">      </span>newseed = (seed * ia + ic) rem im 
<span class="line">   88 </span>      newran =  max * toReal newseed / imd    
<span class="line">   89 </span>          
<span class="line">   90 </span>          
<span class="line">   91 </span>          
</pre>
</body>
</html>
<!--HTML generated by highlight 2.0-24, http://www.andre-simon.de/-->
