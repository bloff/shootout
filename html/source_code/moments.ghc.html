<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
	<title>C:\Fulgham\Projects\shootout\bench\moments\moments.ghc</title>
	<link rel="stylesheet" type="text/css" href="highlight.css">
</head>
<body>
<pre><span class="line">    1 </span><span class="com">-- $Id: moments.ghc.html,v 1.1 2004-06-14 23:09:27 bfulgham Exp $
</span><span class="line">    2 </span><span class="com"></span><span class="com">-- http://www.bagley.org/~doug/shootout/
</span><span class="line">    3 </span><span class="com"></span><span class="com">-- from Brian Gregor
</span><span class="line">    4 </span><span class="com"></span><span class="com">-- with modifications by Max
</span><span class="line">    5 </span><span class="com"></span>
<span class="line">    6 </span>
<span class="line">    7 </span><span class="key">module </span>Main <span class="key">where
</span><span class="line">    8 </span><span class="key">
</span><span class="line">    9 </span><span class="key">import </span>IO
<span class="line">   10 </span><span class="key">import </span>System
<span class="line">   11 </span><span class="key">import </span>Numeric
<span class="line">   12 </span>
<span class="line">   13 </span><span class="com">-- read the file
</span><span class="line">   14 </span><span class="com"></span>main = <span class="key">do </span>input &lt;- getContents
<span class="line">   15 </span>          putAns (lines input)
<span class="line">   16 </span>
<span class="line">   17 </span>
<span class="line">   18 </span><span class="com">-- print out the answers
</span><span class="line">   19 </span><span class="com"></span>putAns :: [String] -&gt; IO ()
<span class="line">   20 </span>putAns st_nums = <span class="key">do
</span><span class="line">   21 </span><span class="key">                   </span>putStrLn (<span class="str">&quot;n:                  &quot;</span> ++ (showInt (truncate
<span class="line">   22 </span>                             n) <span class="str">&quot;&quot;</span>))
<span class="line">   23 </span>                   putStrLn (<span class="str">&quot;median:             &quot;</span> ++ (showFFloat (Just <span class="num">6</span>)
<span class="line">   24 </span>                             (median nums n) <span class="str">&quot;&quot;</span>))
<span class="line">   25 </span>                   putStrLn (<span class="str">&quot;mean:               &quot;</span> ++ (showFFloat (Just <span class="num">6</span>)
<span class="line">   26 </span>                             mean <span class="str">&quot;&quot;</span>))
<span class="line">   27 </span>                   putStrLn (<span class="str">&quot;average_deviation:  &quot;</span> ++ (showFFloat (Just <span class="num">6</span>)
<span class="line">   28 </span>                             avg_dev <span class="str">&quot;&quot;</span>))
<span class="line">   29 </span>                   putStrLn (<span class="str">&quot;standard_deviation: &quot;</span> ++ (showFFloat (Just <span class="num">6</span>)
<span class="line">   30 </span>                             std_dev <span class="str">&quot;&quot;</span>))
<span class="line">   31 </span>                   putStrLn (<span class="str">&quot;variance:           &quot;</span> ++ (showFFloat (Just <span class="num">6</span>)
<span class="line">   32 </span>                             var <span class="str">&quot;&quot;</span>))
<span class="line">   33 </span>                   putStrLn (<span class="str">&quot;skew:               &quot;</span> ++ (showFFloat (Just <span class="num">6</span>)
<span class="line">   34 </span>                             skew <span class="str">&quot;&quot;</span>))
<span class="line">   35 </span>                   putStrLn (<span class="str">&quot;kurtosis:           &quot;</span> ++ (showFFloat (Just <span class="num">6</span>)
<span class="line">   36 </span>                             kurt <span class="str">&quot;&quot;</span>))
<span class="line">   37 </span>                 <span class="key">where
</span><span class="line">   38 </span><span class="key">                   </span>n =  fromIntegral (length nums)
<span class="line">   39 </span>                   nums =  strToDoub st_nums
<span class="line">   40 </span>                   mean =  (sum nums) / n
<span class="line">   41 </span>                   deviation =  [x-mean | x &lt;- nums]
<span class="line">   42 </span>                   avg_dev =  (sum [abs x | x &lt;- deviation])/ n
<span class="line">   43 </span>                   var =  (sum [x**2 | x &lt;- deviation]) / (n-1)
<span class="line">   44 </span>                   std_dev =  sqrt var
<span class="line">   45 </span>                   skew =  (sum [x**3 | x &lt;- deviation]) / (n*var*std_dev)
<span class="line">   46 </span>                   kurt =  (sum [x**4 | x &lt;- deviation]) / (n*var*var)<span class="num">-3.0
</span><span class="line">   47 </span><span class="num">
</span><span class="line">   48 </span><span class="num">
</span><span class="line">   49 </span><span class="num"></span><span class="com">-- convert the strings to doubles
</span><span class="line">   50 </span><span class="com"></span>strToDoub :: [String] -&gt; [Double]
<span class="line">   51 </span>strToDoub nums = map readMy nums
<span class="line">   52 </span>    <span class="key">where
</span><span class="line">   53 </span><span class="key">    </span>readMy str = readMyInc str Nothing <span class="num">0.0
</span><span class="line">   54 </span><span class="num">    </span>readMyInc [] f v = v*case f <span class="key">of </span>{Nothing-&gt;1<span class="num">.0</span>;Just f<span class="str">'-&gt;f'</span>}
<span class="line">   55 </span>    readMyInc (<span class="str">' '</span>:cs) f v = readMyInc cs f v
<span class="line">   56 </span>    readMyInc (<span class="str">'.'</span>:cs) f v = readMyInc cs (Just <span class="num">1.0</span>) v
<span class="line">   57 </span>    readMyInc (c:cs) f v = if (c&gt;=<span class="str">'0'</span>)&amp;&amp;(c&lt;=<span class="str">'9'</span>) <span class="key">then
</span><span class="line">   58 </span><span class="key">        </span>readMyInc cs nextF (v*10<span class="num">.0</span>+dig)
<span class="line">   59 </span>        <span class="key">else </span>v <span class="key">where
</span><span class="line">   60 </span><span class="key">        </span>dig = fromInteger $ toInteger (fromEnum c-fromEnum <span class="str">'0'</span>)
<span class="line">   61 </span>        nextF = f&gt;&gt;=(return.(/<span class="num">10.0</span>))
<span class="line">   62 </span>
<span class="line">   63 </span><span class="com">-- calculate the median
</span><span class="line">   64 </span><span class="com"></span>median :: [Double] -&gt; <span class="typ">Double </span>-&gt; <span class="typ">Double
</span><span class="line">   65 </span><span class="typ"></span>median nums n = mid (mSort nums)
<span class="line">   66 </span>       <span class="key">where
</span><span class="line">   67 </span><span class="key">         </span>mid x
<span class="line">   68 </span>           | odd (length x) = x!! midpt
<span class="line">   69 </span>           | otherwise       = ((x!!(midpt-1)) + (x!!midpt)) / <span class="num">2.0
</span><span class="line">   70 </span><span class="num">         </span>midpt :: <span class="typ">Int
</span><span class="line">   71 </span><span class="typ">         </span>midpt = floor (n/2)
<span class="line">   72 </span>
<span class="line">   73 </span><span class="com">-- Sorting: the various languages use various algorithms
</span><span class="line">   74 </span><span class="com"></span><span class="com">-- here's  an optimized mergesort from
</span><span class="line">   75 </span><span class="com"></span><span class="com">-- &quot;Algorithms - a Functional Approach&quot; by
</span><span class="line">   76 </span><span class="com"></span><span class="com">-- Fethi Rabhe &amp; Guy Lapalme
</span><span class="line">   77 </span><span class="com"></span>split :: (Ord a) =&gt; [a] -&gt; [[a]]
<span class="line">   78 </span>split [] = []
<span class="line">   79 </span>split (x:xs) = [x]:split xs
<span class="line">   80 </span>
<span class="line">   81 </span>merge :: (Ord a) =&gt; [a] -&gt; [a] -&gt; [a]
<span class="line">   82 </span>merge [] b  = b
<span class="line">   83 </span>merge a [] = a
<span class="line">   84 </span>merge a&#64;(x:xs) b&#64;(y:ys)
<span class="line">   85 </span>    | (x&lt;=y) = x : (merge xs b)
<span class="line">   86 </span>    | otherwise = y : (merge a ys)
<span class="line">   87 </span>
<span class="line">   88 </span>mergepairs :: (Ord a) =&gt; [[a]] -&gt; [[a]]
<span class="line">   89 </span>mergepairs [] = []
<span class="line">   90 </span>mergepairs x&#64;[l] = x
<span class="line">   91 </span>mergepairs (l1:l2:rest) = (merge l1 l2) : (mergepairs $! rest)
<span class="line">   92 </span>
<span class="line">   93 </span><span class="com">-- The actual sort
</span><span class="line">   94 </span><span class="com"></span>mSort :: (Ord a) =&gt; [a] -&gt; [a]
<span class="line">   95 </span>mSort l = ms (split l)
<span class="line">   96 </span>    <span class="key">where  </span>ms [r] = r
<span class="line">   97 </span>           ms l   = ms (mergepairs l)
</pre>
</body>
</html>
<!--HTML generated by highlight 2.0-24, http://www.andre-simon.de/-->
