<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
	<title>C:\Fulgham\Projects\shootout\bench\lists\lists.mzc</title>
	<link rel="stylesheet" type="text/css" href="highlight.css">
</head>
<body>
<pre><span class="line">    1 </span>#!/usr/bin/mzscheme -r
<span class="line">    2 </span>(define SIZE <span class="num">10000</span>)
<span class="line">    3 </span>
<span class="line">    4 </span>(define (sequence start stop)
<span class="line">    5 </span>  (<span class="key">if </span>(&gt; start stop)
<span class="line">    6 </span>      <span class="str">'()
</span><span class="line">    7 </span><span class="str">      (cons start (sequence (+ start 1) stop))))
</span><span class="line">    8 </span><span class="str">
</span><span class="line">    9 </span><span class="str">(define (head-to-tail! headlist taillist)
</span><span class="line">   10 </span><span class="str">  (when (null? taillist) (begin
</span><span class="line">   11 </span><span class="str">               (set! taillist (list (car headlist)))
</span><span class="line">   12 </span><span class="str">               (set! headlist (cdr headlist))))
</span><span class="line">   13 </span><span class="str">  (letrec ((htt-helper (lambda (dest)
</span><span class="line">   14 </span><span class="str">             (when (not (null? headlist))
</span><span class="line">   15 </span><span class="str">                (let ((headlink headlist))
</span><span class="line">   16 </span><span class="str">                  (set-cdr! dest headlink)
</span><span class="line">   17 </span><span class="str">                  (set! headlist (cdr headlist))
</span><span class="line">   18 </span><span class="str">                  (htt-helper headlink))))))
</span><span class="line">   19 </span><span class="str">    (htt-helper taillist)
</span><span class="line">   20 </span><span class="str">    (values headlist taillist)))
</span><span class="line">   21 </span><span class="str">
</span><span class="line">   22 </span><span class="str">(define (test-lists)
</span><span class="line">   23 </span><span class="str">  (let* ([L1 (sequence 1 SIZE)]
</span><span class="line">   24 </span><span class="str">     [L2 (append L1 '</span>())]
<span class="line">   25 </span>     [L3 <span class="str">'()])
</span><span class="line">   26 </span><span class="str">    (set!-values (L2 L3) (head-to-tail! L2 L3))
</span><span class="line">   27 </span><span class="str">    (set!-values (L3 L2) (head-to-tail! (reverse! L3) L2))
</span><span class="line">   28 </span><span class="str">    (set! L1 (reverse! L1))
</span><span class="line">   29 </span><span class="str">    (cond ((not (= SIZE (car L1))) 0)
</span><span class="line">   30 </span><span class="str">      ((not (equal? L1 L2))       0)
</span><span class="line">   31 </span><span class="str">      (else           (length L1)))))
</span><span class="line">   32 </span><span class="str">
</span><span class="line">   33 </span><span class="str">(define (main args)
</span><span class="line">   34 </span><span class="str">  (let ((result #f))
</span><span class="line">   35 </span><span class="str">    (let loop ((counter (if (= (vector-length args) 0)
</span><span class="line">   36 </span><span class="str">                1
</span><span class="line">   37 </span><span class="str">                (string-&gt;number (vector-ref args 0)))))
</span><span class="line">   38 </span><span class="str">      (when (&gt; counter 0)
</span><span class="line">   39 </span><span class="str">        (set! result (test-lists))
</span><span class="line">   40 </span><span class="str">        (loop (- counter 1))))
</span><span class="line">   41 </span><span class="str">    (printf &quot;~s~n&quot; result)))
</span><span class="line">   42 </span><span class="str">
</span><span class="line">   43 </span><span class="str">(main argv)</span>
</pre>
</body>
</html>
<!--HTML generated by highlight 2.0-24, http://www.andre-simon.de/-->
