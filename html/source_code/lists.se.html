<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
	<title>C:\Fulgham\Projects\shootout\bench\lists\lists.se</title>
	<link rel="stylesheet" type="text/css" href="highlight.css">
</head>
<body>
<pre><span class="line">    1 </span><span class="com">-- -*- mode: eiffel -*-
</span><span class="line">    2 </span><span class="com"></span><span class="com">-- $Id: lists.se.html,v 1.1 2004-06-14 23:09:27 bfulgham Exp $
</span><span class="line">    3 </span><span class="com"></span><span class="com">-- http://www.bagley.org/~doug/shootout/
</span><span class="line">    4 </span><span class="com"></span><span class="com">-- from Friedrich Dominicus
</span><span class="line">    5 </span><span class="com"></span>
<span class="line">    6 </span><span class="key">class </span>LISTS
<span class="line">    7 </span>
<span class="line">    8 </span>
<span class="line">    9 </span>creation
<span class="line">   10 </span>    make
<span class="line">   11 </span>
<span class="line">   12 </span>
<span class="line">   13 </span>
<span class="line">   14 </span><span class="key">feature
</span><span class="line">   15 </span><span class="key">
</span><span class="line">   16 </span><span class="key">    </span>exc: EXCEPTIONS;
<span class="line">   17 </span>    args: ARGUMENTS;
<span class="line">   18 </span>    l1, l2, l3: DOUBLY_LINKED_LIST[INTEGER];
<span class="line">   19 </span>    size : <span class="typ">INTEGER </span><span class="key">is </span><span class="num">10000</span>;
<span class="line">   20 </span>    run_n : <span class="typ">INTEGER</span>;
<span class="line">   21 </span>
<span class="line">   22 </span>    preamble <span class="key">is
</span><span class="line">   23 </span><span class="key">        do
</span><span class="line">   24 </span><span class="key">            create </span>exc;
<span class="line">   25 </span>            <span class="key">create </span>args
<span class="line">   26 </span>            <span class="key">if </span>args.argument_count /= <span class="num">1 </span><span class="key">then
</span><span class="line">   27 </span><span class="key">                </span>io.put_string(<span class="str">&quot;exception_test &lt;integer&gt;%N&quot;</span>);
<span class="line">   28 </span>                exc.die(1);
<span class="line">   29 </span>            <span class="key">end</span>;
<span class="line">   30 </span>            <span class="key">if </span>args.argument(1).is_integer <span class="key">then
</span><span class="line">   31 </span><span class="key">                </span>run_n := argument(1).to_integer;
<span class="line">   32 </span>            <span class="key">else
</span><span class="line">   33 </span><span class="key">                </span>io.put_string(<span class="str">&quot;Argument wasn't an integer, giving up%N&quot;</span>);
<span class="line">   34 </span>                exc.die(1);
<span class="line">   35 </span>            <span class="key">end</span>;
<span class="line">   36 </span>        <span class="key">end
</span><span class="line">   37 </span><span class="key">
</span><span class="line">   38 </span><span class="key">
</span><span class="line">   39 </span><span class="key">
</span><span class="line">   40 </span><span class="key">    </span>make <span class="key">is
</span><span class="line">   41 </span><span class="key">        local
</span><span class="line">   42 </span><span class="key">          </span>i : <span class="typ">INTEGER</span>;
<span class="line">   43 </span>      length : <span class="typ">INTEGER</span>;
<span class="line">   44 </span>        <span class="key">do
</span><span class="line">   45 </span><span class="key">            </span>preamble;
<span class="line">   46 </span>            <span class="key">from </span>i := <span class="num">1
</span><span class="line">   47 </span><span class="num">            </span>until i &gt; run_n
<span class="line">   48 </span>            <span class="key">loop
</span><span class="line">   49 </span><span class="key">                </span>length := run_it
<span class="line">   50 </span>                i := i + <span class="num">1</span>;
<span class="line">   51 </span>            <span class="key">end</span>;
<span class="line">   52 </span>
<span class="line">   53 </span>            <span class="com">-- io.put_string (&quot;l1 length = &quot;);
</span><span class="line">   54 </span><span class="com"></span>            io.put_integer (length);
<span class="line">   55 </span>            io.put_new_line;
<span class="line">   56 </span>        <span class="key">end</span>;
<span class="line">   57 </span>
<span class="line">   58 </span>    run_it : <span class="typ">INTEGER </span><span class="key">is
</span><span class="line">   59 </span><span class="key">        local
</span><span class="line">   60 </span><span class="key">            </span>length : <span class="typ">INTEGER</span>;
<span class="line">   61 </span>        <span class="key">do
</span><span class="line">   62 </span><span class="key">            create </span>l1.make;
<span class="line">   63 </span>            fill_l1;
<span class="line">   64 </span>            <span class="com">-- copy L1 to L2 (can use any builtin list copy function, if
</span><span class="line">   65 </span><span class="com"></span>            <span class="com">-- available)
</span><span class="line">   66 </span><span class="com"></span>            l2 := clone(l1);
<span class="line">   67 </span>            move_from_front_to_end;
<span class="line">   68 </span>
<span class="line">   69 </span>            l3 := l1.clone (l1);
<span class="line">   70 </span>            move_from_end_to_end;
<span class="line">   71 </span>            <span class="com">-- reversing using the &quot;official interface of the
</span><span class="line">   72 </span><span class="com"></span>            <span class="com">-- SmallEiffel datastructures&quot;
</span><span class="line">   73 </span><span class="com"></span>            <span class="com">--reverse_in_place_naive (l1);
</span><span class="line">   74 </span><span class="com"></span>            <span class="com">-- hand crafted version see doubly_linked_list for details
</span><span class="line">   75 </span><span class="com"></span>            l1.revert_in_place;
<span class="line">   76 </span>            <span class="com">-- check that first item of L1 is now == SIZE.%
</span><span class="line">   77 </span><span class="com"></span>            <span class="com">-- in Eiffel we could write
</span><span class="line">   78 </span><span class="com"></span>            <span class="com">-- check l1.fist = size end;
</span><span class="line">   79 </span><span class="com"></span>            <span class="com">-- if that does not hold and exception is raised. Well
</span><span class="line">   80 </span><span class="com"></span>            <span class="com">-- just for the record ;-)
</span><span class="line">   81 </span><span class="com"></span>            <span class="key">if </span>l1.first = size <span class="key">then
</span><span class="line">   82 </span><span class="key">                </span><span class="com">-- io.put_string(&quot;seems to work%N&quot;);
</span><span class="line">   83 </span><span class="com"></span>            <span class="key">else
</span><span class="line">   84 </span><span class="key">                </span>io.put_string(<span class="str">&quot;should not happen%N&quot;</span>);
<span class="line">   85 </span>            <span class="key">end</span>;
<span class="line">   86 </span>            <span class="com">-- compare L1 and L2 for equality and return length of L1
</span><span class="line">   87 </span><span class="com"></span>            <span class="com">-- which should be equal to SIZE
</span><span class="line">   88 </span><span class="com"></span>            length := compare_lists (l1, l2);
<span class="line">   89 </span>            <span class="key">Result </span>:= length;
<span class="line">   90 </span>        <span class="key">end</span>;
<span class="line">   91 </span>
<span class="line">   92 </span>    fill_l1 <span class="key">is
</span><span class="line">   93 </span><span class="key">            </span><span class="com">-- first create a list (L1) of integers from 1 through SIZE
</span><span class="line">   94 </span><span class="com"></span>            <span class="com">-- (SIZE is currently defined as 10000).
</span><span class="line">   95 </span><span class="com"></span>        <span class="key">local
</span><span class="line">   96 </span><span class="key">            </span>i: <span class="typ">INTEGER</span>;
<span class="line">   97 </span>        <span class="key">do
</span><span class="line">   98 </span><span class="key">            from </span>i := <span class="num">1
</span><span class="line">   99 </span><span class="num">            </span>until i &gt; size
<span class="line">  100 </span>            <span class="key">loop
</span><span class="line">  101 </span><span class="key">                </span>l1.add_last(i);
<span class="line">  102 </span>                i := i + <span class="num">1</span>;
<span class="line">  103 </span>            <span class="key">end</span>;
<span class="line">  104 </span>        <span class="key">end</span>;
<span class="line">  105 </span>
<span class="line">  106 </span>    move_from_front_to_end <span class="key">is
</span><span class="line">  107 </span><span class="key">            </span><span class="com">-- remove each individual item from left side (head) of L2 and
</span><span class="line">  108 </span><span class="com"></span>            <span class="com">-- append to right side (tail) of L3 (preserving order). (L2
</span><span class="line">  109 </span><span class="com"></span>                                     should
<span class="line">  110 </span>            <span class="com">-- be emptied by one item at a time as that item is appended
</span><span class="line">  111 </span><span class="com"></span>            <span class="com">-- to L3).
</span><span class="line">  112 </span><span class="com"></span>            <span class="com">-- REMARK: built-in functionality is used which is not
</span><span class="line">  113 </span><span class="com"></span>            <span class="com">-- optimized for speed, e.g the add_last method creates a
</span><span class="line">  114 </span><span class="com"></span>            <span class="com">-- new node each time, this could be optimized by
</span><span class="line">  115 </span><span class="com"></span>            <span class="com">-- handcrafted code (in fact the shootout encourages the
</span><span class="line">  116 </span><span class="com"></span>            <span class="com">-- &quot;implement yourself approach&quot;, which makes it biased
</span><span class="line">  117 </span><span class="com"></span>            <span class="com">-- towards hand-tailored implementations.
</span><span class="line">  118 </span><span class="com"></span>        <span class="key">do
</span><span class="line">  119 </span><span class="key">            from </span>!!l3.make
<span class="line">  120 </span>            until l2.is_empty
<span class="line">  121 </span>            <span class="key">loop
</span><span class="line">  122 </span><span class="key">                </span>l3.add_last(l2.first);
<span class="line">  123 </span>                l2.remove_first;
<span class="line">  124 </span>            <span class="key">end</span>;
<span class="line">  125 </span>            <span class="key">check
</span><span class="line">  126 </span><span class="key">                </span>l3_adjusted: l3.first = <span class="num">1 </span><span class="key">and </span>l3.last = size;
<span class="line">  127 </span>            <span class="key">end</span>; <span class="com">-- check
</span><span class="line">  128 </span><span class="com"></span>            <span class="key">debug
</span><span class="line">  129 </span><span class="key">                </span>io.put_string(<span class="str">&quot;l3 is now %N&quot;</span>);
<span class="line">  130 </span>                print (l3);
<span class="line">  131 </span>                io.newline;
<span class="line">  132 </span>            <span class="key">end</span>;
<span class="line">  133 </span>        <span class="key">end
</span><span class="line">  134 </span><span class="key">
</span><span class="line">  135 </span><span class="key">    </span>move_from_end_to_end <span class="key">is
</span><span class="line">  136 </span><span class="key">            </span><span class="com">-- remove each individual item from right side (tail) of L3
</span><span class="line">  137 </span><span class="com"></span>            <span class="com">-- and append to right side (tail) of L2 (reversing list).
</span><span class="line">  138 </span><span class="com"></span>            <span class="com">-- (L3  should be emptied by one item at a time as that item
</span><span class="line">  139 </span><span class="com"></span>            <span class="com">--  is appended to L2).
</span><span class="line">  140 </span><span class="com"></span>            <span class="com">-- REMARKS: see move_from_font_to_end
</span><span class="line">  141 </span><span class="com"></span>        <span class="key">do
</span><span class="line">  142 </span><span class="key">            from </span>!!l2.make
<span class="line">  143 </span>            until l3.is_empty
<span class="line">  144 </span>            <span class="key">loop
</span><span class="line">  145 </span><span class="key">                </span>l2.add_last(l3.last);
<span class="line">  146 </span>                l3.remove_last;
<span class="line">  147 </span>            <span class="key">end</span>;
<span class="line">  148 </span>            <span class="key">check
</span><span class="line">  149 </span><span class="key">                </span>l2_built_properly: l2.first = size <span class="key">and </span>l2.last = <span class="num">1</span>;
<span class="line">  150 </span>            <span class="key">end</span>;
<span class="line">  151 </span>            <span class="key">debug
</span><span class="line">  152 </span><span class="key">                </span>io.put_string (<span class="str">&quot;l2 is now: %N&quot;</span>);
<span class="line">  153 </span>                print (l2);
<span class="line">  154 </span>                io.put_new_line;
<span class="line">  155 </span>            <span class="key">end</span>;
<span class="line">  156 </span>        <span class="key">end</span>;
<span class="line">  157 </span>
<span class="line">  158 </span>
<span class="line">  159 </span>
<span class="line">  160 </span>
<span class="line">  161 </span>    reverse_in_place_naive (dlist: TWO_WAY_LINKED_LIST [INTEGER]) <span class="key">is
</span><span class="line">  162 </span><span class="key">            </span><span class="com">-- first try should make quite a difference in run-time
</span><span class="line">  163 </span><span class="com"></span>            <span class="com">-- reverse L1 (preferably in place) (can use any builtin
</span><span class="line">  164 </span><span class="com"></span>            <span class="com">-- function for this, if available.
</span><span class="line">  165 </span><span class="com"></span>        <span class="key">local
</span><span class="line">  166 </span><span class="key">            </span>i : <span class="typ">INTEGER</span>;
<span class="line">  167 </span>            done : <span class="typ">BOOLEAN</span>;
<span class="line">  168 </span>            <span class="com">-- fl_clone : TWO_WAY_LINKED_LIST[INTEGER];
</span><span class="line">  169 </span><span class="com"></span>        <span class="key">do
</span><span class="line">  170 </span><span class="key">            </span><span class="com">-- fl_clone := clone(first_link);
</span><span class="line">  171 </span><span class="com"></span>            <span class="key">from </span>i := <span class="num">1
</span><span class="line">  172 </span><span class="num">            </span>until
<span class="line">  173 </span>                i &gt; size
<span class="line">  174 </span>            <span class="key">loop
</span><span class="line">  175 </span><span class="key">                </span>dlist.add(dlist.last, i);
<span class="line">  176 </span>                <span class="com">-- inefficient. the problem is that remove_lasts moves
</span><span class="line">  177 </span><span class="com"></span>                <span class="com">-- the cursoer and there for one has to run through
</span><span class="line">  178 </span><span class="com"></span>                <span class="com">-- the list over and over again. Well one can that
</span><span class="line">  179 </span><span class="com"></span>                <span class="com">-- just find out by reading the sources ...;-)
</span><span class="line">  180 </span><span class="com"></span>
<span class="line">  181 </span>                dlist.remove_last;
<span class="line">  182 </span>                i := i + <span class="num">1</span>;
<span class="line">  183 </span>            <span class="key">end</span>;
<span class="line">  184 </span>            <span class="key">if </span>dlist.first = size <span class="key">then
</span><span class="line">  185 </span><span class="key">                </span>io.put_string(<span class="str">&quot;first element = size%N&quot;</span>);
<span class="line">  186 </span>            <span class="key">else
</span><span class="line">  187 </span><span class="key">                </span>io.put_string(<span class="str">&quot;first element != size %N&quot;</span>);
<span class="line">  188 </span>            <span class="key">end</span>;
<span class="line">  189 </span>            <span class="key">debug
</span><span class="line">  190 </span><span class="key">                </span>io.put_string(<span class="str">&quot;dlist is now %N&quot;</span>);
<span class="line">  191 </span>                print (dlist);
<span class="line">  192 </span>                io.newline;
<span class="line">  193 </span>            <span class="key">end</span>;
<span class="line">  194 </span>        <span class="key">end</span>;
<span class="line">  195 </span>
<span class="line">  196 </span>    compare_lists (al1, al2 : DOUBLY_LINKED_LIST[INTEGER]): <span class="typ">INTEGER </span><span class="key">is
</span><span class="line">  197 </span><span class="key">        do
</span><span class="line">  198 </span><span class="key">            if </span>al1.is_equal(al2) <span class="key">then
</span><span class="line">  199 </span><span class="key">                </span><span class="com">-- io.put_string(&quot;lists are equal%N&quot;);
</span><span class="line">  200 </span><span class="com"></span>            <span class="key">else
</span><span class="line">  201 </span><span class="key">                </span>io.put_string (<span class="str">&quot;lists are not equal %N&quot;</span>);
<span class="line">  202 </span>            <span class="key">end</span>;
<span class="line">  203 </span>            <span class="key">Result </span>:= al1.count;
<span class="line">  204 </span>        <span class="key">end</span>;
<span class="line">  205 </span>
<span class="line">  206 </span>
<span class="line">  207 </span>
<span class="line">  208 </span>
<span class="line">  209 </span><span class="key">end </span><span class="com">-- class LISTS</span>
</pre>
</body>
</html>
<!--HTML generated by highlight 2.0-24, http://www.andre-simon.de/-->
