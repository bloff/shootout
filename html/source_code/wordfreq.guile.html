<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
	<title>C:\Fulgham\Projects\shootout\bench\wordfreq\wordfreq.guile</title>
	<link rel="stylesheet" type="text/css" href="highlight.css">
</head>
<body>
<pre><span class="line">    1 </span>#!/usr/bin/guile <span class="esc">\
</span><span class="line">    2 </span><span class="esc"></span>-e main -s
<span class="line">    3 </span>!#
<span class="line">    4 </span>
<span class="line">    5 </span><span class="com">;;; $Id: wordfreq.guile.html,v 1.1 2004-06-14 23:09:29 bfulgham Exp $
</span><span class="line">    6 </span><span class="com"></span><span class="com">;;; http://www.bagley.org/~doug/shootout/
</span><span class="line">    7 </span><span class="com"></span><span class="com">;;; from Brad Knotwell
</span><span class="line">    8 </span><span class="com"></span>
<span class="line">    9 </span>(use-modules (ice-9 string-fun) (ice-9 common-list))
<span class="line">   10 </span>(use-modules (ice-9 format))
<span class="line">   11 </span>
<span class="line">   12 </span>(define my-hash (make-hash-table <span class="num">4000</span>))
<span class="line">   13 </span>
<span class="line">   14 </span>(define (print-sorted-hash)
<span class="line">   15 </span>  (define (display-elt elt)
<span class="line">   16 </span>    (display (format <span class="str">&quot;~7D</span><span class="esc">\t</span><span class="str">~a</span><span class="esc">\n</span><span class="str">&quot;</span> (<span class="key">car </span>elt) (<span class="key">cdr </span>elt))))
<span class="line">   17 </span>  (map display-elt
<span class="line">   18 </span>       (sort-list (hash-fold (<span class="key">lambda </span>(x y z) (<span class="key">cons </span>(<span class="key">cons </span>y x) z))  <span class="str">'() my-
</span><span class="line">   19 </span><span class="str">        hash)
</span><span class="line">   20 </span><span class="str">          (lambda (x y) (or (&gt; (car x) (car y))
</span><span class="line">   21 </span><span class="str">                    (and (= (car x) (car y))
</span><span class="line">   22 </span><span class="str">                     (string&gt;=? (cdr x) (cdr y))))))))
</span><span class="line">   23 </span><span class="str">(define (load-hash x . tl)
</span><span class="line">   24 </span><span class="str">  (define (do-entry entry)
</span><span class="line">   25 </span><span class="str">    (let ((entry-val (hash-ref my-hash entry)))
</span><span class="line">   26 </span><span class="str">      (hash-set! my-hash entry (if entry-val (1+ entry-val) 1))))
</span><span class="line">   27 </span><span class="str">  (map do-entry (remove-if (lambda (x) (string=? x &quot;&quot;)) (cons x tl))))
</span><span class="line">   28 </span><span class="str">
</span><span class="line">   29 </span><span class="str">(define (main args)
</span><span class="line">   30 </span><span class="str">  (do ((line (read-line) (read-line)))
</span><span class="line">   31 </span><span class="str">      ((eof-object? line) (print-sorted-hash))
</span><span class="line">   32 </span><span class="str">    (separate-fields-discarding-char
</span><span class="line">   33 </span><span class="str">     #</span><span class="esc">\s</span><span class="str">pace
</span><span class="line">   34 </span><span class="str">     (list-&gt;string (map (lambda (x) (if (char-alphabetic? x) x #</span><span class="esc">\s</span><span class="str">pace))
</span><span class="line">   35 </span><span class="str">            (string-&gt;list (string-downcase line))))
</span><span class="line">   36 </span><span class="str">     load-hash)))</span>
</pre>
</body>
</html>
<!--HTML generated by highlight 2.0-24, http://www.andre-simon.de/-->
