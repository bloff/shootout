<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
	<title>C:\Fulgham\Projects\shootout\bench\strcat\strcat.mzc</title>
	<link rel="stylesheet" type="text/css" href="highlight.css">
</head>
<body>
<pre><span class="line">    1 </span>#!/usr/bin/mzscheme -r
<span class="line">    2 </span><span class="com">;; strcat.scm
</span><span class="line">    3 </span><span class="com"></span>
<span class="line">    4 </span><span class="com">;;; SPECIFICATION
</span><span class="line">    5 </span><span class="com"></span>
<span class="line">    6 </span><span class="com">;For this test, each program should be implemented in the same way,
</span><span class="line">    7 </span><span class="com"></span><span class="com">;according to the following specification.
</span><span class="line">    8 </span><span class="com"></span><span class="com">;
</span><span class="line">    9 </span><span class="com"></span><span class="com">;    pseudocode for strcat test
</span><span class="line">   10 </span><span class="com"></span><span class="com">;
</span><span class="line">   11 </span><span class="com"></span><span class="com">;   s is initialized to the null string
</span><span class="line">   12 </span><span class="com"></span><span class="com">;   repeat N times:
</span><span class="line">   13 </span><span class="com"></span><span class="com">;     append &quot;hello\n&quot; to s
</span><span class="line">   14 </span><span class="com"></span><span class="com">;   count the number of individual characters in s
</span><span class="line">   15 </span><span class="com"></span><span class="com">;   print the count
</span><span class="line">   16 </span><span class="com"></span>
<span class="line">   17 </span><span class="com">;  There should be N distinct string append statements done in a loop.
</span><span class="line">   18 </span><span class="com"></span><span class="com">;  After each append the resultant string should be 6 characters
</span><span class="line">   19 </span><span class="com"></span><span class="com">;  longer (the length of &quot;hello\n&quot;).
</span><span class="line">   20 </span><span class="com"></span><span class="com">;  s should be a string, string buffer, or character array.
</span><span class="line">   21 </span><span class="com"></span><span class="com">;  The program should not construct a list of strings and join it.
</span><span class="line">   22 </span><span class="com"></span>
<span class="line">   23 </span>(define hello <span class="str">&quot;hello</span><span class="esc">\n</span><span class="str">&quot;</span>)
<span class="line">   24 </span>
<span class="line">   25 </span><span class="com">;; Simple slow version
</span><span class="line">   26 </span><span class="com"></span><span class="com">;; This is surprisingly slow
</span><span class="line">   27 </span><span class="com"></span>
<span class="line">   28 </span>
<span class="line">   29 </span><span class="com">;(define (main args)
</span><span class="line">   30 </span><span class="com"></span><span class="com">;  (let* ((n (or (and (= (length args) 2) (string-&gt;number (cadr args))) 1))
</span><span class="line">   31 </span><span class="com"></span><span class="com">;  (str &quot;&quot;))
</span><span class="line">   32 </span><span class="com"></span><span class="com">;    (do ((i 0 (+ i 1)))
</span><span class="line">   33 </span><span class="com"></span><span class="com">; ((= i n))
</span><span class="line">   34 </span><span class="com"></span><span class="com">;      (set! str (string-append str hello)))
</span><span class="line">   35 </span><span class="com"></span><span class="com">;    (display (string-length str))
</span><span class="line">   36 </span><span class="com"></span><span class="com">;    (newline)))
</span><span class="line">   37 </span><span class="com"></span>
<span class="line">   38 </span>
<span class="line">   39 </span><span class="com">;; Quote from Bigloo documentation
</span><span class="line">   40 </span><span class="com"></span>
<span class="line">   41 </span><span class="com">;; (blit-string! string1 o1 string2 o2 len)
</span><span class="line">   42 </span><span class="com"></span><span class="com">;; Fill string s2 starting at position o2 with len characters
</span><span class="line">   43 </span><span class="com"></span><span class="com">;; taken out of string s1 from position o1.
</span><span class="line">   44 </span><span class="com"></span><span class="com">;;
</span><span class="line">   45 </span><span class="com"></span><span class="com">;; (let ((s (make-string 20 #\-)))
</span><span class="line">   46 </span><span class="com"></span><span class="com">;;         (blit-string! &quot;toto&quot; 0 s 16 4)
</span><span class="line">   47 </span><span class="com"></span><span class="com">;;         s)
</span><span class="line">   48 </span><span class="com"></span><span class="com">;;    =&gt; &quot;----------------toto&quot;
</span><span class="line">   49 </span><span class="com"></span>
<span class="line">   50 </span>
<span class="line">   51 </span>(define (blit-string! s1 o1 s2 o2 len)
<span class="line">   52 </span>  (do ((o1 o1 (+ o1 <span class="num">1</span>))
<span class="line">   53 </span>       (o2 o2 (+ o2 <span class="num">1</span>))
<span class="line">   54 </span>       (len len (- len <span class="num">1</span>)))
<span class="line">   55 </span>
<span class="line">   56 </span>      ((= len <span class="num">0</span>))
<span class="line">   57 </span>
<span class="line">   58 </span>    (string-set! s2 o2 (string-ref s1 o1))))
<span class="line">   59 </span>
<span class="line">   60 </span><span class="com">;; Serranos version (works like a charm)
</span><span class="line">   61 </span><span class="com"></span>
<span class="line">   62 </span>(define (main args)
<span class="line">   63 </span>  (let* ((n (<span class="key">or </span>(<span class="key">and </span>(= (<span class="key">length </span>args) <span class="num">2</span>) (string-&gt;number (<span class="key">cadr </span>args)))
<span class="line">   64 </span>                <span class="num">1</span>))
<span class="line">   65 </span>  (i <span class="num">0</span>)
<span class="line">   66 </span>  (buflen <span class="num">32</span>)
<span class="line">   67 </span>  (strbuf (make-string buflen))
<span class="line">   68 </span>  (stufflen (string-length hello))
<span class="line">   69 </span>  (stuff hello)
<span class="line">   70 </span>  (stuffstart <span class="num">0</span>))
<span class="line">   71 </span>
<span class="line">   72 </span>    (do ((i <span class="num">0 </span>(+ i <span class="num">1</span>)))
<span class="line">   73 </span>         ((= i n))
<span class="line">   74 </span>      (<span class="key">if </span>(&gt;= (+ stufflen stuffstart) buflen)
<span class="line">   75 </span>   (let* ((nbuflen (* <span class="num">2 </span>buflen))
<span class="line">   76 </span>   (nstrbuf (make-string nbuflen)))
<span class="line">   77 </span>     (blit-string! strbuf <span class="num">0 </span>nstrbuf <span class="num">0 </span>buflen)
<span class="line">   78 </span>     (<span class="key">set</span>! buflen nbuflen)
<span class="line">   79 </span>     (<span class="key">set</span>! strbuf nstrbuf)))
<span class="line">   80 </span>      (blit-string! stuff <span class="num">0 </span>strbuf stuffstart stufflen)
<span class="line">   81 </span>      (<span class="key">set</span>! stuffstart (+ stuffstart stufflen)))
<span class="line">   82 </span>
<span class="line">   83 </span>    (<span class="key">set</span>! strbuf (substring strbuf <span class="num">0 </span>stuffstart))
<span class="line">   84 </span>
<span class="line">   85 </span>    (display (string-length strbuf))
<span class="line">   86 </span>    (newline)))
<span class="line">   87 </span>
<span class="line">   88 </span>(time (main <span class="str">'(&quot;strcat&quot; &quot;40000&quot;)))
</span><span class="line">   89 </span><span class="str">
</span><span class="line">   90 </span><span class="str">
</span><span class="line">   91 </span><span class="str"></span>
</pre>
</body>
</html>
<!--HTML generated by highlight 2.0-24, http://www.andre-simon.de/-->
