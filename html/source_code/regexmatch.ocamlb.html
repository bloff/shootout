<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
	<title>C:\Fulgham\Projects\shootout\bench\regexmatch\regexmatch.ocamlb</title>
	<link rel="stylesheet" type="text/css" href="highlight.css">
</head>
<body>
<pre><span class="line">    1 </span><span class="com">(*
</span><span class="line">    2 </span><span class="com"> * $Id: regexmatch.ocamlb.html,v 1.1 2004-06-14 23:09:28 bfulgham Exp $
</span><span class="line">    3 </span><span class="com"> * http://www.bagley.org/~doug/shootout/
</span><span class="line">    4 </span><span class="com"> * from: Markus Mottl
</span><span class="line">    5 </span><span class="com"> *)</span>
<span class="line">    6 </span>
<span class="line">    7 </span><span class="key">open </span>Pcre
<span class="line">    8 </span>
<span class="line">    9 </span><span class="key">let </span>rex =
<span class="line">   10 </span>  regexp ~flags:[`EXTENDED]
<span class="line">   11 </span>    <span class="str">&quot;(?: ^ | [^</span><span class="esc">\d\(</span><span class="str">])     # must be preceeded by non-digit
</span><span class="line">   12 </span><span class="str">     (</span><span class="esc">\(\d\d\d\)</span><span class="str">|</span><span class="esc">\d\d\d</span><span class="str">)  # match 1: area code
</span><span class="line">   13 </span><span class="str">     [ ]                  # area code followed by one space
</span><span class="line">   14 </span><span class="str">     </span><span class="esc">\d\d\d                              </span><span class="str"># prefix of 3 digits
</span><span class="line">   15 </span><span class="str">     [ -]                 # separator is either space or dash
</span><span class="line">   16 </span><span class="str">     </span><span class="esc">\d\d\d\d                          </span><span class="str"># last 4 digits
</span><span class="line">   17 </span><span class="str">     (?: </span><span class="esc">\D</span><span class="str">|$)            # must be followed by a non-digit (or EOL)&quot;</span>
<span class="line">   18 </span>
<span class="line">   19 </span><span class="key">let </span>phones =
<span class="line">   20 </span>  <span class="key">let </span>lines = ref [] <span class="key">in
</span><span class="line">   21 </span><span class="key">  </span>foreach_line (<span class="key">fun </span>line -&gt; lines := line :: !lines);
<span class="line">   22 </span>  List.rev !lines
<span class="line">   23 </span>
<span class="line">   24 </span><span class="key">let </span>check_phone irflags ar cnt must_print line =
<span class="line">   25 </span>  <span class="key">try
</span><span class="line">   26 </span><span class="key">    </span>unsafe_pcre_exec irflags rex <span class="num">0 </span>line <span class="num">4 </span>ar;
<span class="line">   27 </span>    <span class="key">let </span>num = String.copy <span class="str">&quot;(...) ...-....&quot;</span> <span class="key">and </span>pos = Array.unsafe_get ar <span class="num">2
</span><span class="line">   28 </span><span class="num">              </span><span class="key">in
</span><span class="line">   29 </span><span class="key">    let </span>ofs = <span class="key">if </span>String.unsafe_get line pos = <span class="str">'('</span> <span class="key">then </span><span class="num">1 </span><span class="key">else </span><span class="num">0 </span><span class="key">in
</span><span class="line">   30 </span><span class="key">    let </span>pos = pos + ofs <span class="key">in
</span><span class="line">   31 </span><span class="key">    </span>String.unsafe_blit line pos num <span class="num">1 3</span>;
<span class="line">   32 </span>    <span class="key">let </span>pos = pos + ofs + <span class="num">4 </span><span class="key">in
</span><span class="line">   33 </span><span class="key">    </span>String.unsafe_blit line pos num <span class="num">6 3</span>;
<span class="line">   34 </span>    String.unsafe_blit line (pos + <span class="num">4</span>) num <span class="num">10 4</span>;
<span class="line">   35 </span>    <span class="key">if </span>must_print <span class="key">then </span>Printf.printf <span class="str">&quot;%d: %s</span><span class="esc">\n</span><span class="str">&quot;</span> !cnt num;
<span class="line">   36 </span>    incr cnt
<span class="line">   37 </span>  <span class="key">with </span>Not_found -&gt; ()
<span class="line">   38 </span>
<span class="line">   39 </span><span class="key">let </span>n = <span class="key">if </span>Array.length Sys.argv &gt; <span class="num">1 </span><span class="key">then </span>int_of_string Sys.argv.(<span class="num">1</span>) <span class="key">else
</span><span class="line">   40 </span><span class="key">        </span><span class="num">1</span>;;
<span class="line">   41 </span><span class="key">for </span>i = <span class="num">2 </span><span class="key">to </span>n <span class="key">do
</span><span class="line">   42 </span><span class="key">  </span>List.iter (check_phone (rflags []) (Array.create <span class="num">6 0</span>) (ref <span class="num">1</span>) <span class="key">false</span>)
<span class="line">   43 </span>             phones
<span class="line">   44 </span><span class="key">done</span>;
<span class="line">   45 </span>List.iter (check_phone (rflags []) (Array.create <span class="num">6 0</span>) (ref <span class="num">1</span>) <span class="key">true</span>) phones
</pre>
</body>
</html>
<!--HTML generated by highlight 2.0-24, http://www.andre-simon.de/-->
