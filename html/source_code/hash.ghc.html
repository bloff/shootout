<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
	<title>C:\Fulgham\Projects\shootout\bench\hash\hash.ghc</title>
	<link rel="stylesheet" type="text/css" href="highlight.css">
</head>
<body>
<pre><span class="line">    1 </span><span class="com">-- $Id: hash.ghc.html,v 1.1 2004-06-14 23:09:26 bfulgham Exp $
</span><span class="line">    2 </span><span class="com"></span><span class="com">-- http://www.bagley.org/~doug/shootout/
</span><span class="line">    3 </span><span class="com"></span><span class="com">-- from Bryn Keller
</span><span class="line">    4 </span><span class="com"></span><span class="com">-- build with ghc -O2 -package data hash.ghc
</span><span class="line">    5 </span><span class="com"></span>
<span class="line">    6 </span><span class="key">import </span>System (getArgs)
<span class="line">    7 </span><span class="key">import </span>FiniteMap
<span class="line">    8 </span><span class="key">import </span>Numeric (showInt)
<span class="line">    9 </span>
<span class="line">   10 </span>countKeys tbl <span class="num">0 </span>= <span class="num">0
</span><span class="line">   11 </span><span class="num"></span>countKeys tbl n = <span class="key">case </span>(lookupWithDefaultFM tbl <span class="key">False </span>(show n)) <span class="key">of
</span><span class="line">   12 </span><span class="key">                    True </span>-&gt; <span class="num">1 </span>+ countKeys tbl (n <span class="num">- 1</span>)
<span class="line">   13 </span>                    _    -&gt; countKeys tbl (n <span class="num">- 1</span>)
<span class="line">   14 </span>
<span class="line">   15 </span>buildTable tbl max num | num &lt;= max = buildTable (addToFM tbl (showHex num
<span class="line">   16 </span>                                <span class="str">&quot;&quot;</span>) <span class="key">True</span>) max (num + <span class="num">1</span>)
<span class="line">   17 </span>                       | otherwise = tbl
<span class="line">   18 </span>
<span class="line">   19 </span>showHex n r = <span class="key">let </span>(n<span class="str">',d) = quotRem n 16
</span><span class="line">   20 </span><span class="str">                  r'</span>     = toEnum (fromEnum <span class="str">'0'</span> + fromIntegral d) : r
<span class="line">   21 </span>                  <span class="key">in </span>if n<span class="str">' == 0 then r'</span> <span class="key">else </span>showHex n<span class="str">' r'</span>
<span class="line">   22 </span>
<span class="line">   23 </span>main = <span class="key">do  </span>args &lt;- getArgs
<span class="line">   24 </span>           <span class="key">case </span>args <span class="key">of
</span><span class="line">   25 </span><span class="key">            </span>[number] -&gt; <span class="key">let </span>num = read number
<span class="line">   26 </span>                            tbl = buildTable emptyFM num <span class="num">1
</span><span class="line">   27 </span><span class="num">                    </span><span class="key">in do </span>putStrLn $ show (countKeys tbl num)
<span class="line">   28 </span>            _        -&gt; fail <span class="str">&quot;You must enter a number.&quot;</span>
</pre>
</body>
</html>
<!--HTML generated by highlight 2.0-24, http://www.andre-simon.de/-->
