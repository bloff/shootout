<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
	<title>C:\Fulgham\Projects\shootout\bench\moments\moments.gnat</title>
	<link rel="stylesheet" type="text/css" href="highlight.css">
</head>
<body>
<pre><span class="line">    1 </span><span class="com">-- $Id: moments.gnat.html,v 1.1 2004-06-14 23:09:27 bfulgham Exp $
</span><span class="line">    2 </span><span class="com"></span><span class="com">-- http://dada.perl.it/shootout/
</span><span class="line">    3 </span><span class="com"></span><span class="com">-- Ada 95 code by C.C.
</span><span class="line">    4 </span><span class="com"></span>
<span class="line">    5 </span><span class="com">-- Annotated Ada Reference Manual ISO/IEC 8652:1995: http://www.ada-auth.
</span><span class="line">    6 </span><span class="com"></span>org/
<span class="line">    7 </span>
<span class="line">    8 </span><span class="key">with </span>System, Ada.Numerics.Generic_Elementary_Functions;
<span class="line">    9 </span><span class="key">with </span>Ada.Unchecked_Deallocation, Ada.Text_IO;
<span class="line">   10 </span>
<span class="line">   11 </span><span class="key">procedure </span>Moments <span class="key">is
</span><span class="line">   12 </span><span class="key">   type </span>Real <span class="key">is digits </span><span class="typ">Positive</span>'Max (<span class="num">15</span>, System.Max_Digits);
<span class="line">   13 </span>   <span class="key">package </span>AF <span class="key">is new
</span><span class="line">   14 </span><span class="key">         </span>Ada.Numerics.Generic_Elementary_Functions (Float_Type =&gt; Real);
<span class="line">   15 </span>   <span class="key">package </span>Io <span class="key">renames </span>Ada.Text_IO;
<span class="line">   16 </span>   <span class="key">package </span>Rio <span class="key">is new </span>Ada.Text_IO.Float_IO (Num =&gt; Real);
<span class="line">   17 </span>   <span class="key">procedure </span>Put (Item : Real; Fore : Io.Field := <span class="num">0</span>; Aft : Io.Field := <span class="num">6</span>;
<span class="line">   18 </span>                  Exp : Io.Field := <span class="num">0</span>) <span class="key">renames </span>Rio.Put;
<span class="line">   19 </span>
<span class="line">   20 </span>   <span class="key">generic
</span><span class="line">   21 </span><span class="key">       type </span>Item_Type <span class="key">is private</span>;      <span class="com">--  Component type of array to be
</span><span class="line">   22 </span><span class="com"></span>       sorted
<span class="line">   23 </span>       <span class="key">with function </span><span class="str">&quot;&lt;=&quot;</span> (X, Y : Item_Type) <span class="key">return </span><span class="typ">Boolean</span>;
<span class="line">   24 </span>       <span class="key">type </span>Sequence <span class="key">is array </span>(<span class="typ">Integer </span><span class="key">range </span>&lt;&gt;) <span class="key">of </span>Item_Type;
<span class="line">   25 </span>   <span class="key">package </span>Sort_Pkg <span class="key">is
</span><span class="line">   26 </span><span class="key">      procedure </span>Quick_Sort (S : <span class="key">in out </span>Sequence);
<span class="line">   27 </span>   <span class="key">end </span>Sort_Pkg;  <span class="com">--  Copied from Southampton Ada MPICH supercomputer
</span><span class="line">   28 </span><span class="com"></span>   bindings
<span class="line">   29 </span>
<span class="line">   30 </span>   <span class="key">package body </span>Sort_Pkg <span class="key">is
</span><span class="line">   31 </span><span class="key">      procedure </span>Quick_Sort (S : <span class="key">in out </span>Sequence) <span class="key">is
</span><span class="line">   32 </span><span class="key">         procedure </span>Sort_Recursive (Lwb, Upb : <span class="typ">Integer</span>) <span class="key">is
</span><span class="line">   33 </span><span class="key">            </span>Pivot    : Item_Type := S (Upb);
<span class="line">   34 </span>            Front    : <span class="typ">Integer </span>:= Lwb;
<span class="line">   35 </span>            Back     : <span class="typ">Integer </span>:= Upb;
<span class="line">   36 </span>            Temp     : Item_Type;
<span class="line">   37 </span>         <span class="key">begin
</span><span class="line">   38 </span><span class="key">            if </span>Lwb &lt; Upb <span class="key">then
</span><span class="line">   39 </span><span class="key">               while  </span>(Front &lt;= Back)  <span class="key">loop
</span><span class="line">   40 </span><span class="key">                  while not  </span>(Pivot &lt;= S (Front)) <span class="key">loop
</span><span class="line">   41 </span><span class="key">                     </span>Front := Front + <span class="num">1</span>;
<span class="line">   42 </span>                  <span class="key">end loop</span>;
<span class="line">   43 </span>                  <span class="key">while not  </span>(S (Back) &lt;= Pivot) <span class="key">loop
</span><span class="line">   44 </span><span class="key">                     </span>Back := Back <span class="num">- 1</span>;
<span class="line">   45 </span>                  <span class="key">end loop</span>;
<span class="line">   46 </span>                  <span class="key">if </span>Front &lt;= Back <span class="key">then
</span><span class="line">   47 </span><span class="key">                     </span>Temp := S (Front);
<span class="line">   48 </span>                     S (Front) := S (Back);
<span class="line">   49 </span>                     S (Back) := Temp;
<span class="line">   50 </span>                     Front := Front + <span class="num">1</span>;
<span class="line">   51 </span>                     Back  := Back <span class="num">- 1</span>;
<span class="line">   52 </span>                  <span class="key">end if</span>;
<span class="line">   53 </span>               <span class="key">end loop</span>;
<span class="line">   54 </span>               Sort_Recursive (Lwb, Back);
<span class="line">   55 </span>               Sort_Recursive (Front, Upb);
<span class="line">   56 </span>            <span class="key">end if</span>;
<span class="line">   57 </span>         <span class="key">end </span>Sort_Recursive;
<span class="line">   58 </span>      <span class="key">begin
</span><span class="line">   59 </span><span class="key">         </span>Sort_Recursive (S'First, S'Last);
<span class="line">   60 </span>      <span class="key">end </span>Quick_Sort;
<span class="line">   61 </span>   <span class="key">end </span>Sort_Pkg;
<span class="line">   62 </span>
<span class="line">   63 </span>   <span class="key">type </span>Real_Array <span class="key">is array </span>(<span class="typ">Integer </span><span class="key">range </span>&lt;&gt;) <span class="key">of </span>Real;
<span class="line">   64 </span>   <span class="key">type </span>Real_Array_Ptr <span class="key">is access </span>Real_Array;
<span class="line">   65 </span>   <span class="key">procedure </span>Deallocate_Real_Array <span class="key">is new </span>Ada.Unchecked_Deallocation (
<span class="line">   66 </span>
<span class="line">   67 </span>                  Object =&gt; Real_Array, Name =&gt; Real_Array_Ptr);
<span class="line">   68 </span>   <span class="key">package </span>Sort <span class="key">is new </span>Sort_Pkg (Real, <span class="str">&quot;&lt;=&quot;</span> =&gt; <span class="str">&quot;&lt;=&quot;</span>, Sequence =&gt;
<span class="line">   69 </span>                                 Real_Array);
<span class="line">   70 </span>
<span class="line">   71 </span>   Data           : Real_Array_Ptr := <span class="key">new </span>Real_Array (<span class="num">1 </span>.. <span class="num">0</span>);
<span class="line">   72 </span>   Temp_Array     : Real_Array_Ptr;
<span class="line">   73 </span>   Dev, D_2, Mean, Median     : Real;
<span class="line">   74 </span>   Standard_Deviation         : Real;
<span class="line">   75 </span>   Sum, Avg_Abs_Deviation     : Real := <span class="num">0.0</span>;
<span class="line">   76 </span>   Variance, Skew, Kurtosis   : Real := <span class="num">0.0</span>;
<span class="line">   77 </span>   M              : <span class="typ">Natural </span>:= <span class="num">0</span>;
<span class="line">   78 </span><span class="key">begin
</span><span class="line">   79 </span><span class="key">   while not </span>Io.End_Of_File <span class="key">loop
</span><span class="line">   80 </span><span class="key">      </span>M := M + <span class="num">1</span>;
<span class="line">   81 </span>      <span class="key">if </span>M &gt; Data'Last <span class="key">then                  </span><span class="com">--  Lengthen array of strings
</span><span class="line">   82 </span><span class="com"></span>         Temp_Array := <span class="key">new </span>Real_Array (
<span class="line">   83 </span>                        <span class="num">1 </span>.. <span class="num">4 </span>+ <span class="typ">Positive </span>(Real'Ceiling (<span class="num">1.70 </span>* Real (M))))
<span class="line">   84 </span>                                           ;
<span class="line">   85 </span>         Temp_Array (Data'<span class="key">Range</span>) := Data.<span class="key">all</span>;
<span class="line">   86 </span>         Deallocate_Real_Array (Data);
<span class="line">   87 </span>         Data := Temp_Array;     <span class="com">--  Replace the old array with the new
</span><span class="line">   88 </span><span class="com"></span>                 one
<span class="line">   89 </span>      <span class="key">end if</span>;
<span class="line">   90 </span>      Rio.Get (Item =&gt; Data (M));      <span class="com">-- Read  numbers between whitespace
</span><span class="line">   91 </span><span class="com"></span>      Sum := Sum + Data (M);
<span class="line">   92 </span>   <span class="key">end loop</span>;
<span class="line">   93 </span>   Mean := Sum / Real (M);
<span class="line">   94 </span>   <span class="key">for </span>K <span class="key">in </span><span class="num">1 </span>.. M <span class="key">loop
</span><span class="line">   95 </span><span class="key">      </span>Dev := Data (K) - Mean;
<span class="line">   96 </span>      Avg_Abs_Deviation := Avg_Abs_Deviation + <span class="key">abs </span>Dev;
<span class="line">   97 </span>      D_2 := Dev * Dev;
<span class="line">   98 </span>      Variance := Variance + D_2;
<span class="line">   99 </span>      Skew := Skew + (D_2 * Dev);
<span class="line">  100 </span>      Kurtosis := Kurtosis + (D_2 * D_2);
<span class="line">  101 </span>   <span class="key">end loop</span>;
<span class="line">  102 </span>   Avg_Abs_Deviation := Avg_Abs_Deviation / Real (M);
<span class="line">  103 </span>   Variance := Variance / Real (M <span class="num">- 1</span>);
<span class="line">  104 </span>   Standard_Deviation := AF.Sqrt (Variance);
<span class="line">  105 </span>   <span class="key">if </span>Variance &lt; <span class="num">10.0 </span>* Real'Model_Epsilon <span class="key">then
</span><span class="line">  106 </span><span class="key">      </span>Io.Put_Line (<span class="str">&quot;&gt; Reduced accuracy results: 0 = ((Variance/10 + 1) - 1)
</span><span class="line">  107 </span><span class="str">                   &quot;</span>);
<span class="line">  108 </span>   <span class="key">else
</span><span class="line">  109 </span><span class="key">      </span>Skew := Skew / (Real (M) * Variance * Standard_Deviation);
<span class="line">  110 </span>      Kurtosis := <span class="num">-3.0 </span>+ Kurtosis / (Real (M) * Variance * Variance);
<span class="line">  111 </span>   <span class="key">end if</span>;
<span class="line">  112 </span>   Sort.Quick_Sort (S =&gt; Data (<span class="num">1 </span>.. M));
<span class="line">  113 </span>   <span class="key">if </span><span class="num">1 </span>= (M <span class="key">mod </span><span class="num">2</span>) <span class="key">then
</span><span class="line">  114 </span><span class="key">      </span>Median := Data ((M + <span class="num">1</span>) / <span class="num">2</span>);
<span class="line">  115 </span>   <span class="key">else
</span><span class="line">  116 </span><span class="key">      </span>Median := (Data (M / <span class="num">2</span>) + Data (<span class="num">1 </span>+ M / <span class="num">2</span>)) / <span class="num">2.0</span>;
<span class="line">  117 </span>   <span class="key">end if</span>;
<span class="line">  118 </span>   Io.Put_Line (<span class="str">&quot;n:                 &quot;</span> &amp; <span class="typ">Integer</span>'Image (M));
<span class="line">  119 </span>   Io.Put (<span class="str">&quot;median:             &quot;</span>); Put (Median);              Io.New_Line;
<span class="line">  120 </span>   Io.Put (<span class="str">&quot;mean:               &quot;</span>); Put (Mean);                Io.New_Line;
<span class="line">  121 </span>   Io.Put (<span class="str">&quot;average_deviation:  &quot;</span>); Put (Avg_Abs_Deviation);   Io.New_Line;
<span class="line">  122 </span>   Io.Put (<span class="str">&quot;standard_deviation: &quot;</span>); Put (Standard_Deviation);  Io.New_Line;
<span class="line">  123 </span>   Io.Put (<span class="str">&quot;variance:           &quot;</span>); Put (Variance);            Io.New_Line;
<span class="line">  124 </span>   Io.Put (<span class="str">&quot;skew:               &quot;</span>); Put (Skew);                Io.New_Line;
<span class="line">  125 </span>   Io.Put (<span class="str">&quot;kurtosis:           &quot;</span>); Put (Kurtosis);            Io.New_Line;
<span class="line">  126 </span><span class="key">end </span>Moments;
<span class="line">  127 </span>
</pre>
</body>
</html>
<!--HTML generated by highlight 2.0-24, http://www.andre-simon.de/-->
