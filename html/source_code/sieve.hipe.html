<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
	<title>C:\Fulgham\Projects\shootout\bench\sieve\sieve.hipe</title>
	<link rel="stylesheet" type="text/css" href="highlight.css">
</head>
<body>
<pre><span class="line">    1 </span><span class="com">%%% -*- mode: erlang -*-
</span><span class="line">    2 </span><span class="com"></span><span class="com">%%% $Id: sieve.hipe.html,v 1.1 2004-06-14 23:09:28 bfulgham Exp $
</span><span class="line">    3 </span><span class="com"></span><span class="com">%%% http://www.bagley.org/~doug/shootout/
</span><span class="line">    4 </span><span class="com"></span>
<span class="line">    5 </span>-module(sieve).
<span class="line">    6 </span>-export([main/0, main/1]).
<span class="line">    7 </span>-import(io, [fwrite/2]).
<span class="line">    8 </span>-import(lists, [seq/2]).
<span class="line">    9 </span>-import(math, [sqrt/1]).
<span class="line">   10 </span>
<span class="line">   11 </span><span class="com">%% get the program argument, which is how many test iterations
</span><span class="line">   12 </span><span class="com"></span><span class="com">%% to run
</span><span class="line">   13 </span><span class="com"></span>main() -&gt; main([<span class="str">'1'</span>]).
<span class="line">   14 </span>main(Arg) -&gt;
<span class="line">   15 </span>    [Tmp] = Arg,
<span class="line">   16 </span>    Num = list_to_integer(atom_to_list(Tmp)),
<span class="line">   17 </span>    test(Num),
<span class="line">   18 </span>    halt(0).
<span class="line">   19 </span>
<span class="line">   20 </span>test(N) -&gt;
<span class="line">   21 </span>    Primes = primes(8192),
<span class="line">   22 </span>    Count = length(Primes),
<span class="line">   23 </span>    <span class="key">case </span>N &gt; <span class="num">1 </span><span class="key">of
</span><span class="line">   24 </span><span class="key">    </span>true  -&gt; test(N-1);
<span class="line">   25 </span>    false -&gt; fwrite(<span class="str">&quot;Count: ~w</span><span class="esc">\n</span><span class="str">&quot;</span>, [Count])
<span class="line">   26 </span>    <span class="key">end</span>.
<span class="line">   27 </span>
<span class="line">   28 </span>primes(Size) -&gt;
<span class="line">   29 </span>    era(sqrt(Size), seq(2,Size)).
<span class="line">   30 </span>
<span class="line">   31 </span>
<span class="line">   32 </span><span class="com">%% modified from Maurice Castro's original (below), sped it up
</span><span class="line">   33 </span><span class="com"></span><span class="com">%% a fraction by reordering clauses and args, but if it's less
</span><span class="line">   34 </span><span class="com"></span><span class="com">%% clear now, that's my fault.
</span><span class="line">   35 </span><span class="com"></span><span class="com">%% -Doug
</span><span class="line">   36 </span><span class="com"></span>
<span class="line">   37 </span>era(Max, [H|T]) <span class="key">when </span>H =&lt; Max -&gt;
<span class="line">   38 </span>    [H | era(Max, sieve([H|T], H))];
<span class="line">   39 </span>era(Max, L) -&gt;
<span class="line">   40 </span>    L.
<span class="line">   41 </span>
<span class="line">   42 </span>sieve([H|T], N) <span class="key">when </span>H rem N =/= <span class="num">0 </span>-&gt;
<span class="line">   43 </span>    [H | sieve(T, N)];
<span class="line">   44 </span>sieve([H|T], N) -&gt;
<span class="line">   45 </span>    sieve(T, N);
<span class="line">   46 </span>sieve([], N) -&gt;
<span class="line">   47 </span>    [].
<span class="line">   48 </span>
<span class="line">   49 </span>
<span class="line">   50 </span><span class="com">%%% eratosthenes algorithm from Maurice Castro, with permission,
</span><span class="line">   51 </span><span class="com"></span><span class="com">%%% from his book, _Erlang in Real Time_, ISBN: 0864447434
</span><span class="line">   52 </span><span class="com"></span><span class="com">%%% http://www.serc.rmit.edu.au/~maurice/erlbk/eg/choice/erasto.erl
</span><span class="line">   53 </span><span class="com"></span><span class="com">%
</span><span class="line">   54 </span><span class="com"></span><span class="com">%era(Max, L) when hd(L) =&lt; Max -&gt;
</span><span class="line">   55 </span><span class="com"></span><span class="com">%    Prime = hd(L),
</span><span class="line">   56 </span><span class="com"></span><span class="com">%    [Prime | era(Max, sieve(Prime, L))];
</span><span class="line">   57 </span><span class="com"></span><span class="com">%era(Max, L) -&gt;
</span><span class="line">   58 </span><span class="com"></span><span class="com">%    L.
</span><span class="line">   59 </span><span class="com"></span><span class="com">%
</span><span class="line">   60 </span><span class="com"></span><span class="com">%sieve(N, []) -&gt;
</span><span class="line">   61 </span><span class="com"></span><span class="com">%    [];
</span><span class="line">   62 </span><span class="com"></span><span class="com">%sieve(N, [H|T]) when H rem N == 0 -&gt;
</span><span class="line">   63 </span><span class="com"></span><span class="com">%    sieve(N, T);
</span><span class="line">   64 </span><span class="com"></span><span class="com">%sieve(N, [H|T]) -&gt;
</span><span class="line">   65 </span><span class="com"></span><span class="com">%    [H | sieve(N, T)].</span>
</pre>
</body>
</html>
<!--HTML generated by highlight 2.0-24, http://www.andre-simon.de/-->
