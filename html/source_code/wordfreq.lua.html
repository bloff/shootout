<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
	<title>C:\Fulgham\Projects\shootout\bench\wordfreq\wordfreq.lua</title>
	<link rel="stylesheet" type="text/css" href="highlight.css">
</head>
<body>
<pre><span class="line">    1 </span><span class="com">-- $Id: wordfreq.lua.html,v 1.1 2004-06-14 23:09:29 bfulgham Exp $
</span><span class="line">    2 </span><span class="com"></span><span class="com">-- http://shootout.alioth.debian.org
</span><span class="line">    3 </span><span class="com"></span><span class="com">-- contributed by Roberto Ierusalimschy
</span><span class="line">    4 </span><span class="com"></span>
<span class="line">    5 </span><span class="com">-- this version reads 4K chunks of input at a time
</span><span class="line">    6 </span><span class="com"></span>
<span class="line">    7 </span><span class="key">local </span>words = {}   <span class="com">-- list of all words (for sorting)
</span><span class="line">    8 </span><span class="com"></span><span class="key">local </span>count = {}   <span class="com">-- count occurrences of each word
</span><span class="line">    9 </span><span class="com"></span>
<span class="line">   10 </span><span class="key">local </span>BUFSIZE = <span class="num">2</span>^<span class="num">12
</span><span class="line">   11 </span><span class="num">
</span><span class="line">   12 </span><span class="num"></span><span class="key">while </span>true <span class="key">do
</span><span class="line">   13 </span><span class="key">  local </span>lines, rest = io.read(BUFSIZE, <span class="str">&quot;*l&quot;</span>)
<span class="line">   14 </span>  <span class="key">if </span>lines == <span class="key">nil then break end
</span><span class="line">   15 </span><span class="key">  </span>lines = lines..(rest <span class="key">or </span><span class="str">''</span>)    <span class="com">-- ensures whole lines
</span><span class="line">   16 </span><span class="com"></span>  <span class="key">for </span>w <span class="key">in </span><span class="typ">string</span>.gfind(string.lower(lines), <span class="str">&quot;(%l+)&quot;</span>) <span class="key">do
</span><span class="line">   17 </span><span class="key">    local </span>cw = count[w]
<span class="line">   18 </span>    <span class="key">if not </span>cw <span class="key">then     </span><span class="com">-- first occurrence?
</span><span class="line">   19 </span><span class="com"></span>      cw = <span class="num">0
</span><span class="line">   20 </span><span class="num">      </span>table.insert(words, w)
<span class="line">   21 </span>    <span class="key">end
</span><span class="line">   22 </span><span class="key">    </span>count[w] = cw + <span class="num">1
</span><span class="line">   23 </span><span class="num">  </span><span class="key">end
</span><span class="line">   24 </span><span class="key">end
</span><span class="line">   25 </span><span class="key">
</span><span class="line">   26 </span><span class="key"></span>table.sort(words, <span class="key">function </span>(a,b)
<span class="line">   27 </span>  <span class="key">return  </span>count[a] &gt; count[b]  <span class="key">or </span>(count[a] == count[b] <span class="key">and </span>a &gt; b)
<span class="line">   28 </span><span class="key">end</span>)
<span class="line">   29 </span>
<span class="line">   30 </span><span class="key">for </span>i=<span class="num">1</span>,table.getn(words) <span class="key">do
</span><span class="line">   31 </span><span class="key">  local </span>w = words[i]
<span class="line">   32 </span>  io.write(string.format(<span class="str">&quot;%7d\t%s\n&quot;</span>, count[w], w))
<span class="line">   33 </span><span class="key">end
</span><span class="line">   34 </span><span class="key"></span>
</pre>
</body>
</html>
<!--HTML generated by highlight 2.0-24, http://www.andre-simon.de/-->
