<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
	<title>C:\Fulgham\Projects\shootout\bench\wc\wc.gnat</title>
	<link rel="stylesheet" type="text/css" href="highlight.css">
</head>
<body>
<pre><span class="line">    1 </span><span class="com">-- $Id: wc.gnat.html,v 1.1 2004-06-14 23:09:29 bfulgham Exp $
</span><span class="line">    2 </span><span class="com"></span><span class="com">-- http://dada.perl.it/shootout/
</span><span class="line">    3 </span><span class="com"></span><span class="com">-- Ada 95 code by C.C.
</span><span class="line">    4 </span><span class="com"></span>
<span class="line">    5 </span><span class="com">-- Annotated Ada Reference Manual ISO/IEC 8652:1995: http://www.ada-auth.
</span><span class="line">    6 </span><span class="com"></span>org/
<span class="line">    7 </span>
<span class="line">    8 </span><span class="key">with </span>Interfaces.C, System, Ada.Strings.Fixed, Ada.Text_IO;
<span class="line">    9 </span>
<span class="line">   10 </span><span class="key">procedure </span>Wc <span class="key">is
</span><span class="line">   11 </span><span class="key">   package </span>IC <span class="key">renames </span>Interfaces.C;
<span class="line">   12 </span>   <span class="key">function </span>L_Trim (Source : <span class="typ">String</span>; Side : Ada.Strings.Trim_End :=
<span class="line">   13 </span>               Ada.Strings.Left) <span class="key">return </span><span class="typ">String </span><span class="key">renames </span>Ada.Strings.Fixed.
<span class="line">   14 </span>               Trim;
<span class="line">   15 </span>
<span class="line">   16 </span>   <span class="key">package </span>Io <span class="key">is
</span><span class="line">   17 </span><span class="key">      type </span>File_Descriptor <span class="key">is new </span>IC.int;       <span class="com">--  STDIN=0, STDOUT=1,
</span><span class="line">   18 </span><span class="com"></span>                                                          STDERR=<span class="num">2
</span><span class="line">   19 </span><span class="num">      </span><span class="key">type </span>Setmode_Flag <span class="key">is new </span>IC.int;
<span class="line">   20 </span>      STDIN       : <span class="key">constant </span>File_Descriptor := <span class="num">0</span>;
<span class="line">   21 </span>      O_BINARY    : <span class="key">constant </span>Setmode_Flag := <span class="num">16</span>#<span class="num">8000</span>#;
<span class="line">   22 </span>
<span class="line">   23 </span>      <span class="key">function </span>C_Setmode (
<span class="line">   24 </span>               FD       : File_Descriptor;
<span class="line">   25 </span>               Mode     : Setmode_Flag)
<span class="line">   26 </span>            <span class="key">return </span>IC.int;
<span class="line">   27 </span>
<span class="line">   28 </span>      <span class="key">function </span>C_Sysread (
<span class="line">   29 </span>               FD       : File_Descriptor;
<span class="line">   30 </span>               Buf      : System.Address;
<span class="line">   31 </span>               NByte    : IC.int)
<span class="line">   32 </span>            <span class="key">return </span>IC.int;
<span class="line">   33 </span><span class="com">--   private
</span><span class="line">   34 </span><span class="com"></span><span class="com">--      pragma Import (C, C_Setmode, &quot;_setmode&quot;);          --  Microsoft
</span><span class="line">   35 </span><span class="com"></span>                       Windows
<span class="line">   36 </span><span class="com">--      pragma Import (C, C_Sysread, &quot;_read&quot;);
</span><span class="line">   37 </span><span class="com"></span>   <span class="key">end </span>Io;
<span class="line">   38 </span>
<span class="line">   39 </span>   Buffer      : <span class="typ">String </span>(<span class="num">1 </span>.. <span class="num">4 </span>* <span class="num">1024</span>);
<span class="line">   40 </span>   NL, NW, NC  : <span class="typ">Natural </span>:= <span class="num">0</span>;
<span class="line">   41 </span>   Inside_Word : <span class="typ">Boolean </span>:= False;
<span class="line">   42 </span>   C           : <span class="typ">Character</span>;
<span class="line">   43 </span>   Last, R     : <span class="typ">Integer</span>;
<span class="line">   44 </span><span class="key">begin
</span><span class="line">   45 </span><span class="key">   </span>R := <span class="typ">Integer </span>(Io.C_Setmode (Io.STDIN, Io.O_BINARY));  <span class="com">--  Read CR,LF
</span><span class="line">   46 </span><span class="com"></span>        right
<span class="line">   47 </span>   <span class="key">loop
</span><span class="line">   48 </span><span class="key">      </span>Last := <span class="typ">Integer </span>(Io.C_Sysread (FD =&gt; Io.STDIN,
<span class="line">   49 </span>                  Buf =&gt; Buffer (<span class="num">1</span>)'Address, NByte =&gt; Buffer'Length));
<span class="line">   50 </span>      <span class="key">exit when </span>Last &lt;= <span class="num">0</span>;
<span class="line">   51 </span>      NC := NC + Last;
<span class="line">   52 </span>      <span class="key">for </span>K <span class="key">in </span>Buffer'First .. Last <span class="key">loop
</span><span class="line">   53 </span><span class="key">         </span>C := Buffer (K);
<span class="line">   54 </span>         <span class="key">if </span>C = ASCII.LF <span class="key">then
</span><span class="line">   55 </span><span class="key">            </span>NL := NL + <span class="num">1</span>;
<span class="line">   56 </span>         <span class="key">end if</span>;
<span class="line">   57 </span>         <span class="key">if </span>C = ' ' <span class="key">or </span>C = ASCII.CR <span class="key">or </span>C = ASCII.LF <span class="key">or </span>C = ASCII.HT <span class="key">then
</span><span class="line">   58 </span><span class="key">            </span>Inside_Word := False;
<span class="line">   59 </span>         <span class="key">elsif not </span>Inside_Word <span class="key">then
</span><span class="line">   60 </span><span class="key">            </span>Inside_Word := True;
<span class="line">   61 </span>            NW := NW + <span class="num">1</span>;
<span class="line">   62 </span>         <span class="key">end if</span>;
<span class="line">   63 </span>      <span class="key">end loop</span>;
<span class="line">   64 </span>   <span class="key">end loop</span>;
<span class="line">   65 </span>   Ada.Text_IO.Put_Line (L_Trim (<span class="typ">Natural</span>'Image (NL)) &amp; <span class="typ">Natural</span>'Image (NW)
<span class="line">   66 </span>                         &amp;
<span class="line">   67 </span>            <span class="typ">Natural</span>'Image (NC));
<span class="line">   68 </span><span class="key">end </span>Wc;
<span class="line">   69 </span>   <span class="com">--  The &quot;Ada.Streams.Stream_IO.Read (File, Item, Last)&quot; procedure can't
</span><span class="line">   70 </span><span class="com"></span>   <span class="com">--  read from STDIN: can't associate Standard Input with File parameter.
</span><span class="line">   71 </span><span class="com"></span>   <span class="com">--  GNAT's Interfaces.C_Streams.fread function isn't from ISO/IEC 8652:
</span><span class="line">   72 </span><span class="com"></span>   <span class="num">1995</span>.
</pre>
</body>
</html>
<!--HTML generated by highlight 2.0-24, http://www.andre-simon.de/-->
